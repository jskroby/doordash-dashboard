"use strict";var f=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var te=f(Dt=>{"use strict";Object.defineProperty(Dt,"__esModule",{value:!0});Dt.LibsqlError=void 0;var ts=class extends Error{code;rawCode;constructor(e,r,s,n){r!==void 0&&(e=`${r}: ${e}`),super(e,{cause:n}),this.code=r,this.rawCode=s,this.name="LibsqlError"}};Dt.LibsqlError=ts});var $t=f(Ve=>{"use strict";Object.defineProperty(Ve,"__esModule",{value:!0});Ve.encodeBaseUrl=Ve.parseUri=void 0;var Ft=te();function nu(t){let e=iu.exec(t);if(e===null)throw new Ft.LibsqlError(`The URL '${t}' is not in a valid format`,"URL_INVALID");let r=e.groups,s=r.scheme,n=r.authority!==void 0?ou(r.authority):void 0,i=Pe(r.path),o=r.query!==void 0?uu(r.query):void 0,a=r.fragment!==void 0?Pe(r.fragment):void 0;return{scheme:s,authority:n,path:i,query:o,fragment:a}}Ve.parseUri=nu;var iu=(()=>{let t="(?<scheme>[A-Za-z][A-Za-z.+-]*)",e="(?<authority>[^/?#]*)",r="(?<path>[^?#]*)",s="(?<query>[^#]*)",n="(?<fragment>.*)";return new RegExp(`^${t}:(//${e})?${r}(\\?${s})?(#${n})?$`,"su")})();function ou(t){let e=au.exec(t);if(e===null)throw new Ft.LibsqlError("The authority part of the URL is not in a valid format","URL_INVALID");let r=e.groups,s=Pe(r.host_br??r.host),n=r.port?parseInt(r.port,10):void 0,i=r.username!==void 0?{username:Pe(r.username),password:r.password!==void 0?Pe(r.password):void 0}:void 0;return{host:s,port:n,userinfo:i}}var au=new RegExp("^((?<username>[^:]*)(:(?<password>.*))?@)?((?<host>[^:\\[\\]]*)|(\\[(?<host_br>[^\\[\\]]*)\\]))(:(?<port>[0-9]*))?$","su");function uu(t){let e=t.split("&"),r=[];for(let s of e){if(s==="")continue;let n,i,o=s.indexOf("=");o<0?(n=s,i=""):(n=s.substring(0,o),i=s.substring(o+1)),r.push({key:Pe(n.replaceAll("+"," ")),value:Pe(i.replaceAll("+"," "))})}return{pairs:r}}function Pe(t){try{return decodeURIComponent(t)}catch(e){throw e instanceof URIError?new Ft.LibsqlError(`URL component has invalid percent encoding: ${e}`,"URL_INVALID",void 0,e):e}}function cu(t,e,r){if(e===void 0)throw new Ft.LibsqlError(`URL with scheme ${JSON.stringify(t+":")} requires authority (the "//" part)`,"URL_INVALID");let s=`${t}:`,n=lu(e.host),i=fu(e.port),a=`//${hu(e.userinfo)}${n}${i}`,u=r.split("/").map(encodeURIComponent).join("/");return u!==""&&!u.startsWith("/")&&(u="/"+u),new URL(`${s}${a}${u}`)}Ve.encodeBaseUrl=cu;function lu(t){return t.includes(":")?`[${encodeURI(t)}]`:encodeURI(t)}function fu(t){return t!==void 0?`:${t}`:""}function hu(t){if(t===void 0)return"";let e=encodeURIComponent(t.username),r=t.password!==void 0?`:${encodeURIComponent(t.password)}`:"";return`${e}${r}@`}});var Wt=f((rs,ss)=>{(function(t,e){typeof rs=="object"&&typeof ss<"u"?ss.exports=e():typeof define=="function"&&define.amd?define(e):function(){var r=t.Base64,s=e();s.noConflict=function(){return t.Base64=r,s},t.Meteor&&(Base64=s),t.Base64=s}()})(typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:rs,function(){"use strict";var t="3.7.7",e=t,r=typeof Buffer=="function",s=typeof TextDecoder=="function"?new TextDecoder:void 0,n=typeof TextEncoder=="function"?new TextEncoder:void 0,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o=Array.prototype.slice.call(i),a=function(l){var p={};return l.forEach(function(B,G){return p[B]=G}),p}(o),u=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,c=String.fromCharCode.bind(String),h=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):function(l){return new Uint8Array(Array.prototype.slice.call(l,0))},d=function(l){return l.replace(/=/g,"").replace(/[+\/]/g,function(p){return p=="+"?"-":"_"})},b=function(l){return l.replace(/[^A-Za-z0-9\+\/]/g,"")},S=function(l){for(var p,B,G,Oe,de="",es=l.length%3,kt=0;kt<l.length;){if((B=l.charCodeAt(kt++))>255||(G=l.charCodeAt(kt++))>255||(Oe=l.charCodeAt(kt++))>255)throw new TypeError("invalid character found");p=B<<16|G<<8|Oe,de+=o[p>>18&63]+o[p>>12&63]+o[p>>6&63]+o[p&63]}return es?de.slice(0,es-3)+"===".substring(es):de},y=typeof btoa=="function"?function(l){return btoa(l)}:r?function(l){return Buffer.from(l,"binary").toString("base64")}:S,_=r?function(l){return Buffer.from(l).toString("base64")}:function(l){for(var p=4096,B=[],G=0,Oe=l.length;G<Oe;G+=p)B.push(c.apply(null,l.subarray(G,G+p)));return y(B.join(""))},g=function(l,p){return p===void 0&&(p=!1),p?d(_(l)):_(l)},N=function(l){if(l.length<2){var p=l.charCodeAt(0);return p<128?l:p<2048?c(192|p>>>6)+c(128|p&63):c(224|p>>>12&15)+c(128|p>>>6&63)+c(128|p&63)}else{var p=65536+(l.charCodeAt(0)-55296)*1024+(l.charCodeAt(1)-56320);return c(240|p>>>18&7)+c(128|p>>>12&63)+c(128|p>>>6&63)+c(128|p&63)}},fe=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,mt=function(l){return l.replace(fe,N)},he=r?function(l){return Buffer.from(l,"utf8").toString("base64")}:n?function(l){return _(n.encode(l))}:function(l){return y(mt(l))},H=function(l,p){return p===void 0&&(p=!1),p?d(he(l)):he(l)},bt=function(l){return H(l,!0)},wt=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,Ut=function(l){switch(l.length){case 4:var p=(7&l.charCodeAt(0))<<18|(63&l.charCodeAt(1))<<12|(63&l.charCodeAt(2))<<6|63&l.charCodeAt(3),B=p-65536;return c((B>>>10)+55296)+c((B&1023)+56320);case 3:return c((15&l.charCodeAt(0))<<12|(63&l.charCodeAt(1))<<6|63&l.charCodeAt(2));default:return c((31&l.charCodeAt(0))<<6|63&l.charCodeAt(1))}},We=function(l){return l.replace(wt,Ut)},Nt=function(l){if(l=l.replace(/\s+/g,""),!u.test(l))throw new TypeError("malformed base64.");l+="==".slice(2-(l.length&3));for(var p,B="",G,Oe,de=0;de<l.length;)p=a[l.charAt(de++)]<<18|a[l.charAt(de++)]<<12|(G=a[l.charAt(de++)])<<6|(Oe=a[l.charAt(de++)]),B+=G===64?c(p>>16&255):Oe===64?c(p>>16&255,p>>8&255):c(p>>16&255,p>>8&255,p&255);return B},Xr=typeof atob=="function"?function(l){return atob(b(l))}:r?function(l){return Buffer.from(l,"base64").toString("binary")}:Nt,Vn=r?function(l){return h(Buffer.from(l,"base64"))}:function(l){return h(Xr(l).split("").map(function(p){return p.charCodeAt(0)}))},Hn=function(l){return Vn(Gn(l))},tu=r?function(l){return Buffer.from(l,"base64").toString("utf8")}:s?function(l){return s.decode(Vn(l))}:function(l){return We(Xr(l))},Gn=function(l){return b(l.replace(/[-_]/g,function(p){return p=="-"?"+":"/"}))},Zr=function(l){return tu(Gn(l))},ru=function(l){if(typeof l!="string")return!1;var p=l.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(p)||!/[^\s0-9a-zA-Z\-_]/.test(p)},zn=function(l){return{value:l,enumerable:!1,writable:!0,configurable:!0}},Jn=function(){var l=function(p,B){return Object.defineProperty(String.prototype,p,zn(B))};l("fromBase64",function(){return Zr(this)}),l("toBase64",function(p){return H(this,p)}),l("toBase64URI",function(){return H(this,!0)}),l("toBase64URL",function(){return H(this,!0)}),l("toUint8Array",function(){return Hn(this)})},Kn=function(){var l=function(p,B){return Object.defineProperty(Uint8Array.prototype,p,zn(B))};l("toBase64",function(p){return g(this,p)}),l("toBase64URI",function(){return g(this,!0)}),l("toBase64URL",function(){return g(this,!0)})},su=function(){Jn(),Kn()},gt={version:t,VERSION:e,atob:Xr,atobPolyfill:Nt,btoa:y,btoaPolyfill:S,fromBase64:Zr,toBase64:H,encode:H,encodeURI:bt,encodeURL:bt,utob:mt,btou:We,decode:Zr,isValid:ru,fromUint8Array:g,toUint8Array:Hn,extendString:Jn,extendUint8Array:Kn,extendBuiltins:su};return gt.Base64={},Object.keys(gt).forEach(function(l){return gt.Base64[l]=gt[l]}),gt})});var He=f(Se=>{"use strict";Object.defineProperty(Se,"__esModule",{value:!0});Se.ResultSetImpl=Se.transactionModeToBegin=Se.supportedUrlLink=void 0;var du=Wt();Se.supportedUrlLink="https://github.com/libsql/libsql-client-ts#supported-urls";function pu(t){if(t==="write")return"BEGIN IMMEDIATE";if(t==="read")return"BEGIN TRANSACTION READONLY";if(t==="deferred")return"BEGIN DEFERRED";throw RangeError('Unknown transaction mode, supported values are "write", "read" and "deferred"')}Se.transactionModeToBegin=pu;var ns=class{columns;columnTypes;rows;rowsAffected;lastInsertRowid;constructor(e,r,s,n,i){this.columns=e,this.columnTypes=r,this.rows=s,this.rowsAffected=n,this.lastInsertRowid=i}toJSON(){return{columns:this.columns,columnTypes:this.columnTypes,rows:this.rows.map(_u),rowsAffected:this.rowsAffected,lastInsertRowid:this.lastInsertRowid!==void 0?""+this.lastInsertRowid:null}}};Se.ResultSetImpl=ns;function _u(t){return Array.prototype.map.call(t,yu)}function yu(t){return typeof t=="bigint"?""+t:t instanceof ArrayBuffer?du.Base64.fromUint8Array(new Uint8Array(t)):t}});var Et=f(Ge=>{"use strict";Object.defineProperty(Ge,"__esModule",{value:!0});Ge.expandConfig=Ge.isInMemoryConfig=void 0;var St=te(),mu=$t(),bu=He(),Yn=":memory:";function wu(t){return t.scheme==="file"&&(t.path===":memory:"||t.path.startsWith(":memory:?"))}Ge.isInMemoryConfig=wu;function gu(t,e){if(typeof t!="object")throw new TypeError(`Expected client configuration as object, got ${typeof t}`);let{url:r,authToken:s,tls:n,intMode:i,concurrency:o}=t;o=Math.max(0,o||20),i??="number";let a=[];r===Yn&&(r="file::memory:");let u=(0,mu.parseUri)(r),c=u.scheme.toLowerCase(),h=c==="file"&&u.path===Yn&&u.authority===void 0,d;h?d={cache:{values:["shared","private"],update:(_,g)=>a.push(`${_}=${g}`)}}:d={tls:{values:["0","1"],update:(_,g)=>n=g==="1"},authToken:{update:(_,g)=>s=g}};for(let{key:_,value:g}of u.query?.pairs??[]){if(!Object.hasOwn(d,_))throw new St.LibsqlError(`Unsupported URL query parameter ${JSON.stringify(_)}`,"URL_PARAM_NOT_SUPPORTED");let N=d[_];if(N.values!==void 0&&!N.values.includes(g))throw new St.LibsqlError(`Unknown value for the "${_}" query argument: ${JSON.stringify(g)}. Supported values are: [${N.values.map(fe=>'"'+fe+'"').join(", ")}]`,"URL_INVALID");N.update!==void 0&&N?.update(_,g)}let b=a.length===0?"":`?${a.join("&")}`,S=u.path+b,y;if(c==="libsql")if(n===!1){if(u.authority?.port===void 0)throw new St.LibsqlError('A "libsql:" URL with ?tls=0 must specify an explicit port',"URL_INVALID");y=e?"http":"ws"}else y=e?"https":"wss";else y=c;if(y==="http"||y==="ws"?n??=!1:n??=!0,y!=="http"&&y!=="ws"&&y!=="https"&&y!=="wss"&&y!=="file")throw new St.LibsqlError(`The client supports only "libsql:", "wss:", "ws:", "https:", "http:" and "file:" URLs, got ${JSON.stringify(u.scheme+":")}. For more information, please read ${bu.supportedUrlLink}`,"URL_SCHEME_NOT_SUPPORTED");if(i!=="number"&&i!=="bigint"&&i!=="string")throw new TypeError(`Invalid value for intMode, expected "number", "bigint" or "string", got ${JSON.stringify(i)}`);if(u.fragment!==void 0)throw new St.LibsqlError(`URL fragments are not supported: ${JSON.stringify("#"+u.fragment)}`,"URL_INVALID");return h?{scheme:"file",tls:!1,path:S,intMode:i,concurrency:o,syncUrl:t.syncUrl,syncInterval:t.syncInterval,fetch:t.fetch,authToken:void 0,encryptionKey:void 0,authority:void 0}:{scheme:y,tls:n,authority:u.authority,path:S,authToken:s,intMode:i,concurrency:o,encryptionKey:t.encryptionKey,syncUrl:t.syncUrl,syncInterval:t.syncInterval,fetch:t.fetch}}Ge.expandConfig=gu});var Xn=f(z=>{"use strict";var Su=z&&z.__createBinding||(Object.create?function(t,e,r,s){s===void 0&&(s=r);var n=Object.getOwnPropertyDescriptor(e,r);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,s,n)}:function(t,e,r,s){s===void 0&&(s=r),t[s]=e[r]}),Eu=z&&z.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),Qn=z&&z.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&Su(e,t,r);return Eu(e,t),e};Object.defineProperty(z,"__esModule",{value:!0});z.load=z.currentTarget=void 0;var vu=Qn(require("path")),qu=Qn(require("fs"));function Cu(){let t=null;switch(process.platform){case"android":switch(process.arch){case"arm":return"android-arm-eabi";case"arm64":return"android-arm64"}t="Android";break;case"win32":switch(process.arch){case"x64":return"win32-x64-msvc";case"arm64":return"win32-arm64-msvc";case"ia32":return"win32-ia32-msvc"}t="Windows";break;case"darwin":switch(process.arch){case"x64":return"darwin-x64";case"arm64":return"darwin-arm64"}t="macOS";break;case"linux":switch(process.arch){case"x64":case"arm64":return xu()?`linux-${process.arch}-gnu`:`linux-${process.arch}-musl`;case"arm":return"linux-arm-gnueabihf"}t="Linux";break;case"freebsd":if(process.arch==="x64")return"freebsd-x64";t="FreeBSD";break}throw t?new Error(`Neon: unsupported ${t} architecture: ${process.arch}`):new Error(`Neon: unsupported system: ${process.platform}`)}z.currentTarget=Cu;function xu(){let t=process.report?.getReport();if(typeof t!="object"||!t||!("header"in t))return!1;let e=t.header;return typeof e=="object"&&!!e&&"glibcVersionRuntime"in e}function Ru(t){let e=vu.join(t,"index.node");return qu.existsSync(e)?require(e):null}z.load=Ru});var ti=f((Hp,ei)=>{"use strict";var Zn=()=>process.platform==="linux",is=null,Ou=()=>(is||(is=Zn()&&process.report?process.report.getReport():{}),is);ei.exports={isLinux:Zn,getReport:Ou}});var ni=f((Gp,si)=>{"use strict";var ri=require("fs"),Pu="/usr/bin/ldd",Tu=t=>ri.readFileSync(t,"utf-8"),Iu=t=>new Promise((e,r)=>{ri.readFile(t,"utf-8",(s,n)=>{s?r(s):e(n)})});si.exports={LDD_PATH:Pu,readFileSync:Tu,readFile:Iu}});var Ei=f((zp,Si)=>{"use strict";var oi=require("child_process"),{isLinux:ze,getReport:ai}=ti(),{LDD_PATH:Vt,readFile:ui,readFileSync:ci}=ni(),ne,ie,li="getconf GNU_LIBC_VERSION 2>&1 || true; ldd --version 2>&1 || true",Ee="",fi=()=>Ee||new Promise(t=>{oi.exec(li,(e,r)=>{Ee=e?" ":r,t(Ee)})}),hi=()=>{if(!Ee)try{Ee=oi.execSync(li,{encoding:"utf8"})}catch{Ee=" "}return Ee},pe="glibc",di=/GLIBC\s(\d+\.\d+)/,Te="musl",ju=pe.toUpperCase(),Lu=Te.toLowerCase(),Bu=t=>t.includes("libc.musl-")||t.includes("ld-musl-"),pi=()=>{let t=ai();return t.header&&t.header.glibcVersionRuntime?pe:Array.isArray(t.sharedObjects)&&t.sharedObjects.some(Bu)?Te:null},_i=t=>{let[e,r]=t.split(/[\r\n]+/);return e&&e.includes(pe)?pe:r&&r.includes(Te)?Te:null},yi=t=>t.includes(Lu)?Te:t.includes(ju)?pe:null,Mu=async()=>{if(ne!==void 0)return ne;ne=null;try{let t=await ui(Vt);ne=yi(t)}catch{}return ne},Au=()=>{if(ne!==void 0)return ne;ne=null;try{let t=ci(Vt);ne=yi(t)}catch{}return ne},mi=async()=>{let t=null;if(ze()&&(t=await Mu(),t||(t=pi()),!t)){let e=await fi();t=_i(e)}return t},bi=()=>{let t=null;if(ze()&&(t=Au(),t||(t=pi()),!t)){let e=hi();t=_i(e)}return t},Uu=async()=>ze()&&await mi()!==pe,Nu=()=>ze()&&bi()!==pe,ku=async()=>{if(ie!==void 0)return ie;ie=null;try{let e=(await ui(Vt)).match(di);e&&(ie=e[1])}catch{}return ie},Du=()=>{if(ie!==void 0)return ie;ie=null;try{let e=ci(Vt).match(di);e&&(ie=e[1])}catch{}return ie},wi=()=>{let t=ai();return t.header&&t.header.glibcVersionRuntime?t.header.glibcVersionRuntime:null},ii=t=>t.trim().split(/\s+/)[1],gi=t=>{let[e,r,s]=t.split(/[\r\n]+/);return e&&e.includes(pe)?ii(e):r&&s&&r.includes(Te)?ii(s):null},Fu=async()=>{let t=null;if(ze()&&(t=await ku(),t||(t=wi()),!t)){let e=await fi();t=gi(e)}return t},$u=()=>{let t=null;if(ze()&&(t=Du(),t||(t=wi()),!t)){let e=hi();t=gi(e)}return t};Si.exports={GLIBC:pe,MUSL:Te,family:mi,familySync:bi,isNonGlibcLinux:Uu,isNonGlibcLinuxSync:Nu,version:Fu,versionSync:$u}});var qi=f((Jp,vi)=>{"use strict";var os={value:"SqliteError",writable:!0,enumerable:!1,configurable:!0};function Ie(t,e,r){if(new.target!==Ie)return new Ie(t,e);if(typeof e!="string")throw new TypeError("Expected second argument to be a string");Error.call(this,t),os.value=""+t,Object.defineProperty(this,"message",os),Error.captureStackTrace(this,Ie),this.code=e,this.rawCode=r}Object.setPrototypeOf(Ie,Error);Object.setPrototypeOf(Ie.prototype,Error.prototype);Object.defineProperty(Ie.prototype,"name",os);vi.exports=Ie});var Pi=f((Kp,ls)=>{"use strict";var{load:Wu,currentTarget:Vu}=Xn(),{familySync:Hu,GLIBC:Gu}=Ei();function zu(){if(process.env.LIBSQL_JS_DEV)return Wu(__dirname);let t=Vu();if(Hu()==Gu)switch(t){case"linux-x64-musl":t="linux-x64-gnu";break;case"linux-arm64-musl":t="linux-arm64-gnu";break}return require(`@libsql/${t}`)}var{databaseOpen:Ju,databaseOpenWithRpcSync:Ku,databaseInTransaction:Yu,databaseClose:Qu,databaseSyncSync:Xu,databaseSyncUntilSync:Zu,databaseExecSync:ec,databasePrepareSync:tc,databaseDefaultSafeIntegers:rc,databaseLoadExtension:sc,databaseMaxWriteReplicationIndex:nc,statementRaw:ic,statementIsReader:oc,statementGet:Ci,statementRun:xi,statementRowsSync:Ri,statementColumns:ac,statementSafeIntegers:uc,rowsNext:cc}=zu(),Oi=qi();function as(t){return t.libsqlError?new Oi(t.message,t.code,t.rawCode):t}var us=class{constructor(e,r){let s=r?.encryptionCipher??"aes256cbc";if(r&&r.syncUrl){var n="";r.syncAuth?(console.warn("Warning: The `syncAuth` option is deprecated, please use `authToken` option instead."),n=r.syncAuth):r.authToken&&(n=r.authToken);let o=r?.encryptionKey??"",a=r?.syncPeriod??0,u=r?.readYourWrites??!0;this.db=Ku(e,r.syncUrl,n,s,o,a,u)}else{let o=r?.authToken??"",a=r?.encryptionKey??"";this.db=Ju(e,o,s,a)}this.memory=e===":memory:",this.readonly=!1,this.name="",this.open=!0;let i=this.db;Object.defineProperties(this,{inTransaction:{get(){return Yu(i)}}})}sync(){return Xu.call(this.db)}syncUntil(e){return Zu.call(this.db,e)}prepare(e){try{let r=tc.call(this.db,e);return new cs(r)}catch(r){throw as(r)}}transaction(e){if(typeof e!="function")throw new TypeError("Expected first argument to be a function");let r=this,s=i=>(...o)=>{r.exec("BEGIN "+i);try{let a=e(...o);return r.exec("COMMIT"),a}catch(a){throw r.exec("ROLLBACK"),a}},n={default:{value:s("")},deferred:{value:s("DEFERRED")},immediate:{value:s("IMMEDIATE")},exclusive:{value:s("EXCLUSIVE")},database:{value:this,enumerable:!0}};return Object.defineProperties(n.default.value,n),Object.defineProperties(n.deferred.value,n),Object.defineProperties(n.immediate.value,n),Object.defineProperties(n.exclusive.value,n),n.default.value}pragma(e,r){if(r==null&&(r={}),typeof e!="string")throw new TypeError("Expected first argument to be a string");if(typeof r!="object")throw new TypeError("Expected second argument to be an options object");let s=r.simple,n=this.prepare(`PRAGMA ${e}`,this,!0);return s?n.pluck().get():n.all()}backup(e,r){throw new Error("not implemented")}serialize(e){throw new Error("not implemented")}function(e,r,s){throw r==null&&(r={}),typeof r=="function"&&(s=r,r={}),typeof e!="string"?new TypeError("Expected first argument to be a string"):typeof s!="function"?new TypeError("Expected last argument to be a function"):typeof r!="object"?new TypeError("Expected second argument to be an options object"):e?new Error("not implemented"):new TypeError("User-defined function name cannot be an empty string")}aggregate(e,r){throw typeof e!="string"?new TypeError("Expected first argument to be a string"):typeof r!="object"||r===null?new TypeError("Expected second argument to be an options object"):e?new Error("not implemented"):new TypeError("User-defined function name cannot be an empty string")}table(e,r){throw typeof e!="string"?new TypeError("Expected first argument to be a string"):e?new Error("not implemented"):new TypeError("Virtual table module name cannot be an empty string")}loadExtension(...e){sc.call(this.db,...e)}maxWriteReplicationIndex(){return nc.call(this.db)}exec(e){try{ec.call(this.db,e)}catch(r){throw as(r)}}close(){Qu.call(this.db),this.open=!1}defaultSafeIntegers(e){return rc.call(this.db,e??!0),this}unsafeMode(...e){throw new Error("not implemented")}},cs=class{constructor(e){this.stmt=e}raw(e){return ic.call(this.stmt,e??!0),this}get reader(){return oc.call(this.stmt)}run(...e){try{return e.length==1&&typeof e[0]=="object"?xi.call(this.stmt,e[0]):xi.call(this.stmt,e.flat())}catch(r){throw as(r)}}get(...e){return e.length==1&&typeof e[0]=="object"?Ci.call(this.stmt,e[0]):Ci.call(this.stmt,e.flat())}iterate(...e){var r=void 0;return e.length==1&&typeof e[0]=="object"?r=Ri.call(this.stmt,e[0]):r=Ri.call(this.stmt,e.flat()),{nextRows:Array(100),nextRowIndex:100,next(){this.nextRowIndex===100&&(cc.call(r,this.nextRows),this.nextRowIndex=0);let n=this.nextRows[this.nextRowIndex];return this.nextRows[this.nextRowIndex]=void 0,n?(this.nextRowIndex++,{value:n,done:!1}):{done:!0}},[Symbol.iterator](){return this}}}all(...e){let r=[];for(let s of this.iterate(...e))r.push(s);return r}columns(){return ac.call(this.stmt)}safeIntegers(e){return uc.call(this.stmt,e??!0),this}};ls.exports=us;ls.exports.SqliteError=Oi});var Ai=f(M=>{"use strict";var lc=M&&M.__createBinding||(Object.create?function(t,e,r,s){s===void 0&&(s=r);var n=Object.getOwnPropertyDescriptor(e,r);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,s,n)}:function(t,e,r,s){s===void 0&&(s=r),t[s]=e[r]}),fc=M&&M.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&lc(e,t,r)},hc=M&&M.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(M,"__esModule",{value:!0});M.Sqlite3Transaction=M.Sqlite3Client=M._createClient=M.createClient=void 0;var fs=hc(Pi()),Ii=require("node:buffer"),oe=te(),ji=Et(),je=He();fc(te(),M);function dc(t){return Li((0,ji.expandConfig)(t,!0))}M.createClient=dc;function Li(t){if(t.scheme!=="file")throw new oe.LibsqlError(`URL scheme ${JSON.stringify(t.scheme+":")} is not supported by the local sqlite3 client. For more information, please read ${je.supportedUrlLink}`,"URL_SCHEME_NOT_SUPPORTED");let e=t.authority;if(e!==void 0){let o=e.host.toLowerCase();if(o!==""&&o!=="localhost")throw new oe.LibsqlError(`Invalid host in file URL: ${JSON.stringify(e.host)}. A "file:" URL with an absolute path should start with one slash ("file:/absolute/path.db") or with three slashes ("file:///absolute/path.db"). For more information, please read ${je.supportedUrlLink}`,"URL_INVALID");if(e.port!==void 0)throw new oe.LibsqlError("File URL cannot have a port","URL_INVALID");if(e.userinfo!==void 0)throw new oe.LibsqlError("File URL cannot have username and password","URL_INVALID")}let r=(0,ji.isInMemoryConfig)(t);if(r&&t.syncUrl)throw new oe.LibsqlError(`Embedded replica must use file for local db but URI with in-memory mode were provided instead: ${t.path}`,"URL_INVALID");let s=t.path;r&&(s=`${t.scheme}:${t.path}`);let n={authToken:t.authToken,encryptionKey:t.encryptionKey,syncUrl:t.syncUrl,syncPeriod:t.syncInterval},i=new fs.default(s,n);return P(i,"SELECT 1 AS checkThatTheDatabaseCanBeOpened",t.intMode),new Ht(s,n,i,t.intMode)}M._createClient=Li;var Ht=class{#e;#t;#r;#s;closed;protocol;constructor(e,r,s,n){this.#e=e,this.#t=r,this.#r=s,this.#s=n,this.closed=!1,this.protocol="file"}async execute(e,r){let s;return typeof e=="string"?s={sql:e,args:r||[]}:s=e,this.#i(),P(this.#n(),s,this.#s)}async batch(e,r="deferred"){this.#i();let s=this.#n();try{P(s,(0,je.transactionModeToBegin)(r),this.#s);let n=e.map(i=>{if(!s.inTransaction)throw new oe.LibsqlError("The transaction has been rolled back","TRANSACTION_CLOSED");return P(s,i,this.#s)});return P(s,"COMMIT",this.#s),n}finally{s.inTransaction&&P(s,"ROLLBACK",this.#s)}}async migrate(e){this.#i();let r=this.#n();try{P(r,"PRAGMA foreign_keys=off",this.#s),P(r,(0,je.transactionModeToBegin)("deferred"),this.#s);let s=e.map(n=>{if(!r.inTransaction)throw new oe.LibsqlError("The transaction has been rolled back","TRANSACTION_CLOSED");return P(r,n,this.#s)});return P(r,"COMMIT",this.#s),s}finally{r.inTransaction&&P(r,"ROLLBACK",this.#s),P(r,"PRAGMA foreign_keys=on",this.#s)}}async transaction(e="write"){let r=this.#n();return P(r,(0,je.transactionModeToBegin)(e),this.#s),this.#r=null,new Gt(r,this.#s)}async executeMultiple(e){this.#i();let r=this.#n();try{return Bi(r,e)}finally{r.inTransaction&&P(r,"ROLLBACK",this.#s)}}async sync(){this.#i();let e=await this.#n().sync();return{frames_synced:e.frames_synced,frame_no:e.frame_no}}close(){this.closed=!0,this.#r!==null&&this.#r.close()}#i(){if(this.closed)throw new oe.LibsqlError("The client is closed","CLIENT_CLOSED")}#n(){return this.#r===null&&(this.#r=new fs.default(this.#e,this.#t)),this.#r}};M.Sqlite3Client=Ht;var Gt=class{#e;#t;constructor(e,r){this.#e=e,this.#t=r}async execute(e,r){let s;return typeof e=="string"?s={sql:e,args:r||[]}:s=e,this.#r(),P(this.#e,s,this.#t)}async batch(e){return e.map(r=>(this.#r(),P(this.#e,r,this.#t)))}async executeMultiple(e){return this.#r(),Bi(this.#e,e)}async rollback(){this.#e.open&&(this.#r(),P(this.#e,"ROLLBACK",this.#t))}async commit(){this.#r(),P(this.#e,"COMMIT",this.#t)}close(){this.#e.inTransaction&&P(this.#e,"ROLLBACK",this.#t)}get closed(){return!this.#e.inTransaction}#r(){if(this.closed)throw new oe.LibsqlError("The transaction is closed","TRANSACTION_CLOSED")}};M.Sqlite3Transaction=Gt;function P(t,e,r){let s,n;if(typeof e=="string")s=e,n=[];else if(s=e.sql,Array.isArray(e.args))n=e.args.map(i=>Ti(i,r));else{n={};for(let i in e.args){let o=i[0]==="@"||i[0]==="$"||i[0]===":"?i.substring(1):i;n[o]=Ti(e.args[i],r)}}try{let i=t.prepare(s);i.safeIntegers(!0);let o=!0;try{i.raw(!0)}catch{o=!1}if(o){let a=Array.from(i.columns().map(b=>b.name)),u=Array.from(i.columns().map(b=>b.type??"")),c=i.all(n).map(b=>pc(b,a,r)),h=0,d=void 0;return new je.ResultSetImpl(a,u,c,h,d)}else{let a=i.run(n),u=a.changes,c=BigInt(a.lastInsertRowid);return new je.ResultSetImpl([],[],[],u,c)}}catch(i){throw Mi(i)}}function pc(t,e,r){let s={};Object.defineProperty(s,"length",{value:t.length});for(let n=0;n<t.length;++n){let i=_c(t[n],r);Object.defineProperty(s,n,{value:i});let o=e[n];Object.hasOwn(s,o)||Object.defineProperty(s,o,{value:i,enumerable:!0,configurable:!0,writable:!0})}return s}function _c(t,e){if(typeof t=="bigint")if(e==="number"){if(t<yc||t>mc)throw new RangeError("Received integer which cannot be safely represented as a JavaScript number");return Number(t)}else{if(e==="bigint")return t;if(e==="string")return""+t;throw new Error("Invalid value for IntMode")}else if(t instanceof Ii.Buffer)return t.buffer;return t}var yc=-9007199254740991n,mc=9007199254740991n;function Ti(t,e){if(typeof t=="number"){if(!Number.isFinite(t))throw new RangeError("Only finite numbers (not Infinity or NaN) can be passed as arguments");return t}else if(typeof t=="bigint"){if(t<bc||t>wc)throw new RangeError("bigint is too large to be represented as a 64-bit integer and passed as argument");return t}else if(typeof t=="boolean")switch(e){case"bigint":return t?1n:0n;case"string":return t?"1":"0";default:return t?1:0}else{if(t instanceof ArrayBuffer)return Ii.Buffer.from(t);if(t instanceof Date)return t.valueOf();if(t===void 0)throw new TypeError("undefined cannot be passed as argument to the database");return t}}var bc=-9223372036854775808n,wc=9223372036854775807n;function Bi(t,e){try{t.exec(e)}catch(r){throw Mi(r)}}function Mi(t){return t instanceof fs.default.SqliteError?new oe.LibsqlError(t.message,t.code,t.rawCode,t):t}});var _e=f((Qp,ki)=>{"use strict";var Ui=["nodebuffer","arraybuffer","fragments"],Ni=typeof Blob<"u";Ni&&Ui.push("blob");ki.exports={BINARY_TYPES:Ui,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:Ni,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}});var vt=f((Xp,zt)=>{"use strict";var{EMPTY_BUFFER:gc}=_e(),hs=Buffer[Symbol.species];function Sc(t,e){if(t.length===0)return gc;if(t.length===1)return t[0];let r=Buffer.allocUnsafe(e),s=0;for(let n=0;n<t.length;n++){let i=t[n];r.set(i,s),s+=i.length}return s<e?new hs(r.buffer,r.byteOffset,s):r}function Di(t,e,r,s,n){for(let i=0;i<n;i++)r[s+i]=t[i]^e[i&3]}function Fi(t,e){for(let r=0;r<t.length;r++)t[r]^=e[r&3]}function Ec(t){return t.length===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.length)}function ds(t){if(ds.readOnly=!0,Buffer.isBuffer(t))return t;let e;return t instanceof ArrayBuffer?e=new hs(t):ArrayBuffer.isView(t)?e=new hs(t.buffer,t.byteOffset,t.byteLength):(e=Buffer.from(t),ds.readOnly=!1),e}zt.exports={concat:Sc,mask:Di,toArrayBuffer:Ec,toBuffer:ds,unmask:Fi};if(!process.env.WS_NO_BUFFER_UTIL)try{let t=require("bufferutil");zt.exports.mask=function(e,r,s,n,i){i<48?Di(e,r,s,n,i):t.mask(e,r,s,n,i)},zt.exports.unmask=function(e,r){e.length<32?Fi(e,r):t.unmask(e,r)}}catch{}});var Vi=f((Zp,Wi)=>{"use strict";var $i=Symbol("kDone"),ps=Symbol("kRun"),_s=class{constructor(e){this[$i]=()=>{this.pending--,this[ps]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[ps]()}[ps](){if(this.pending!==this.concurrency&&this.jobs.length){let e=this.jobs.shift();this.pending++,e(this[$i])}}};Wi.exports=_s});var xt=f((e_,Ji)=>{"use strict";var qt=require("zlib"),Hi=vt(),vc=Vi(),{kStatusCode:Gi}=_e(),qc=Buffer[Symbol.species],Cc=Buffer.from([0,0,255,255]),Yt=Symbol("permessage-deflate"),ye=Symbol("total-length"),Ct=Symbol("callback"),ve=Symbol("buffers"),Kt=Symbol("error"),Jt,ys=class{constructor(e,r,s){if(this._maxPayload=s|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!r,this._deflate=null,this._inflate=null,this.params=null,!Jt){let n=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;Jt=new vc(n)}}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let e=this._deflate[Ct];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){let r=this._options,s=e.find(n=>!(r.serverNoContextTakeover===!1&&n.server_no_context_takeover||n.server_max_window_bits&&(r.serverMaxWindowBits===!1||typeof r.serverMaxWindowBits=="number"&&r.serverMaxWindowBits>n.server_max_window_bits)||typeof r.clientMaxWindowBits=="number"&&!n.client_max_window_bits));if(!s)throw new Error("None of the extension offers can be accepted");return r.serverNoContextTakeover&&(s.server_no_context_takeover=!0),r.clientNoContextTakeover&&(s.client_no_context_takeover=!0),typeof r.serverMaxWindowBits=="number"&&(s.server_max_window_bits=r.serverMaxWindowBits),typeof r.clientMaxWindowBits=="number"?s.client_max_window_bits=r.clientMaxWindowBits:(s.client_max_window_bits===!0||r.clientMaxWindowBits===!1)&&delete s.client_max_window_bits,s}acceptAsClient(e){let r=e[0];if(this._options.clientNoContextTakeover===!1&&r.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!r.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(r.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&r.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return r}normalizeParams(e){return e.forEach(r=>{Object.keys(r).forEach(s=>{let n=r[s];if(n.length>1)throw new Error(`Parameter "${s}" must have only a single value`);if(n=n[0],s==="client_max_window_bits"){if(n!==!0){let i=+n;if(!Number.isInteger(i)||i<8||i>15)throw new TypeError(`Invalid value for parameter "${s}": ${n}`);n=i}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${s}": ${n}`)}else if(s==="server_max_window_bits"){let i=+n;if(!Number.isInteger(i)||i<8||i>15)throw new TypeError(`Invalid value for parameter "${s}": ${n}`);n=i}else if(s==="client_no_context_takeover"||s==="server_no_context_takeover"){if(n!==!0)throw new TypeError(`Invalid value for parameter "${s}": ${n}`)}else throw new Error(`Unknown parameter "${s}"`);r[s]=n})}),e}decompress(e,r,s){Jt.add(n=>{this._decompress(e,r,(i,o)=>{n(),s(i,o)})})}compress(e,r,s){Jt.add(n=>{this._compress(e,r,(i,o)=>{n(),s(i,o)})})}_decompress(e,r,s){let n=this._isServer?"client":"server";if(!this._inflate){let i=`${n}_max_window_bits`,o=typeof this.params[i]!="number"?qt.Z_DEFAULT_WINDOWBITS:this.params[i];this._inflate=qt.createInflateRaw({...this._options.zlibInflateOptions,windowBits:o}),this._inflate[Yt]=this,this._inflate[ye]=0,this._inflate[ve]=[],this._inflate.on("error",Rc),this._inflate.on("data",zi)}this._inflate[Ct]=s,this._inflate.write(e),r&&this._inflate.write(Cc),this._inflate.flush(()=>{let i=this._inflate[Kt];if(i){this._inflate.close(),this._inflate=null,s(i);return}let o=Hi.concat(this._inflate[ve],this._inflate[ye]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[ye]=0,this._inflate[ve]=[],r&&this.params[`${n}_no_context_takeover`]&&this._inflate.reset()),s(null,o)})}_compress(e,r,s){let n=this._isServer?"server":"client";if(!this._deflate){let i=`${n}_max_window_bits`,o=typeof this.params[i]!="number"?qt.Z_DEFAULT_WINDOWBITS:this.params[i];this._deflate=qt.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:o}),this._deflate[ye]=0,this._deflate[ve]=[],this._deflate.on("data",xc)}this._deflate[Ct]=s,this._deflate.write(e),this._deflate.flush(qt.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let i=Hi.concat(this._deflate[ve],this._deflate[ye]);r&&(i=new qc(i.buffer,i.byteOffset,i.length-4)),this._deflate[Ct]=null,this._deflate[ye]=0,this._deflate[ve]=[],r&&this.params[`${n}_no_context_takeover`]&&this._deflate.reset(),s(null,i)})}};Ji.exports=ys;function xc(t){this[ve].push(t),this[ye]+=t.length}function zi(t){if(this[ye]+=t.length,this[Yt]._maxPayload<1||this[ye]<=this[Yt]._maxPayload){this[ve].push(t);return}this[Kt]=new RangeError("Max payload size exceeded"),this[Kt].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[Kt][Gi]=1009,this.removeListener("data",zi),this.reset()}function Rc(t){this[Yt]._inflate=null,t[Gi]=1007,this[Ct](t)}});var Je=f((t_,Qt)=>{"use strict";var{isUtf8:Ki}=require("buffer"),{hasBlob:Oc}=_e(),Pc=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function Tc(t){return t>=1e3&&t<=1014&&t!==1004&&t!==1005&&t!==1006||t>=3e3&&t<=4999}function ms(t){let e=t.length,r=0;for(;r<e;)if((t[r]&128)===0)r++;else if((t[r]&224)===192){if(r+1===e||(t[r+1]&192)!==128||(t[r]&254)===192)return!1;r+=2}else if((t[r]&240)===224){if(r+2>=e||(t[r+1]&192)!==128||(t[r+2]&192)!==128||t[r]===224&&(t[r+1]&224)===128||t[r]===237&&(t[r+1]&224)===160)return!1;r+=3}else if((t[r]&248)===240){if(r+3>=e||(t[r+1]&192)!==128||(t[r+2]&192)!==128||(t[r+3]&192)!==128||t[r]===240&&(t[r+1]&240)===128||t[r]===244&&t[r+1]>143||t[r]>244)return!1;r+=4}else return!1;return!0}function Ic(t){return Oc&&typeof t=="object"&&typeof t.arrayBuffer=="function"&&typeof t.type=="string"&&typeof t.stream=="function"&&(t[Symbol.toStringTag]==="Blob"||t[Symbol.toStringTag]==="File")}Qt.exports={isBlob:Ic,isValidStatusCode:Tc,isValidUTF8:ms,tokenChars:Pc};if(Ki)Qt.exports.isValidUTF8=function(t){return t.length<24?ms(t):Ki(t)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let t=require("utf-8-validate");Qt.exports.isValidUTF8=function(e){return e.length<32?ms(e):t(e)}}catch{}});var Es=f((r_,ro)=>{"use strict";var{Writable:jc}=require("stream"),Yi=xt(),{BINARY_TYPES:Lc,EMPTY_BUFFER:Qi,kStatusCode:Bc,kWebSocket:Mc}=_e(),{concat:bs,toArrayBuffer:Ac,unmask:Uc}=vt(),{isValidStatusCode:Nc,isValidUTF8:Xi}=Je(),Xt=Buffer[Symbol.species],J=0,Zi=1,eo=2,to=3,ws=4,gs=5,Zt=6,Ss=class extends jc{constructor(e={}){super(),this._allowSynchronousEvents=e.allowSynchronousEvents!==void 0?e.allowSynchronousEvents:!0,this._binaryType=e.binaryType||Lc[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=e.maxPayload|0,this._skipUTF8Validation=!!e.skipUTF8Validation,this[Mc]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=J}_write(e,r,s){if(this._opcode===8&&this._state==J)return s();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(s)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let s=this._buffers[0];return this._buffers[0]=new Xt(s.buffer,s.byteOffset+e,s.length-e),new Xt(s.buffer,s.byteOffset,e)}let r=Buffer.allocUnsafe(e);do{let s=this._buffers[0],n=r.length-e;e>=s.length?r.set(this._buffers.shift(),n):(r.set(new Uint8Array(s.buffer,s.byteOffset,e),n),this._buffers[0]=new Xt(s.buffer,s.byteOffset+e,s.length-e)),e-=s.length}while(e>0);return r}startLoop(e){this._loop=!0;do switch(this._state){case J:this.getInfo(e);break;case Zi:this.getPayloadLength16(e);break;case eo:this.getPayloadLength64(e);break;case to:this.getMask();break;case ws:this.getData(e);break;case gs:case Zt:this._loop=!1;return}while(this._loop);this._errored||e()}getInfo(e){if(this._bufferedBytes<2){this._loop=!1;return}let r=this.consume(2);if((r[0]&48)!==0){let n=this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");e(n);return}let s=(r[0]&64)===64;if(s&&!this._extensions[Yi.extensionName]){let n=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(n);return}if(this._fin=(r[0]&128)===128,this._opcode=r[0]&15,this._payloadLength=r[1]&127,this._opcode===0){if(s){let n=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(n);return}if(!this._fragmented){let n=this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");e(n);return}this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented){let n=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(n);return}this._compressed=s}else if(this._opcode>7&&this._opcode<11){if(!this._fin){let n=this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");e(n);return}if(s){let n=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(n);return}if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1){let n=this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");e(n);return}}else{let n=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(n);return}if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(r[1]&128)===128,this._isServer){if(!this._masked){let n=this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK");e(n);return}}else if(this._masked){let n=this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");e(n);return}this._payloadLength===126?this._state=Zi:this._payloadLength===127?this._state=eo:this.haveLength(e)}getPayloadLength16(e){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e)}getPayloadLength64(e){if(this._bufferedBytes<8){this._loop=!1;return}let r=this.consume(8),s=r.readUInt32BE(0);if(s>Math.pow(2,21)-1){let n=this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH");e(n);return}this._payloadLength=s*Math.pow(2,32)+r.readUInt32BE(4),this.haveLength(e)}haveLength(e){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)){let r=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");e(r);return}this._masked?this._state=to:this._state=ws}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=ws}getData(e){let r=Qi;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}r=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!==0&&Uc(r,this._mask)}if(this._opcode>7){this.controlMessage(r,e);return}if(this._compressed){this._state=gs,this.decompress(r,e);return}r.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(r)),this.dataMessage(e)}decompress(e,r){this._extensions[Yi.extensionName].decompress(e,this._fin,(n,i)=>{if(n)return r(n);if(i.length){if(this._messageLength+=i.length,this._messageLength>this._maxPayload&&this._maxPayload>0){let o=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");r(o);return}this._fragments.push(i)}this.dataMessage(r),this._state===J&&this.startLoop(r)})}dataMessage(e){if(!this._fin){this._state=J;return}let r=this._messageLength,s=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let n;this._binaryType==="nodebuffer"?n=bs(s,r):this._binaryType==="arraybuffer"?n=Ac(bs(s,r)):this._binaryType==="blob"?n=new Blob(s):n=s,this._allowSynchronousEvents?(this.emit("message",n,!0),this._state=J):(this._state=Zt,setImmediate(()=>{this.emit("message",n,!0),this._state=J,this.startLoop(e)}))}else{let n=bs(s,r);if(!this._skipUTF8Validation&&!Xi(n)){let i=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");e(i);return}this._state===gs||this._allowSynchronousEvents?(this.emit("message",n,!1),this._state=J):(this._state=Zt,setImmediate(()=>{this.emit("message",n,!1),this._state=J,this.startLoop(e)}))}}controlMessage(e,r){if(this._opcode===8){if(e.length===0)this._loop=!1,this.emit("conclude",1005,Qi),this.end();else{let s=e.readUInt16BE(0);if(!Nc(s)){let i=this.createError(RangeError,`invalid status code ${s}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");r(i);return}let n=new Xt(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!Xi(n)){let i=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");r(i);return}this._loop=!1,this.emit("conclude",s,n),this.end()}this._state=J;return}this._allowSynchronousEvents?(this.emit(this._opcode===9?"ping":"pong",e),this._state=J):(this._state=Zt,setImmediate(()=>{this.emit(this._opcode===9?"ping":"pong",e),this._state=J,this.startLoop(r)}))}createError(e,r,s,n,i){this._loop=!1,this._errored=!0;let o=new e(s?`Invalid WebSocket frame: ${r}`:r);return Error.captureStackTrace(o,this.createError),o.code=i,o[Bc]=n,o}};ro.exports=Ss});var Cs=f((n_,io)=>{"use strict";var{Duplex:s_}=require("stream"),{randomFillSync:kc}=require("crypto"),so=xt(),{EMPTY_BUFFER:Dc,kWebSocket:Fc,NOOP:$c}=_e(),{isBlob:Ke,isValidStatusCode:Wc}=Je(),{mask:no,toBuffer:Le}=vt(),K=Symbol("kByteLength"),Vc=Buffer.alloc(4),er=8*1024,Be,Ye=er,re=0,Hc=1,Gc=2,vs=class t{constructor(e,r,s){this._extensions=r||{},s&&(this._generateMask=s,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=re,this.onerror=$c,this[Fc]=void 0}static frame(e,r){let s,n=!1,i=2,o=!1;r.mask&&(s=r.maskBuffer||Vc,r.generateMask?r.generateMask(s):(Ye===er&&(Be===void 0&&(Be=Buffer.alloc(er)),kc(Be,0,er),Ye=0),s[0]=Be[Ye++],s[1]=Be[Ye++],s[2]=Be[Ye++],s[3]=Be[Ye++]),o=(s[0]|s[1]|s[2]|s[3])===0,i=6);let a;typeof e=="string"?(!r.mask||o)&&r[K]!==void 0?a=r[K]:(e=Buffer.from(e),a=e.length):(a=e.length,n=r.mask&&r.readOnly&&!o);let u=a;a>=65536?(i+=8,u=127):a>125&&(i+=2,u=126);let c=Buffer.allocUnsafe(n?a+i:i);return c[0]=r.fin?r.opcode|128:r.opcode,r.rsv1&&(c[0]|=64),c[1]=u,u===126?c.writeUInt16BE(a,2):u===127&&(c[2]=c[3]=0,c.writeUIntBE(a,4,6)),r.mask?(c[1]|=128,c[i-4]=s[0],c[i-3]=s[1],c[i-2]=s[2],c[i-1]=s[3],o?[c,e]:n?(no(e,s,c,i,a),[c]):(no(e,s,e,0,a),[c,e])):[c,e]}close(e,r,s,n){let i;if(e===void 0)i=Dc;else{if(typeof e!="number"||!Wc(e))throw new TypeError("First argument must be a valid error code number");if(r===void 0||!r.length)i=Buffer.allocUnsafe(2),i.writeUInt16BE(e,0);else{let a=Buffer.byteLength(r);if(a>123)throw new RangeError("The message must not be greater than 123 bytes");i=Buffer.allocUnsafe(2+a),i.writeUInt16BE(e,0),typeof r=="string"?i.write(r,2):i.set(r,2)}}let o={[K]:i.length,fin:!0,generateMask:this._generateMask,mask:s,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._state!==re?this.enqueue([this.dispatch,i,!1,o,n]):this.sendFrame(t.frame(i,o),n)}ping(e,r,s){let n,i;if(typeof e=="string"?(n=Buffer.byteLength(e),i=!1):Ke(e)?(n=e.size,i=!1):(e=Le(e),n=e.length,i=Le.readOnly),n>125)throw new RangeError("The data size must not be greater than 125 bytes");let o={[K]:n,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:9,readOnly:i,rsv1:!1};Ke(e)?this._state!==re?this.enqueue([this.getBlobData,e,!1,o,s]):this.getBlobData(e,!1,o,s):this._state!==re?this.enqueue([this.dispatch,e,!1,o,s]):this.sendFrame(t.frame(e,o),s)}pong(e,r,s){let n,i;if(typeof e=="string"?(n=Buffer.byteLength(e),i=!1):Ke(e)?(n=e.size,i=!1):(e=Le(e),n=e.length,i=Le.readOnly),n>125)throw new RangeError("The data size must not be greater than 125 bytes");let o={[K]:n,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:10,readOnly:i,rsv1:!1};Ke(e)?this._state!==re?this.enqueue([this.getBlobData,e,!1,o,s]):this.getBlobData(e,!1,o,s):this._state!==re?this.enqueue([this.dispatch,e,!1,o,s]):this.sendFrame(t.frame(e,o),s)}send(e,r,s){let n=this._extensions[so.extensionName],i=r.binary?2:1,o=r.compress,a,u;typeof e=="string"?(a=Buffer.byteLength(e),u=!1):Ke(e)?(a=e.size,u=!1):(e=Le(e),a=e.length,u=Le.readOnly),this._firstFragment?(this._firstFragment=!1,o&&n&&n.params[n._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(o=a>=n._threshold),this._compress=o):(o=!1,i=0),r.fin&&(this._firstFragment=!0);let c={[K]:a,fin:r.fin,generateMask:this._generateMask,mask:r.mask,maskBuffer:this._maskBuffer,opcode:i,readOnly:u,rsv1:o};Ke(e)?this._state!==re?this.enqueue([this.getBlobData,e,this._compress,c,s]):this.getBlobData(e,this._compress,c,s):this._state!==re?this.enqueue([this.dispatch,e,this._compress,c,s]):this.dispatch(e,this._compress,c,s)}getBlobData(e,r,s,n){this._bufferedBytes+=s[K],this._state=Gc,e.arrayBuffer().then(i=>{if(this._socket.destroyed){let a=new Error("The socket was closed while the blob was being read");process.nextTick(qs,this,a,n);return}this._bufferedBytes-=s[K];let o=Le(i);r?this.dispatch(o,r,s,n):(this._state=re,this.sendFrame(t.frame(o,s),n),this.dequeue())}).catch(i=>{process.nextTick(zc,this,i,n)})}dispatch(e,r,s,n){if(!r){this.sendFrame(t.frame(e,s),n);return}let i=this._extensions[so.extensionName];this._bufferedBytes+=s[K],this._state=Hc,i.compress(e,s.fin,(o,a)=>{if(this._socket.destroyed){let u=new Error("The socket was closed while data was being compressed");qs(this,u,n);return}this._bufferedBytes-=s[K],this._state=re,s.readOnly=!1,this.sendFrame(t.frame(a,s),n),this.dequeue()})}dequeue(){for(;this._state===re&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[3][K],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][K],this._queue.push(e)}sendFrame(e,r){e.length===2?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],r),this._socket.uncork()):this._socket.write(e[0],r)}};io.exports=vs;function qs(t,e,r){typeof r=="function"&&r(e);for(let s=0;s<t._queue.length;s++){let n=t._queue[s],i=n[n.length-1];typeof i=="function"&&i(e)}}function zc(t,e,r){qs(t,e,r),t.onerror(e)}});var _o=f((i_,po)=>{"use strict";var{kForOnEventAttribute:Rt,kListener:xs}=_e(),oo=Symbol("kCode"),ao=Symbol("kData"),uo=Symbol("kError"),co=Symbol("kMessage"),lo=Symbol("kReason"),Qe=Symbol("kTarget"),fo=Symbol("kType"),ho=Symbol("kWasClean"),me=class{constructor(e){this[Qe]=null,this[fo]=e}get target(){return this[Qe]}get type(){return this[fo]}};Object.defineProperty(me.prototype,"target",{enumerable:!0});Object.defineProperty(me.prototype,"type",{enumerable:!0});var Me=class extends me{constructor(e,r={}){super(e),this[oo]=r.code===void 0?0:r.code,this[lo]=r.reason===void 0?"":r.reason,this[ho]=r.wasClean===void 0?!1:r.wasClean}get code(){return this[oo]}get reason(){return this[lo]}get wasClean(){return this[ho]}};Object.defineProperty(Me.prototype,"code",{enumerable:!0});Object.defineProperty(Me.prototype,"reason",{enumerable:!0});Object.defineProperty(Me.prototype,"wasClean",{enumerable:!0});var Xe=class extends me{constructor(e,r={}){super(e),this[uo]=r.error===void 0?null:r.error,this[co]=r.message===void 0?"":r.message}get error(){return this[uo]}get message(){return this[co]}};Object.defineProperty(Xe.prototype,"error",{enumerable:!0});Object.defineProperty(Xe.prototype,"message",{enumerable:!0});var Ot=class extends me{constructor(e,r={}){super(e),this[ao]=r.data===void 0?null:r.data}get data(){return this[ao]}};Object.defineProperty(Ot.prototype,"data",{enumerable:!0});var Jc={addEventListener(t,e,r={}){for(let n of this.listeners(t))if(!r[Rt]&&n[xs]===e&&!n[Rt])return;let s;if(t==="message")s=function(i,o){let a=new Ot("message",{data:o?i:i.toString()});a[Qe]=this,tr(e,this,a)};else if(t==="close")s=function(i,o){let a=new Me("close",{code:i,reason:o.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});a[Qe]=this,tr(e,this,a)};else if(t==="error")s=function(i){let o=new Xe("error",{error:i,message:i.message});o[Qe]=this,tr(e,this,o)};else if(t==="open")s=function(){let i=new me("open");i[Qe]=this,tr(e,this,i)};else return;s[Rt]=!!r[Rt],s[xs]=e,r.once?this.once(t,s):this.on(t,s)},removeEventListener(t,e){for(let r of this.listeners(t))if(r[xs]===e&&!r[Rt]){this.removeListener(t,r);break}}};po.exports={CloseEvent:Me,ErrorEvent:Xe,Event:me,EventTarget:Jc,MessageEvent:Ot};function tr(t,e,r){typeof t=="object"&&t.handleEvent?t.handleEvent.call(t,r):t.call(e,r)}});var Rs=f((o_,yo)=>{"use strict";var{tokenChars:Pt}=Je();function ae(t,e,r){t[e]===void 0?t[e]=[r]:t[e].push(r)}function Kc(t){let e=Object.create(null),r=Object.create(null),s=!1,n=!1,i=!1,o,a,u=-1,c=-1,h=-1,d=0;for(;d<t.length;d++)if(c=t.charCodeAt(d),o===void 0)if(h===-1&&Pt[c]===1)u===-1&&(u=d);else if(d!==0&&(c===32||c===9))h===-1&&u!==-1&&(h=d);else if(c===59||c===44){if(u===-1)throw new SyntaxError(`Unexpected character at index ${d}`);h===-1&&(h=d);let S=t.slice(u,h);c===44?(ae(e,S,r),r=Object.create(null)):o=S,u=h=-1}else throw new SyntaxError(`Unexpected character at index ${d}`);else if(a===void 0)if(h===-1&&Pt[c]===1)u===-1&&(u=d);else if(c===32||c===9)h===-1&&u!==-1&&(h=d);else if(c===59||c===44){if(u===-1)throw new SyntaxError(`Unexpected character at index ${d}`);h===-1&&(h=d),ae(r,t.slice(u,h),!0),c===44&&(ae(e,o,r),r=Object.create(null),o=void 0),u=h=-1}else if(c===61&&u!==-1&&h===-1)a=t.slice(u,d),u=h=-1;else throw new SyntaxError(`Unexpected character at index ${d}`);else if(n){if(Pt[c]!==1)throw new SyntaxError(`Unexpected character at index ${d}`);u===-1?u=d:s||(s=!0),n=!1}else if(i)if(Pt[c]===1)u===-1&&(u=d);else if(c===34&&u!==-1)i=!1,h=d;else if(c===92)n=!0;else throw new SyntaxError(`Unexpected character at index ${d}`);else if(c===34&&t.charCodeAt(d-1)===61)i=!0;else if(h===-1&&Pt[c]===1)u===-1&&(u=d);else if(u!==-1&&(c===32||c===9))h===-1&&(h=d);else if(c===59||c===44){if(u===-1)throw new SyntaxError(`Unexpected character at index ${d}`);h===-1&&(h=d);let S=t.slice(u,h);s&&(S=S.replace(/\\/g,""),s=!1),ae(r,a,S),c===44&&(ae(e,o,r),r=Object.create(null),o=void 0),a=void 0,u=h=-1}else throw new SyntaxError(`Unexpected character at index ${d}`);if(u===-1||i||c===32||c===9)throw new SyntaxError("Unexpected end of input");h===-1&&(h=d);let b=t.slice(u,h);return o===void 0?ae(e,b,r):(a===void 0?ae(r,b,!0):s?ae(r,a,b.replace(/\\/g,"")):ae(r,a,b),ae(e,o,r)),e}function Yc(t){return Object.keys(t).map(e=>{let r=t[e];return Array.isArray(r)||(r=[r]),r.map(s=>[e].concat(Object.keys(s).map(n=>{let i=s[n];return Array.isArray(i)||(i=[i]),i.map(o=>o===!0?n:`${n}=${o}`).join("; ")})).join("; ")).join(", ")}).join(", ")}yo.exports={format:Yc,parse:Kc}});var js=f((c_,Oo)=>{"use strict";var Qc=require("events"),Xc=require("https"),Zc=require("http"),wo=require("net"),el=require("tls"),{randomBytes:tl,createHash:rl}=require("crypto"),{Duplex:a_,Readable:u_}=require("stream"),{URL:Os}=require("url"),qe=xt(),sl=Es(),nl=Cs(),{isBlob:il}=Je(),{BINARY_TYPES:mo,EMPTY_BUFFER:rr,GUID:ol,kForOnEventAttribute:Ps,kListener:al,kStatusCode:ul,kWebSocket:I,NOOP:go}=_e(),{EventTarget:{addEventListener:cl,removeEventListener:ll}}=_o(),{format:fl,parse:hl}=Rs(),{toBuffer:dl}=vt(),pl=30*1e3,So=Symbol("kAborted"),Ts=[8,13],be=["CONNECTING","OPEN","CLOSING","CLOSED"],_l=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/,v=class t extends Qc{constructor(e,r,s){super(),this._binaryType=mo[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=rr,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=t.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,e!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,r===void 0?r=[]:Array.isArray(r)||(typeof r=="object"&&r!==null?(s=r,r=[]):r=[r]),Eo(this,e,r,s)):(this._autoPong=s.autoPong,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){mo.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,r,s){let n=new sl({allowSynchronousEvents:s.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:s.maxPayload,skipUTF8Validation:s.skipUTF8Validation}),i=new nl(e,this._extensions,s.generateMask);this._receiver=n,this._sender=i,this._socket=e,n[I]=this,i[I]=this,e[I]=this,n.on("conclude",bl),n.on("drain",wl),n.on("error",gl),n.on("message",Sl),n.on("ping",El),n.on("pong",vl),i.onerror=ql,e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),r.length>0&&e.unshift(r),e.on("close",Co),e.on("data",nr),e.on("end",xo),e.on("error",Ro),this._readyState=t.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=t.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[qe.extensionName]&&this._extensions[qe.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=t.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,r){if(this.readyState!==t.CLOSED){if(this.readyState===t.CONNECTING){D(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===t.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=t.CLOSING,this._sender.close(e,r,!this._isServer,s=>{s||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),qo(this)}}pause(){this.readyState===t.CONNECTING||this.readyState===t.CLOSED||(this._paused=!0,this._socket.pause())}ping(e,r,s){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(s=e,e=r=void 0):typeof r=="function"&&(s=r,r=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){Is(this,e,s);return}r===void 0&&(r=!this._isServer),this._sender.ping(e||rr,r,s)}pong(e,r,s){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(s=e,e=r=void 0):typeof r=="function"&&(s=r,r=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){Is(this,e,s);return}r===void 0&&(r=!this._isServer),this._sender.pong(e||rr,r,s)}resume(){this.readyState===t.CONNECTING||this.readyState===t.CLOSED||(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,r,s){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof r=="function"&&(s=r,r={}),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){Is(this,e,s);return}let n={binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0,...r};this._extensions[qe.extensionName]||(n.compress=!1),this._sender.send(e||rr,n,s)}terminate(){if(this.readyState!==t.CLOSED){if(this.readyState===t.CONNECTING){D(this,this._req,"WebSocket was closed before the connection was established");return}this._socket&&(this._readyState=t.CLOSING,this._socket.destroy())}}};Object.defineProperty(v,"CONNECTING",{enumerable:!0,value:be.indexOf("CONNECTING")});Object.defineProperty(v.prototype,"CONNECTING",{enumerable:!0,value:be.indexOf("CONNECTING")});Object.defineProperty(v,"OPEN",{enumerable:!0,value:be.indexOf("OPEN")});Object.defineProperty(v.prototype,"OPEN",{enumerable:!0,value:be.indexOf("OPEN")});Object.defineProperty(v,"CLOSING",{enumerable:!0,value:be.indexOf("CLOSING")});Object.defineProperty(v.prototype,"CLOSING",{enumerable:!0,value:be.indexOf("CLOSING")});Object.defineProperty(v,"CLOSED",{enumerable:!0,value:be.indexOf("CLOSED")});Object.defineProperty(v.prototype,"CLOSED",{enumerable:!0,value:be.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(t=>{Object.defineProperty(v.prototype,t,{enumerable:!0})});["open","error","close","message"].forEach(t=>{Object.defineProperty(v.prototype,`on${t}`,{enumerable:!0,get(){for(let e of this.listeners(t))if(e[Ps])return e[al];return null},set(e){for(let r of this.listeners(t))if(r[Ps]){this.removeListener(t,r);break}typeof e=="function"&&this.addEventListener(t,e,{[Ps]:!0})}})});v.prototype.addEventListener=cl;v.prototype.removeEventListener=ll;Oo.exports=v;function Eo(t,e,r,s){let n={allowSynchronousEvents:!0,autoPong:!0,protocolVersion:Ts[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...s,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(t._autoPong=n.autoPong,!Ts.includes(n.protocolVersion))throw new RangeError(`Unsupported protocol version: ${n.protocolVersion} (supported versions: ${Ts.join(", ")})`);let i;if(e instanceof Os)i=e;else try{i=new Os(e)}catch{throw new SyntaxError(`Invalid URL: ${e}`)}i.protocol==="http:"?i.protocol="ws:":i.protocol==="https:"&&(i.protocol="wss:"),t._url=i.href;let o=i.protocol==="wss:",a=i.protocol==="ws+unix:",u;if(i.protocol!=="ws:"&&!o&&!a?u=`The URL's protocol must be one of "ws:", "wss:", "http:", "https", or "ws+unix:"`:a&&!i.pathname?u="The URL's pathname is empty":i.hash&&(u="The URL contains a fragment identifier"),u){let _=new SyntaxError(u);if(t._redirects===0)throw _;sr(t,_);return}let c=o?443:80,h=tl(16).toString("base64"),d=o?Xc.request:Zc.request,b=new Set,S;if(n.createConnection=n.createConnection||(o?ml:yl),n.defaultPort=n.defaultPort||c,n.port=i.port||c,n.host=i.hostname.startsWith("[")?i.hostname.slice(1,-1):i.hostname,n.headers={...n.headers,"Sec-WebSocket-Version":n.protocolVersion,"Sec-WebSocket-Key":h,Connection:"Upgrade",Upgrade:"websocket"},n.path=i.pathname+i.search,n.timeout=n.handshakeTimeout,n.perMessageDeflate&&(S=new qe(n.perMessageDeflate!==!0?n.perMessageDeflate:{},!1,n.maxPayload),n.headers["Sec-WebSocket-Extensions"]=fl({[qe.extensionName]:S.offer()})),r.length){for(let _ of r){if(typeof _!="string"||!_l.test(_)||b.has(_))throw new SyntaxError("An invalid or duplicated subprotocol was specified");b.add(_)}n.headers["Sec-WebSocket-Protocol"]=r.join(",")}if(n.origin&&(n.protocolVersion<13?n.headers["Sec-WebSocket-Origin"]=n.origin:n.headers.Origin=n.origin),(i.username||i.password)&&(n.auth=`${i.username}:${i.password}`),a){let _=n.path.split(":");n.socketPath=_[0],n.path=_[1]}let y;if(n.followRedirects){if(t._redirects===0){t._originalIpc=a,t._originalSecure=o,t._originalHostOrSocketPath=a?n.socketPath:i.host;let _=s&&s.headers;if(s={...s,headers:{}},_)for(let[g,N]of Object.entries(_))s.headers[g.toLowerCase()]=N}else if(t.listenerCount("redirect")===0){let _=a?t._originalIpc?n.socketPath===t._originalHostOrSocketPath:!1:t._originalIpc?!1:i.host===t._originalHostOrSocketPath;(!_||t._originalSecure&&!o)&&(delete n.headers.authorization,delete n.headers.cookie,_||delete n.headers.host,n.auth=void 0)}n.auth&&!s.headers.authorization&&(s.headers.authorization="Basic "+Buffer.from(n.auth).toString("base64")),y=t._req=d(n),t._redirects&&t.emit("redirect",t.url,y)}else y=t._req=d(n);n.timeout&&y.on("timeout",()=>{D(t,y,"Opening handshake has timed out")}),y.on("error",_=>{y===null||y[So]||(y=t._req=null,sr(t,_))}),y.on("response",_=>{let g=_.headers.location,N=_.statusCode;if(g&&n.followRedirects&&N>=300&&N<400){if(++t._redirects>n.maxRedirects){D(t,y,"Maximum redirects exceeded");return}y.abort();let fe;try{fe=new Os(g,e)}catch{let he=new SyntaxError(`Invalid URL: ${g}`);sr(t,he);return}Eo(t,fe,r,s)}else t.emit("unexpected-response",y,_)||D(t,y,`Unexpected server response: ${_.statusCode}`)}),y.on("upgrade",(_,g,N)=>{if(t.emit("upgrade",_),t.readyState!==v.CONNECTING)return;y=t._req=null;let fe=_.headers.upgrade;if(fe===void 0||fe.toLowerCase()!=="websocket"){D(t,g,"Invalid Upgrade header");return}let mt=rl("sha1").update(h+ol).digest("base64");if(_.headers["sec-websocket-accept"]!==mt){D(t,g,"Invalid Sec-WebSocket-Accept header");return}let he=_.headers["sec-websocket-protocol"],H;if(he!==void 0?b.size?b.has(he)||(H="Server sent an invalid subprotocol"):H="Server sent a subprotocol but none was requested":b.size&&(H="Server sent no subprotocol"),H){D(t,g,H);return}he&&(t._protocol=he);let bt=_.headers["sec-websocket-extensions"];if(bt!==void 0){if(!S){D(t,g,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let wt;try{wt=hl(bt)}catch{D(t,g,"Invalid Sec-WebSocket-Extensions header");return}let Ut=Object.keys(wt);if(Ut.length!==1||Ut[0]!==qe.extensionName){D(t,g,"Server indicated an extension that was not requested");return}try{S.accept(wt[qe.extensionName])}catch{D(t,g,"Invalid Sec-WebSocket-Extensions header");return}t._extensions[qe.extensionName]=S}t.setSocket(g,N,{allowSynchronousEvents:n.allowSynchronousEvents,generateMask:n.generateMask,maxPayload:n.maxPayload,skipUTF8Validation:n.skipUTF8Validation})}),n.finishRequest?n.finishRequest(y,t):y.end()}function sr(t,e){t._readyState=v.CLOSING,t._errorEmitted=!0,t.emit("error",e),t.emitClose()}function yl(t){return t.path=t.socketPath,wo.connect(t)}function ml(t){return t.path=void 0,!t.servername&&t.servername!==""&&(t.servername=wo.isIP(t.host)?"":t.host),el.connect(t)}function D(t,e,r){t._readyState=v.CLOSING;let s=new Error(r);Error.captureStackTrace(s,D),e.setHeader?(e[So]=!0,e.abort(),e.socket&&!e.socket.destroyed&&e.socket.destroy(),process.nextTick(sr,t,s)):(e.destroy(s),e.once("error",t.emit.bind(t,"error")),e.once("close",t.emitClose.bind(t)))}function Is(t,e,r){if(e){let s=il(e)?e.size:dl(e).length;t._socket?t._sender._bufferedBytes+=s:t._bufferedAmount+=s}if(r){let s=new Error(`WebSocket is not open: readyState ${t.readyState} (${be[t.readyState]})`);process.nextTick(r,s)}}function bl(t,e){let r=this[I];r._closeFrameReceived=!0,r._closeMessage=e,r._closeCode=t,r._socket[I]!==void 0&&(r._socket.removeListener("data",nr),process.nextTick(vo,r._socket),t===1005?r.close():r.close(t,e))}function wl(){let t=this[I];t.isPaused||t._socket.resume()}function gl(t){let e=this[I];e._socket[I]!==void 0&&(e._socket.removeListener("data",nr),process.nextTick(vo,e._socket),e.close(t[ul])),e._errorEmitted||(e._errorEmitted=!0,e.emit("error",t))}function bo(){this[I].emitClose()}function Sl(t,e){this[I].emit("message",t,e)}function El(t){let e=this[I];e._autoPong&&e.pong(t,!this._isServer,go),e.emit("ping",t)}function vl(t){this[I].emit("pong",t)}function vo(t){t.resume()}function ql(t){let e=this[I];e.readyState!==v.CLOSED&&(e.readyState===v.OPEN&&(e._readyState=v.CLOSING,qo(e)),this._socket.end(),e._errorEmitted||(e._errorEmitted=!0,e.emit("error",t)))}function qo(t){t._closeTimer=setTimeout(t._socket.destroy.bind(t._socket),pl)}function Co(){let t=this[I];this.removeListener("close",Co),this.removeListener("data",nr),this.removeListener("end",xo),t._readyState=v.CLOSING;let e;!this._readableState.endEmitted&&!t._closeFrameReceived&&!t._receiver._writableState.errorEmitted&&(e=t._socket.read())!==null&&t._receiver.write(e),t._receiver.end(),this[I]=void 0,clearTimeout(t._closeTimer),t._receiver._writableState.finished||t._receiver._writableState.errorEmitted?t.emitClose():(t._receiver.on("error",bo),t._receiver.on("finish",bo))}function nr(t){this[I]._receiver.write(t)||this.pause()}function xo(){let t=this[I];t._readyState=v.CLOSING,t._receiver.end(),this.end()}function Ro(){let t=this[I];this.removeListener("error",Ro),this.on("error",go),t&&(t._readyState=v.CLOSING,this.destroy())}});var jo=f((l_,Io)=>{"use strict";var{Duplex:Cl}=require("stream");function Po(t){t.emit("close")}function xl(){!this.destroyed&&this._writableState.finished&&this.destroy()}function To(t){this.removeListener("error",To),this.destroy(),this.listenerCount("error")===0&&this.emit("error",t)}function Rl(t,e){let r=!0,s=new Cl({...e,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return t.on("message",function(i,o){let a=!o&&s._readableState.objectMode?i.toString():i;s.push(a)||t.pause()}),t.once("error",function(i){s.destroyed||(r=!1,s.destroy(i))}),t.once("close",function(){s.destroyed||s.push(null)}),s._destroy=function(n,i){if(t.readyState===t.CLOSED){i(n),process.nextTick(Po,s);return}let o=!1;t.once("error",function(u){o=!0,i(u)}),t.once("close",function(){o||i(n),process.nextTick(Po,s)}),r&&t.terminate()},s._final=function(n){if(t.readyState===t.CONNECTING){t.once("open",function(){s._final(n)});return}t._socket!==null&&(t._socket._writableState.finished?(n(),s._readableState.endEmitted&&s.destroy()):(t._socket.once("finish",function(){n()}),t.close()))},s._read=function(){t.isPaused&&t.resume()},s._write=function(n,i,o){if(t.readyState===t.CONNECTING){t.once("open",function(){s._write(n,i,o)});return}t.send(n,o)},s.on("end",xl),s.on("error",To),s}Io.exports=Rl});var Bo=f((f_,Lo)=>{"use strict";var{tokenChars:Ol}=Je();function Pl(t){let e=new Set,r=-1,s=-1,n=0;for(n;n<t.length;n++){let o=t.charCodeAt(n);if(s===-1&&Ol[o]===1)r===-1&&(r=n);else if(n!==0&&(o===32||o===9))s===-1&&r!==-1&&(s=n);else if(o===44){if(r===-1)throw new SyntaxError(`Unexpected character at index ${n}`);s===-1&&(s=n);let a=t.slice(r,s);if(e.has(a))throw new SyntaxError(`The "${a}" subprotocol is duplicated`);e.add(a),r=s=-1}else throw new SyntaxError(`Unexpected character at index ${n}`)}if(r===-1||s!==-1)throw new SyntaxError("Unexpected end of input");let i=t.slice(r,n);if(e.has(i))throw new SyntaxError(`The "${i}" subprotocol is duplicated`);return e.add(i),e}Lo.exports={parse:Pl}});var Fo=f((d_,Do)=>{"use strict";var Tl=require("events"),ir=require("http"),{Duplex:h_}=require("stream"),{createHash:Il}=require("crypto"),Mo=Rs(),Ae=xt(),jl=Bo(),Ll=js(),{GUID:Bl,kWebSocket:Ml}=_e(),Al=/^[+/0-9A-Za-z]{22}==$/,Ao=0,Uo=1,ko=2,Ls=class extends Tl{constructor(e,r){if(super(),e={allowSynchronousEvents:!0,autoPong:!0,maxPayload:100*1024*1024,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:Ll,...e},e.port==null&&!e.server&&!e.noServer||e.port!=null&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(e.port!=null?(this._server=ir.createServer((s,n)=>{let i=ir.STATUS_CODES[426];n.writeHead(426,{"Content-Length":i.length,"Content-Type":"text/plain"}),n.end(i)}),this._server.listen(e.port,e.host,e.backlog,r)):e.server&&(this._server=e.server),this._server){let s=this.emit.bind(this,"connection");this._removeListeners=Ul(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(n,i,o)=>{this.handleUpgrade(n,i,o,s)}})}e.perMessageDeflate===!0&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=Ao}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(this._state===ko){e&&this.once("close",()=>{e(new Error("The server is not running"))}),process.nextTick(Tt,this);return}if(e&&this.once("close",e),this._state!==Uo)if(this._state=Uo,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients?this.clients.size?this._shouldEmitClose=!0:process.nextTick(Tt,this):process.nextTick(Tt,this);else{let r=this._server;this._removeListeners(),this._removeListeners=this._server=null,r.close(()=>{Tt(this)})}}shouldHandle(e){if(this.options.path){let r=e.url.indexOf("?");if((r!==-1?e.url.slice(0,r):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,r,s,n){r.on("error",No);let i=e.headers["sec-websocket-key"],o=e.headers.upgrade,a=+e.headers["sec-websocket-version"];if(e.method!=="GET"){Ue(this,e,r,405,"Invalid HTTP method");return}if(o===void 0||o.toLowerCase()!=="websocket"){Ue(this,e,r,400,"Invalid Upgrade header");return}if(i===void 0||!Al.test(i)){Ue(this,e,r,400,"Missing or invalid Sec-WebSocket-Key header");return}if(a!==8&&a!==13){Ue(this,e,r,400,"Missing or invalid Sec-WebSocket-Version header");return}if(!this.shouldHandle(e)){It(r,400);return}let u=e.headers["sec-websocket-protocol"],c=new Set;if(u!==void 0)try{c=jl.parse(u)}catch{Ue(this,e,r,400,"Invalid Sec-WebSocket-Protocol header");return}let h=e.headers["sec-websocket-extensions"],d={};if(this.options.perMessageDeflate&&h!==void 0){let b=new Ae(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let S=Mo.parse(h);S[Ae.extensionName]&&(b.accept(S[Ae.extensionName]),d[Ae.extensionName]=b)}catch{Ue(this,e,r,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let b={origin:e.headers[`${a===8?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(this.options.verifyClient.length===2){this.options.verifyClient(b,(S,y,_,g)=>{if(!S)return It(r,y||401,_,g);this.completeUpgrade(d,i,c,e,r,s,n)});return}if(!this.options.verifyClient(b))return It(r,401)}this.completeUpgrade(d,i,c,e,r,s,n)}completeUpgrade(e,r,s,n,i,o,a){if(!i.readable||!i.writable)return i.destroy();if(i[Ml])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>Ao)return It(i,503);let c=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${Il("sha1").update(r+Bl).digest("base64")}`],h=new this.options.WebSocket(null,void 0,this.options);if(s.size){let d=this.options.handleProtocols?this.options.handleProtocols(s,n):s.values().next().value;d&&(c.push(`Sec-WebSocket-Protocol: ${d}`),h._protocol=d)}if(e[Ae.extensionName]){let d=e[Ae.extensionName].params,b=Mo.format({[Ae.extensionName]:[d]});c.push(`Sec-WebSocket-Extensions: ${b}`),h._extensions=e}this.emit("headers",c,n),i.write(c.concat(`\r
`).join(`\r
`)),i.removeListener("error",No),h.setSocket(i,o,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(h),h.on("close",()=>{this.clients.delete(h),this._shouldEmitClose&&!this.clients.size&&process.nextTick(Tt,this)})),a(h,n)}};Do.exports=Ls;function Ul(t,e){for(let r of Object.keys(e))t.on(r,e[r]);return function(){for(let s of Object.keys(e))t.removeListener(s,e[s])}}function Tt(t){t._state=ko,t.emit("close")}function No(){this.destroy()}function It(t,e,r,s){r=r||ir.STATUS_CODES[e],s={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(r),...s},t.once("finish",t.destroy),t.end(`HTTP/1.1 ${e} ${ir.STATUS_CODES[e]}\r
`+Object.keys(s).map(n=>`${n}: ${s[n]}`).join(`\r
`)+`\r
\r
`+r)}function Ue(t,e,r,s,n){if(t.listenerCount("wsClientError")){let i=new Error(n);Error.captureStackTrace(i,Ue),t.emit("wsClientError",i,r,e)}else It(r,s,n)}});var Wo=f((p_,$o)=>{"use strict";var we=js();we.createWebSocketStream=jo();we.Server=Fo();we.Receiver=Es();we.Sender=Cs();we.WebSocket=we;we.WebSocketServer=we.Server;$o.exports=we});var Bs=f((__,Vo)=>{"use strict";var{WebSocket:Nl}=Wo();Vo.exports={WebSocket:Nl}});var ar=f(or=>{"use strict";Object.defineProperty(or,"__esModule",{value:!0});or.Client=void 0;var Ms=class{constructor(){this.intMode="number"}intMode};or.Client=Ms});var C=f(q=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0});q.MisuseError=q.InternalError=q.ProtocolVersionError=q.LibsqlUrlParseError=q.HttpServerError=q.WebSocketError=q.WebSocketUnsupportedError=q.ClosedError=q.ResponseError=q.ProtoError=q.ClientError=void 0;var F=class extends Error{constructor(e){super(e),this.name="ClientError"}};q.ClientError=F;var As=class extends F{constructor(e){super(e),this.name="ProtoError"}};q.ProtoError=As;var Us=class extends F{code;proto;constructor(e,r){super(e),this.name="ResponseError",this.code=r.code,this.proto=r,this.stack=void 0}};q.ResponseError=Us;var Ns=class extends F{constructor(e,r){r!==void 0?(super(`${e}: ${r}`),this.cause=r):super(e),this.name="ClosedError"}};q.ClosedError=Ns;var ks=class extends F{constructor(e){super(e),this.name="WebSocketUnsupportedError"}};q.WebSocketUnsupportedError=ks;var Ds=class extends F{constructor(e){super(e),this.name="WebSocketError"}};q.WebSocketError=Ds;var Fs=class extends F{status;constructor(e,r){super(e),this.status=r,this.name="HttpServerError"}};q.HttpServerError=Fs;var $s=class extends F{constructor(e){super(e),this.name="LibsqlUrlParseError"}};q.LibsqlUrlParseError=$s;var Ws=class extends F{constructor(e){super(e),this.name="ProtocolVersionError"}};q.ProtocolVersionError=Ws;var Vs=class extends F{constructor(e){super(e),this.name="InternalError"}};q.InternalError=Vs;var Hs=class extends F{constructor(e){super(e),this.name="MisuseError"}};q.MisuseError=Hs});var et=f(j=>{"use strict";Object.defineProperty(j,"__esModule",{value:!0});j.readJsonObject=j.arrayObjectsMap=j.object=j.array=j.boolean=j.number=j.stringOpt=j.string=void 0;var Ho=C();function kl(t){if(typeof t=="string")return t;throw Ze(t,"string")}j.string=kl;function Dl(t){if(t!=null){if(typeof t=="string")return t;throw Ze(t,"string or null")}}j.stringOpt=Dl;function Fl(t){if(typeof t=="number")return t;throw Ze(t,"number")}j.number=Fl;function $l(t){if(typeof t=="boolean")return t;throw Ze(t,"boolean")}j.boolean=$l;function Go(t){if(Array.isArray(t))return t;throw Ze(t,"array")}j.array=Go;function Gs(t){if(t!==null&&typeof t=="object"&&!Array.isArray(t))return t;throw Ze(t,"object")}j.object=Gs;function Wl(t,e){return Go(t).map(r=>e(Gs(r)))}j.arrayObjectsMap=Wl;function Ze(t,e){if(t===void 0)return new Ho.ProtoError(`Expected ${e}, but the property was missing`);let r=typeof t;return t===null?r="null":Array.isArray(t)&&(r="array"),new Ho.ProtoError(`Expected ${e}, received ${r}`)}function Vl(t,e){return e(Gs(t))}j.readJsonObject=Vl});var zo=f(tt=>{"use strict";Object.defineProperty(tt,"__esModule",{value:!0});tt.writeJsonObject=tt.ObjectWriter=void 0;var ur=class{#e;#t;constructor(e){this.#e=e,this.#t=!1}begin(){this.#e.push("{"),this.#t=!0}end(){this.#e.push("}"),this.#t=!1}#r(e){this.#t?(this.#e.push('"'),this.#t=!1):this.#e.push(',"'),this.#e.push(e),this.#e.push('":')}string(e,r){this.#r(e),this.#e.push(JSON.stringify(r))}stringRaw(e,r){this.#r(e),this.#e.push('"'),this.#e.push(r),this.#e.push('"')}number(e,r){this.#r(e),this.#e.push(""+r)}boolean(e,r){this.#r(e),this.#e.push(r?"true":"false")}object(e,r,s){this.#r(e),this.begin(),s(this,r),this.end()}arrayObjects(e,r,s){this.#r(e),this.#e.push("[");for(let n=0;n<r.length;++n)n!==0&&this.#e.push(","),this.begin(),s(this,r[n]),this.end();this.#e.push("]")}};tt.ObjectWriter=ur;function Hl(t,e){let r=[],s=new ur(r);return s.begin(),e(s,t),s.end(),r.join("")}tt.writeJsonObject=Hl});var zs=f(k=>{"use strict";Object.defineProperty(k,"__esModule",{value:!0});k.FIXED_32=k.GROUP_END=k.GROUP_START=k.LENGTH_DELIMITED=k.FIXED_64=k.VARINT=void 0;k.VARINT=0;k.FIXED_64=1;k.LENGTH_DELIMITED=2;k.GROUP_START=3;k.GROUP_END=4;k.FIXED_32=5});var Ks=f(rt=>{"use strict";Object.defineProperty(rt,"__esModule",{value:!0});rt.readProtobufMessage=rt.FieldReader=void 0;var Jo=C(),Ce=zs(),Js=class{#e;#t;#r;constructor(e){this.#e=e,this.#t=new DataView(e.buffer,e.byteOffset,e.byteLength),this.#r=0}varint(){let e=0;for(let r=0;;r+=7){let s=this.#e[this.#r++];if(e|=(s&127)<<r,!(s&128))break}return e}varintBig(){let e=0n;for(let r=0n;;r+=7n){let s=this.#e[this.#r++];if(e|=BigInt(s&127)<<r,!(s&128))break}return e}bytes(e){let r=new Uint8Array(this.#e.buffer,this.#e.byteOffset+this.#r,e);return this.#r+=e,r}double(){let e=this.#t.getFloat64(this.#r,!0);return this.#r+=8,e}skipVarint(){for(;this.#e[this.#r++]&128;);}skip(e){this.#r+=e}eof(){return this.#r>=this.#e.byteLength}},cr=class{#e;#t;constructor(e){this.#e=e,this.#t=-1}setup(e){this.#t=e}#r(e){if(this.#t!==e)throw new Jo.ProtoError(`Expected wire type ${e}, got ${this.#t}`);this.#t=-1}bytes(){this.#r(Ce.LENGTH_DELIMITED);let e=this.#e.varint();return this.#e.bytes(e)}string(){return new TextDecoder().decode(this.bytes())}message(e){return Ko(this.bytes(),e)}int32(){return this.#r(Ce.VARINT),this.#e.varint()}uint32(){return this.int32()}bool(){return this.int32()!==0}uint64(){return this.#r(Ce.VARINT),this.#e.varintBig()}sint64(){let e=this.uint64();return e>>1n^-(e&1n)}double(){return this.#r(Ce.FIXED_64),this.#e.double()}maybeSkip(){if(!(this.#t<0)){if(this.#t===Ce.VARINT)this.#e.skipVarint();else if(this.#t===Ce.FIXED_64)this.#e.skip(8);else if(this.#t===Ce.LENGTH_DELIMITED){let e=this.#e.varint();this.#e.skip(e)}else if(this.#t===Ce.FIXED_32)this.#e.skip(4);else throw new Jo.ProtoError(`Unexpected wire type ${this.#t}`);this.#t=-1}}};rt.FieldReader=cr;function Ko(t,e){let r=new Js(t),s=new cr(r),n=e.default();for(;!r.eof();){let i=r.varint(),o=i>>3,a=i&7;s.setup(a);let u=e[o];if(u!==void 0){let c=u(s,n);c!==void 0&&(n=c)}s.maybeSkip()}return n}rt.readProtobufMessage=Ko});var Yo=f(st=>{"use strict";Object.defineProperty(st,"__esModule",{value:!0});st.writeProtobufMessage=st.MessageWriter=void 0;var lr=zs(),fr=class t{#e;#t;#r;#s;constructor(){this.#e=new ArrayBuffer(256),this.#t=new Uint8Array(this.#e),this.#r=new DataView(this.#e),this.#s=0}#i(e){if(this.#s+e<=this.#e.byteLength)return;let r=this.#e.byteLength;for(;r<this.#s+e;)r*=2;let s=new ArrayBuffer(r),n=new Uint8Array(s),i=new DataView(s);n.set(new Uint8Array(this.#e,0,this.#s)),this.#e=s,this.#t=n,this.#r=i}#n(e){this.#i(5),e=0|e;do{let r=e&127;e>>>=7,r|=e?128:0,this.#t[this.#s++]=r}while(e)}#a(e){this.#i(10),e=e&0xffffffffffffffffn;do{let r=Number(e&0x7fn);e>>=7n,r|=e?128:0,this.#t[this.#s++]=r}while(e)}#o(e,r){this.#n(e<<3|r)}bytes(e,r){this.#o(e,lr.LENGTH_DELIMITED),this.#n(r.byteLength),this.#i(r.byteLength),this.#t.set(r,this.#s),this.#s+=r.byteLength}string(e,r){this.bytes(e,new TextEncoder().encode(r))}message(e,r,s){let n=new t;s(n,r),this.bytes(e,n.data())}int32(e,r){this.#o(e,lr.VARINT),this.#n(r)}uint32(e,r){this.int32(e,r)}bool(e,r){this.int32(e,r?1:0)}sint64(e,r){this.#o(e,lr.VARINT),this.#a(r<<1n^r>>63n)}double(e,r){this.#o(e,lr.FIXED_64),this.#i(8),this.#r.setFloat64(this.#s,r,!0),this.#s+=8}data(){return new Uint8Array(this.#e,0,this.#s)}};st.MessageWriter=fr;function Gl(t,e){let r=new fr;return e(r,t),r.data()}st.writeProtobufMessage=Gl});var Ys=f(ue=>{"use strict";Object.defineProperty(ue,"__esModule",{value:!0});ue.writeProtobufMessage=ue.readProtobufMessage=ue.writeJsonObject=ue.readJsonObject=void 0;var zl=et();Object.defineProperty(ue,"readJsonObject",{enumerable:!0,get:function(){return zl.readJsonObject}});var Jl=zo();Object.defineProperty(ue,"writeJsonObject",{enumerable:!0,get:function(){return Jl.writeJsonObject}});var Kl=Ks();Object.defineProperty(ue,"readProtobufMessage",{enumerable:!0,get:function(){return Kl.readProtobufMessage}});var Yl=Yo();Object.defineProperty(ue,"writeProtobufMessage",{enumerable:!0,get:function(){return Yl.writeProtobufMessage}})});var Xs=f(hr=>{"use strict";Object.defineProperty(hr,"__esModule",{value:!0});hr.IdAlloc=void 0;var Ql=C(),Qs=class{#e;#t;constructor(){this.#e=new Set,this.#t=new Set}alloc(){for(let r of this.#t)return this.#t.delete(r),this.#e.add(r),this.#e.has(this.#e.size-1)||this.#t.add(this.#e.size-1),r;let e=this.#e.size;return this.#e.add(e),e}free(e){if(!this.#e.delete(e))throw new Ql.InternalError("Freeing an id that is not allocated");this.#t.delete(this.#e.size),e<this.#e.size&&this.#t.add(e)}};hr.IdAlloc=Qs});var Y=f(dr=>{"use strict";Object.defineProperty(dr,"__esModule",{value:!0});dr.impossible=void 0;var Xl=C();function Zl(t,e){throw new Xl.InternalError(e)}dr.impossible=Zl});var Zs=f(nt=>{"use strict";Object.defineProperty(nt,"__esModule",{value:!0});nt.valueFromProto=nt.valueToProto=void 0;var Qo=C(),ef=Y();function tf(t){if(t===null)return null;if(typeof t=="string")return t;if(typeof t=="number"){if(!Number.isFinite(t))throw new RangeError("Only finite numbers (not Infinity or NaN) can be passed as arguments");return t}else if(typeof t=="bigint"){if(t<rf||t>sf)throw new RangeError("This bigint value is too large to be represented as a 64-bit integer and passed as argument");return t}else{if(typeof t=="boolean")return t?1n:0n;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(t instanceof Uint8Array)return t;if(t instanceof Date)return+t.valueOf();if(typeof t=="object")return""+t.toString();throw new TypeError("Unsupported type of value")}}nt.valueToProto=tf;var rf=-9223372036854775808n,sf=9223372036854775807n;function nf(t,e){if(t===null)return null;if(typeof t=="number")return t;if(typeof t=="string")return t;if(typeof t=="bigint")if(e==="number"){let r=Number(t);if(!Number.isSafeInteger(r))throw new RangeError("Received integer which is too large to be safely represented as a JavaScript number");return r}else{if(e==="bigint")return t;if(e==="string")return""+t;throw new Qo.MisuseError("Invalid value for IntMode")}else{if(t instanceof Uint8Array)return t.slice().buffer;throw t===void 0?new Qo.ProtoError("Received unrecognized type of Value"):(0,ef.impossible)(t,"Impossible type of Value")}}nt.valueFromProto=nf});var jt=f(Q=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0});Q.errorFromProto=Q.valueResultFromProto=Q.rowResultFromProto=Q.rowsResultFromProto=Q.stmtResultFromProto=void 0;var of=C(),Xo=Zs();function pr(t){return{affectedRowCount:t.affectedRowCount,lastInsertRowid:t.lastInsertRowid,columnNames:t.cols.map(e=>e.name),columnDecltypes:t.cols.map(e=>e.decltype)}}Q.stmtResultFromProto=pr;function af(t,e){let r=pr(t),s=t.rows.map(n=>Zo(r.columnNames,n,e));return{...r,rows:s}}Q.rowsResultFromProto=af;function uf(t,e){let r=pr(t),s;return t.rows.length>0&&(s=Zo(r.columnNames,t.rows[0],e)),{...r,row:s}}Q.rowResultFromProto=uf;function cf(t,e){let r=pr(t),s;return t.rows.length>0&&r.columnNames.length>0&&(s=(0,Xo.valueFromProto)(t.rows[0][0],e)),{...r,value:s}}Q.valueResultFromProto=cf;function Zo(t,e,r){let s={};Object.defineProperty(s,"length",{value:e.length});for(let n=0;n<e.length;++n){let i=(0,Xo.valueFromProto)(e[n],r);Object.defineProperty(s,n,{value:i});let o=t[n];o!==void 0&&!Object.hasOwn(s,o)&&Object.defineProperty(s,o,{value:i,enumerable:!0,configurable:!0,writable:!0})}return s}function lf(t){return new of.ResponseError(t.message,t)}Q.errorFromProto=lf});var ot=f(it=>{"use strict";Object.defineProperty(it,"__esModule",{value:!0});it.sqlToProto=it.Sql=void 0;var en=C(),_r=class{#e;#t;#r;constructor(e,r){this.#e=e,this.#t=r,this.#r=void 0}_getSqlId(e){if(this.#e!==e)throw new en.MisuseError("Attempted to use SQL text opened with other object");if(this.#r!==void 0)throw new en.ClosedError("SQL text is closed",this.#r);return this.#t}close(){this._setClosed(new en.ClientError("SQL text was manually closed"))}_setClosed(e){this.#r===void 0&&(this.#r=e,this.#e._closeSql(this.#t))}get closed(){return this.#r!==void 0}};it.Sql=_r;function ff(t,e){return e instanceof _r?{sqlId:e._getSqlId(t)}:{sql:""+e}}it.sqlToProto=ff});var mr=f(yr=>{"use strict";Object.defineProperty(yr,"__esModule",{value:!0});yr.Queue=void 0;var tn=class{#e;#t;constructor(){this.#e=[],this.#t=[]}get length(){return this.#e.length+this.#t.length}push(e){this.#e.push(e)}shift(){return this.#t.length===0&&this.#e.length>0&&(this.#t=this.#e.reverse(),this.#e=[]),this.#t.pop()}first(){return this.#t.length!==0?this.#t[this.#t.length-1]:this.#e[0]}};yr.Queue=tn});var wr=f(at=>{"use strict";Object.defineProperty(at,"__esModule",{value:!0});at.stmtToProto=at.Stmt=void 0;var hf=ot(),Lt=Zs(),br=class{sql;_args;_namedArgs;constructor(e){this.sql=e,this._args=[],this._namedArgs=new Map}bindIndexes(e){this._args.length=0;for(let r of e)this._args.push((0,Lt.valueToProto)(r));return this}bindIndex(e,r){if(e!==(e|0)||e<=0)throw new RangeError("Index of a positional argument must be positive integer");for(;this._args.length<e;)this._args.push(null);return this._args[e-1]=(0,Lt.valueToProto)(r),this}bindName(e,r){return this._namedArgs.set(e,(0,Lt.valueToProto)(r)),this}unbindAll(){return this._args.length=0,this._namedArgs.clear(),this}};at.Stmt=br;function df(t,e,r){let s,n=[],i=[];if(e instanceof br){s=e.sql,n=e._args;for(let[u,c]of e._namedArgs.entries())i.push({name:u,value:c})}else Array.isArray(e)?(s=e[0],Array.isArray(e[1])?n=e[1].map(u=>(0,Lt.valueToProto)(u)):i=Object.entries(e[1]).map(([u,c])=>({name:u,value:(0,Lt.valueToProto)(c)}))):s=e;let{sql:o,sqlId:a}=(0,hf.sqlToProto)(t,s);return{sql:o,sqlId:a,args:n,namedArgs:i,wantRows:r}}at.stmtToProto=df});var nn=f(xe=>{"use strict";Object.defineProperty(xe,"__esModule",{value:!0});xe.BatchCond=xe.BatchStep=xe.Batch=void 0;var $=C(),ut=jt(),pf=wr(),_f=Y(),rn=class{_stream;#e;_steps;#t;constructor(e,r){this._stream=e,this.#e=r,this._steps=[],this.#t=!1}step(){return new gr(this)}execute(){if(this.#t)throw new $.MisuseError("This batch has already been executed");this.#t=!0;let e={steps:this._steps.map(r=>r.proto)};return this.#e?mf(this._stream,this._steps,e):yf(this._stream,this._steps,e)}};xe.Batch=rn;function yf(t,e,r){return t._batch(r).then(s=>{for(let n=0;n<e.length;++n){let i=s.stepResults.get(n),o=s.stepErrors.get(n);e[n].callback(i,o)}})}async function mf(t,e,r){let s=await t._openCursor(r);try{let n=0,i,o=[];for(;;){let a=await s.next();if(a===void 0)break;if(a.type==="step_begin"){if(a.step<n||a.step>=e.length)throw new $.ProtoError("Server produced StepBeginEntry for unexpected step");if(i!==void 0)throw new $.ProtoError("Server produced StepBeginEntry before terminating previous step");for(let u=n;u<a.step;++u)e[u].callback(void 0,void 0);n=a.step+1,i=a,o=[]}else if(a.type==="step_end"){if(i===void 0)throw new $.ProtoError("Server produced StepEndEntry but no step is active");let u={cols:i.cols,rows:o,affectedRowCount:a.affectedRowCount,lastInsertRowid:a.lastInsertRowid};e[i.step].callback(u,void 0),i=void 0,o=[]}else if(a.type==="step_error"){if(i===void 0){if(a.step>=e.length)throw new $.ProtoError("Server produced StepErrorEntry for unexpected step");for(let u=n;u<a.step;++u)e[u].callback(void 0,void 0)}else{if(a.step!==i.step)throw new $.ProtoError("Server produced StepErrorEntry for unexpected step");i=void 0,o=[]}e[a.step].callback(void 0,a.error),n=a.step+1}else if(a.type==="row"){if(i===void 0)throw new $.ProtoError("Server produced RowEntry but no step is active");o.push(a.row)}else throw a.type==="error"?(0,ut.errorFromProto)(a.error):a.type==="none"?new $.ProtoError("Server produced unrecognized CursorEntry"):(0,_f.impossible)(a,"Impossible CursorEntry")}if(i!==void 0)throw new $.ProtoError("Server closed Cursor before terminating active step");for(let a=n;a<e.length;++a)e[a].callback(void 0,void 0)}finally{s.close()}}var gr=class{_batch;#e;_index;constructor(e){this._batch=e,this.#e=[],this._index=void 0}condition(e){return this.#e.push(e._proto),this}query(e){return this.#t(e,!0,ut.rowsResultFromProto)}queryRow(e){return this.#t(e,!0,ut.rowResultFromProto)}queryValue(e){return this.#t(e,!0,ut.valueResultFromProto)}run(e){return this.#t(e,!1,ut.stmtResultFromProto)}#t(e,r,s){if(this._index!==void 0)throw new $.MisuseError("This BatchStep has already been added to the batch");let n=(0,pf.stmtToProto)(this._batch._stream._sqlOwner(),e,r),i;this.#e.length===0?i=void 0:this.#e.length===1?i=this.#e[0]:i={type:"and",conds:this.#e.slice()};let o={stmt:n,condition:i};return new Promise((a,u)=>{let c=(h,d)=>{h!==void 0&&d!==void 0?u(new $.ProtoError("Server returned both result and error")):d!==void 0?u((0,ut.errorFromProto)(d)):a(h!==void 0?s(h,this._batch._stream.intMode):void 0)};this._index=this._batch._steps.length,this._batch._steps.push({proto:o,callback:c})})}};xe.BatchStep=gr;var sn=class t{_batch;_proto;constructor(e,r){this._batch=e,this._proto=r}static ok(e){return new t(e._batch,{type:"ok",step:ea(e)})}static error(e){return new t(e._batch,{type:"error",step:ea(e)})}static not(e){return new t(e._batch,{type:"not",cond:e._proto})}static and(e,r){for(let s of r)ta(e,s);return new t(e,{type:"and",conds:r.map(s=>s._proto)})}static or(e,r){for(let s of r)ta(e,s);return new t(e,{type:"or",conds:r.map(s=>s._proto)})}static isAutocommit(e){return e._stream.client()._ensureVersion(3,"BatchCond.isAutocommit()"),new t(e,{type:"is_autocommit"})}};xe.BatchCond=sn;function ea(t){if(t._index===void 0)throw new $.MisuseError("Cannot add a condition referencing a step that has not been added to the batch");return t._index}function ta(t,e){if(e._batch!==t)throw new $.MisuseError("Cannot mix BatchCond objects for different Batch objects")}});var ra=f(Sr=>{"use strict";Object.defineProperty(Sr,"__esModule",{value:!0});Sr.describeResultFromProto=void 0;function bf(t){return{paramNames:t.params.map(e=>e.name),columns:t.cols,isExplain:t.isExplain,isReadonly:t.isReadonly}}Sr.describeResultFromProto=bf});var qr=f(vr=>{"use strict";Object.defineProperty(vr,"__esModule",{value:!0});vr.Stream=void 0;var wf=nn(),gf=ra(),Er=jt(),sa=ot(),Sf=wr(),on=class{constructor(e){this.intMode=e}query(e){return this.#e(e,!0,Er.rowsResultFromProto)}queryRow(e){return this.#e(e,!0,Er.rowResultFromProto)}queryValue(e){return this.#e(e,!0,Er.valueResultFromProto)}run(e){return this.#e(e,!1,Er.stmtResultFromProto)}#e(e,r,s){let n=(0,Sf.stmtToProto)(this._sqlOwner(),e,r);return this._execute(n).then(i=>s(i,this.intMode))}batch(e=!1){return new wf.Batch(this,e)}describe(e){let r=(0,sa.sqlToProto)(this._sqlOwner(),e);return this._describe(r).then(gf.describeResultFromProto)}sequence(e){let r=(0,sa.sqlToProto)(this._sqlOwner(),e);return this._sequence(r)}intMode};vr.Stream=on});var un=f(Cr=>{"use strict";Object.defineProperty(Cr,"__esModule",{value:!0});Cr.Cursor=void 0;var an=class{};Cr.Cursor=an});var oa=f(xr=>{"use strict";Object.defineProperty(xr,"__esModule",{value:!0});xr.WsCursor=void 0;var na=C(),Ef=un(),ia=mr(),vf=1e3,qf=10,cn=class extends Ef.Cursor{#e;#t;#r;#s;#i;#n;#a;constructor(e,r,s){super(),this.#e=e,this.#t=r,this.#r=s,this.#s=new ia.Queue,this.#i=new ia.Queue,this.#n=void 0,this.#a=!1}async next(){for(;;){if(this.#n!==void 0)throw new na.ClosedError("Cursor is closed",this.#n);for(;!this.#a&&this.#i.length<qf;)this.#i.push(this.#o());let e=this.#s.shift();if(this.#a||e!==void 0)return e;await this.#i.shift().then(r=>{if(r!==void 0){for(let s of r.entries)this.#s.push(s);this.#a||=r.done}})}}#o(){return this.#t._sendCursorRequest(this,{type:"fetch_cursor",cursorId:this.#r,maxCount:vf}).then(e=>e,e=>{this._setClosed(e)})}_setClosed(e){this.#n===void 0&&(this.#n=e,this.#t._sendCursorRequest(this,{type:"close_cursor",cursorId:this.#r}).catch(()=>{}),this.#t._cursorClosed(this))}close(){this._setClosed(new na.ClientError("Cursor was manually closed"))}get closed(){return this.#n!==void 0}};xr.WsCursor=cn});var fn=f(Rr=>{"use strict";Object.defineProperty(Rr,"__esModule",{value:!0});Rr.WsStream=void 0;var Ne=C(),Cf=mr(),xf=qr(),Rf=oa(),ln=class t extends xf.Stream{#e;#t;#r;#s;#i;#n;static open(e){let r=e._streamIdAlloc.alloc(),s=new t(e,r),n=()=>{},i=a=>s.#c(a),o={type:"open_stream",streamId:r};return e._sendRequest(o,{responseCallback:n,errorCallback:i}),s}constructor(e,r){super(e.intMode),this.#e=e,this.#t=r,this.#r=new Cf.Queue,this.#s=void 0,this.#i=!1,this.#n=void 0}client(){return this.#e}_sqlOwner(){return this.#e}_execute(e){return this.#a({type:"execute",streamId:this.#t,stmt:e}).then(r=>r.result)}_batch(e){return this.#a({type:"batch",streamId:this.#t,batch:e}).then(r=>r.result)}_describe(e){return this.#e._ensureVersion(2,"describe()"),this.#a({type:"describe",streamId:this.#t,sql:e.sql,sqlId:e.sqlId}).then(r=>r.result)}_sequence(e){return this.#e._ensureVersion(2,"sequence()"),this.#a({type:"sequence",streamId:this.#t,sql:e.sql,sqlId:e.sqlId}).then(r=>{})}getAutocommit(){return this.#e._ensureVersion(3,"getAutocommit()"),this.#a({type:"get_autocommit",streamId:this.#t}).then(e=>e.isAutocommit)}#a(e){return new Promise((r,s)=>{this.#o({type:"request",request:e,responseCallback:r,errorCallback:s})})}_openCursor(e){return this.#e._ensureVersion(3,"cursor"),new Promise((r,s)=>{this.#o({type:"cursor",batch:e,cursorCallback:r,errorCallback:s})})}_sendCursorRequest(e,r){if(e!==this.#s)throw new Ne.InternalError("Cursor not associated with the stream attempted to execute a request");return new Promise((s,n)=>{this.#n!==void 0?n(new Ne.ClosedError("Stream is closed",this.#n)):this.#e._sendRequest(r,{responseCallback:s,errorCallback:n})})}_cursorClosed(e){if(e!==this.#s)throw new Ne.InternalError("Cursor was closed, but it was not associated with the stream");this.#s=void 0,this.#u()}#o(e){this.#n!==void 0?e.errorCallback(new Ne.ClosedError("Stream is closed",this.#n)):this.#i?e.errorCallback(new Ne.ClosedError("Stream is closing",void 0)):(this.#r.push(e),this.#u())}#u(){for(;;){let e=this.#r.first();if(e===void 0&&this.#s===void 0&&this.#i){this.#c(new Ne.ClientError("Stream was gracefully closed"));break}else if(e?.type==="request"&&this.#s===void 0){let{request:r,responseCallback:s,errorCallback:n}=e;this.#r.shift(),this.#e._sendRequest(r,{responseCallback:s,errorCallback:n})}else if(e?.type==="cursor"&&this.#s===void 0){let{batch:r,cursorCallback:s}=e;this.#r.shift();let n=this.#e._cursorIdAlloc.alloc(),i=new Rf.WsCursor(this.#e,this,n),o={type:"open_cursor",streamId:this.#t,cursorId:n,batch:r},a=()=>{},u=c=>i._setClosed(c);this.#e._sendRequest(o,{responseCallback:a,errorCallback:u}),this.#s=i,s(i)}else break}}#c(e){if(this.#n!==void 0)return;for(this.#n=e,this.#s!==void 0&&this.#s._setClosed(e);;){let i=this.#r.shift();if(i!==void 0)i.errorCallback(e);else break}let r={type:"close_stream",streamId:this.#t},s=()=>this.#e._streamIdAlloc.free(this.#t),n=()=>{};this.#e._sendRequest(r,{responseCallback:s,errorCallback:n})}close(){this.#c(new Ne.ClientError("Stream was manually closed"))}closeGracefully(){this.#i=!0,this.#u()}get closed(){return this.#n!==void 0||this.#i}};Rr.WsStream=ln});var dn=f(ct=>{"use strict";Object.defineProperty(ct,"__esModule",{value:!0});ct.Batch=ct.Stmt=void 0;var Of=Wt(),aa=Y();function ua(t,e){e.sql!==void 0&&t.string("sql",e.sql),e.sqlId!==void 0&&t.number("sql_id",e.sqlId),t.arrayObjects("args",e.args,ca),t.arrayObjects("named_args",e.namedArgs,Pf),t.boolean("want_rows",e.wantRows)}ct.Stmt=ua;function Pf(t,e){t.string("name",e.name),t.object("value",e.value,ca)}function Tf(t,e){t.arrayObjects("steps",e.steps,If)}ct.Batch=Tf;function If(t,e){e.condition!==void 0&&t.object("condition",e.condition,hn),t.object("stmt",e.stmt,ua)}function hn(t,e){if(t.stringRaw("type",e.type),e.type==="ok"||e.type==="error")t.number("step",e.step);else if(e.type==="not")t.object("cond",e.cond,hn);else if(e.type==="and"||e.type==="or")t.arrayObjects("conds",e.conds,hn);else if(e.type!=="is_autocommit")throw(0,aa.impossible)(e,"Impossible type of BatchCond")}function ca(t,e){if(e===null)t.stringRaw("type","null");else if(typeof e=="bigint")t.stringRaw("type","integer"),t.stringRaw("value",""+e);else if(typeof e=="number")t.stringRaw("type","float"),t.number("value",e);else if(typeof e=="string")t.stringRaw("type","text"),t.string("value",e);else if(e instanceof Uint8Array)t.stringRaw("type","blob"),t.stringRaw("base64",Of.Base64.fromUint8Array(e));else if(e!==void 0)throw(0,aa.impossible)(e,"Impossible type of Value")}});var fa=f(Or=>{"use strict";Object.defineProperty(Or,"__esModule",{value:!0});Or.ClientMsg=void 0;var pn=dn(),la=Y();function jf(t,e){if(t.stringRaw("type",e.type),e.type==="hello")e.jwt!==void 0&&t.string("jwt",e.jwt);else if(e.type==="request")t.number("request_id",e.requestId),t.object("request",e.request,Lf);else throw(0,la.impossible)(e,"Impossible type of ClientMsg")}Or.ClientMsg=jf;function Lf(t,e){if(t.stringRaw("type",e.type),e.type==="open_stream")t.number("stream_id",e.streamId);else if(e.type==="close_stream")t.number("stream_id",e.streamId);else if(e.type==="execute")t.number("stream_id",e.streamId),t.object("stmt",e.stmt,pn.Stmt);else if(e.type==="batch")t.number("stream_id",e.streamId),t.object("batch",e.batch,pn.Batch);else if(e.type==="open_cursor")t.number("stream_id",e.streamId),t.number("cursor_id",e.cursorId),t.object("batch",e.batch,pn.Batch);else if(e.type==="close_cursor")t.number("cursor_id",e.cursorId);else if(e.type==="fetch_cursor")t.number("cursor_id",e.cursorId),t.number("max_count",e.maxCount);else if(e.type==="sequence")t.number("stream_id",e.streamId),e.sql!==void 0&&t.string("sql",e.sql),e.sqlId!==void 0&&t.number("sql_id",e.sqlId);else if(e.type==="describe")t.number("stream_id",e.streamId),e.sql!==void 0&&t.string("sql",e.sql),e.sqlId!==void 0&&t.number("sql_id",e.sqlId);else if(e.type==="store_sql")t.number("sql_id",e.sqlId),t.string("sql",e.sql);else if(e.type==="close_sql")t.number("sql_id",e.sqlId);else if(e.type==="get_autocommit")t.number("stream_id",e.streamId);else throw(0,la.impossible)(e,"Impossible type of Request")}});var yn=f(lt=>{"use strict";Object.defineProperty(lt,"__esModule",{value:!0});lt.Batch=lt.Stmt=void 0;var da=Y();function pa(t,e){e.sql!==void 0&&t.string(1,e.sql),e.sqlId!==void 0&&t.int32(2,e.sqlId);for(let r of e.args)t.message(3,r,_a);for(let r of e.namedArgs)t.message(4,r,Bf);t.bool(5,e.wantRows)}lt.Stmt=pa;function Bf(t,e){t.string(1,e.name),t.message(2,e.value,_a)}function Mf(t,e){for(let r of e.steps)t.message(1,r,Af)}lt.Batch=Mf;function Af(t,e){e.condition!==void 0&&t.message(1,e.condition,_n),t.message(2,e.stmt,pa)}function _n(t,e){if(e.type==="ok")t.uint32(1,e.step);else if(e.type==="error")t.uint32(2,e.step);else if(e.type==="not")t.message(3,e.cond,_n);else if(e.type==="and")t.message(4,e.conds,ha);else if(e.type==="or")t.message(5,e.conds,ha);else if(e.type==="is_autocommit")t.message(6,void 0,ya);else throw(0,da.impossible)(e,"Impossible type of BatchCond")}function ha(t,e){for(let r of e)t.message(1,r,_n)}function _a(t,e){if(e===null)t.message(1,void 0,ya);else if(typeof e=="bigint")t.sint64(2,e);else if(typeof e=="number")t.double(3,e);else if(typeof e=="string")t.string(4,e);else if(e instanceof Uint8Array)t.bytes(5,e);else if(e!==void 0)throw(0,da.impossible)(e,"Impossible type of Value")}function ya(t,e){}});var ba=f(Pr=>{"use strict";Object.defineProperty(Pr,"__esModule",{value:!0});Pr.ClientMsg=void 0;var mn=yn(),ma=Y();function Uf(t,e){if(e.type==="hello")t.message(1,e,Nf);else if(e.type==="request")t.message(2,e,kf);else throw(0,ma.impossible)(e,"Impossible type of ClientMsg")}Pr.ClientMsg=Uf;function Nf(t,e){e.jwt!==void 0&&t.string(1,e.jwt)}function kf(t,e){t.int32(1,e.requestId);let r=e.request;if(r.type==="open_stream")t.message(2,r,Df);else if(r.type==="close_stream")t.message(3,r,Ff);else if(r.type==="execute")t.message(4,r,$f);else if(r.type==="batch")t.message(5,r,Wf);else if(r.type==="open_cursor")t.message(6,r,Vf);else if(r.type==="close_cursor")t.message(7,r,Hf);else if(r.type==="fetch_cursor")t.message(8,r,Gf);else if(r.type==="sequence")t.message(9,r,zf);else if(r.type==="describe")t.message(10,r,Jf);else if(r.type==="store_sql")t.message(11,r,Kf);else if(r.type==="close_sql")t.message(12,r,Yf);else if(r.type==="get_autocommit")t.message(13,r,Qf);else throw(0,ma.impossible)(r,"Impossible type of Request")}function Df(t,e){t.int32(1,e.streamId)}function Ff(t,e){t.int32(1,e.streamId)}function $f(t,e){t.int32(1,e.streamId),t.message(2,e.stmt,mn.Stmt)}function Wf(t,e){t.int32(1,e.streamId),t.message(2,e.batch,mn.Batch)}function Vf(t,e){t.int32(1,e.streamId),t.int32(2,e.cursorId),t.message(3,e.batch,mn.Batch)}function Hf(t,e){t.int32(1,e.cursorId)}function Gf(t,e){t.int32(1,e.cursorId),t.uint32(2,e.maxCount)}function zf(t,e){t.int32(1,e.streamId),e.sql!==void 0&&t.string(2,e.sql),e.sqlId!==void 0&&t.int32(3,e.sqlId)}function Jf(t,e){t.int32(1,e.streamId),e.sql!==void 0&&t.string(2,e.sql),e.sqlId!==void 0&&t.int32(3,e.sqlId)}function Kf(t,e){t.int32(1,e.sqlId),t.string(2,e.sql)}function Yf(t,e){t.int32(1,e.sqlId)}function Qf(t,e){t.int32(1,e.streamId)}});var Ir=f(O=>{"use strict";var Xf=O&&O.__createBinding||(Object.create?function(t,e,r,s){s===void 0&&(s=r);var n=Object.getOwnPropertyDescriptor(e,r);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,s,n)}:function(t,e,r,s){s===void 0&&(s=r),t[s]=e[r]}),Zf=O&&O.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),eh=O&&O.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&Xf(e,t,r);return Zf(e,t),e};Object.defineProperty(O,"__esModule",{value:!0});O.Value=O.DescribeResult=O.CursorEntry=O.BatchResult=O.StmtResult=O.Error=void 0;var th=Wt(),wa=C(),w=eh(et());function Tr(t){let e=w.string(t.message),r=w.stringOpt(t.code);return{message:e,code:r}}O.Error=Tr;function ga(t){let e=w.arrayObjectsMap(t.cols,Sa),r=w.array(t.rows).map(o=>w.arrayObjectsMap(o,bn)),s=w.number(t.affected_row_count),n=w.stringOpt(t.last_insert_rowid),i=n!==void 0?BigInt(n):void 0;return{cols:e,rows:r,affectedRowCount:s,lastInsertRowid:i}}O.StmtResult=ga;function Sa(t){let e=w.stringOpt(t.name),r=w.stringOpt(t.decltype);return{name:e,decltype:r}}function rh(t){let e=new Map;w.array(t.step_results).forEach((s,n)=>{s!==null&&e.set(n,ga(w.object(s)))});let r=new Map;return w.array(t.step_errors).forEach((s,n)=>{s!==null&&r.set(n,Tr(w.object(s)))}),{stepResults:e,stepErrors:r}}O.BatchResult=rh;function sh(t){let e=w.string(t.type);if(e==="step_begin"){let r=w.number(t.step),s=w.arrayObjectsMap(t.cols,Sa);return{type:"step_begin",step:r,cols:s}}else if(e==="step_end"){let r=w.number(t.affected_row_count),s=w.stringOpt(t.last_insert_rowid),n=s!==void 0?BigInt(s):void 0;return{type:"step_end",affectedRowCount:r,lastInsertRowid:n}}else if(e==="step_error"){let r=w.number(t.step),s=Tr(w.object(t.error));return{type:"step_error",step:r,error:s}}else{if(e==="row")return{type:"row",row:w.arrayObjectsMap(t.row,bn)};if(e==="error")return{type:"error",error:Tr(w.object(t.error))};throw new wa.ProtoError("Unexpected type of CursorEntry")}}O.CursorEntry=sh;function nh(t){let e=w.arrayObjectsMap(t.params,ih),r=w.arrayObjectsMap(t.cols,oh),s=w.boolean(t.is_explain),n=w.boolean(t.is_readonly);return{params:e,cols:r,isExplain:s,isReadonly:n}}O.DescribeResult=nh;function ih(t){return{name:w.stringOpt(t.name)}}function oh(t){let e=w.string(t.name),r=w.stringOpt(t.decltype);return{name:e,decltype:r}}function bn(t){let e=w.string(t.type);if(e==="null")return null;if(e==="integer"){let r=w.string(t.value);return BigInt(r)}else{if(e==="float")return w.number(t.value);if(e==="text")return w.string(t.value);if(e==="blob")return th.Base64.toUint8Array(w.string(t.base64));throw new wa.ProtoError("Unexpected type of Value")}}O.Value=bn});var va=f(ce=>{"use strict";var ah=ce&&ce.__createBinding||(Object.create?function(t,e,r,s){s===void 0&&(s=r);var n=Object.getOwnPropertyDescriptor(e,r);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,s,n)}:function(t,e,r,s){s===void 0&&(s=r),t[s]=e[r]}),uh=ce&&ce.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),ch=ce&&ce.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&ah(e,t,r);return uh(e,t),e};Object.defineProperty(ce,"__esModule",{value:!0});ce.ServerMsg=void 0;var Ea=C(),W=ch(et()),ft=Ir();function lh(t){let e=W.string(t.type);if(e==="hello_ok")return{type:"hello_ok"};if(e==="hello_error")return{type:"hello_error",error:(0,ft.Error)(W.object(t.error))};if(e==="response_ok"){let r=W.number(t.request_id),s=fh(W.object(t.response));return{type:"response_ok",requestId:r,response:s}}else if(e==="response_error"){let r=W.number(t.request_id),s=(0,ft.Error)(W.object(t.error));return{type:"response_error",requestId:r,error:s}}else throw new Ea.ProtoError("Unexpected type of ServerMsg")}ce.ServerMsg=lh;function fh(t){let e=W.string(t.type);if(e==="open_stream")return{type:"open_stream"};if(e==="close_stream")return{type:"close_stream"};if(e==="execute")return{type:"execute",result:(0,ft.StmtResult)(W.object(t.result))};if(e==="batch")return{type:"batch",result:(0,ft.BatchResult)(W.object(t.result))};if(e==="open_cursor")return{type:"open_cursor"};if(e==="close_cursor")return{type:"close_cursor"};if(e==="fetch_cursor"){let r=W.arrayObjectsMap(t.entries,ft.CursorEntry),s=W.boolean(t.done);return{type:"fetch_cursor",entries:r,done:s}}else{if(e==="sequence")return{type:"sequence"};if(e==="describe")return{type:"describe",result:(0,ft.DescribeResult)(W.object(t.result))};if(e==="store_sql")return{type:"store_sql"};if(e==="close_sql")return{type:"close_sql"};if(e==="get_autocommit")return{type:"get_autocommit",isAutocommit:W.boolean(t.is_autocommit)};throw new Ea.ProtoError("Unexpected type of Response")}}});var jr=f(T=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});T.DescribeResult=T.CursorEntry=T.BatchResult=T.StmtResult=T.Error=void 0;T.Error={default(){return{message:"",code:void 0}},1(t,e){e.message=t.string()},2(t,e){e.code=t.string()}};T.StmtResult={default(){return{cols:[],rows:[],affectedRowCount:0,lastInsertRowid:void 0}},1(t,e){e.cols.push(t.message(qa))},2(t,e){e.rows.push(t.message(Ca))},3(t,e){e.affectedRowCount=Number(t.uint64())},4(t,e){e.lastInsertRowid=t.sint64()}};var qa={default(){return{name:void 0,decltype:void 0}},1(t,e){e.name=t.string()},2(t,e){e.decltype=t.string()}},Ca={default(){return[]},1(t,e){e.push(t.message(wh))}};T.BatchResult={default(){return{stepResults:new Map,stepErrors:new Map}},1(t,e){let[r,s]=t.message(hh);e.stepResults.set(r,s)},2(t,e){let[r,s]=t.message(dh);e.stepErrors.set(r,s)}};var hh={default(){return[0,T.StmtResult.default()]},1(t,e){e[0]=t.uint32()},2(t,e){e[1]=t.message(T.StmtResult)}},dh={default(){return[0,T.Error.default()]},1(t,e){e[0]=t.uint32()},2(t,e){e[1]=t.message(T.Error)}};T.CursorEntry={default(){return{type:"none"}},1(t){return t.message(ph)},2(t){return t.message(_h)},3(t){return t.message(yh)},4(t){return{type:"row",row:t.message(Ca)}},5(t){return{type:"error",error:t.message(T.Error)}}};var ph={default(){return{type:"step_begin",step:0,cols:[]}},1(t,e){e.step=t.uint32()},2(t,e){e.cols.push(t.message(qa))}},_h={default(){return{type:"step_end",affectedRowCount:0,lastInsertRowid:void 0}},1(t,e){e.affectedRowCount=t.uint32()},2(t,e){e.lastInsertRowid=t.uint64()}},yh={default(){return{type:"step_error",step:0,error:T.Error.default()}},1(t,e){e.step=t.uint32()},2(t,e){e.error=t.message(T.Error)}};T.DescribeResult={default(){return{params:[],cols:[],isExplain:!1,isReadonly:!1}},1(t,e){e.params.push(t.message(mh))},2(t,e){e.cols.push(t.message(bh))},3(t,e){e.isExplain=t.bool()},4(t,e){e.isReadonly=t.bool()}};var mh={default(){return{name:void 0}},1(t,e){e.name=t.string()}},bh={default(){return{name:"",decltype:void 0}},1(t,e){e.name=t.string()},2(t,e){e.decltype=t.string()}},wh={default(){},1(t){return null},2(t){return t.sint64()},3(t){return t.double()},4(t){return t.string()},5(t){return t.bytes()}}});var xa=f(Lr=>{"use strict";Object.defineProperty(Lr,"__esModule",{value:!0});Lr.ServerMsg=void 0;var se=jr();Lr.ServerMsg={default(){return{type:"none"}},1(t){return{type:"hello_ok"}},2(t){return t.message(gh)},3(t){return t.message(Eh)},4(t){return t.message(Sh)}};var gh={default(){return{type:"hello_error",error:se.Error.default()}},1(t,e){e.error=t.message(se.Error)}},Sh={default(){return{type:"response_error",requestId:0,error:se.Error.default()}},1(t,e){e.requestId=t.int32()},2(t,e){e.error=t.message(se.Error)}},Eh={default(){return{type:"response_ok",requestId:0,response:{type:"none"}}},1(t,e){e.requestId=t.int32()},2(t,e){e.response={type:"open_stream"}},3(t,e){e.response={type:"close_stream"}},4(t,e){e.response=t.message(vh)},5(t,e){e.response=t.message(qh)},6(t,e){e.response={type:"open_cursor"}},7(t,e){e.response={type:"close_cursor"}},8(t,e){e.response=t.message(Ch)},9(t,e){e.response={type:"sequence"}},10(t,e){e.response=t.message(xh)},11(t,e){e.response={type:"store_sql"}},12(t,e){e.response={type:"close_sql"}},13(t,e){e.response=t.message(Rh)}},vh={default(){return{type:"execute",result:se.StmtResult.default()}},1(t,e){e.result=t.message(se.StmtResult)}},qh={default(){return{type:"batch",result:se.BatchResult.default()}},1(t,e){e.result=t.message(se.BatchResult)}},Ch={default(){return{type:"fetch_cursor",entries:[],done:!1}},1(t,e){e.entries.push(t.message(se.CursorEntry))},2(t,e){e.done=t.bool()}},xh={default(){return{type:"describe",result:se.DescribeResult.default()}},1(t,e){e.result=t.message(se.DescribeResult)}},Rh={default(){return{type:"get_autocommit",isAutocommit:!1}},1(t,e){e.isAutocommit=t.bool()}}});var Ar=f(ge=>{"use strict";Object.defineProperty(ge,"__esModule",{value:!0});ge.WsClient=ge.subprotocolsV3=ge.subprotocolsV2=void 0;var Oh=ar(),Br=Ys(),A=C(),Mr=Xs(),Ra=jt(),Ph=ot(),wn=Y(),Th=fn(),Ih=fa(),jh=ba(),Lh=va(),Bh=xa();ge.subprotocolsV2=new Map([["hrana2",{version:2,encoding:"json"}],["hrana1",{version:1,encoding:"json"}]]);ge.subprotocolsV3=new Map([["hrana3-protobuf",{version:3,encoding:"protobuf"}],["hrana3",{version:3,encoding:"json"}],["hrana2",{version:2,encoding:"json"}],["hrana1",{version:1,encoding:"json"}]]);var gn=class extends Oh.Client{#e;#t;#r;#s;#i;#n;#a;#o;#u;_streamIdAlloc;_cursorIdAlloc;#c;constructor(e,r){super(),this.#e=e,this.#t=[],this.#r=!1,this.#s=void 0,this.#i=!1,this.#n=void 0,this.#a=!1,this.#o=new Map,this.#u=new Mr.IdAlloc,this._streamIdAlloc=new Mr.IdAlloc,this._cursorIdAlloc=new Mr.IdAlloc,this.#c=new Mr.IdAlloc,this.#e.binaryType="arraybuffer",this.#e.addEventListener("open",()=>this.#p()),this.#e.addEventListener("close",s=>this.#d(s)),this.#e.addEventListener("error",s=>this.#_(s)),this.#e.addEventListener("message",s=>this.#m(s)),this.#f({type:"hello",jwt:r})}#f(e){if(this.#s!==void 0)throw new A.InternalError("Trying to send a message on a closed client");if(this.#r)this.#h(e);else{let r=()=>this.#h(e),s=()=>{};this.#t.push({openCallback:r,errorCallback:s})}}#p(){let e=this.#e.protocol;if(e===void 0){this.#l(new A.ClientError("The `WebSocket.protocol` property is undefined. This most likely means that the WebSocket implementation provided by the environment is broken. If you are using Miniflare 2, please update to Miniflare 3, which fixes this problem."));return}else if(e==="")this.#n={version:1,encoding:"json"};else if(this.#n=ge.subprotocolsV3.get(e),this.#n===void 0){this.#l(new A.ProtoError(`Unrecognized WebSocket subprotocol: ${JSON.stringify(e)}`));return}for(let r of this.#t)r.openCallback();this.#t.length=0,this.#r=!0}#h(e){let r=this.#n.encoding;if(r==="json"){let s=(0,Br.writeJsonObject)(e,Ih.ClientMsg);this.#e.send(s)}else if(r==="protobuf"){let s=(0,Br.writeProtobufMessage)(e,jh.ClientMsg);this.#e.send(s)}else throw(0,wn.impossible)(r,"Impossible encoding")}getVersion(){return new Promise((e,r)=>{if(this.#a=!0,this.#s!==void 0)r(this.#s);else if(this.#r)e(this.#n.version);else{let s=()=>e(this.#n.version);this.#t.push({openCallback:s,errorCallback:r})}})}_ensureVersion(e,r){if(this.#n===void 0||!this.#a)throw new A.ProtocolVersionError(`${r} is supported only on protocol version ${e} and higher, but the version supported by the WebSocket server is not yet known. Use Client.getVersion() to wait until the version is available.`);if(this.#n.version<e)throw new A.ProtocolVersionError(`${r} is supported on protocol version ${e} and higher, but the WebSocket server only supports version ${this.#n.version}`)}_sendRequest(e,r){if(this.#s!==void 0){r.errorCallback(new A.ClosedError("Client is closed",this.#s));return}let s=this.#u.alloc();this.#o.set(s,{...r,type:e.type}),this.#f({type:"request",requestId:s,request:e})}#_(e){let s=e.message??"WebSocket was closed due to an error";this.#l(new A.WebSocketError(s))}#d(e){let r=`WebSocket was closed with code ${e.code}`;e.reason&&(r+=`: ${e.reason}`),this.#l(new A.WebSocketError(r))}#l(e){if(this.#s===void 0){this.#s=e;for(let r of this.#t)r.errorCallback(e);this.#t.length=0;for(let[r,s]of this.#o.entries())s.errorCallback(e),this.#u.free(r);this.#o.clear(),this.#e.close()}}#m(e){if(this.#s===void 0)try{let r,s=this.#n.encoding;if(s==="json"){if(typeof e.data!="string"){this.#e.close(3003,"Only text messages are accepted with JSON encoding"),this.#l(new A.ProtoError("Received non-text message from server with JSON encoding"));return}r=(0,Br.readJsonObject)(JSON.parse(e.data),Lh.ServerMsg)}else if(s==="protobuf"){if(!(e.data instanceof ArrayBuffer)){this.#e.close(3003,"Only binary messages are accepted with Protobuf encoding"),this.#l(new A.ProtoError("Received non-binary message from server with Protobuf encoding"));return}r=(0,Br.readProtobufMessage)(new Uint8Array(e.data),Bh.ServerMsg)}else throw(0,wn.impossible)(s,"Impossible encoding");this.#y(r)}catch(r){this.#e.close(3007,"Could not handle message"),this.#l(r)}}#y(e){if(e.type==="none")throw new A.ProtoError("Received an unrecognized ServerMsg");if(e.type==="hello_ok"||e.type==="hello_error"){if(this.#i)throw new A.ProtoError("Received a duplicated hello response");if(this.#i=!0,e.type==="hello_error")throw(0,Ra.errorFromProto)(e.error);return}else if(!this.#i)throw new A.ProtoError("Received a non-hello message before a hello response");if(e.type==="response_ok"){let r=e.requestId,s=this.#o.get(r);if(this.#o.delete(r),s===void 0)throw new A.ProtoError("Received unexpected OK response");this.#u.free(r);try{if(s.type!==e.response.type)throw console.dir({responseState:s,msg:e}),new A.ProtoError("Received unexpected type of response");s.responseCallback(e.response)}catch(n){throw s.errorCallback(n),n}}else if(e.type==="response_error"){let r=e.requestId,s=this.#o.get(r);if(this.#o.delete(r),s===void 0)throw new A.ProtoError("Received unexpected error response");this.#u.free(r),s.errorCallback((0,Ra.errorFromProto)(e.error))}else throw(0,wn.impossible)(e,"Impossible ServerMsg type")}openStream(){return Th.WsStream.open(this)}storeSql(e){this._ensureVersion(2,"storeSql()");let r=this.#c.alloc(),s=new Ph.Sql(this,r),n=()=>{},i=a=>s._setClosed(a),o={type:"store_sql",sqlId:r,sql:e};return this._sendRequest(o,{responseCallback:n,errorCallback:i}),s}_closeSql(e){if(this.#s!==void 0)return;let r=()=>this.#c.free(e),s=i=>this.#l(i),n={type:"close_sql",sqlId:e};this._sendRequest(n,{responseCallback:r,errorCallback:s})}close(){this.#l(new A.ClientError("Client was manually closed"))}get closed(){return this.#s!==void 0}};ge.WsClient=gn});var Ur=f((G_,Oa)=>{"use strict";var Mh=Request,Ah=Headers,Uh=fetch;Oa.exports={fetch:Uh,Request:Mh,Headers:Ah}});var Ta=f(Bt=>{"use strict";Object.defineProperty(Bt,"__esModule",{value:!0});Bt.queueMicrotask=void 0;var Pa;if(typeof queueMicrotask<"u")Bt.queueMicrotask=Pa=queueMicrotask;else{let t=Promise.resolve();Bt.queueMicrotask=Pa=e=>{t.then(e)}}});var Ia=f(Nr=>{"use strict";Object.defineProperty(Nr,"__esModule",{value:!0});Nr.ByteQueue=void 0;var Sn=class{#e;#t;#r;constructor(e){this.#e=new Uint8Array(new ArrayBuffer(e)),this.#t=0,this.#r=0}get length(){return this.#r-this.#t}data(){return this.#e.slice(this.#t,this.#r)}push(e){this.#s(e.byteLength),this.#e.set(e,this.#r),this.#r+=e.byteLength}#s(e){if(this.#r+e<=this.#e.byteLength)return;let r=this.#r-this.#t;if(r+e<=this.#e.byteLength&&2*this.#r>=this.#e.byteLength)this.#e.copyWithin(0,this.#t,this.#r);else{let s=this.#e.byteLength;do s*=2;while(r+e>s);let n=new Uint8Array(new ArrayBuffer(s));n.set(this.#e.slice(this.#t,this.#r),0),this.#e=n}this.#r=r,this.#t=0}shift(e){this.#t+=e}};Nr.ByteQueue=Sn});var En=f(X=>{"use strict";var Nh=X&&X.__createBinding||(Object.create?function(t,e,r,s){s===void 0&&(s=r);var n=Object.getOwnPropertyDescriptor(e,r);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,s,n)}:function(t,e,r,s){s===void 0&&(s=r),t[s]=e[r]}),kh=X&&X.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),Dh=X&&X.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&Nh(e,t,r);return kh(e,t),e};Object.defineProperty(X,"__esModule",{value:!0});X.CursorRespBody=X.PipelineRespBody=void 0;var ja=C(),V=Dh(et()),kr=Ir();function Fh(t){let e=V.stringOpt(t.baton),r=V.stringOpt(t.base_url),s=V.arrayObjectsMap(t.results,$h);return{baton:e,baseUrl:r,results:s}}X.PipelineRespBody=Fh;function $h(t){let e=V.string(t.type);if(e==="ok")return{type:"ok",response:Wh(V.object(t.response))};if(e==="error")return{type:"error",error:(0,kr.Error)(V.object(t.error))};throw new ja.ProtoError("Unexpected type of StreamResult")}function Wh(t){let e=V.string(t.type);if(e==="close")return{type:"close"};if(e==="execute")return{type:"execute",result:(0,kr.StmtResult)(V.object(t.result))};if(e==="batch")return{type:"batch",result:(0,kr.BatchResult)(V.object(t.result))};if(e==="sequence")return{type:"sequence"};if(e==="describe")return{type:"describe",result:(0,kr.DescribeResult)(V.object(t.result))};if(e==="store_sql")return{type:"store_sql"};if(e==="close_sql")return{type:"close_sql"};if(e==="get_autocommit")return{type:"get_autocommit",isAutocommit:V.boolean(t.is_autocommit)};throw new ja.ProtoError("Unexpected type of StreamResponse")}function Vh(t){let e=V.stringOpt(t.baton),r=V.stringOpt(t.base_url);return{baton:e,baseUrl:r}}X.CursorRespBody=Vh});var vn=f(ht=>{"use strict";Object.defineProperty(ht,"__esModule",{value:!0});ht.CursorRespBody=ht.PipelineRespBody=void 0;var ke=jr();ht.PipelineRespBody={default(){return{baton:void 0,baseUrl:void 0,results:[]}},1(t,e){e.baton=t.string()},2(t,e){e.baseUrl=t.string()},3(t,e){e.results.push(t.message(Hh))}};var Hh={default(){return{type:"none"}},1(t){return{type:"ok",response:t.message(Gh)}},2(t){return{type:"error",error:t.message(ke.Error)}}},Gh={default(){return{type:"none"}},1(t){return{type:"close"}},2(t){return t.message(zh)},3(t){return t.message(Jh)},4(t){return{type:"sequence"}},5(t){return t.message(Kh)},6(t){return{type:"store_sql"}},7(t){return{type:"close_sql"}},8(t){return t.message(Yh)}},zh={default(){return{type:"execute",result:ke.StmtResult.default()}},1(t,e){e.result=t.message(ke.StmtResult)}},Jh={default(){return{type:"batch",result:ke.BatchResult.default()}},1(t,e){e.result=t.message(ke.BatchResult)}},Kh={default(){return{type:"describe",result:ke.DescribeResult.default()}},1(t,e){e.result=t.message(ke.DescribeResult)}},Yh={default(){return{type:"get_autocommit",isAutocommit:!1}},1(t,e){e.isAutocommit=t.bool()}};ht.CursorRespBody={default(){return{baton:void 0,baseUrl:void 0}},1(t,e){e.baton=t.string()},2(t,e){e.baseUrl=t.string()}}});var Ba=f(le=>{"use strict";var Qh=le&&le.__createBinding||(Object.create?function(t,e,r,s){s===void 0&&(s=r);var n=Object.getOwnPropertyDescriptor(e,r);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,s,n)}:function(t,e,r,s){s===void 0&&(s=r),t[s]=e[r]}),Xh=le&&le.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),La=le&&le.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&Qh(e,t,r);return Xh(e,t),e};Object.defineProperty(le,"__esModule",{value:!0});le.HttpCursor=void 0;var Zh=Ia(),ed=un(),td=La(et()),rd=La(Ks()),dt=C(),sd=Y(),nd=En(),id=vn(),od=Ir(),ad=jr(),qn=class extends ed.Cursor{#e;#t;#r;#s;#i;#n;constructor(e,r){super(),this.#e=e,this.#t=r,this.#r=void 0,this.#s=new Zh.ByteQueue(16*1024),this.#i=void 0,this.#n=!1}async open(e){if(e.body===null)throw new dt.ProtoError("No response body for cursor request");this.#r=e.body.getReader();let r=await this.#a(nd.CursorRespBody,id.CursorRespBody);if(r===void 0)throw new dt.ProtoError("Empty response to cursor request");return r}next(){return this.#a(od.CursorEntry,ad.CursorEntry)}close(){this._setClosed(new dt.ClientError("Cursor was manually closed"))}_setClosed(e){this.#i===void 0&&(this.#i=e,this.#e._cursorClosed(this),this.#r!==void 0&&this.#r.cancel())}get closed(){return this.#i!==void 0}async#a(e,r){for(;;){if(this.#n)return;if(this.#i!==void 0)throw new dt.ClosedError("Cursor is closed",this.#i);if(this.#t==="json"){let i=this.#o();if(i!==void 0){let o=new TextDecoder().decode(i),a=JSON.parse(o);return td.readJsonObject(a,e)}}else if(this.#t==="protobuf"){let i=this.#u();if(i!==void 0)return rd.readProtobufMessage(i,r)}else throw(0,sd.impossible)(this.#t,"Impossible encoding");if(this.#r===void 0)throw new dt.InternalError("Attempted to read from HTTP cursor before it was opened");let{value:s,done:n}=await this.#r.read();if(n&&this.#s.length===0)this.#n=!0;else{if(n)throw new dt.ProtoError("Unexpected end of cursor stream");this.#s.push(s)}}}#o(){let e=this.#s.data(),s=e.indexOf(10);if(s<0)return;let n=e.slice(0,s);return this.#s.shift(s+1),n}#u(){let e=this.#s.data(),r=0,s=0;for(;;){if(s>=e.byteLength)return;let i=e[s];if(r|=(i&127)<<7*s,s+=1,!(i&128))break}if(e.byteLength<s+r)return;let n=e.slice(s,s+r);return this.#s.shift(s+r),n}};le.HttpCursor=qn});var xn=f(pt=>{"use strict";Object.defineProperty(pt,"__esModule",{value:!0});pt.CursorReqBody=pt.PipelineReqBody=void 0;var Cn=dn(),ud=Y();function cd(t,e){e.baton!==void 0&&t.string("baton",e.baton),t.arrayObjects("requests",e.requests,ld)}pt.PipelineReqBody=cd;function ld(t,e){if(t.stringRaw("type",e.type),e.type!=="close"){if(e.type==="execute")t.object("stmt",e.stmt,Cn.Stmt);else if(e.type==="batch")t.object("batch",e.batch,Cn.Batch);else if(e.type==="sequence")e.sql!==void 0&&t.string("sql",e.sql),e.sqlId!==void 0&&t.number("sql_id",e.sqlId);else if(e.type==="describe")e.sql!==void 0&&t.string("sql",e.sql),e.sqlId!==void 0&&t.number("sql_id",e.sqlId);else if(e.type==="store_sql")t.number("sql_id",e.sqlId),t.string("sql",e.sql);else if(e.type==="close_sql")t.number("sql_id",e.sqlId);else if(e.type!=="get_autocommit")throw(0,ud.impossible)(e,"Impossible type of StreamRequest")}}function fd(t,e){e.baton!==void 0&&t.string("baton",e.baton),t.object("batch",e.batch,Cn.Batch)}pt.CursorReqBody=fd});var On=f(_t=>{"use strict";Object.defineProperty(_t,"__esModule",{value:!0});_t.CursorReqBody=_t.PipelineReqBody=void 0;var Rn=yn(),hd=Y();function dd(t,e){e.baton!==void 0&&t.string(1,e.baton);for(let r of e.requests)t.message(2,r,pd)}_t.PipelineReqBody=dd;function pd(t,e){if(e.type==="close")t.message(1,e,_d);else if(e.type==="execute")t.message(2,e,yd);else if(e.type==="batch")t.message(3,e,md);else if(e.type==="sequence")t.message(4,e,bd);else if(e.type==="describe")t.message(5,e,wd);else if(e.type==="store_sql")t.message(6,e,gd);else if(e.type==="close_sql")t.message(7,e,Sd);else if(e.type==="get_autocommit")t.message(8,e,Ed);else throw(0,hd.impossible)(e,"Impossible type of StreamRequest")}function _d(t,e){}function yd(t,e){t.message(1,e.stmt,Rn.Stmt)}function md(t,e){t.message(1,e.batch,Rn.Batch)}function bd(t,e){e.sql!==void 0&&t.string(1,e.sql),e.sqlId!==void 0&&t.int32(2,e.sqlId)}function wd(t,e){e.sql!==void 0&&t.string(1,e.sql),e.sqlId!==void 0&&t.int32(2,e.sqlId)}function gd(t,e){t.int32(1,e.sqlId),t.string(2,e.sql)}function Sd(t,e){t.int32(1,e.sqlId)}function Ed(t,e){}function vd(t,e){e.baton!==void 0&&t.string(1,e.baton),t.message(2,e.batch,Rn.Batch)}_t.CursorReqBody=vd});var Tn=f(Wr=>{"use strict";Object.defineProperty(Wr,"__esModule",{value:!0});Wr.HttpStream=void 0;var Ma=Ur(),Z=C(),Fr=Ys(),qd=Xs(),Cd=mr(),Dr=Ta(),Aa=jt(),xd=ot(),Rd=qr(),$r=Y(),Od=Ba(),Pd=xn(),Td=On(),Id=xn(),jd=On(),Ld=En(),Bd=vn(),Pn=class extends Rd.Stream{#e;#t;#r;#s;#i;#n;#a;#o;#u;#c;#f;#p;constructor(e,r,s,n){super(e.intMode),this.#e=e,this.#t=r.toString(),this.#r=s,this.#s=n,this.#i=void 0,this.#n=new Cd.Queue,this.#a=!1,this.#u=!1,this.#c=!1,this.#f=void 0,this.#p=new qd.IdAlloc}client(){return this.#e}_sqlOwner(){return this}storeSql(e){let r=this.#p.alloc();return this.#h({type:"store_sql",sqlId:r,sql:e}).then(()=>{},s=>this._setClosed(s)),new xd.Sql(this,r)}_closeSql(e){this.#f===void 0&&this.#h({type:"close_sql",sqlId:e}).then(()=>this.#p.free(e),r=>this._setClosed(r))}_execute(e){return this.#h({type:"execute",stmt:e}).then(r=>r.result)}_batch(e){return this.#h({type:"batch",batch:e}).then(r=>r.result)}_describe(e){return this.#h({type:"describe",sql:e.sql,sqlId:e.sqlId}).then(r=>r.result)}_sequence(e){return this.#h({type:"sequence",sql:e.sql,sqlId:e.sqlId}).then(r=>{})}getAutocommit(){return this.#e._ensureVersion(3,"getAutocommit()"),this.#h({type:"get_autocommit"}).then(e=>e.isAutocommit)}#h(e){return new Promise((r,s)=>{this.#_({type:"pipeline",request:e,responseCallback:r,errorCallback:s})})}_openCursor(e){return new Promise((r,s)=>{this.#_({type:"cursor",batch:e,cursorCallback:r,errorCallback:s})})}_cursorClosed(e){if(e!==this.#o)throw new Z.InternalError("Cursor was closed, but it was not associated with the stream");this.#o=void 0,(0,Dr.queueMicrotask)(()=>this.#d())}close(){this._setClosed(new Z.ClientError("Stream was manually closed"))}closeGracefully(){this.#u=!0,(0,Dr.queueMicrotask)(()=>this.#d())}get closed(){return this.#f!==void 0||this.#u}_setClosed(e){if(this.#f===void 0){for(this.#f=e,this.#o!==void 0&&this.#o._setClosed(e),this.#e._streamClosed(this);;){let r=this.#n.shift();if(r!==void 0)r.errorCallback(e);else break}(this.#i!==void 0||this.#a)&&!this.#c&&(this.#n.push({type:"pipeline",request:{type:"close"},responseCallback:()=>{},errorCallback:()=>{}}),this.#c=!0,(0,Dr.queueMicrotask)(()=>this.#d()))}}#_(e){if(this.#f!==void 0)throw new Z.ClosedError("Stream is closed",this.#f);if(this.#u)throw new Z.ClosedError("Stream is closing",void 0);this.#n.push(e),(0,Dr.queueMicrotask)(()=>this.#d())}#d(){if(this.#a||this.#o!==void 0)return;if(this.#u&&this.#n.length===0){this._setClosed(new Z.ClientError("Stream was gracefully closed"));return}let e=this.#e._endpoint;if(e===void 0){this.#e._endpointPromise.then(()=>this.#d(),s=>this._setClosed(s));return}let r=this.#n.shift();if(r!==void 0)if(r.type==="pipeline"){let s=[r];for(;;){let n=this.#n.first();if(n!==void 0&&n.type==="pipeline")s.push(n),this.#n.shift();else if(n===void 0&&this.#u&&!this.#c){s.push({type:"pipeline",request:{type:"close"},responseCallback:()=>{},errorCallback:()=>{}}),this.#c=!0;break}else break}this.#l(e,s)}else if(r.type==="cursor")this.#m(e,r);else throw(0,$r.impossible)(r,"Impossible type of QueueEntry")}#l(e,r){this.#y(()=>this.#w(r,e),s=>Ad(s,e.encoding),s=>s.baton,s=>s.baseUrl,s=>Md(r,s),s=>r.forEach(n=>n.errorCallback(s)))}#m(e,r){let s=new Od.HttpCursor(this,e.encoding);this.#o=s,this.#y(()=>this.#g(r,e),n=>s.open(n),n=>n.baton,n=>n.baseUrl,n=>r.cursorCallback(s),n=>r.errorCallback(n))}#y(e,r,s,n,i,o){let a;try{let u=e(),c=this.#s;a=c(u)}catch(u){a=Promise.reject(u)}this.#a=!0,a.then(u=>u.ok?r(u):Ud(u).then(c=>{throw c})).then(u=>{this.#i=s(u),this.#t=n(u)??this.#t,i(u)}).catch(u=>{this._setClosed(u),o(u)}).finally(()=>{this.#a=!1,this.#d()})}#w(e,r){return this.#b(new URL(r.pipelinePath,this.#t),{baton:this.#i,requests:e.map(s=>s.request)},r.encoding,Pd.PipelineReqBody,Td.PipelineReqBody)}#g(e,r){if(r.cursorPath===void 0)throw new Z.ProtocolVersionError(`Cursors are supported only on protocol version 3 and higher, but the HTTP server only supports version ${r.version}.`);return this.#b(new URL(r.cursorPath,this.#t),{baton:this.#i,batch:e.batch},r.encoding,Id.CursorReqBody,jd.CursorReqBody)}#b(e,r,s,n,i){let o,a;if(s==="json")o=(0,Fr.writeJsonObject)(r,n),a="application/json";else if(s==="protobuf")o=(0,Fr.writeProtobufMessage)(r,i),a="application/x-protobuf";else throw(0,$r.impossible)(s,"Impossible encoding");let u=new Ma.Headers;return u.set("content-type",a),this.#r!==void 0&&u.set("authorization",`Bearer ${this.#r}`),new Ma.Request(e.toString(),{method:"POST",headers:u,body:o})}};Wr.HttpStream=Pn;function Md(t,e){if(e.results.length!==t.length)throw new Z.ProtoError("Server returned unexpected number of pipeline results");for(let r=0;r<t.length;++r){let s=e.results[r],n=t[r];if(s.type==="ok"){if(s.response.type!==n.request.type)throw new Z.ProtoError("Received unexpected type of response");n.responseCallback(s.response)}else if(s.type==="error")n.errorCallback((0,Aa.errorFromProto)(s.error));else throw s.type==="none"?new Z.ProtoError("Received unrecognized type of StreamResult"):(0,$r.impossible)(s,"Received impossible type of StreamResult")}}async function Ad(t,e){if(e==="json"){let r=await t.json();return(0,Fr.readJsonObject)(r,Ld.PipelineRespBody)}if(e==="protobuf"){let r=await t.arrayBuffer();return(0,Fr.readProtobufMessage)(new Uint8Array(r),Bd.PipelineRespBody)}throw await t.body?.cancel(),(0,$r.impossible)(e,"Impossible encoding")}async function Ud(t){let e=t.headers.get("content-type")??"text/plain",r=`Server returned HTTP status ${t.status}`;if(e==="application/json"){let s=await t.json();return"message"in s?(0,Aa.errorFromProto)(s):new Z.HttpServerError(r,t.status)}if(e==="text/plain"){let s=(await t.text()).trim();return s!==""&&(r+=`: ${s}`),new Z.HttpServerError(r,t.status)}return await t.body?.cancel(),new Z.HttpServerError(r,t.status)}});var Ln=f(De=>{"use strict";Object.defineProperty(De,"__esModule",{value:!0});De.HttpClient=De.checkEndpoints=void 0;var Ua=Ur(),Nd=ar(),Mt=C(),kd=Tn();De.checkEndpoints=[{versionPath:"v3-protobuf",pipelinePath:"v3-protobuf/pipeline",cursorPath:"v3-protobuf/cursor",version:3,encoding:"protobuf"}];var In={versionPath:"v2",pipelinePath:"v2/pipeline",cursorPath:void 0,version:2,encoding:"json"},jn=class extends Nd.Client{#e;#t;#r;#s;#i;_endpointPromise;_endpoint;constructor(e,r,s,n=2){super(),this.#e=e,this.#t=r,this.#r=s??Ua.fetch,this.#s=void 0,this.#i=new Set,n==3?(this._endpointPromise=Dd(this.#r,this.#e),this._endpointPromise.then(i=>this._endpoint=i,i=>this.#n(i))):(this._endpointPromise=Promise.resolve(In),this._endpointPromise.then(i=>this._endpoint=i,i=>this.#n(i)))}async getVersion(){return this._endpoint!==void 0?this._endpoint.version:(await this._endpointPromise).version}_ensureVersion(e,r){if(!(e<=In.version)){if(this._endpoint===void 0)throw new Mt.ProtocolVersionError(`${r} is supported only on protocol version ${e} and higher, but the version supported by the HTTP server is not yet known. Use Client.getVersion() to wait until the version is available.`);if(this._endpoint.version<e)throw new Mt.ProtocolVersionError(`${r} is supported only on protocol version ${e} and higher, but the HTTP server only supports version ${this._endpoint.version}.`)}}openStream(){if(this.#s!==void 0)throw new Mt.ClosedError("Client is closed",this.#s);let e=new kd.HttpStream(this,this.#e,this.#t,this.#r);return this.#i.add(e),e}_streamClosed(e){this.#i.delete(e)}close(){this.#n(new Mt.ClientError("Client was manually closed"))}get closed(){return this.#s!==void 0}#n(e){if(this.#s===void 0){this.#s=e;for(let r of Array.from(this.#i))r._setClosed(new Mt.ClosedError("Client was closed",e))}}};De.HttpClient=jn;async function Dd(t,e){let r=t;for(let s of De.checkEndpoints){let n=new URL(s.versionPath,e),i=new Ua.Request(n.toString(),{method:"GET"}),o=await r(i);if(await o.arrayBuffer(),o.ok)return s}return In}});var Na=f(Vr=>{"use strict";Object.defineProperty(Vr,"__esModule",{value:!0});Vr.parseLibsqlUrl=void 0;var Re=C();function Fd(t){let e=new URL(t),r,s;for(let[c,h]of e.searchParams.entries())if(c==="authToken")r=h;else if(c==="tls")if(h==="0")s=!1;else if(h==="1")s=!0;else throw new Re.LibsqlUrlParseError(`Unknown value for the "tls" query argument: ${JSON.stringify(h)}`);else throw new Re.LibsqlUrlParseError(`Unknown URL query argument ${JSON.stringify(c)}`);let n,i;if((e.protocol==="http:"||e.protocol==="ws:")&&s===!0)throw new Re.LibsqlUrlParseError(`A ${JSON.stringify(e.protocol)} URL cannot opt into TLS using ?tls=1`);if((e.protocol==="https:"||e.protocol==="wss:")&&s===!1)throw new Re.LibsqlUrlParseError(`A ${JSON.stringify(e.protocol)} URL cannot opt out of TLS using ?tls=0`);if(e.protocol==="http:"||e.protocol==="https:")i=e.protocol;else if(e.protocol==="ws:"||e.protocol==="wss:")n=e.protocol;else if(e.protocol==="libsql:")if(s===!1){if(!e.port)throw new Re.LibsqlUrlParseError('A "libsql:" URL with ?tls=0 must specify an explicit port');i="http:",n="ws:"}else i="https:",n="wss:";else throw new Re.LibsqlUrlParseError(`This client does not support ${JSON.stringify(e.protocol)} URLs. Please use a "libsql:", "ws:", "wss:", "http:" or "https:" URL instead.`);if(e.username||e.password)throw new Re.LibsqlUrlParseError('This client does not support HTTP Basic authentication with a username and password. You can authenticate using a token passed in the "authToken" URL query parameter.');if(e.hash)throw new Re.LibsqlUrlParseError("URL fragments are not supported");let o=e.pathname;o==="/"&&(o="");let a=n!==void 0?`${n}//${e.host}${o}`:void 0,u=i!==void 0?`${i}//${e.host}${o}`:void 0;return{hranaWsUrl:a,hranaHttpUrl:u,authToken:r}}Vr.parseLibsqlUrl=Fd});var Hr=f(m=>{"use strict";var $d=m&&m.__createBinding||(Object.create?function(t,e,r,s){s===void 0&&(s=r);var n=Object.getOwnPropertyDescriptor(e,r);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,s,n)}:function(t,e,r,s){s===void 0&&(s=r),t[s]=e[r]}),Wd=m&&m.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&$d(e,t,r)};Object.defineProperty(m,"__esModule",{value:!0});m.openHttp=m.openWs=m.WsStream=m.WsClient=m.HttpStream=m.HttpClient=m.Stream=m.Stmt=m.Sql=m.parseLibsqlUrl=m.BatchCond=m.BatchStep=m.Batch=m.Client=m.Headers=m.Request=m.fetch=m.WebSocket=void 0;var ka=Bs(),Da=Ar(),Vd=C(),Hd=Ln(),Gd=Ar(),zd=Bs();Object.defineProperty(m,"WebSocket",{enumerable:!0,get:function(){return zd.WebSocket}});var Bn=Ur();Object.defineProperty(m,"fetch",{enumerable:!0,get:function(){return Bn.fetch}});Object.defineProperty(m,"Request",{enumerable:!0,get:function(){return Bn.Request}});Object.defineProperty(m,"Headers",{enumerable:!0,get:function(){return Bn.Headers}});var Jd=ar();Object.defineProperty(m,"Client",{enumerable:!0,get:function(){return Jd.Client}});Wd(C(),m);var Mn=nn();Object.defineProperty(m,"Batch",{enumerable:!0,get:function(){return Mn.Batch}});Object.defineProperty(m,"BatchStep",{enumerable:!0,get:function(){return Mn.BatchStep}});Object.defineProperty(m,"BatchCond",{enumerable:!0,get:function(){return Mn.BatchCond}});var Kd=Na();Object.defineProperty(m,"parseLibsqlUrl",{enumerable:!0,get:function(){return Kd.parseLibsqlUrl}});var Yd=ot();Object.defineProperty(m,"Sql",{enumerable:!0,get:function(){return Yd.Sql}});var Qd=wr();Object.defineProperty(m,"Stmt",{enumerable:!0,get:function(){return Qd.Stmt}});var Xd=qr();Object.defineProperty(m,"Stream",{enumerable:!0,get:function(){return Xd.Stream}});var Zd=Ln();Object.defineProperty(m,"HttpClient",{enumerable:!0,get:function(){return Zd.HttpClient}});var ep=Tn();Object.defineProperty(m,"HttpStream",{enumerable:!0,get:function(){return ep.HttpStream}});var tp=Ar();Object.defineProperty(m,"WsClient",{enumerable:!0,get:function(){return tp.WsClient}});var rp=fn();Object.defineProperty(m,"WsStream",{enumerable:!0,get:function(){return rp.WsStream}});function sp(t,e,r=2){if(typeof ka.WebSocket>"u")throw new Vd.WebSocketUnsupportedError("WebSockets are not supported in this environment");var s=void 0;r==3?s=Array.from(Da.subprotocolsV3.keys()):s=Array.from(Da.subprotocolsV2.keys());let n=new ka.WebSocket(t,s);return new Gd.WsClient(n,e)}m.openWs=sp;function np(t,e,r,s=2){return new Hd.HttpClient(t instanceof URL?t:new URL(t),e,r,s)}m.openHttp=np});var Nn=f(L=>{"use strict";var ip=L&&L.__createBinding||(Object.create?function(t,e,r,s){s===void 0&&(s=r);var n=Object.getOwnPropertyDescriptor(e,r);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,s,n)}:function(t,e,r,s){s===void 0&&(s=r),t[s]=e[r]}),op=L&&L.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),ap=L&&L.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&ip(e,t,r);return op(e,t),e};Object.defineProperty(L,"__esModule",{value:!0});L.mapHranaError=L.resultSetFromHrana=L.stmtToHrana=L.executeHranaBatch=L.HranaTransaction=void 0;var E=ap(Hr()),yt=te(),Gr=He(),An=class{#e;#t;#r;constructor(e,r){this.#e=e,this.#t=r,this.#r=void 0}execute(e){return this.batch([e]).then(r=>r[0])}async batch(e){let r=this._getStream();if(r.closed)throw new yt.LibsqlError("Cannot execute statements because the transaction is closed","TRANSACTION_CLOSED");try{let s=e.map(Fa),n;if(this.#r===void 0){this._getSqlCache().apply(s);let o=r.batch(this.#t>=3),a=o.step(),u=a.run((0,Gr.transactionModeToBegin)(this.#e)),c=a;n=s.map(h=>{let d=o.step().condition(E.BatchCond.ok(c));this.#t>=3&&d.condition(E.BatchCond.not(E.BatchCond.isAutocommit(o)));let b=d.query(h);return b.catch(()=>{}),c=d,b}),this.#r=o.execute().then(()=>u).then(()=>{});try{await this.#r}catch(h){throw this.close(),h}}else{this.#t<3&&await this.#r,this._getSqlCache().apply(s);let o=r.batch(this.#t>=3),a;n=s.map(u=>{let c=o.step();a!==void 0&&c.condition(E.BatchCond.ok(a)),this.#t>=3&&c.condition(E.BatchCond.not(E.BatchCond.isAutocommit(o)));let h=c.query(u);return h.catch(()=>{}),a=c,h}),await o.execute()}let i=[];for(let o of n){let a=await o;if(a===void 0)throw new yt.LibsqlError("Statement in a transaction was not executed, probably because the transaction has been rolled back","TRANSACTION_CLOSED");i.push(Un(a))}return i}catch(s){throw Fe(s)}}async executeMultiple(e){let r=this._getStream();if(r.closed)throw new yt.LibsqlError("Cannot execute statements because the transaction is closed","TRANSACTION_CLOSED");try{if(this.#r===void 0){this.#r=r.run((0,Gr.transactionModeToBegin)(this.#e)).then(()=>{});try{await this.#r}catch(s){throw this.close(),s}}else await this.#r;await r.sequence(e)}catch(s){throw Fe(s)}}async rollback(){try{let e=this._getStream();if(e.closed||this.#r===void 0)return;let r=e.run("ROLLBACK").catch(s=>{throw Fe(s)});e.closeGracefully(),await r}catch(e){throw Fe(e)}finally{this.close()}}async commit(){try{let e=this._getStream();if(e.closed)throw new yt.LibsqlError("Cannot commit the transaction because it is already closed","TRANSACTION_CLOSED");if(this.#r!==void 0)await this.#r;else return;let r=e.run("COMMIT").catch(s=>{throw Fe(s)});e.closeGracefully(),await r}catch(e){throw Fe(e)}finally{this.close()}}};L.HranaTransaction=An;async function up(t,e,r,s,n=!1){n&&r.step().run("PRAGMA foreign_keys=off");let i=r.step(),o=i.run((0,Gr.transactionModeToBegin)(t)),a=i,u=s.map(S=>{let y=r.step().condition(E.BatchCond.ok(a));e>=3&&y.condition(E.BatchCond.not(E.BatchCond.isAutocommit(r)));let _=y.query(S);return a=y,_}),c=r.step().condition(E.BatchCond.ok(a));e>=3&&c.condition(E.BatchCond.not(E.BatchCond.isAutocommit(r)));let h=c.run("COMMIT");r.step().condition(E.BatchCond.not(E.BatchCond.ok(c))).run("ROLLBACK").catch(S=>{}),n&&r.step().run("PRAGMA foreign_keys=on"),await r.execute();let b=[];await o;for(let S of u){let y=await S;if(y===void 0)throw new yt.LibsqlError("Statement in a batch was not executed, probably because the transaction has been rolled back","TRANSACTION_CLOSED");b.push(Un(y))}return await h,b}L.executeHranaBatch=up;function Fa(t){if(typeof t=="string")return new E.Stmt(t);let e=new E.Stmt(t.sql);if(Array.isArray(t.args))e.bindIndexes(t.args);else for(let[r,s]of Object.entries(t.args))e.bindName(r,s);return e}L.stmtToHrana=Fa;function Un(t){let e=t.columnNames.map(o=>o??""),r=t.columnDecltypes.map(o=>o??""),s=t.rows,n=t.affectedRowCount,i=t.lastInsertRowid!==void 0?t.lastInsertRowid:void 0;return new Gr.ResultSetImpl(e,r,s,n,i)}L.resultSetFromHrana=Un;function Fe(t){if(t instanceof E.ClientError){let e=$a(t);return new yt.LibsqlError(t.message,e,void 0,t)}return t}L.mapHranaError=Fe;function $a(t){return t instanceof E.ResponseError&&t.code!==void 0?t.code:t instanceof E.ProtoError?"HRANA_PROTO_ERROR":t instanceof E.ClosedError?t.cause instanceof E.ClientError?$a(t.cause):"HRANA_CLOSED_ERROR":t instanceof E.WebSocketError?"HRANA_WEBSOCKET_ERROR":t instanceof E.HttpServerError?"SERVER_ERROR":t instanceof E.ProtocolVersionError?"PROTOCOL_VERSION_ERROR":t instanceof E.InternalError?"INTERNAL_ERROR":"UNKNOWN"}});var Fn=f(zr=>{"use strict";Object.defineProperty(zr,"__esModule",{value:!0});zr.SqlCache=void 0;var kn=class{#e;#t;capacity;constructor(e,r){this.#e=e,this.#t=new Dn,this.capacity=r}apply(e){if(this.capacity<=0)return;let r=new Set;for(let s of e){if(typeof s.sql!="string")continue;let n=s.sql;if(n.length>=5e3)continue;let i=this.#t.get(n);if(i===void 0){for(;this.#t.size+1>this.capacity;){let[o,a]=this.#t.peekLru();if(r.has(a))break;a.close(),this.#t.delete(o)}this.#t.size+1<=this.capacity&&(i=this.#e.storeSql(n),this.#t.set(n,i))}i!==void 0&&(s.sql=i,r.add(i))}}};zr.SqlCache=kn;var Dn=class{#e;constructor(){this.#e=new Map}get(e){let r=this.#e.get(e);return r!==void 0&&(this.#e.delete(e),this.#e.set(e,r)),r}set(e,r){this.#e.set(e,r)}peekLru(){for(let e of this.#e.entries())return e}delete(e){this.#e.delete(e)}get size(){return this.#e.size}}});var $n=f((oy,Va)=>{function cp(t){var e=0,r=[];function s(){e--,e<t&&n()}function n(){var u=r.shift();a.queue=r.length,u&&o(u.fn).then(u.resolve).catch(u.reject)}function i(u){return new Promise(function(c,h){r.push({fn:u,resolve:c,reject:h}),a.queue=r.length})}function o(u){e++;try{return Promise.resolve(u()).then(function(c){return s(),c},function(c){throw s(),c})}catch(c){return s(),Promise.reject(c)}}var a=function(u){return e>=t?i(u):o(u)};return a}function lp(t,e){var r=!1,s=this;return Promise.all(t.map(function(){var n=arguments;return s(function(){if(!r)return e.apply(void 0,n).catch(function(i){throw r=!0,i})})}))}function Wa(t){return t.queue=0,t.map=lp,t}Va.exports=function(t){return Wa(t?cp(t):function(e){return e()})}});var Ka=f(x=>{"use strict";var za=x&&x.__createBinding||(Object.create?function(t,e,r,s){s===void 0&&(s=r);var n=Object.getOwnPropertyDescriptor(e,r);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,s,n)}:function(t,e,r,s){s===void 0&&(s=r),t[s]=e[r]}),fp=x&&x.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),hp=x&&x.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&za(e,t,r);return fp(e,t),e},dp=x&&x.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&za(e,t,r)},pp=x&&x.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(x,"__esModule",{value:!0});x.WsTransaction=x.WsClient=x._createClient=x.createClient=void 0;var Wn=hp(Hr()),$e=te(),_p=Et(),U=Nn(),yp=Fn(),Ha=$t(),Ga=He(),mp=pp($n());dp(te(),x);function bp(t){return Ja((0,_p.expandConfig)(t,!1))}x.createClient=bp;function Ja(t){if(t.scheme!=="wss"&&t.scheme!=="ws")throw new $e.LibsqlError(`The WebSocket client supports only "libsql:", "wss:" and "ws:" URLs, got ${JSON.stringify(t.scheme+":")}. For more information, please read ${Ga.supportedUrlLink}`,"URL_SCHEME_NOT_SUPPORTED");if(t.encryptionKey!==void 0)throw new $e.LibsqlError("Encryption key is not supported by the remote client.","ENCRYPTION_KEY_NOT_SUPPORTED");if(t.scheme==="ws"&&t.tls)throw new $e.LibsqlError('A "ws:" URL cannot opt into TLS by using ?tls=1',"URL_INVALID");if(t.scheme==="wss"&&!t.tls)throw new $e.LibsqlError('A "wss:" URL cannot opt out of TLS by using ?tls=0',"URL_INVALID");let e=(0,Ha.encodeBaseUrl)(t.scheme,t.authority,t.path),r;try{r=Wn.openWs(e,t.authToken)}catch(s){if(s instanceof Wn.WebSocketUnsupportedError){let n=t.scheme==="wss"?"https":"http",i=(0,Ha.encodeBaseUrl)(n,t.authority,t.path);throw new $e.LibsqlError(`This environment does not support WebSockets, please switch to the HTTP client by using a "${n}:" URL (${JSON.stringify(i)}). For more information, please read ${Ga.supportedUrlLink}`,"WEBSOCKETS_NOT_SUPPORTED")}throw(0,U.mapHranaError)(s)}return new Jr(r,e,t.authToken,t.intMode,t.concurrency)}x._createClient=Ja;var wp=60*1e3,gp=100,Jr=class{#e;#t;#r;#s;#i;closed;protocol;#n;#a;constructor(e,r,s,n,i){this.#e=r,this.#t=s,this.#r=n,this.#s=this.#u(e),this.#i=void 0,this.closed=!1,this.protocol="ws",this.#a=(0,mp.default)(i)}async limit(e){return this.#a(e)}async execute(e,r){let s;return typeof e=="string"?s={sql:e,args:r||[]}:s=e,this.limit(async()=>{let n=await this.#o();try{let i=(0,U.stmtToHrana)(s);n.conn.sqlCache.apply([i]);let o=n.stream.query(i);n.stream.closeGracefully();let a=await o;return(0,U.resultSetFromHrana)(a)}catch(i){throw(0,U.mapHranaError)(i)}finally{this._closeStream(n)}})}async batch(e,r="deferred"){return this.limit(async()=>{let s=await this.#o();try{let n=e.map(U.stmtToHrana),i=await s.conn.client.getVersion();s.conn.sqlCache.apply(n);let o=s.stream.batch(i>=3);return await(0,U.executeHranaBatch)(r,i,o,n)}catch(n){throw(0,U.mapHranaError)(n)}finally{this._closeStream(s)}})}async migrate(e){return this.limit(async()=>{let r=await this.#o();try{let s=e.map(U.stmtToHrana),n=await r.conn.client.getVersion(),i=r.stream.batch(n>=3);return await(0,U.executeHranaBatch)("deferred",n,i,s,!0)}catch(s){throw(0,U.mapHranaError)(s)}finally{this._closeStream(r)}})}async transaction(e="write"){return this.limit(async()=>{let r=await this.#o();try{let s=await r.conn.client.getVersion();return new Kr(this,r,e,s)}catch(s){throw this._closeStream(r),(0,U.mapHranaError)(s)}})}async executeMultiple(e){return this.limit(async()=>{let r=await this.#o();try{let s=r.stream.sequence(e);r.stream.closeGracefully(),await s}catch(s){throw(0,U.mapHranaError)(s)}finally{this._closeStream(r)}})}sync(){throw new $e.LibsqlError("sync not supported in ws mode","SYNC_NOT_SUPPORTED")}async#o(){if(this.closed)throw new $e.LibsqlError("The client is closed","CLIENT_CLOSED");if(new Date().valueOf()-this.#s.openTime.valueOf()>wp&&this.#i===void 0){let n=this.#u();this.#i=n,n.client.getVersion().then(i=>{this.#s!==n&&this.#s.streamStates.size===0&&this.#s.client.close(),this.#s=n,this.#i=void 0},i=>{this.#i=void 0})}if(this.#s.client.closed)try{this.#i!==void 0?this.#s=this.#i:this.#s=this.#u()}catch(n){throw(0,U.mapHranaError)(n)}let s=this.#s;try{s.useSqlCache===void 0&&(s.useSqlCache=await s.client.getVersion()>=2,s.useSqlCache&&(s.sqlCache.capacity=gp));let n=s.client.openStream();n.intMode=this.#r;let i={conn:s,stream:n};return s.streamStates.add(i),i}catch(n){throw(0,U.mapHranaError)(n)}}#u(e){try{return e??=Wn.openWs(this.#e,this.#t),{client:e,useSqlCache:void 0,sqlCache:new yp.SqlCache(e,0),openTime:new Date,streamStates:new Set}}catch(r){throw(0,U.mapHranaError)(r)}}_closeStream(e){e.stream.close();let r=e.conn;r.streamStates.delete(e),r.streamStates.size===0&&r!==this.#s&&r.client.close()}close(){this.#s.client.close(),this.closed=!0}};x.WsClient=Jr;var Kr=class extends U.HranaTransaction{#e;#t;constructor(e,r,s,n){super(s,n),this.#e=e,this.#t=r}_getStream(){return this.#t.stream}_getSqlCache(){return this.#t.conn.sqlCache}close(){this.#e._closeStream(this.#t)}get closed(){return this.#t.stream.closed}};x.WsTransaction=Kr});var eu=f(R=>{"use strict";var Ya=R&&R.__createBinding||(Object.create?function(t,e,r,s){s===void 0&&(s=r);var n=Object.getOwnPropertyDescriptor(e,r);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,s,n)}:function(t,e,r,s){s===void 0&&(s=r),t[s]=e[r]}),Sp=R&&R.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),Ep=R&&R.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&Ya(e,t,r);return Sp(e,t),e},vp=R&&R.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Ya(e,t,r)},qp=R&&R.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(R,"__esModule",{value:!0});R.HttpTransaction=R.HttpClient=R._createClient=R.createClient=void 0;var Cp=Ep(Hr()),At=te(),xp=Et(),ee=Nn(),Qa=Fn(),Rp=$t(),Op=He(),Pp=qp($n());vp(te(),R);function Tp(t){return Xa((0,xp.expandConfig)(t,!0))}R.createClient=Tp;function Xa(t){if(t.scheme!=="https"&&t.scheme!=="http")throw new At.LibsqlError(`The HTTP client supports only "libsql:", "https:" and "http:" URLs, got ${JSON.stringify(t.scheme+":")}. For more information, please read ${Op.supportedUrlLink}`,"URL_SCHEME_NOT_SUPPORTED");if(t.encryptionKey!==void 0)throw new At.LibsqlError("Encryption key is not supported by the remote client.","ENCRYPTION_KEY_NOT_SUPPORTED");if(t.scheme==="http"&&t.tls)throw new At.LibsqlError('A "http:" URL cannot opt into TLS by using ?tls=1',"URL_INVALID");if(t.scheme==="https"&&!t.tls)throw new At.LibsqlError('A "https:" URL cannot opt out of TLS by using ?tls=0',"URL_INVALID");let e=(0,Rp.encodeBaseUrl)(t.scheme,t.authority,t.path);return new Yr(e,t.authToken,t.intMode,t.fetch,t.concurrency)}R._createClient=Xa;var Za=30,Yr=class{#e;protocol;#t;#r;constructor(e,r,s,n,i){this.#e=Cp.openHttp(e,r,n),this.#e.intMode=s,this.protocol="http",this.#t=r,this.#r=(0,Pp.default)(i)}async limit(e){return this.#r(e)}async execute(e,r){let s;return typeof e=="string"?s={sql:e,args:r||[]}:s=e,this.limit(async()=>{try{let n=(0,ee.stmtToHrana)(s),i,o=this.#e.openStream();try{i=o.query(n)}finally{o.closeGracefully()}let a=await i;return(0,ee.resultSetFromHrana)(a)}catch(n){throw(0,ee.mapHranaError)(n)}})}async batch(e,r="deferred"){return this.limit(async()=>{try{let s=e.map(ee.stmtToHrana),n=await this.#e.getVersion(),i,o=this.#e.openStream();try{new Qa.SqlCache(o,Za).apply(s);let c=o.batch(!1);i=(0,ee.executeHranaBatch)(r,n,c,s)}finally{o.closeGracefully()}return await i}catch(s){throw(0,ee.mapHranaError)(s)}})}async migrate(e){return this.limit(async()=>{try{let r=e.map(ee.stmtToHrana),s=await this.#e.getVersion(),n,i=this.#e.openStream();try{let a=i.batch(!1);n=(0,ee.executeHranaBatch)("deferred",s,a,r,!0)}finally{i.closeGracefully()}return await n}catch(r){throw(0,ee.mapHranaError)(r)}})}async transaction(e="write"){return this.limit(async()=>{try{let r=await this.#e.getVersion();return new Qr(this.#e.openStream(),e,r)}catch(r){throw(0,ee.mapHranaError)(r)}})}async executeMultiple(e){return this.limit(async()=>{try{let r,s=this.#e.openStream();try{r=s.sequence(e)}finally{s.closeGracefully()}await r}catch(r){throw(0,ee.mapHranaError)(r)}})}sync(){throw new At.LibsqlError("sync not supported in http mode","SYNC_NOT_SUPPORTED")}close(){this.#e.close()}get closed(){return this.#e.closed}};R.HttpClient=Yr;var Qr=class extends ee.HranaTransaction{#e;#t;constructor(e,r,s){super(r,s),this.#e=e,this.#t=new Qa.SqlCache(e,Za)}_getStream(){return this.#e}_getSqlCache(){return this.#t}close(){this.#e.close()}get closed(){return this.#e.closed}};R.HttpTransaction=Qr});var Ip=exports&&exports.__createBinding||(Object.create?function(t,e,r,s){s===void 0&&(s=r);var n=Object.getOwnPropertyDescriptor(e,r);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,s,n)}:function(t,e,r,s){s===void 0&&(s=r),t[s]=e[r]}),jp=exports&&exports.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Ip(e,t,r)};Object.defineProperty(exports,"__esModule",{value:!0});exports.createClient=void 0;var Lp=Et(),Bp=Ai(),Mp=Ka(),Ap=eu();jp(te(),exports);function Up(t){return Np((0,Lp.expandConfig)(t,!0))}exports.createClient=Up;function Np(t){return t.scheme==="wss"||t.scheme==="ws"?(0,Mp._createClient)(t):t.scheme==="https"||t.scheme==="http"?(0,Ap._createClient)(t):(0,Bp._createClient)(t)}
