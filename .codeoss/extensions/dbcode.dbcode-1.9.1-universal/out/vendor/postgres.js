var ue=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports);var Re=ue((us,Ye)=>{var Ue=new Map,We=new Map,Xe=Symbol("OriginError"),xr=Ye.exports.CLOSE={},cs=Ye.exports.Query=class extends Promise{constructor(r,n,a,i,l={}){let o,c;super((m,C)=>{o=m,c=C}),this.tagged=Array.isArray(r.raw),this.strings=r,this.args=n,this.handler=a,this.canceller=i,this.options=l,this.state=null,this.statement=null,this.resolve=m=>(this.active=!1,o(m)),this.reject=m=>(this.active=!1,c(m)),this.active=!1,this.cancelled=null,this.executed=!1,this.signature="",this[Xe]=this.handler.debug?new Error:this.tagged&&en(this.strings)}get origin(){return(this.handler.debug?this[Xe].stack:this.tagged&&We.has(this.strings)?We.get(this.strings):We.set(this.strings,this[Xe].stack).get(this.strings))||""}static get[Symbol.species](){return Promise}cancel(){return this.canceller&&(this.canceller(this),this.canceller=null)}simple(){return this.options.simple=!0,this.options.prepare=!1,this}async readable(){return this.simple(),this.streaming=!0,this}async writable(){return this.simple(),this.streaming=!0,this}cursor(r=1,n){if(this.options.simple=!1,typeof r=="function"&&(n=r,r=1),this.cursorRows=r,typeof n=="function")return this.cursorFn=n,this;let a;return{[Symbol.asyncIterator]:()=>({next:()=>{if(this.executed&&!this.active)return{done:!0};a&&a();let i=new Promise((l,o)=>{this.cursorFn=c=>(l({value:c,done:!1}),new Promise(m=>a=m)),this.resolve=()=>(this.active=!1,l({done:!0})),this.reject=c=>(this.active=!1,o(c))});return this.execute(),i},return(){return a&&a(xr),{done:!0}}})}}describe(){return this.options.simple=!1,this.onlyDescribe=this.options.prepare=!0,this}stream(){throw new Error(".stream has been renamed to .forEach")}forEach(r){return this.forEachFn=r,this.handle(),this}raw(){return this.isRaw=!0,this}values(){return this.isRaw="values",this}async handle(){!this.executed&&(this.executed=!0)&&await 1&&this.handler(this)}execute(){return this.handle(),this}then(){return this.handle(),super.then.apply(this,arguments)}catch(){return this.handle(),super.catch.apply(this,arguments)}finally(){return this.handle(),super.finally.apply(this,arguments)}};function en(e){if(Ue.has(e))return Ue.get(e);let r=Error.stackTraceLimit;return Error.stackTraceLimit=4,Ue.set(e,new Error),Error.stackTraceLimit=r,Ue.get(e)}});var je=ue((ms,Je)=>{var tn=Je.exports.PostgresError=class extends Error{constructor(r){super(r.message),this.name=this.constructor.name,Object.assign(this,r)}},ds=Je.exports.Errors={connection:Bt,postgres:It,generic:Ct,notSupported:Tt};function Bt(e,r,n){let{host:a,port:i}=n||r,l=Object.assign(new Error("write "+e+" "+(r.path||a+":"+i)),{code:e,errno:e,address:r.path||a},r.path?{}:{port:i});return Error.captureStackTrace(l,Bt),l}function It(e){let r=new tn(e);return Error.captureStackTrace(r,It),r}function Ct(e,r){let n=Object.assign(new Error(e+": "+r),{code:e});return Error.captureStackTrace(n,Ct),n}function Tt(e){let r=Object.assign(new Error(e+" (B) is not supported"),{code:"MESSAGE_NOT_SUPPORTED",name:e});return Error.captureStackTrace(r,Tt),r}});var lt=ue((_s,D)=>{var{Query:xe}=Re(),{Errors:st}=je(),rn=D.exports.types={string:{to:25,from:null,serialize:e=>""+e},number:{to:0,from:[21,23,26,700,701],serialize:e=>""+e,parse:e=>+e},json:{to:114,from:[114,3802],serialize:e=>JSON.stringify(e),parse:e=>JSON.parse(e)},boolean:{to:16,from:16,serialize:e=>e===!0?"t":"f",parse:e=>e==="t"},date:{to:1184,from:[1082,1114,1184],serialize:e=>(e instanceof Date?e:new Date(e)).toISOString(),parse:e=>new Date(e)},bytea:{to:17,from:17,serialize:e=>"\\x"+Buffer.from(e).toString("hex"),parse:e=>Buffer.from(e.slice(2),"hex")}},Ae=class{then(){Ze()}catch(){Ze()}finally(){Ze()}},Rt=D.exports.Identifier=class extends Ae{constructor(r){super(),this.value=Fe(r)}},ke=D.exports.Parameter=class extends Ae{constructor(r,n,a){super(),this.value=r,this.type=n,this.array=a}},nn=D.exports.Builder=class extends Ae{constructor(r,n){super(),this.first=r,this.rest=n}build(r,n,a,i){let l=sn.map(([o,c])=>({fn:c,i:r.search(o)})).sort((o,c)=>o.i-c.i).pop();return l.i===-1?it(this.first,i):l.fn(this.first,this.rest,n,a,i)}};D.exports.handleValue=at;function at(e,r,n,a){let i=e instanceof ke?e.value:e;if(i===void 0&&(e instanceof ke?e.value=a.transform.undefined:i=e=a.transform.undefined,i===void 0))throw st.generic("UNDEFINED_VALUE","Undefined values are not allowed");return"$"+n.push(e instanceof ke?(r.push(e.value),e.array?e.array[e.type||Ut(e.value)]||e.type||Ft(e.value):e.type):(r.push(e),Ut(e)))}var jt=Lt(rn);D.exports.stringify=Dt;function Dt(e,r,n,a,i,l){for(let o=1;o<e.strings.length;o++)r+=ot(r,n,a,i,l)+e.strings[o],n=e.args[o];return r}function ot(e,r,n,a,i){return r instanceof nn?r.build(e,n,a,i):r instanceof xe?et(r,n,a,i):r instanceof Rt?r.value:r&&r[0]instanceof xe?r.reduce((l,o)=>l+" "+et(o,n,a,i),""):at(r,n,a,i)}function et(e,r,n,a){return e.fragment=!0,Dt(e,e.strings[0],e.args[0],r,n,a)}function kt(e,r,n,a,i){return e.map(l=>"("+a.map(o=>ot("values",l[o],r,n,i)).join(",")+")").join(",")}function Nt(e,r,n,a,i){let l=Array.isArray(e[0]),o=r.length?r.flat():Object.keys(l?e[0]:e);return kt(l?e:[e],n,a,o,i)}function De(e,r,n,a,i){if(typeof e=="string"&&(e=[e].concat(r)),Array.isArray(e))return it(e,i);let l;return(r.length?r.flat():Object.keys(e)).map(c=>(l=e[c],(l instanceof xe?et(l,n,a,i):l instanceof Rt?l.value:at(l,n,a,i))+" as "+Fe(i.transform.column.to?i.transform.column.to(c):c))).join(",")}var sn=Object.entries({values:Nt,in:(...e)=>{let r=Nt(...e);return r==="()"?"(null)":r},select:De,as:De,returning:De,"\\(":De,update(e,r,n,a,i){return(r.length?r.flat():Object.keys(e)).map(l=>Fe(i.transform.column.to?i.transform.column.to(l):l)+"="+ot("values",e[l],n,a,i))},insert(e,r,n,a,i){let l=r.length?r.flat():Object.keys(Array.isArray(e)?e[0]:e);return"("+it(l,i)+")values"+kt(Array.isArray(e)?e:[e],n,a,l,i)}}).map(([e,r])=>[new RegExp("((?:^|[\\s(])"+e+"(?:$|[\\s(]))(?![\\s\\S]*\\1)","i"),r]);function Ze(){throw st.generic("NOT_TAGGED_CALL","Query not called as a tagged template literal")}var an=D.exports.serializers=jt.serializers,on=D.exports.parsers=jt.parsers,ys=D.exports.END={};function Ft(e){return Array.isArray(e)?Ft(e[0]):typeof e=="string"?1009:0}var ws=D.exports.mergeUserTypes=function(e){let r=Lt(e||{});return{serializers:Object.assign({},an,r.serializers),parsers:Object.assign({},on,r.parsers)}};function Lt(e){return Object.keys(e).reduce((r,n)=>(e[n].from&&[].concat(e[n].from).forEach(a=>r.parsers[a]=e[n].parse),e[n].serialize&&(r.serializers[e[n].to]=e[n].serialize,e[n].from&&[].concat(e[n].from).forEach(a=>r.serializers[a]=e[n].serialize)),r),{parsers:{},serializers:{}})}function it(e,{transform:{column:r}}){return e.map(n=>Fe(r.to?r.to(n):n)).join(",")}var Fe=D.exports.escapeIdentifier=function(r){return'"'+r.replace(/"/g,'""').replace(/\./g,'"."')+'"'},Ut=D.exports.inferType=function e(r){return r instanceof ke?r.type:r instanceof Date?1184:r instanceof Uint8Array?17:r===!0||r===!1?16:typeof r=="bigint"?20:Array.isArray(r)?e(r[0]):0},cn=/\\/g,ln=/"/g;function un(e){return e.replace(cn,"\\\\").replace(ln,'\\"')}var bs=D.exports.arraySerializer=function e(r,n,a,i){if(Array.isArray(r)===!1)return r;if(!r.length)return"{}";let l=r[0],o=i===1020?";":",";return Array.isArray(l)&&!l.type?"{"+r.map(c=>e(c,n,a,i)).join(o)+"}":"{"+r.map(c=>{if(c===void 0&&(c=a.transform.undefined,c===void 0))throw st.generic("UNDEFINED_VALUE","Undefined values are not allowed");return c===null?"null":'"'+un(n?n(c.type?c.value:c):""+c)+'"'}).join(o)+"}"},qe={i:0,char:null,str:"",quoted:!1,last:0},Es=D.exports.arrayParser=function(r,n,a){return qe.i=qe.last=0,zt(qe,r,n,a)};function zt(e,r,n,a){let i=[],l=a===1020?";":",";for(;e.i<r.length;e.i++){if(e.char=r[e.i],e.quoted)e.char==="\\"?e.str+=r[++e.i]:e.char==='"'?(i.push(n?n(e.str):e.str),e.str="",e.quoted=r[e.i+1]==='"',e.last=e.i+2):e.str+=e.char;else if(e.char==='"')e.quoted=!0;else if(e.char==="{")e.last=++e.i,i.push(zt(e,r,n,a));else if(e.char==="}"){e.quoted=!1,e.last<e.i&&i.push(n?n(r.slice(e.last,e.i)):r.slice(e.last,e.i)),e.last=e.i+1;break}else e.char===l&&e.p!=="}"&&e.p!=='"'&&(i.push(n?n(r.slice(e.last,e.i)):r.slice(e.last,e.i)),e.last=e.i+1);e.p=e.char}return e.last<e.i&&i.push(n?n(r.slice(e.last,e.i+1)):r.slice(e.last,e.i+1)),i}var Pe=D.exports.toCamel=e=>{let r=e[0];for(let n=1;n<e.length;n++)r+=e[n]==="_"?e[++n].toUpperCase():e[n];return r},Oe=D.exports.toPascal=e=>{let r=e[0].toUpperCase();for(let n=1;n<e.length;n++)r+=e[n]==="_"?e[++n].toUpperCase():e[n];return r},Be=D.exports.toKebab=e=>e.replace(/_/g,"-"),tt=D.exports.fromCamel=e=>e.replace(/([A-Z])/g,"_$1").toLowerCase(),rt=D.exports.fromPascal=e=>(e.slice(0,1)+e.slice(1).replace(/([A-Z])/g,"_$1")).toLowerCase(),nt=D.exports.fromKebab=e=>e.replace(/-/g,"_");function ct(e){return function r(n,a){return typeof n=="object"&&n!==null&&(a.type===114||a.type===3802)?Array.isArray(n)?n.map(i=>r(i,a)):Object.entries(n).reduce((i,[l,o])=>Object.assign(i,{[e(l)]:r(o,a)}),{}):n}}Pe.column={from:Pe};Pe.value={from:ct(Pe)};tt.column={to:tt};var fn=D.exports.camel={...Pe};fn.column.to=tt;Oe.column={from:Oe};Oe.value={from:ct(Oe)};rt.column={to:rt};var dn=D.exports.pascal={...Oe};dn.column.to=rt;Be.column={from:Be};Be.value={from:ct(Be)};nt.column={to:nt};var mn=D.exports.kebab={...Be};mn.column.to=nt});var $t=ue((vs,Mt)=>{Mt.exports=class extends Array{constructor(){super(),Object.defineProperties(this,{count:{value:null,writable:!0},state:{value:null,writable:!0},command:{value:null,writable:!0},columns:{value:null,writable:!0},statement:{value:null,writable:!0}})}static get[Symbol.species](){return Array}}});var ut=ue((As,Gt)=>{Gt.exports=pn;function pn(e=[]){let r=e.slice(),n=0;return{get length(){return r.length-n},remove:a=>{let i=r.indexOf(a);return i===-1?null:(r.splice(i,1),a)},push:a=>(r.push(a),a),shift:()=>{let a=r[n++];return n===r.length?(n=0,r=[]):r[n-1]=void 0,a}}}});var Kt=ue((Ps,Qt)=>{var Z=Buffer.allocUnsafe(256),hn="BCcDdEFfHPpQSX".split("").reduce((e,r)=>{let n=r.charCodeAt(0);return e[r]=()=>(Z[0]=n,A.i=5,A),e},{}),A=Object.assign(gn,hn,{N:"\0",i:0,inc(e){return A.i+=e,A},str(e){let r=Buffer.byteLength(e);return Le(r),A.i+=Z.write(e,A.i,r,"utf8"),A},i16(e){return Le(2),Z.writeUInt16BE(e,A.i),A.i+=2,A},i32(e,r){return r||r===0?(Z.writeUInt32BE(e,r),A):(Le(4),Z.writeUInt32BE(e,A.i),A.i+=4,A)},z(e){return Le(e),Z.fill(0,A.i,A.i+e),A.i+=e,A},raw(e){return Z=Buffer.concat([Z.subarray(0,A.i),e]),A.i=Z.length,A},end(e=1){Z.writeUInt32BE(A.i-e,e);let r=Z.subarray(0,A.i);return A.i=0,Z=Buffer.allocUnsafe(256),r}});Qt.exports=A;function Le(e){if(Z.length-A.i<e){let r=Z,n=r.length;Z=Buffer.allocUnsafe(n+(n>>1)+e),r.copy(Z)}}function gn(){return A.i=0,A}});var qt=ue((Os,Zt)=>{var Ht=require("net"),yn=require("tls"),Ie=require("crypto"),ft=require("stream"),{performance:Vt}=require("perf_hooks"),{stringify:wn,handleValue:bn,arrayParser:En,arraySerializer:_n}=lt(),{Errors:ne}=je(),ze=$t(),Sn=ut(),{Query:Wt,CLOSE:vn}=Re(),h=Kt();Zt.exports=Jt;var An=1,pe=h().S().end(),Xt=h().H().end(),Pn=h().i32(8).i32(80877103).end(8),On=Buffer.concat([h().E().str(h.N).i32(0).end(),pe]),Bn=h().D().str("S").str(h.N).end(),Ee=()=>{},In=new Set(["FetchPreparedStatement","RevalidateCachedQuery","transformAssignedExpr"]),Cn={83:"severity_local",86:"severity",67:"code",77:"message",68:"detail",72:"hint",80:"position",112:"internal_position",113:"internal_query",87:"where",115:"schema_name",116:"table_name",99:"column_name",100:"data type_name",110:"constraint_name",70:"file",76:"line",82:"routine"};function Jt(e,r={},{onopen:n=Ee,onend:a=Ee,onclose:i=Ee}={}){let{ssl:l,max:o,user:c,host:m,port:C,database:U,parsers:S,transform:w,onnotice:P,onnotify:R,onparameter:y,max_pipeline:V,keep_alive:O,backoff:x,target_session_attrs:ee}=e,z=Sn(),k=An++,se={pid:null,secret:null},he=mt(He,e.idle_timeout),ye=mt(He,e.max_lifetime),fe=mt(dr,e.connect_timeout),f=null,M,E=new ze,G=Buffer.alloc(0),ge=e.fetch_types,ce={},le={},Ce=Math.random().toString(36).slice(2),u=1,g=0,v=0,j=0,Q=0,b=0,B=0,$=0,F=null,T=null,W=!1,I=null,te=null,X=null,de=null,K=null,N=null,re=null,ae=null,d=null,_e=null,Y={queue:r.closed,idleTimer:he,connect(t){X=t||!0,St()},terminate:ve,execute:Se,cancel:cr,end:He,count:0,id:k};return r.closed&&r.closed.push(Y),Y;async function ir(){let t;try{t=e.socket?await Promise.resolve(e.socket(e)):new Ht.Socket}catch(s){be(s);return}return t.on("error",be),t.on("close",vt),t.on("drain",Et),t}async function cr({pid:t,secret:s},p,_){try{M=h().i32(16).i32(80877102).i32(t).i32(s).end(16),await _t(),f.once("error",_),f.once("close",p)}catch(L){_(L)}}function Se(t){if(W)return Ne(t,ne.connection("CONNECTION_DESTROYED",e));if(!t.cancelled)try{return t.state=se,d?z.push(t):(d=t,d.active=!0),fr(t),H(lr(t))&&!t.describeFirst&&!t.cursorFn&&z.length<V&&(!t.options.onexecute||t.options.onexecute(Y))}catch(s){return z.length===0&&H(pe),oe(s),!0}}function lr(t){if(t.parameters.length>=65534)throw ne.generic("MAX_PARAMETERS_EXCEEDED","Max number of parameters (65534) exceeded");return t.options.simple?h().Q().str(t.statement.string+h.N).end():t.describeFirst?Buffer.concat([yt(t),Xt]):t.prepare?t.prepared?Te(t):Buffer.concat([yt(t),Te(t)]):ur(t)}function yt(t){return Buffer.concat([Pt(t.statement.string,t.parameters,t.statement.types,t.statement.name),Jr("S",t.statement.name)])}function Te(t){return Buffer.concat([Yr(t.parameters,t.statement.types,t.statement.name,t.cursorName),t.cursorFn?Ot("",t.cursorRows):On])}function ur(t){return Buffer.concat([Pt(t.statement.string,t.parameters,t.statement.types),Bn,Te(t)])}function fr(t){let s=[],p=[],_=wn(t,t.strings[0],t.args[0],s,p,e);!t.tagged&&t.args.forEach(L=>bn(L,s,p,e)),t.prepare=e.prepare&&("prepare"in t.options?t.options.prepare:!0),t.string=_,t.signature=t.prepare&&p+_,t.onlyDescribe&&delete le[t.signature],t.parameters=t.parameters||s,t.prepared=t.prepare&&t.signature in le,t.describeFirst=t.onlyDescribe||s.length&&!t.prepared,t.statement=t.prepared?le[t.signature]:{string:_,types:p,name:t.prepare?Ce+u++:""},typeof e.debug=="function"&&e.debug(k,_,s,p)}function H(t,s){return N=N?Buffer.concat([N,t]):Buffer.from(t),s||N.length>=1024?wt(s):(T===null&&(T=setImmediate(wt)),!0)}function wt(t){let s=f.write(N,t);return T!==null&&clearImmediate(T),N=T=null,s}function dr(){oe(ne.connection("CONNECT_TIMEOUT",e,f)),f.destroy()}async function bt(){if(H(Pn),!await new Promise(s=>f.once("data",p=>s(p[0]===83)))&&l==="prefer")return we();f.removeAllListeners(),f=yn.connect({socket:f,servername:Ht.isIP(f.host)?void 0:f.host,...l==="require"||l==="allow"||l==="prefer"?{rejectUnauthorized:!1}:l==="verify-full"?{}:typeof l=="object"?l:{}}),f.on("secureConnect",we),f.on("error",be),f.on("close",vt),f.on("drain",Et)}function Et(){!d&&n(Y)}function Ke(t){if(!(I&&(I.push(t),v-=t.length,v>=0)))for(G=I?Buffer.concat(I,b-v):G.length===0?t:Buffer.concat([G,t],G.length+t.length);G.length>4;){if(b=G.readUInt32BE(1),b>=G.length){v=b-G.length,I=[G];break}try{mr(G.subarray(0,b+1))}catch(s){d&&(d.cursorFn||d.describeFirst)&&H(pe),oe(s)}G=G.subarray(b+1),v=0,I=null}}async function _t(){if(W=!1,ce={},f||(f=await ir()),!!f){if(fe.start(),e.socket)return l?bt():we();if(f.on("connect",l?bt:we),e.path)return f.connect(e.path);f.ssl=l,f.connect(C[j],m[j]),f.host=m[j],f.port=C[j],j=(j+1)%C.length}}function St(){setTimeout(_t,g?g+B-Vt.now():0)}function we(){try{le={},ge=e.fetch_types,Ce=Math.random().toString(36).slice(2),u=1,ye.start(),f.on("data",Ke),O&&f.setKeepAlive&&f.setKeepAlive(!0,1e3*O);let t=qr();H(t)}catch(t){be(t)}}function be(t){if(!(Y.queue===r.connecting&&e.host[Q+1]))for(oe(t);z.length;)Ne(z.shift(),t)}function oe(t){K&&(K.destroy(t),K=null),d&&Ne(d,t),X&&(Ne(X,t),X=null)}function Ne(t,s){"query"in s||"parameters"in s||Object.defineProperties(s,{stack:{value:s.stack+t.origin?t.origin.replace(/.*\n/,`
`):"",enumerable:e.debug},query:{value:t.string,enumerable:e.debug},parameters:{value:t.parameters,enumerable:e.debug},args:{value:t.args,enumerable:e.debug},types:{value:t.statement&&t.statement.types,enumerable:e.debug}}),t.reject(s)}function He(){return de||(!Y.reserved&&a(Y),!Y.reserved&&!X&&!d&&z.length===0?(ve(),new Promise(t=>f&&f.readyState!=="closed"?f.once("close",t):t())):de=new Promise(t=>re=t))}function ve(){W=!0,(K||d||X||z.length)&&be(ne.connection("CONNECTION_DESTROYED",e)),clearImmediate(T),f&&(f.removeListener("data",Ke),f.removeListener("connect",we),f.readyState==="open"&&f.end(h().X().end())),re&&(re(),de=re=null)}async function vt(t){if(G=Buffer.alloc(0),v=0,I=null,clearImmediate(T),f.removeListener("data",Ke),f.removeListener("connect",we),he.cancel(),ye.cancel(),fe.cancel(),f.removeAllListeners(),f=null,X)return St();!t&&(d||z.length)&&be(ne.connection("CONNECTION_CLOSED",e,f)),g=Vt.now(),t&&e.shared.retries++,B=(typeof x=="function"?x(e.shared.retries):x)*1e3,i(Y,ne.connection("CONNECTION_CLOSED",e,f))}function mr(t,s=t[0]){(s===68?pr:s===100?$r:s===65?Dr:s===83?hr:s===90?gr:s===67?yr:s===50?At:s===49?wr:s===116?br:s===84?Er:s===82?_r:s===110?Br:s===75?Ir:s===69?Rr:s===115?kr:s===51?Fr:s===71?Lr:s===78?Qr:s===72?zr:s===99?Gr:s===73?Kr:s===86?Hr:s===118?Vr:s===87?Mr:Wr)(t)}function pr(t){let s=7,p,_,L,J=d.isRaw?new Array(d.statement.columns.length):{};for(let q=0;q<d.statement.columns.length;q++)_=d.statement.columns[q],p=t.readInt32BE(s),s+=4,L=p===-1?null:d.isRaw===!0?t.subarray(s,s+=p):_.parser===void 0?t.toString("utf8",s,s+=p):_.parser.array===!0?_.parser(t.toString("utf8",s+1,s+=p)):_.parser(t.toString("utf8",s,s+=p)),d.isRaw?J[q]=d.isRaw===!0?L:w.value.from?w.value.from(L,_):L:J[_.name]=w.value.from?w.value.from(L,_):L;d.forEachFn?d.forEachFn(w.row.from?w.row.from(J):J,E):E[$++]=w.row.from?w.row.from(J):J}function hr(t){let[s,p]=t.toString("utf8",5,t.length-1).split(h.N);ce[s]=p,e.parameters[s]!==p&&(e.parameters[s]=p,y&&y(s,p))}function gr(t){if(d&&d.options.simple&&d.resolve(te||E),d=te=null,E=new ze,fe.cancel(),X){if(ee){if(!ce.in_hot_standby||!ce.default_transaction_read_only)return Ur();if(Nr(ee,ce))return ve()}if(ge)return X===!0&&(X=null),Cr();X!==!0&&Se(X),e.shared.retries=Q=0,X=null;return}for(;z.length&&(d=z.shift())&&(d.active=!0,d.cancelled);)Jt(e).cancel(d.state,d.cancelled.resolve,d.cancelled.reject);d||(Y.reserved?!Y.reserved.release&&t[5]===73?de?ve():(Y.reserved=null,n(Y)):Y.reserved():de?ve():n(Y))}function yr(t){$=0;for(let s=t.length-1;s>0;s--)if(t[s]===32&&t[s+1]<58&&E.count===null&&(E.count=+t.toString("utf8",s+1,t.length-1)),t[s-1]>=65){E.command=t.toString("utf8",5,s),E.state=se;break}if(_e&&(_e(),_e=null),E.command==="BEGIN"&&o!==1&&!Y.reserved)return oe(ne.generic("UNSAFE_TRANSACTION","Only use sql.begin, sql.reserved or max: 1"));if(d.options.simple)return At();d.cursorFn&&(E.count&&d.cursorFn(E),H(pe)),d.resolve(E)}function wr(){d.parsing=!1}function At(){!E.statement&&(E.statement=d.statement),E.columns=d.statement.columns}function br(t){let s=t.readUInt16BE(5);for(let p=0;p<s;++p)!d.statement.types[p]&&(d.statement.types[p]=t.readUInt32BE(7+p*4));d.prepare&&(le[d.signature]=d.statement),d.describeFirst&&!d.onlyDescribe&&(H(Te(d)),d.describeFirst=!1)}function Er(t){E.command&&(te=te||[E],te.push(E=new ze),E.count=null,d.statement.columns=null);let s=t.readUInt16BE(5),p=7,_;d.statement.columns=Array(s);for(let L=0;L<s;++L){for(_=p;t[p++]!==0;);let J=t.readUInt32BE(p),q=t.readUInt16BE(p+4),me=t.readUInt32BE(p+6);d.statement.columns[L]={name:w.column.from?w.column.from(t.toString("utf8",_,p-1)):t.toString("utf8",_,p-1),parser:S[me],table:J,number:q,type:me},p+=18}if(E.statement=d.statement,d.onlyDescribe)return d.resolve(d.statement),H(pe)}async function _r(t,s=t.readUInt32BE(5)){(s===3?Sr:s===5?vr:s===10?Ar:s===11?Pr:s===12?Or:s!==0?Xr:Ee)(t,s)}async function Sr(){let t=await Ve();H(h().p().str(t).z(1).end())}async function vr(t){let s="md5"+await Yt(Buffer.concat([Buffer.from(await Yt(await Ve()+c)),t.subarray(9)]));H(h().p().str(s).z(1).end())}async function Ar(){ae=(await Ie.randomBytes(18)).toString("base64"),h().p().str("SCRAM-SHA-256"+h.N);let t=h.i;H(h.inc(4).str("n,,n=*,r="+ae).i32(h.i-t-4,t).end())}async function Pr(t){let s=t.toString("utf8",9).split(",").reduce((q,me)=>(q[me[0]]=me.slice(2),q),{}),p=await Ie.pbkdf2Sync(await Ve(),Buffer.from(s.s,"base64"),parseInt(s.i),32,"sha256"),_=await Me(p,"Client Key"),L="n=*,r="+ae+",r="+s.r+",s="+s.s+",i="+s.i+",c=biws,r="+s.r;F=(await Me(await Me(p,"Server Key"),L)).toString("base64");let J="c=biws,r="+s.r+",p="+Nn(_,Buffer.from(await Me(await Tn(_),L))).toString("base64");H(h().p().str(J).end())}function Or(t){t.toString("utf8",9).split(h.N,1)[0].slice(2)!==F&&(oe(ne.generic("SASL_SIGNATURE_MISMATCH","The server did not return the correct signature")),f.destroy())}function Ve(){return Promise.resolve(typeof e.pass=="function"?e.pass():e.pass)}function Br(){if(E.statement=d.statement,E.statement.columns=[],d.onlyDescribe)return d.resolve(d.statement),H(pe)}function Ir(t){se.pid=t.readUInt32BE(5),se.secret=t.readUInt32BE(9)}async function Cr(){ge=!1,(await new Wt([`
      select b.oid, b.typarray
      from pg_catalog.pg_type a
      left join pg_catalog.pg_type b on b.oid = a.typelem
      where a.typcategory = 'A'
      group by b.oid, b.typarray
      order by b.oid
    `],[],Se)).forEach(({oid:s,typarray:p})=>Tr(s,p))}function Tr(t,s){if(e.parsers[s]&&e.serializers[s])return;let p=e.parsers[t];e.shared.typeArrayMap[t]=s,e.parsers[s]=_=>En(_,p,s),e.parsers[s].array=!0,e.serializers[s]=_=>_n(_,e.serializers[t],e,s)}function Nr(t,s){return t==="read-write"&&s.default_transaction_read_only==="on"||t==="read-only"&&s.default_transaction_read_only==="off"||t==="primary"&&s.in_hot_standby==="on"||t==="standby"&&s.in_hot_standby==="off"||t==="prefer-standby"&&s.in_hot_standby==="off"&&e.host[Q]}function Ur(){let t=new Wt([`
      show transaction_read_only;
      select pg_catalog.pg_is_in_recovery()
    `],[],Se,null,{simple:!0});t.resolve=([[s],[p]])=>{ce.default_transaction_read_only=s.transaction_read_only,ce.in_hot_standby=p.pg_is_in_recovery?"on":"off"},t.execute()}function Rr(t){d&&(d.cursorFn||d.describeFirst)&&H(pe);let s=ne.postgres(dt(t));d&&d.retried?oe(d.retried):d&&d.prepared&&In.has(s.routine)?jr(d,s):oe(s)}function jr(t,s){delete le[t.signature],t.retried=s,Se(t)}function Dr(t){if(!R)return;let s=9;for(;t[s++]!==0;);R(t.toString("utf8",9,s-1),t.toString("utf8",s,t.length-1))}async function kr(){try{let t=await Promise.resolve(d.cursorFn(E));$=0,t===vn?H(Zr(d.portal)):(E=new ze,H(Ot("",d.cursorRows)))}catch(t){H(pe),d.reject(t)}}function Fr(){E.count&&d.cursorFn(E),d.resolve(E)}function Lr(){K=new ft.Writable({autoDestroy:!0,write(t,s,p){f.write(h().d().raw(t).end(),p)},destroy(t,s){s(t),f.write(h().f().str(t+h.N).end()),K=null},final(t){f.write(h().c().end()),_e=t}}),d.resolve(K)}function zr(){K=new ft.Readable({read(){f.resume()}}),d.resolve(K)}function Mr(){K=new ft.Duplex({autoDestroy:!0,read(){f.resume()},write(t,s,p){f.write(h().d().raw(t).end(),p)},destroy(t,s){s(t),f.write(h().f().str(t+h.N).end()),K=null},final(t){f.write(h().c().end()),_e=t}}),d.resolve(K)}function $r(t){K&&(K.push(t.subarray(5))||f.pause())}function Gr(){K&&K.push(null),K=null}function Qr(t){P?P(dt(t)):console.log(dt(t))}function Kr(){}function Hr(){oe(ne.notSupported("FunctionCallResponse"))}function Vr(){oe(ne.notSupported("NegotiateProtocolVersion"))}function Wr(t){console.error("Postgres.js : Unknown Message:",t[0])}function Xr(t,s){console.error("Postgres.js : Unknown Auth:",s)}function Yr(t,s,p="",_=""){let L,J;return h().B().str(_+h.N).str(p+h.N).i16(0).i16(t.length),t.forEach((q,me)=>{if(q===null)return h.i32(4294967295);J=s[me],t[me]=q=J in e.serializers?e.serializers[J](q):""+q,L=h.i,h.inc(4).str(q).i32(h.i-L-4,L)}),h.i16(0),h.end()}function Pt(t,s,p,_=""){return h().P().str(_+h.N).str(t+h.N).i16(s.length),s.forEach((L,J)=>h.i32(p[J]||0)),h.end()}function Jr(t,s=""){return h().D().str(t).str(s+h.N).end()}function Ot(t="",s=0){return Buffer.concat([h().E().str(t+h.N).i32(s).end(),Xt])}function Zr(t=""){return Buffer.concat([h().C().str("P").str(t+h.N).end(),h().S().end()])}function qr(){return M||h().inc(4).i16(3).z(2).str(Object.entries(Object.assign({user:c,database:U,client_encoding:"UTF8"},e.connection)).filter(([,t])=>t).map(([t,s])=>t+h.N+s).join(h.N)).z(2).end(0)}}function dt(e){let r={},n=5;for(let a=5;a<e.length-1;a++)e[a]===0&&(r[Cn[e[n]]]=e.toString("utf8",n+1,a),n=a+1);return r}function Yt(e){return Ie.createHash("md5").update(e).digest("hex")}function Me(e,r){return Ie.createHmac("sha256",e).update(r).digest()}function Tn(e){return Ie.createHash("sha256").update(e).digest()}function Nn(e,r){let n=Math.max(e.length,r.length),a=Buffer.allocUnsafe(n);for(let i=0;i<n;i++)a[i]=e[i]^r[i];return a}function mt(e,r){if(r=typeof r=="function"?r():r,!r)return{cancel:Ee,start:Ee};let n;return{cancel(){n&&(clearTimeout(n),n=null)},start(){n&&clearTimeout(n),n=setTimeout(a,r*1e3,arguments)}};function a(i){e.apply(null,i),n=null}}});var tr=ue((Bs,er)=>{var xt=()=>{};er.exports=Un;function Un(e,r){let n=new Map,a="postgresjs_"+Math.random().toString(36).slice(2),i={},l,o,c=!1,m=S.sql=e({...r,transform:{column:{},value:{},row:{}},max:1,fetch_types:!1,idle_timeout:null,max_lifetime:null,connection:{...r.connection,replication:"database"},onclose:async function(){c||(o=null,i.pid=i.secret=void 0,w(await P(m,a,r.publications)),n.forEach(y=>y.forEach(({onsubscribe:V})=>V())))},no_subscribe:!0}),C=m.end,U=m.close;return m.end=async()=>(c=!0,o&&await new Promise(y=>(o.once("close",y),o.end())),C()),m.close=async()=>(o&&await new Promise(y=>(o.once("close",y),o.end())),U()),S;async function S(y,V,O=xt,x=xt){y=Dn(y),l||(l=P(m,a,r.publications));let ee={fn:V,onsubscribe:O},z=n.has(y)?n.get(y).add(ee):n.set(y,new Set([ee])).get(y),k=()=>{z.delete(ee),z.size===0&&n.delete(y)};return l.then(se=>(w(se),O(),o&&o.on("error",x),{unsubscribe:k,state:i,sql:m}))}function w(y){o=y.stream,i.pid=y.state.pid,i.secret=y.state.secret}async function P(y,V,O){if(!O)throw new Error("Missing publication names");let x=await y.unsafe(`CREATE_REPLICATION_SLOT ${V} TEMPORARY LOGICAL pgoutput NOEXPORT_SNAPSHOT`),[ee]=x,z=await y.unsafe(`START_REPLICATION SLOT ${V} LOGICAL ${ee.consistent_point} (proto_version '1', publication_names '${O}')`).writable(),k={lsn:Buffer.concat(ee.consistent_point.split("/").map(f=>Buffer.from(("00000000"+f).slice(-8),"hex")))};return z.on("data",he),z.on("error",se),z.on("close",y.close),{stream:z,state:x.state};function se(f){console.error("Unexpected error during logical streaming - reconnecting",f)}function he(f){f[0]===119?jn(f.subarray(25),k,y.options.parsers,ye,r.transform):f[0]===107&&f[17]&&(k.lsn=f.subarray(1,9),fe())}function ye(f,M){let E=M.relation.schema+"."+M.relation.table;R("*",f,M),R("*:"+E,f,M),M.relation.keys.length&&R("*:"+E+"="+M.relation.keys.map(G=>f[G.name]),f,M),R(M.command,f,M),R(M.command+":"+E,f,M),M.relation.keys.length&&R(M.command+":"+E+"="+M.relation.keys.map(G=>f[G.name]),f,M)}function fe(){let f=Buffer.alloc(34);f[0]=114,f.fill(k.lsn,1),f.writeBigInt64BE(BigInt(Date.now()-Date.UTC(2e3,0,1))*BigInt(1e3),25),z.write(f)}}function R(y,V,O){n.has(y)&&n.get(y).forEach(({fn:x})=>x(V,O,y))}}function Rn(e){return new Date(Date.UTC(2e3,0,1)+Number(e/BigInt(1e3)))}function jn(e,r,n,a,i){let l=(o,[c,m])=>(o[c.charCodeAt(0)]=m,o);Object.entries({R:o=>{let c=1,m=r[o.readUInt32BE(c)]={schema:o.toString("utf8",c+=4,c=o.indexOf(0,c))||"pg_catalog",table:o.toString("utf8",c+1,c=o.indexOf(0,c+1)),columns:Array(o.readUInt16BE(c+=2)),keys:[]};c+=2;let C=0,U;for(;c<o.length;)U=m.columns[C++]={key:o[c++],name:i.column.from?i.column.from(o.toString("utf8",c,c=o.indexOf(0,c))):o.toString("utf8",c,c=o.indexOf(0,c)),type:o.readUInt32BE(c+=1),parser:n[o.readUInt32BE(c)],atttypmod:o.readUInt32BE(c+=4)},U.key&&m.keys.push(U),c+=4},Y:()=>{},O:()=>{},B:o=>{r.date=Rn(o.readBigInt64BE(9)),r.lsn=o.subarray(1,9)},I:o=>{let c=1,m=r[o.readUInt32BE(c)],{row:C}=$e(o,m.columns,c+=7,i);a(C,{command:"insert",relation:m})},D:o=>{let c=1,m=r[o.readUInt32BE(c)];c+=4;let C=o[c]===75;a(C||o[c]===79?$e(o,m.columns,c+=3,i).row:null,{command:"delete",relation:m,key:C})},U:o=>{let c=1,m=r[o.readUInt32BE(c)];c+=4;let C=o[c]===75,U=C||o[c]===79?$e(o,m.columns,c+=3,i):null;U&&(c=U.i);let{row:S}=$e(o,m.columns,c+3,i);a(S,{command:"update",relation:m,key:C,old:U&&U.row})},T:()=>{},C:()=>{}}).reduce(l,{})[e[0]](e)}function $e(e,r,n,a){let i,l,o,c=a.raw?new Array(r.length):{};for(let m=0;m<r.length;m++)i=e[n++],l=r[m],o=i===110?null:i===117?void 0:l.parser===void 0?e.toString("utf8",n+4,n+=4+e.readUInt32BE(n)):l.parser.array===!0?l.parser(e.toString("utf8",n+5,n+=4+e.readUInt32BE(n))):l.parser(e.toString("utf8",n+4,n+=4+e.readUInt32BE(n))),a.raw?c[m]=a.raw===!0?o:a.value.from?a.value.from(o,l):o:c[l.name]=a.value.from?a.value.from(o,l):o;return{i:n,row:a.row.from?a.row.from(c):c}}function Dn(e){let r=e.match(/^(\*|insert|update|delete)?:?([^.]+?\.?[^=]+)?=?(.+)?/i)||[];if(!r)throw new Error("Malformed subscribe pattern: "+e);let[,n,a,i]=r;return(n||"*")+(a?":"+(a.indexOf(".")===-1?"public."+a:a):"")+(i?"="+i:"")}});var sr=ue((Is,nr)=>{var rr=require("stream");nr.exports=kn;function kn(e,r,n=393216){return new Promise(async(a,i)=>{await e.begin(async l=>{let o;!r&&([{oid:r}]=await l`select lo_creat(-1) as oid`);let[{fd:c}]=await l`select lo_open(${r}, ${n}) as fd`,m={writable:U,readable:C,close:()=>l`select lo_close(${c})`.then(o),tell:()=>l`select lo_tell64(${c})`,read:S=>l`select loread(${c}, ${S}) as data`,write:S=>l`select lowrite(${c}, ${S})`,truncate:S=>l`select lo_truncate64(${c}, ${S})`,seek:(S,w=0)=>l`select lo_lseek64(${c}, ${S}, ${w})`,size:()=>l`
          select
            lo_lseek64(${c}, location, 0) as position,
            seek.size
          from (
            select
              lo_lseek64($1, 0, 2) as size,
              tell.location
            from (select lo_tell64($1) as location) tell
          ) seek
        `};return a(m),new Promise(async S=>o=S);async function C({highWaterMark:S=2048*8,start:w=0,end:P=1/0}={}){let R=P-w;return w&&await m.seek(w),new rr.Readable({highWaterMark:S,async read(y){let V=y>R?y-R:y;R-=y;let[{data:O}]=await m.read(V);this.push(O),O.length<y&&this.push(null)}})}async function U({highWaterMark:S=2048*8,start:w=0}={}){return w&&await m.seek(w),new rr.Writable({highWaterMark:S,write(P,R,y){m.write(P).then(()=>y(),y)}})}}).catch(i)})}});var Fn=require("os"),Ln=require("fs"),{mergeUserTypes:zn,inferType:Mn,Parameter:Ge,Identifier:$n,Builder:Gn,toPascal:Qn,pascal:Kn,toCamel:Hn,camel:Vn,toKebab:Wn,kebab:Xn,fromPascal:Yn,fromCamel:Jn,fromKebab:Zn}=lt(),ar=qt(),{Query:pt,CLOSE:or}=Re(),ie=ut(),{Errors:ht,PostgresError:gt}=je(),qn=tr(),xn=sr();Object.assign(Qe,{PostgresError:gt,toPascal:Qn,pascal:Kn,toCamel:Hn,camel:Vn,toKebab:Wn,kebab:Xn,fromPascal:Yn,fromCamel:Jn,fromKebab:Zn,BigInt:{to:20,from:[20],parse:e=>BigInt(e),serialize:e=>e.toString()}});module.exports=Qe;function Qe(e,r){let n=es(e,r),a=n.no_subscribe||qn(Qe,{...n}),i=!1,l=ie(),o=ie(),c=ie(),m=ie(),C=ie(),U=ie(),S=ie(),w=ie(),P={connecting:o,reserved:c,closed:m,ended:C,open:U,busy:S,full:w},R=[...Array(n.max)].map(()=>ar(n,P,{onopen:le,onend:ce,onclose:Ce})),y=V(ye);return Object.assign(y,{get parameters(){return n.parameters},largeObject:xn.bind(null,y),subscribe:a,CLOSE:or,END:or,PostgresError:gt,options:n,reserve:ee,listen:O,begin:z,close:E,end:M}),y;function V(u){return u.debug=n.debug,Object.entries(n.types).reduce((b,[B,$])=>(b[B]=F=>new Ge(F,$.to),b),g),Object.assign(v,{types:g,typed:g,unsafe:j,notify:x,array:he,json:se,file:Q}),v;function g(b,B){return new Ge(b,B)}function v(b,...B){return b&&Array.isArray(b.raw)?new pt(b,B,u,f):typeof b=="string"&&!B.length?new $n(n.transform.column.to?n.transform.column.to(b):b):new Gn(b,B)}function j(b,B=[],$={}){return arguments.length===2&&!Array.isArray(B)&&($=B,B=[]),new pt([b],B,u,f,{prepare:!1,...$,simple:"simple"in $?$.simple:B.length===0})}function Q(b,B=[],$={}){return arguments.length===2&&!Array.isArray(B)&&($=B,B=[]),new pt([],B,T=>{Ln.readFile(b,"utf8",(W,I)=>{if(W)return T.reject(W);T.strings=[I],u(T)})},f,{...$,simple:"simple"in $?$.simple:B.length===0})}}async function O(u,g,v){let j={fn:g,onlisten:v},Q=O.sql||(O.sql=Qe({...n,max:1,idle_timeout:null,max_lifetime:null,fetch_types:!1,onclose(){Object.entries(O.channels).forEach(([T,{listeners:W}])=>{delete O.channels[T],Promise.all(W.map(I=>O(T,I.fn,I.onlisten).catch(()=>{})))})},onnotify(T,W){T in O.channels&&O.channels[T].listeners.forEach(I=>I.fn(W))}})),b=O.channels||(O.channels={});if(u in b){b[u].listeners.push(j);let T=await b[u].result;return j.onlisten&&j.onlisten(),{state:T.state,unlisten:F}}b[u]={result:Q`listen ${Q.unsafe('"'+u.replace(/"/g,'""')+'"')}`,listeners:[j]};let $=await b[u].result;return j.onlisten&&j.onlisten(),{state:$.state,unlisten:F};async function F(){if(u in b&&(b[u].listeners=b[u].listeners.filter(T=>T!==j),!b[u].listeners.length))return delete b[u],Q`unlisten ${Q.unsafe('"'+u.replace(/"/g,'""')+'"')}`}}async function x(u,g){return await y`select pg_notify(${u}, ${""+g})`}async function ee(){let u=ie(),g=U.length?U.shift():await new Promise(Q=>{l.push({reserve:Q}),m.length&&ge(m.shift())});k(g,c),g.reserved=()=>u.length?g.execute(u.shift()):k(g,c),g.reserved.release=!0;let v=V(j);return v.release=()=>{g.reserved=null,le(g)},v;function j(Q){g.queue===w?u.push(Q):g.execute(Q)||k(g,w)}}async function z(u,g){!g&&(g=u,u="");let v=ie(),j=0,Q,b=null;try{return await y.unsafe("begin "+u.replace(/[^a-z ]/ig,""),[],{onexecute:$}).execute(),await Promise.race([B(Q,g),new Promise((F,T)=>Q.onclose=T)])}catch(F){throw F}async function B(F,T,W){let I=V(K);I.savepoint=de,I.prepare=N=>b=N.replace(/[^a-z0-9$-_. ]/gi);let te,X;W&&await I`savepoint ${I(W)}`;try{if(X=await new Promise((N,re)=>{let ae=T(I);Promise.resolve(Array.isArray(ae)?Promise.all(ae):ae).then(N,re)}),te)throw te}catch(N){throw await(W?I`rollback to ${I(W)}`:I`rollback`),N instanceof gt&&N.code==="25P02"&&te||N}return W||(b?await I`prepare transaction '${I.unsafe(b)}'`:await I`commit`),X;function de(N,re){return N&&Array.isArray(N.raw)?de(ae=>ae.apply(ae,arguments)):(arguments.length===1&&(re=N,N=null),B(F,re,"s"+j+++(N?"_"+N:"")))}function K(N){N.catch(re=>te||(te=re)),F.queue===w?v.push(N):F.execute(N)||k(F,w)}}function $(F){Q=F,k(F,c),F.reserved=()=>v.length?F.execute(v.shift()):k(F,c)}}function k(u,g){return u.queue.remove(u),g.push(u),u.queue=g,g===U?u.idleTimer.start():u.idleTimer.cancel(),u}function se(u){return new Ge(u,3802)}function he(u,g){return Array.isArray(u)?new Ge(u,g||(u.length?Mn(u)||25:0),n.shared.typeArrayMap):he(Array.from(arguments))}function ye(u){if(i)return u.reject(ht.connection("CONNECTION_ENDED",n,n));if(U.length)return fe(U.shift(),u);if(m.length)return ge(m.shift(),u);S.length?fe(S.shift(),u):l.push(u)}function fe(u,g){return u.execute(g)?k(u,S):k(u,w)}function f(u){return new Promise((g,v)=>{u.state?u.active?ar(n).cancel(u.state,g,v):u.cancelled={resolve:g,reject:v}:(l.remove(u),u.cancelled=!0,u.reject(ht.generic("57014","canceling statement due to user request")),g())})}async function M({timeout:u=null}={}){if(i)return i;await 1;let g;return i=Promise.race([new Promise(v=>u!==null&&(g=setTimeout(G,u*1e3,v))),Promise.all(R.map(v=>v.end()).concat(O.sql?O.sql.end({timeout:0}):[],a.sql?a.sql.end({timeout:0}):[]))]).then(()=>clearTimeout(g))}async function E(){await Promise.all(R.map(u=>u.end()))}async function G(u){for(await Promise.all(R.map(g=>g.terminate()));l.length;)l.shift().reject(ht.connection("CONNECTION_DESTROYED",n));u()}function ge(u,g){return k(u,o),u.connect(g),u}function ce(u){k(u,C)}function le(u){if(l.length===0)return k(u,U);let g=Math.ceil(l.length/(o.length+1)),v=!0;for(;v&&l.length&&g-- >0;){let j=l.shift();if(j.reserve)return j.reserve(u);v=u.execute(j)}v?k(u,S):k(u,w)}function Ce(u,g){k(u,m),u.reserved=null,u.onclose&&(u.onclose(g),u.onclose=null),n.onclose&&n.onclose(u.id),l.length&&ge(u,l.shift())}}function es(e,r){if(e&&e.shared)return e;let n=process.env,a=(!e||typeof e=="string"?r:e)||{},{url:i,multihost:l}=as(e),o=[...i.searchParams].reduce((w,[P,R])=>(w[P]=R,w),{}),c=a.hostname||a.host||l||i.hostname||n.PGHOST||"localhost",m=a.port||i.port||n.PGPORT||5432,C=a.user||a.username||i.username||n.PGUSERNAME||n.PGUSER||os();a.no_prepare&&(a.prepare=!1),o.sslmode&&(o.ssl=o.sslmode,delete o.sslmode),"timeout"in a&&(console.log("The timeout option is deprecated, use idle_timeout instead"),a.idle_timeout=a.timeout),o.sslrootcert==="system"&&(o.ssl="verify-full");let U=["idle_timeout","connect_timeout","max_lifetime","max_pipeline","backoff","keep_alive"],S={max:10,ssl:!1,idle_timeout:null,connect_timeout:30,max_lifetime:ns,max_pipeline:100,backoff:rs,keep_alive:60,prepare:!0,debug:!1,fetch_types:!0,publications:"alltables",target_session_attrs:null};return{host:Array.isArray(c)?c:c.split(",").map(w=>w.split(":")[0]),port:Array.isArray(m)?m:c.split(",").map(w=>parseInt(w.split(":")[1]||m)),path:a.path||c.indexOf("/")>-1&&c+"/.s.PGSQL."+m,database:a.database||a.db||(i.pathname||"").slice(1)||n.PGDATABASE||C,user:C,pass:a.pass||a.password||i.password||n.PGPASSWORD||"",...Object.entries(S).reduce((w,[P,R])=>{let y=P in a?a[P]:P in o?o[P]==="disable"||o[P]==="false"?!1:o[P]:n["PG"+P.toUpperCase()]||R;return w[P]=typeof y=="string"&&U.includes(P)?+y:y,w},{}),connection:{application_name:"postgres.js",...a.connection,...Object.entries(o).reduce((w,[P,R])=>(P in S||(w[P]=R),w),{})},types:a.types||{},target_session_attrs:ts(a,i,n),onnotice:a.onnotice,onnotify:a.onnotify,onclose:a.onclose,onparameter:a.onparameter,socket:a.socket,transform:ss(a.transform||{undefined:void 0}),parameters:{},shared:{retries:0,typeArrayMap:{}},...zn(a.types)}}function ts(e,r,n){let a=e.target_session_attrs||r.searchParams.get("target_session_attrs")||n.PGTARGETSESSIONATTRS;if(!a||["read-write","read-only","primary","standby","prefer-standby"].includes(a))return a;throw new Error("target_session_attrs "+a+" is not supported")}function rs(e){return(.5+Math.random()/2)*Math.min(3**e/100,20)}function ns(){return 60*(30+Math.random()*30)}function ss(e){return{undefined:e.undefined,column:{from:typeof e.column=="function"?e.column:e.column&&e.column.from,to:e.column&&e.column.to},value:{from:typeof e.value=="function"?e.value:e.value&&e.value.from,to:e.value&&e.value.to},row:{from:typeof e.row=="function"?e.row:e.row&&e.row.from,to:e.row&&e.row.to}}}function as(e){if(!e||typeof e!="string")return{url:{searchParams:new Map}};let r=e;r=r.slice(r.indexOf("://")+3).split(/[?/]/)[0],r=decodeURIComponent(r.slice(r.indexOf("@")+1));let n=new URL(e.replace(r,r.split(",")[0]));return{url:{username:decodeURIComponent(n.username),password:decodeURIComponent(n.password),host:n.host,hostname:n.hostname,port:n.port,pathname:n.pathname,searchParams:n.searchParams},multihost:r.indexOf(",")>-1&&r}}function os(){try{return Fn.userInfo().username}catch{return process.env.USERNAME||process.env.USER||process.env.LOGNAME}}
