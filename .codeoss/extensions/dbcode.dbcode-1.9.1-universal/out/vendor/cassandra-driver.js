"use strict";var C=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var Ft=C((Du,Ps)=>{var qu=function(n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var e=null;try{e=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function t(b,h,P){this.low=b|0,this.high=h|0,this.unsigned=!!P}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0});function r(b){return(b&&b.__isLong__)===!0}function i(b){var h=Math.clz32(b&-b);return b?31-h:h}t.isLong=r;var s={},o={};function a(b,h){var P,V,ie;return h?(b>>>=0,(ie=0<=b&&b<256)&&(V=o[b],V)?V:(P=u(b,0,!0),ie&&(o[b]=P),P)):(b|=0,(ie=-128<=b&&b<128)&&(V=s[b],V)?V:(P=u(b,b<0?-1:0,!1),ie&&(s[b]=P),P))}t.fromInt=a;function c(b,h){if(isNaN(b))return h?d:l;if(h){if(b<0)return d;if(b>=w)return R}else{if(b<=-E)return D;if(b+1>=E)return L}return b<0?c(-b,h).neg():u(b%_|0,b/_|0,h)}t.fromNumber=c;function u(b,h,P){return new t(b,h,P)}t.fromBits=u;var f=Math.pow;function g(b,h,P){if(b.length===0)throw Error("empty string");if(typeof h=="number"?(P=h,h=!1):h=!!h,b==="NaN"||b==="Infinity"||b==="+Infinity"||b==="-Infinity")return h?d:l;if(P=P||10,P<2||36<P)throw RangeError("radix");var V;if((V=b.indexOf("-"))>0)throw Error("interior hyphen");if(V===0)return g(b.substring(1),h,P).neg();for(var ie=c(f(P,8)),Y=l,ge=0;ge<b.length;ge+=8){var De=Math.min(8,b.length-ge),Qe=parseInt(b.substring(ge,ge+De),P);if(De<8){var Ie=c(f(P,De));Y=Y.mul(Ie).add(c(Qe))}else Y=Y.mul(ie),Y=Y.add(c(Qe))}return Y.unsigned=h,Y}t.fromString=g;function S(b,h){return typeof b=="number"?c(b,h):typeof b=="string"?g(b,h):u(b.low,b.high,typeof h=="boolean"?h:b.unsigned)}t.fromValue=S;var p=65536,y=1<<24,_=p*p,w=_*_,E=w/2,v=a(y),l=a(0);t.ZERO=l;var d=a(0,!0);t.UZERO=d;var m=a(1);t.ONE=m;var N=a(1,!0);t.UONE=N;var A=a(-1);t.NEG_ONE=A;var L=u(-1,2147483647,!1);t.MAX_VALUE=L;var R=u(-1,-1,!0);t.MAX_UNSIGNED_VALUE=R;var D=u(0,-2147483648,!1);t.MIN_VALUE=D;var x=t.prototype;x.toInt=function(){return this.unsigned?this.low>>>0:this.low},x.toNumber=function(){return this.unsigned?(this.high>>>0)*_+(this.low>>>0):this.high*_+(this.low>>>0)},x.toString=function(h){if(h=h||10,h<2||36<h)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(D)){var P=c(h),V=this.div(P),ie=V.mul(P).sub(this);return V.toString(h)+ie.toInt().toString(h)}else return"-"+this.neg().toString(h);for(var Y=c(f(h,6),this.unsigned),ge=this,De="";;){var Qe=ge.div(Y),Ie=ge.sub(Qe.mul(Y)).toInt()>>>0,fe=Ie.toString(h);if(ge=Qe,ge.isZero())return fe+De;for(;fe.length<6;)fe="0"+fe;De=""+fe+De}},x.getHighBits=function(){return this.high},x.getHighBitsUnsigned=function(){return this.high>>>0},x.getLowBits=function(){return this.low},x.getLowBitsUnsigned=function(){return this.low>>>0},x.getNumBitsAbs=function(){if(this.isNegative())return this.eq(D)?64:this.neg().getNumBitsAbs();for(var h=this.high!=0?this.high:this.low,P=31;P>0&&(h&1<<P)==0;P--);return this.high!=0?P+33:P+1},x.isZero=function(){return this.high===0&&this.low===0},x.eqz=x.isZero,x.isNegative=function(){return!this.unsigned&&this.high<0},x.isPositive=function(){return this.unsigned||this.high>=0},x.isOdd=function(){return(this.low&1)===1},x.isEven=function(){return(this.low&1)===0},x.equals=function(h){return r(h)||(h=S(h)),this.unsigned!==h.unsigned&&this.high>>>31===1&&h.high>>>31===1?!1:this.high===h.high&&this.low===h.low},x.eq=x.equals,x.notEquals=function(h){return!this.eq(h)},x.neq=x.notEquals,x.ne=x.notEquals,x.lessThan=function(h){return this.comp(h)<0},x.lt=x.lessThan,x.lessThanOrEqual=function(h){return this.comp(h)<=0},x.lte=x.lessThanOrEqual,x.le=x.lessThanOrEqual,x.greaterThan=function(h){return this.comp(h)>0},x.gt=x.greaterThan,x.greaterThanOrEqual=function(h){return this.comp(h)>=0},x.gte=x.greaterThanOrEqual,x.ge=x.greaterThanOrEqual,x.compare=function(h){if(r(h)||(h=S(h)),this.eq(h))return 0;var P=this.isNegative(),V=h.isNegative();return P&&!V?-1:!P&&V?1:this.unsigned?h.high>>>0>this.high>>>0||h.high===this.high&&h.low>>>0>this.low>>>0?-1:1:this.sub(h).isNegative()?-1:1},x.comp=x.compare,x.negate=function(){return!this.unsigned&&this.eq(D)?D:this.not().add(m)},x.neg=x.negate,x.add=function(h){r(h)||(h=S(h));var P=this.high>>>16,V=this.high&65535,ie=this.low>>>16,Y=this.low&65535,ge=h.high>>>16,De=h.high&65535,Qe=h.low>>>16,Ie=h.low&65535,fe=0,Ze=0,Ee=0,He=0;return He+=Y+Ie,Ee+=He>>>16,He&=65535,Ee+=ie+Qe,Ze+=Ee>>>16,Ee&=65535,Ze+=V+De,fe+=Ze>>>16,Ze&=65535,fe+=P+ge,fe&=65535,u(Ee<<16|He,fe<<16|Ze,this.unsigned)},x.subtract=function(h){return r(h)||(h=S(h)),this.add(h.neg())},x.sub=x.subtract,x.multiply=function(h){if(this.isZero())return this;if(r(h)||(h=S(h)),e){var P=e.mul(this.low,this.high,h.low,h.high);return u(P,e.get_high(),this.unsigned)}if(h.isZero())return this.unsigned?d:l;if(this.eq(D))return h.isOdd()?D:l;if(h.eq(D))return this.isOdd()?D:l;if(this.isNegative())return h.isNegative()?this.neg().mul(h.neg()):this.neg().mul(h).neg();if(h.isNegative())return this.mul(h.neg()).neg();if(this.lt(v)&&h.lt(v))return c(this.toNumber()*h.toNumber(),this.unsigned);var V=this.high>>>16,ie=this.high&65535,Y=this.low>>>16,ge=this.low&65535,De=h.high>>>16,Qe=h.high&65535,Ie=h.low>>>16,fe=h.low&65535,Ze=0,Ee=0,He=0,Zr=0;return Zr+=ge*fe,He+=Zr>>>16,Zr&=65535,He+=Y*fe,Ee+=He>>>16,He&=65535,He+=ge*Ie,Ee+=He>>>16,He&=65535,Ee+=ie*fe,Ze+=Ee>>>16,Ee&=65535,Ee+=Y*Ie,Ze+=Ee>>>16,Ee&=65535,Ee+=ge*Qe,Ze+=Ee>>>16,Ee&=65535,Ze+=V*fe+ie*Ie+Y*Qe+ge*De,Ze&=65535,u(He<<16|Zr,Ze<<16|Ee,this.unsigned)},x.mul=x.multiply,x.divide=function(h){if(r(h)||(h=S(h)),h.isZero())throw Error("division by zero");if(e){if(!this.unsigned&&this.high===-2147483648&&h.low===-1&&h.high===-1)return this;var P=(this.unsigned?e.div_u:e.div_s)(this.low,this.high,h.low,h.high);return u(P,e.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?d:l;var V,ie,Y;if(this.unsigned){if(h.unsigned||(h=h.toUnsigned()),h.gt(this))return d;if(h.gt(this.shru(1)))return N;Y=d}else{if(this.eq(D)){if(h.eq(m)||h.eq(A))return D;if(h.eq(D))return m;var ge=this.shr(1);return V=ge.div(h).shl(1),V.eq(l)?h.isNegative()?m:A:(ie=this.sub(h.mul(V)),Y=V.add(ie.div(h)),Y)}else if(h.eq(D))return this.unsigned?d:l;if(this.isNegative())return h.isNegative()?this.neg().div(h.neg()):this.neg().div(h).neg();if(h.isNegative())return this.div(h.neg()).neg();Y=l}for(ie=this;ie.gte(h);){V=Math.max(1,Math.floor(ie.toNumber()/h.toNumber()));for(var De=Math.ceil(Math.log(V)/Math.LN2),Qe=De<=48?1:f(2,De-48),Ie=c(V),fe=Ie.mul(h);fe.isNegative()||fe.gt(ie);)V-=Qe,Ie=c(V,this.unsigned),fe=Ie.mul(h);Ie.isZero()&&(Ie=m),Y=Y.add(Ie),ie=ie.sub(fe)}return Y},x.div=x.divide,x.modulo=function(h){if(r(h)||(h=S(h)),e){var P=(this.unsigned?e.rem_u:e.rem_s)(this.low,this.high,h.low,h.high);return u(P,e.get_high(),this.unsigned)}return this.sub(this.div(h).mul(h))},x.mod=x.modulo,x.rem=x.modulo,x.not=function(){return u(~this.low,~this.high,this.unsigned)},x.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},x.clz=x.countLeadingZeros,x.countTrailingZeros=function(){return this.low?i(this.low):i(this.high)+32},x.ctz=x.countTrailingZeros,x.and=function(h){return r(h)||(h=S(h)),u(this.low&h.low,this.high&h.high,this.unsigned)},x.or=function(h){return r(h)||(h=S(h)),u(this.low|h.low,this.high|h.high,this.unsigned)},x.xor=function(h){return r(h)||(h=S(h)),u(this.low^h.low,this.high^h.high,this.unsigned)},x.shiftLeft=function(h){return r(h)&&(h=h.toInt()),(h&=63)===0?this:h<32?u(this.low<<h,this.high<<h|this.low>>>32-h,this.unsigned):u(0,this.low<<h-32,this.unsigned)},x.shl=x.shiftLeft,x.shiftRight=function(h){return r(h)&&(h=h.toInt()),(h&=63)===0?this:h<32?u(this.low>>>h|this.high<<32-h,this.high>>h,this.unsigned):u(this.high>>h-32,this.high>=0?0:-1,this.unsigned)},x.shr=x.shiftRight,x.shiftRightUnsigned=function(h){return r(h)&&(h=h.toInt()),(h&=63)===0?this:h<32?u(this.low>>>h|this.high<<32-h,this.high>>>h,this.unsigned):h===32?u(this.high,0,this.unsigned):u(this.high>>>h-32,0,this.unsigned)},x.shru=x.shiftRightUnsigned,x.shr_u=x.shiftRightUnsigned,x.rotateLeft=function(h){var P;return r(h)&&(h=h.toInt()),(h&=63)===0?this:h===32?u(this.high,this.low,this.unsigned):h<32?(P=32-h,u(this.low<<h|this.high>>>P,this.high<<h|this.low>>>P,this.unsigned)):(h-=32,P=32-h,u(this.high<<h|this.low>>>P,this.low<<h|this.high>>>P,this.unsigned))},x.rotl=x.rotateLeft,x.rotateRight=function(h){var P;return r(h)&&(h=h.toInt()),(h&=63)===0?this:h===32?u(this.high,this.low,this.unsigned):h<32?(P=32-h,u(this.high<<P|this.low>>>h,this.low<<P|this.high>>>h,this.unsigned)):(h-=32,P=32-h,u(this.low<<P|this.high>>>h,this.high<<P|this.low>>>h,this.unsigned))},x.rotr=x.rotateRight,x.toSigned=function(){return this.unsigned?u(this.low,this.high,!1):this},x.toUnsigned=function(){return this.unsigned?this:u(this.low,this.high,!0)},x.toBytes=function(h){return h?this.toBytesLE():this.toBytesBE()},x.toBytesLE=function(){var h=this.high,P=this.low;return[P&255,P>>>8&255,P>>>16&255,P>>>24,h&255,h>>>8&255,h>>>16&255,h>>>24]},x.toBytesBE=function(){var h=this.high,P=this.low;return[h>>>24,h>>>16&255,h>>>8&255,h&255,P>>>24,P>>>16&255,P>>>8&255,P&255]},t.fromBytes=function(h,P,V){return V?t.fromBytesLE(h,P):t.fromBytesBE(h,P)},t.fromBytesLE=function(h,P){return new t(h[0]|h[1]<<8|h[2]<<16|h[3]<<24,h[4]|h[5]<<8|h[6]<<16|h[7]<<24,P)},t.fromBytesBE=function(h,P){return new t(h[4]<<24|h[5]<<16|h[6]<<8|h[7],h[0]<<24|h[1]<<16|h[2]<<8|h[3],P)};var ut=t;return n.default=ut,"default"in n?n.default:n}({});typeof define=="function"&&define.amd?define([],function(){return qu}):typeof Ps=="object"&&typeof Du=="object"&&(Ps.exports=qu)});var j=C(lt=>{"use strict";var Ye=require("util");function de(n){Error.call(this,n),Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.info="Cassandra Driver Error",this.message=n}Ye.inherits(de,Error);function Fu(n,e){if(de.call(this,e),this.innerErrors=n,this.info="Represents an error when a query cannot be performed because no host is available or could be reached by the driver.",!e&&(this.message="All host(s) tried for query failed.",n)){let t=Object.keys(n);if(t.length>0){let r=t[0];this.message+=Ye.format(" First host tried, %s: %s. See innerErrors.",r,n[r])}}}Ye.inherits(Fu,de);function ku(n,e){de.call(this,e),this.code=n,this.info="Represents an error message from the server"}Ye.inherits(ku,de);function Uu(n){de.call(this,n),this.info="Represents a bug inside the driver or in a Cassandra host."}Ye.inherits(Uu,de);function Mu(n){de.call(this,n),this.info="Represents an authentication error from the driver or from a Cassandra node."}Ye.inherits(Mu,de);function Vu(n){de.call(this,n),this.info="Represents an error that is raised when one of the arguments provided to a method is not valid."}Ye.inherits(Vu,de);function zu(n,e){de.call(this,n,this.constructor),this.info="Represents a client-side error that is raised when the client did not hear back from the server within socketOptions.readTimeout",this.host=e}Ye.inherits(zu,de);function Hu(n){de.call(this,n,this.constructor),this.info="Represents a feature that is not supported in the driver or in the Cassandra version."}Ye.inherits(Hu,de);function Ku(n,e,t){let r=Ye.format("All connections to host %s are busy, %d requests are in-flight on %s",n,e,t===1?"a single connection":"each connection");de.call(this,r,this.constructor),this.info="Represents a client-side error indicating that all connections to a certain host have reached the maximum amount of in-flight requests supported (pooling.maxRequestsPerConnection)"}Ye.inherits(Ku,de);function ju(n){let e=`Value ${n.toString} is out of range for a JavaScript Number`;de.call(this,e,this.constructor),this.info="Represents a run-time exception when attempting to decode a vint and the JavaScript Number doesn't have enough space to fit the value that was decoded"}Ye.inherits(ju,de);lt.ArgumentError=Vu;lt.AuthenticationError=Mu;lt.BusyConnectionError=Ku;lt.DriverError=de;lt.OperationTimedOutError=zu;lt.DriverInternalError=Uu;lt.NoHostAvailableError=Fu;lt.NotSupportedError=Hu;lt.ResponseError=ku;lt.VIntOutOfRangeException=ju});var Be=C((RC,Wu)=>{"use strict";function om(n){return new Promise(e=>setTimeout(e,n||0))}function am(n,e){return new Promise((t,r)=>n.once(e,(i,s)=>{i?r(i):t(s)}))}function cm(n){return new Promise((e,t)=>n((r,i)=>{r?t(r):e(i)}))}function um(n,e){return function(t,r){t?e(t):n(r)}}async function lm(n,e,t){let r;for(;(r=n.counter++)<e;)await t(r)}function hm(n,e,t){return new Promise((r,i)=>{n.newQueryPlan(e,t,(s,o)=>{s?i(s):r(o)})})}function fm(n,e){if(!e)return n;Gu(n,e)}function dm(n,e,t){e>n&&(e=n);let r=new Array(e),i={counter:0};for(let s=0;s<e;s++)r[s]=lm(i,n,t);return Promise.all(r)}function pm(n){n.catch(()=>{})}function Gu(n,e){n.then(t=>process.nextTick(()=>e(null,t)),t=>process.nextTick(()=>e(t)))}Wu.exports={delay:om,fromCallback:cm,fromEvent:am,getCallback:um,newQueryPlan:hm,optionalCallback:fm,times:dm,toBackground:pm,toCallback:Gu}});var O=C(q=>{"use strict";var ht=Ft(),nr=require("util"),gm=require("net"),{EventEmitter:mm}=require("events"),Yr=j(),ym=Be(),wm=9007199254740992,_m=2147483647,$u=Object.freeze({}),Em=Object.freeze([]);function Oe(){}var Tm=Buffer.alloc||xm,Qu=Buffer.allocUnsafe||Zu,Sm=Int8Array.from!==Buffer.from&&Buffer.from||bm,Cm=Int8Array.from!==Buffer.from&&Buffer.from||vm;function Zu(n){return new Buffer(n)}function xm(n){let e=Zu(n);return e.fill(0),e}function bm(n,e){if(typeof n!="string")throw new TypeError("Expected string, obtained "+nr.inspect(n));return new Buffer(n,e)}function vm(n){if(!Array.isArray(n))throw new TypeError("Expected Array, obtained "+nr.inspect(n));return new Buffer(n)}function Nm(n){let e=n;return function(r,i){e(r,i),e=Oe}}function Am(n){let e=Qu(n.length);return n.copy(e),e}function Im(n,e){return n&&(e.stack+=`
  (event loop)
`+n.substr(n.indexOf(`
`)+1)),e}function Pm(n,e,t,r){if(!this.logEmitter){let i=r||this.options;if(!i||!i.logEmitter)throw new Error("Log emitter not defined");this.logEmitter=i.logEmitter}this.logEmitter("log",n,this.constructor.name,e,t||"")}function Bm(n){if(n.length===1)return n[0].length;let e=0;return n.forEach(function(t){let r=t.length;r=r||0,e+=r}),e}function Om(n){return Array.prototype.slice.call(arguments,1).forEach(function(t){if(!t)return;let r=Object.keys(t);for(let i=0;i<r.length;i++){let s=r[i],o=t[s];o!==void 0&&(n[s]=o)}}),n}function Rm(n){let e=Object.keys(n),t={};for(let r=0;r<e.length;r++){let i=e[r];t[i.toLowerCase()]=n[i]}return t}function Yu(n){return Array.prototype.slice.call(arguments,1).forEach(function(t){for(let r in t){if(!t.hasOwnProperty(r))continue;let i=n[r],s=typeof i;!i||s==="number"||s==="string"||Array.isArray(i)||i instanceof Date||i.constructor.name!=="Object"?n[r]=t[r]:n[r]=Yu({},i,t[r])}}),n}function Lm(n){return function(e,t){return e[n]>t[n]?1:e[n]<t[n]?-1:0}}function qm(n,e){return function(t,r){if(typeof t[n]>"u")return 0;let i=t[n].apply(t,e),s=r[n].apply(r,e);return i>s?1:i<s?-1:0}}function Dm(n){return n[Symbol.iterator]()}function Fm(n){let e=[],t=n.next();for(;!t.done;)e.push(t.value),t=n.next();return e}function Xu(n,e,t){let r=0,i=n.length-1;for(;r<=i;){let s=r+i>>>1,o=n[s],a=t(o,e);if(a<0)r=s+1;else if(a>0)i=s-1;else return s}return~r}function km(n,e,t){if(n.length===0)return n.push(e);let r=Xu(n,e,t);r<0&&(r=~r),n.splice(r,0,e)}function Um(n,e){if(typeof n!="function")throw new Yr.ArgumentError(nr.format("%s is not a function",e||"callback"));return n}function Mm(n,e){if(!n||Array.isArray(n)||!e||e.length===0)return n;let t=new Array(e.length);n=Rm(n);let r={};for(let i=0;i<e.length;i++){let s=e[i].name;if(!n.hasOwnProperty(s))throw new Yr.ArgumentError(nr.format('Parameter "%s" not defined',s));t[i]=n[s],r[s]=i}return t}function Vm(n,e){if(!n||Array.isArray(n))return{params:n,namedParameters:!1,keyIndexes:null};let t=Object.keys(n),r=new Array(t.length),i=new Array(t.length),s=e.getHints()||$u,o={};for(let a=0;a<t.length;a++){let c=t[a];r[a]={name:c.toLowerCase(),value:n[c]},i[a]=s[c],o[c]=a}return e.setHints(i),{params:r,namedParameters:!0,keyIndexes:o}}function zm(n,e){return!e||e<0?null:e===1?n:new Array(e+1).join(n)}function Hm(n){if(!n)return Em;let e=Object.keys(n),t=new Array(e.length);for(let r=0;r<e.length;r++)t[r]=n[e[r]];return t}function Km(n,e,t){if(typeof e=="function"){t.call(this,e);return}let r=n.promiseFactory||jm,i=this;return r(function(o){t.call(i,o)})}function jm(n){return new Promise(function(t,r){n(function(s,o){if(s)return r(s);t(o)})})}function Gm(n,e){return n!==void 0?n:e}function Wm(n,e,t){return n!==void 0?n:e!==void 0?e:t}function $m(n){for(let e=n.length-1;e>0;e--){let t=Math.floor(Math.random()*(e+1)),r=n[e];n[e]=n[t],n[t]=r}return n}function rr(){this.length=0,this.items={}}rr.prototype.add=function(n){return this.contains(n)?!1:(this.items[n]=!0,this.length++,!0)};rr.prototype.contains=function(n){return this.length>0&&this.items[n]===!0};rr.prototype.remove=function(n){if(!this.contains(n))return!1;delete this.items[n],this.length--};rr.prototype.toArray=function(){return Object.keys(this.items)};var Bs=class{constructor(e){if(!e||!e.nameOrIp||!e.dns)throw new Error("nameOrIp and dns lib must be provided as part of the options");this._resolve4=nr.promisify(e.dns.resolve4),this._nameOrIp=e.nameOrIp,this._isIp=gm.isIP(e.nameOrIp),this._index=0,this._addresses=null,this._refreshing=null}async init(){this._isIp||await this._resolve()}async refresh(){if(!this._isIp){if(this._refreshing)return await ym.fromEvent(this._refreshing,"finished");this._refreshing=new mm().setMaxListeners(0);try{await this._resolve()}catch{}this._refreshing.emit("finished"),this._refreshing=null}}async _resolve(){let e=await this._resolve4(this._nameOrIp);if(!e||e.length===0)throw new Error(`${this._nameOrIp} could not be resolved`);this._addresses=e}getIp(){if(this._isIp)return this._nameOrIp;let e=this._addresses[this._index%this._addresses.length];return this._index=this._index!==_m?this._index+1:0,e}};function Qm(n,e,t){if(!Array.isArray(n))throw new TypeError("First parameter is not an Array");t=t||Oe;let r=n.length;if(r===0)return t();let i=0;for(let o=0;o<r;o++)e(n[o],s);function s(o){if(o){let a=t;t=Oe,a(o);return}++i===r&&t()}}function Zm(n,e,t){if(!Array.isArray(n))throw new TypeError("First parameter is not an Array");t=t||Oe;let r=n.length;if(r===0)return t();let i,s=1;e(n[0],o),i===void 0&&(i=!1);function o(a){if(a)return t(a);if(s>=r)return t();if(i===void 0&&(i=!0),i)return process.nextTick(function(){e(n[s++],o)});e(n[s++],o)}}function Ym(n,e,t){return Ju(n,e,!0,t)}function Xm(n,e,t){return Ju(n,e,!1,t)}function Ju(n,e,t,r){if(!Array.isArray(n))throw new TypeError("First parameter must be an Array");r=r||Oe;let i=n.length;if(i===0)return r(null,[]);let s=new Array(i),o=0,a=t?u:c;for(let g=0;g<i;g++)a(g);function c(g){e(n[g],function(p,y){s[g]=y,f(p)})}function u(g){e(n[g],g,function(p,y){s[g]=y,f(p)})}function f(g){if(g){let S=r;r=Oe,S(g);return}++o===i&&r(null,s)}}function Jm(n,e,t){if(!Array.isArray(n))throw new TypeError("First parameter must be an Array");t=t||Oe;let r=n.length;if(r===0)return t(null,[]);let i=new Array(r),s=0,o;a(0),o===void 0&&(o=!1);function a(u){e(n[u],function(g,S){i[u]=S,c(g)})}function c(u){if(u)return t(u);if(++s===r)return t(null,i);o===void 0&&(o=!0);let f=s;if(o)return process.nextTick(function(){a(f)});a(s)}}function ey(n,e){if(!Array.isArray(n))throw new TypeError("First parameter must be an Array");e=e||Oe;let t=n.length,r=0;for(let s=0;s<t;s++)n[s](i);function i(s){if(s){let o=e;return e=Oe,o(s)}++r===t&&e()}}function ty(n,e){if(!Array.isArray(n))throw new TypeError("First parameter must be an Array");e=e||Oe;let t=0,r;i();function i(s,o){if(s)return e(s);if(t===n.length)return e(null,o);if(r)return process.nextTick(function(){r=!0,n[t++](i),r=!1});r=!0,n[t++](i),r=!1}}function ny(n,e,t){if(t=t||Oe,n=+n,isNaN(n)||n===0)return t();let r=0;for(let s=0;s<n;s++)e(s,i);function i(s){if(s){let o=t;return t=Oe,o(s)}++r===n&&t()}}function ry(n,e,t,r){let i;r=r||Oe,e=Math.min(e,n);let s=e-1,o,a=0;for(o=0;o<e;o++)t(o,c);o=-1;function c(u){if(u){let f=r;r=Oe,f(u);return}if(++a===n)return r();if(s++,!(s>=n)){if(i===void 0&&(i=o>=0),i){let f=s;return process.nextTick(function(){t(f,c)})}t(s,c)}}}function iy(n,e,t){if(n=+n,isNaN(n)||n<1)return t();let r=1,i;e(0,s),i===void 0&&(i=!1);function s(o){if(o)return t(o);if(r===n)return t();i===void 0&&(i=!0);let a=r++;if(i)return process.nextTick(function(){e(a,s)});e(a,s)}}function sy(n,e,t){let r=0;i();function i(s){if(s)return t(s);if(!n())return t();if(r===0){r=1,e(function(o){r===1&&(r=4),i(o)}),r===1&&(r=2);return}if(r===4)return process.nextTick(function(){e(i)});e(i)}}var oy=function(){function n(d){return d.toUnsigned().shiftLeft(1).xor(d.shiftRight(63))}function e(d){return d.shiftRightUnsigned(1).xor(d.and(ht.ONE).negate())}function t(d,m){return r(n(d),m)}function r(d,m){let N=i(d);return N===1?(m[0]=d.getLowBits(),1):(s(d,N,m),N)}function i(d){return 639-o(d.or(ht.ONE))*9>>6}function s(d,m,N){let A=m-1,L=d.getLowBits(),R,D=4;for(R=A;R>=0&&D-- >0;R--)N[R]=255&L,L>>=8;for(L=d.getHighBits();R>=0;R--)N[R]=255&L,L>>=8;N[0]|=a(A)}function o(d){if(d.equals(ht.ZERO))return 64;let m=1,N=d.getHighBits();return N===0&&(m+=32,N=d.getLowBits()),N>>>16||(m+=16,N<<=16),N>>>24||(m+=8,N<<=8),N>>>28||(m+=4,N<<=4),N>>>30||(m+=2,N<<=2),m-=N>>>31,m}function a(d){return~(255>>d)}function c(d,m){return e(u(d,m))}function u(d,m){let N=d[m.value++];if((N&128)===0)return ht.fromInt(N);let A=f(N),L=S(A),R=ht.fromInt(A&p(L));for(let D=0;D<L;D++){let x=ht.fromInt(d[m.value++]);R=R.shiftLeft(8).or(x)}return R}function f(d){return d>127?d-256:d}function g(d){if(d===0)return 32;let m=1;return d>>>16||(m+=16,d<<=16),d>>>24||(m+=8,d<<=8),d>>>28||(m+=4,d<<=4),d>>>30||(m+=2,d<<=2),m-=d>>>31,m}function S(d){return g(~d)-24}function p(d){return 255>>d}function y(d,m){r(ht.fromNumber(d),m)}function _(d,m){return E(w(d,m,d.length))}function w(d,m,N){if(m<0)throw new Yr.ArgumentError("Reader index should be non-negative, but was "+m);if(m>=N)return ht.fromNumber(-1);let A=d.at(m++);if(A>=0)return ht.fromNumber(A);let L=S(A);if(m+L>N)return ht.fromNumber(-1);let R=ht.fromNumber(A&p(L));for(let D=0;D<L;D++){let x=d.at(m++);R.shiftLeft(8),R.or(x&255)}return R}function E(d){let m=d.toInt();if(d.notEquals(m))throw new Yr.VIntOutOfRangeException(d);return m}function v(d){let m=d[0];if((m&128)===0)return[m,1];let N=8-(~m&255).toString(2).length,A=m&255>>N;for(let L=1;L<=N;L++){let R=d[L];A<<=8,A|=R&255}return[A,N+1]}function l(d){let m=[];if(d<128)m.push(d);else{let N=d,A=0,L=N.toString(2).length,R=A+1;for(;L>8-R;)A+=1,L-=8,R=Math.min(A+1,8),m.push(N&255),N>>=8;if(A>8)throw new Error(`Value ${d} is too big and cannot be encoded as vint`);let D=8-A;N|=255>>D<<D,m.push(Math.abs(N))}return m.reverse(),Buffer.from(m)}return{readVInt:c,writeVInt:t,uvintPack:l,uvintUnpack:v}}();q.adaptNamedParamsPrepared=Mm;q.adaptNamedParamsWithHints=Vm;q.AddressResolver=Bs;q.allocBuffer=Tm;q.allocBufferUnsafe=Qu;q.allocBufferFromArray=Cm;q.allocBufferFromString=Sm;q.arrayIterator=Dm;q.binarySearch=Xu;q.callbackOnce=Nm;q.copyBuffer=Am;q.deepExtend=Yu;q.each=Qm;q.eachSeries=Zm;q.emptyArray=Object.freeze([]);q.emptyObject=$u;q.extend=Om;q.fixStack=Im;q.forEachOf=Ym;q.funcCompare=qm;q.ifUndefined=Gm;q.ifUndefined3=Wm;q.insertSorted=km;q.iteratorToArray=Fm;q.log=Pm;q.map=Xm;q.mapSeries=Jm;q.maxInt=wm;q.noop=Oe;q.objectValues=Hm;q.parallel=ey;q.promiseWrapper=Km;q.propCompare=Lm;q.series=ty;q.shuffleArray=$m;q.stringRepeat=zm;q.times=ny;q.timesLimit=ry;q.timesSeries=iy;q.totalLength=Bm;q.validateFn=Um;q.whilst=sy;q.HashSet=rr;q.VIntCoding=oy});var tl=C(Rs=>{"use strict";var el=require("dns"),ay=require("util"),cy=O();function Os(){}Os.prototype.translate=function(n,e,t){t(n+":"+e)};function Xr(){}ay.inherits(Xr,Os);Xr.prototype.translate=function(n,e,t){let r=n,i=this,s;cy.series([function(a){el.reverse(n,function(c,u){if(c)return a(c);if(!u)return a();s=u[0],a()})},function(a){if(!s)return a();el.lookup(s,function(c,u){if(c)return a(c);r=u,a()})}],function(o){o&&i.logError(n,o),t(r+":"+e)})};Xr.prototype.logError=function(n,e){};Rs.AddressTranslator=Os;Rs.EC2MultiRegionTranslator=Xr});var Ls=C((DC,il)=>{"use strict";var uy=require("crypto"),ly=O();function ft(n){if(!n||n.length!==16)throw new Error("You must provide a buffer containing 16 bytes");this.buffer=n}ft.fromString=function(n){if(typeof n!="string"||n.length!==36)throw new Error("Invalid string representation of Uuid, it should be in the 00000000-0000-0000-0000-000000000000");return new ft(ly.allocBufferFromString(n.replace(/-/g,""),"hex"))};ft.random=function(n){if(n)rl(function(e,t){return e?n(e):n(null,nl(t))});else{let e=rl();return nl(e)}};ft.prototype.getBuffer=function(){return this.buffer};ft.prototype.equals=function(n){return n instanceof ft&&this.buffer.equals(n.buffer)};ft.prototype.toString=function(){let n=hy(this);return n.substr(0,8)+"-"+n.substr(8,4)+"-"+n.substr(12,4)+"-"+n.substr(16,4)+"-"+n.substr(20,12)};ft.prototype.inspect=function(){return this.constructor.name+": "+this.toString()};ft.prototype.toJSON=function(){return this.toString()};function nl(n){return n[6]&=15,n[6]|=64,n[8]&=63,n[8]|=128,new ft(n)}function hy(n){return n.buffer.toString("hex")}function rl(n){return uy.randomBytes(16,n)}il.exports=ft});var hl=C((FC,ll)=>{"use strict";var fy=require("util"),al=require("crypto"),bn=Ft(),qs=Ls(),kt=O(),cl=122192928e5,ti=1e4,dy=kt.allocBufferFromString("808080808080","hex"),py=kt.allocBufferFromString("8080","hex"),gy=kt.allocBufferFromString("7f7f7f7f7f7f","hex"),my=kt.allocBufferFromString("7f7f","hex"),Jr=0,ei=0,sl=0;function Te(n,e,t,r){let i;if(n instanceof Buffer){if(n.length!==16)throw new Error("Buffer for v1 uuid not valid");i=n}else i=Sy(n,e,t,r);qs.call(this,i)}fy.inherits(Te,qs);Te.fromDate=function(n,e,t,r,i){if(typeof e=="function"?(i=e,e=t=r=null):typeof t=="function"?(i=t,t=r=null):typeof r=="function"&&(i=r,r=null),!i)return new Te(n,e,t,r);kt.parallel([s=>ol(t,6,(o,a)=>s(o,t=a)),s=>ol(r,2,(o,a)=>s(o,r=a))],s=>{if(s)return i(s);let o;try{o=new Te(n,e,t,r)}catch(a){return i(a)}i(null,o)})};Te.fromString=function(n){return new Te(qs.fromString(n).getBuffer())};Te.min=function(n,e){return new Te(n,e,dy,py)};Te.max=function(n,e){return new Te(n,e,gy,my)};Te.now=function(n,e,t){return Te.fromDate(null,null,n,e,t)};Te.prototype.getDatePrecision=function(){let n=this.buffer.readUInt32BE(0),e=0;e|=(this.buffer[4]&255)<<8,e|=this.buffer[5]&255,e|=(this.buffer[6]&15)<<24,e|=(this.buffer[7]&255)<<16;let t=bn.fromBits(n,e),r=bn.fromNumber(ti),i=t.modulo(r),s=t.div(r).subtract(bn.fromNumber(cl));return{date:new Date(s.toNumber()),ticks:i.toNumber()}};Te.prototype.getDate=function(){return this.getDatePrecision().date};Te.prototype.getNodeId=function(){return this.buffer.slice(10)};Te.prototype.getClockId=function(){return this.buffer.slice(8,10)};Te.prototype.getNodeIdString=function(){return this.buffer.slice(10).toString("ascii")};function yy(n,e,t){let r=bn.fromNumber(e+cl).multiply(bn.fromNumber(1e4)).add(bn.fromNumber(t)),i=r.getHighBitsUnsigned();n.writeUInt32BE(r.getLowBitsUnsigned(),0),n.writeUInt16BE(i&65535,4),n.writeUInt16BE(i>>>16&65535,6)}function wy(n){let e=n;if(typeof n=="string"&&(e=kt.allocBufferFromString(n,"ascii")),!(e instanceof Buffer))e=ul(2);else if(e.length!==2)throw new Error("Clock identifier must have 2 bytes");return e}function _y(n){let e=n;if(typeof n=="string"&&(e=kt.allocBufferFromString(n,"ascii")),!(e instanceof Buffer))e=ul(6);else if(e.length!==6)throw new Error("Node identifier must have 6 bytes");return e}function Ey(n){return(typeof n!="number"||n>=ti)&&(Jr++,Jr>=ti&&(Jr=0),n=Jr),n}function Ty(n,e){if(!(n instanceof Date)||isNaN(n.getTime())){n=new Date;let t=n.getTime();ei++,(ei>ti||t>sl)&&(ei=0,sl=t),e=ei}return{time:n.getTime(),ticks:Ey(e)}}function ul(n){return al.randomBytes(n)}function ol(n,e,t){if(n)return t(null,n);al.randomBytes(e,t)}function Sy(n,e,t,r){let i=Ty(n,e);t=_y(t),r=wy(r);let s=kt.allocBufferUnsafe(16);return yy(s,i.time,i.ticks),r.copy(s,8,0),t.copy(s,10,0),s[6]=s[6]&15,s[6]=s[6]|16,s[8]=s[8]&63,s[8]=s[8]|128,s}ll.exports=Te});var Fs=C((kC,fl)=>{"use strict";var Cy=/(\d+)\.(\d+)(?:\.(\d+))?(?:\.(\d+)?)?(?:[-~]([\w+]*(?:-\w[.\w]*)*))?(?:\+([.\w]+))?/,Ds=class n{constructor(e,t,r,i,s,o){this.major=e,this.minor=t,this.patch=r,this.dsePatch=i,this.preReleases=s,this.build=o}toString(){let e=this.major+"."+this.minor;return this.patch!==void 0&&(e+="."+this.patch),this.dsePatch!==void 0&&(e+="."+this.dsePatch),this.preReleases!==void 0&&this.preReleases.forEach(t=>{e+="-"+t}),this.build&&(e+="+"+this.build),e}compare(e){if(this.major<e.major)return-1;if(this.major>e.major)return 1;if(this.minor<e.minor)return-1;if(this.minor>e.minor)return 1;let t=this.patch||0,r=e.patch||0;if(t<r)return-1;if(t>r)return 1;if(this.dsePatch===void 0){if(e.dsePatch!==void 0)return-1}else{if(e.dsePatch===void 0)return 1;if(this.dsePatch<e.dsePatch)return-1;if(this.dsePatch>e.dsePatch)return 1}if(this.preReleases===void 0){if(e.preReleases!==void 0)return 1}else if(e.preReleases===void 0)return-1;return 0}static parse(e){if(!e)return null;let t=e.match(Cy);if(t){let r=parseInt(t[1],10),i=parseInt(t[2],10),s=t[3]?parseInt(t[3],10):void 0,o=t[4]?parseInt(t[4],10):void 0,a=t[5]?t[5].split("-"):void 0,c=t[6];return new n(r,i,s,o,a,c)}throw new TypeError("Could not extract version from '"+e+"'")}};fl.exports=Ds});var pl=C((UC,dl)=>{"use strict";var xy=O(),Ut=Fs(),by=Ut.parse("2.0.0"),vy=Ut.parse("2.1.0"),Ny=Ut.parse("2.2.0"),Ay=Ut.parse("3.0.0"),Iy=Ut.parse("5.1.0"),Py=Ut.parse("6.0.0"),By={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,dseV1:65,dseV2:66,maxSupported:66,minSupported:1,isDse:function(n){return n>=this.dseV1&&n<=this.dseV2},isSupportedCassandra:function(n){return n<=4&&n>=1},isSupported:function(n){return this.isDse(n)||this.isSupportedCassandra(n)},supportsPrepareFlags:function(n){return n===this.dseV2},supportsKeyspaceInRequest:function(n){return n===this.dseV2},supportsResultMetadataId:function(n){return n===this.dseV2},supportsPreparedPartitionKey:function(n){return n>=this.v4},supportsSchemaChangeFullMetadata:function(n){return n>=this.v3},supportsContinuousPaging:function(n){return this.isDse(n)},supportsPaging:function(n){return n>=this.v2},supportsTimestamp:function(n){return n>=this.v3},supportsNamedParameters:function(n){return n>=this.v3},supportsUnset:function(n){return n>=this.v4},supportsFailureReasonMap:function(n){return n>=this.v5},uses2BytesStreamIds:function(n){return n>=this.v3},uses4BytesCollectionLength:function(n){return n>=this.v3},uses4BytesQueryFlags:function(n){return this.isDse(n)},canStartupResponseErrorBeWrapped:function(n){return n>=this.v4},getLowerSupported:function(n){return n>=this.v5?this.v4:n<=this.v1?0:n-1},getHighestCommon:function(n,e){let t=n.log?n.log.bind(n):xy.noop,r=n.protocolVersion,i=!1,s=r;if(e.forEach(o=>{let a=null;if(o.dseVersion&&(a=Ut.parse(o.dseVersion),t("verbose",`Encountered host ${o.address} with dse version ${a}`),a.compare(Iy)>=0)){i=!0,a.compare(Py)>=0?r=Math.min(this.dseV2,r):r=Math.min(this.dseV1,r),s=r;return}if(!o.cassandraVersion||o.cassandraVersion.length===0){t("warning","Encountered host "+o.address+" with no cassandra version, skipping as part of protocol version evaluation");return}try{let c=Ut.parse(o.cassandraVersion);a||t("verbose","Encountered host "+o.address+" with cassandra version "+c),c.compare(Ay)>=0?(i=!0,r=Math.min(this.v4,r),s=r):c.compare(Ny)>=0?(r=Math.min(this.v4,r),s=r):c.compare(vy)>=0?(r=Math.min(this.v3,r),s=r):c.compare(by)>=0?r=Math.min(this.v2,r):r=this.v1}catch{t("warning","Encountered host "+o.address+" with unparseable cassandra version "+o.cassandraVersion+" skipping as part of protocol version evaluation")}}),i&&r<this.v3){let o=". This should not be possible as nodes within a cluster can't be separated by more than one major version";s<this.v3?t("error","Detected hosts that require at least protocol version 0x3, but currently connected to "+n.address+":"+n.port+" using protocol version 0x"+s+". Will not be able to connect to these hosts"+o):t("error","Detected hosts with maximum protocol version of 0x"+r.toString(16)+" but there are some hosts that require at least version 0x3. Will not be able to connect to these older hosts"+o),r=s}return t("verbose","Resolved protocol version 0x"+r.toString(16)+" as the highest common protocol version among hosts"),r},isBeta:function(n){return n===this.v5}};dl.exports=By});var ks=C((MC,ml)=>{var gl=O();function I(n,e){this.bits_=[],this.sign_=e;for(var t=!0,r=n.length-1;r>=0;r--){var i=n[r]|0;(!t||i!=e)&&(this.bits_[r]=i,t=!1)}}I.IntCache_={};I.fromInt=function(n){if(-128<=n&&n<128){var e=I.IntCache_[n];if(e)return e}var t=new I([n|0],n<0?-1:0);return-128<=n&&n<128&&(I.IntCache_[n]=t),t};I.fromNumber=function(n){if(isNaN(n)||!isFinite(n))return I.ZERO;if(n<0)return I.fromNumber(-n).negate();for(var e=[],t=1,r=0;n>=t;r++)e[r]=n/t|0,t*=I.TWO_PWR_32_DBL_;return new I(e,0)};I.fromBits=function(n){var e=n[n.length-1];return new I(n,e&1<<31?-1:0)};I.fromString=function(n,e){if(n.length==0)throw TypeError("number format error: empty string");var t=e||10;if(t<2||36<t)throw Error("radix out of range: "+t);if(n.charAt(0)=="-")return I.fromString(n.substring(1),t).negate();if(n.indexOf("-")>=0)throw TypeError('number format error: interior "-" character');for(var r=I.fromNumber(Math.pow(t,8)),i=I.ZERO,s=0;s<n.length;s+=8){var o=Math.min(8,n.length-s),a=parseInt(n.substring(s,s+o),t);if(o<8){var c=I.fromNumber(Math.pow(t,o));i=i.multiply(c).add(I.fromNumber(a))}else i=i.multiply(r),i=i.add(I.fromNumber(a))}return i};I.fromBuffer=function(n){for(var e=new Array(Math.ceil(n.length/4)),t=n[0]&128?-1:0,r=0;r<e.length;r++){var i=n.length-(r+1)*4,s;if(i<0){i=i+4,s=0;for(var o=0;o<i;o++){var a=n[o];t===-1&&(a=~a&255),s=s|a<<(i-o-1)*8}t===-1&&(s=~s)}else s=n.readInt32BE(i);e[r]=s}return new I(e,t)};I.toBuffer=function(n){var e=n.sign_,t=n.bits_;if(t.length===0)return gl.allocBufferFromArray([n.sign_]);var r=t[t.length-1];e===-1&&(r=~r);var i=[];r>>>24>0&&i.push(r>>24&255),r>>>16>0&&i.push(r>>16&255),r>>>8>0&&i.push(r>>8&255),i.push(r&255),i[0]>>7!==0&&i.unshift(0);for(var s=gl.allocBufferUnsafe(i.length+(t.length-1)*4),o=0;o<i.length;o++){var a=i[o];e===-1?s[o]=~a:s[o]=a}for(var c=0;c<t.length-1;c++){var u=t[t.length-2-c],f=i.length+c*4;s.writeInt32BE(u,f)}return s};I.TWO_PWR_32_DBL_=65536*65536;I.ZERO=I.fromInt(0);I.ONE=I.fromInt(1);I.TWO_PWR_24_=I.fromInt(1<<24);I.prototype.toInt=function(){return this.bits_.length>0?this.bits_[0]:this.sign_};I.prototype.toNumber=function(){if(this.isNegative())return-this.negate().toNumber();for(var n=0,e=1,t=0;t<this.bits_.length;t++)n+=this.getBitsUnsigned(t)*e,e*=I.TWO_PWR_32_DBL_;return n};I.prototype.toString=function(n){var e=n||10;if(e<2||36<e)throw Error("radix out of range: "+e);if(this.isZero())return"0";if(this.isNegative())return"-"+this.negate().toString(e);for(var t=I.fromNumber(Math.pow(e,6)),r=this,i="";;){var s=r.divide(t),o=r.subtract(s.multiply(t)).toInt(),a=o.toString(e);if(r=s,r.isZero())return a+i;for(;a.length<6;)a="0"+a;i=""+a+i}};I.prototype.getBits=function(n){return n<0?0:n<this.bits_.length?this.bits_[n]:this.sign_};I.prototype.getBitsUnsigned=function(n){var e=this.getBits(n);return e>=0?e:I.TWO_PWR_32_DBL_+e};I.prototype.getSign=function(){return this.sign_};I.prototype.isZero=function(){if(this.sign_!=0)return!1;for(var n=0;n<this.bits_.length;n++)if(this.bits_[n]!=0)return!1;return!0};I.prototype.isNegative=function(){return this.sign_==-1};I.prototype.isOdd=function(){return this.bits_.length==0&&this.sign_==-1||this.bits_.length>0&&(this.bits_[0]&1)!=0};I.prototype.equals=function(n){if(this.sign_!=n.sign_)return!1;for(var e=Math.max(this.bits_.length,n.bits_.length),t=0;t<e;t++)if(this.getBits(t)!=n.getBits(t))return!1;return!0};I.prototype.notEquals=function(n){return!this.equals(n)};I.prototype.greaterThan=function(n){return this.compare(n)>0};I.prototype.greaterThanOrEqual=function(n){return this.compare(n)>=0};I.prototype.lessThan=function(n){return this.compare(n)<0};I.prototype.lessThanOrEqual=function(n){return this.compare(n)<=0};I.prototype.compare=function(n){var e=this.subtract(n);return e.isNegative()?-1:e.isZero()?0:1};I.prototype.shorten=function(n){for(var e=n-1>>5,t=(n-1)%32,r=[],i=0;i<e;i++)r[i]=this.getBits(i);var s=t==31?4294967295:(1<<t+1)-1,o=this.getBits(e)&s;return o&1<<t?(o|=4294967295-s,r[e]=o,new I(r,-1)):(r[e]=o,new I(r,0))};I.prototype.negate=function(){return this.not().add(I.ONE)};I.prototype.add=function(n){for(var e=Math.max(this.bits_.length,n.bits_.length),t=[],r=0,i=0;i<=e;i++){var s=this.getBits(i)>>>16,o=this.getBits(i)&65535,a=n.getBits(i)>>>16,c=n.getBits(i)&65535,u=r+o+c,f=(u>>>16)+s+a;r=f>>>16,u&=65535,f&=65535,t[i]=f<<16|u}return I.fromBits(t)};I.prototype.subtract=function(n){return this.add(n.negate())};I.prototype.multiply=function(n){if(this.isZero())return I.ZERO;if(n.isZero())return I.ZERO;if(this.isNegative())return n.isNegative()?this.negate().multiply(n.negate()):this.negate().multiply(n).negate();if(n.isNegative())return this.multiply(n.negate()).negate();if(this.lessThan(I.TWO_PWR_24_)&&n.lessThan(I.TWO_PWR_24_))return I.fromNumber(this.toNumber()*n.toNumber());for(var e=this.bits_.length+n.bits_.length,t=[],r=0;r<2*e;r++)t[r]=0;for(var r=0;r<this.bits_.length;r++)for(var i=0;i<n.bits_.length;i++){var s=this.getBits(r)>>>16,o=this.getBits(r)&65535,a=n.getBits(i)>>>16,c=n.getBits(i)&65535;t[2*r+2*i]+=o*c,I.carry16_(t,2*r+2*i),t[2*r+2*i+1]+=s*c,I.carry16_(t,2*r+2*i+1),t[2*r+2*i+1]+=o*a,I.carry16_(t,2*r+2*i+1),t[2*r+2*i+2]+=s*a,I.carry16_(t,2*r+2*i+2)}for(var r=0;r<e;r++)t[r]=t[2*r+1]<<16|t[2*r];for(var r=e;r<2*e;r++)t[r]=0;return new I(t,0)};I.carry16_=function(n,e){for(;(n[e]&65535)!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535};I.prototype.divide=function(n){if(n.isZero())throw Error("division by zero");if(this.isZero())return I.ZERO;if(this.isNegative())return n.isNegative()?this.negate().divide(n.negate()):this.negate().divide(n).negate();if(n.isNegative())return this.divide(n.negate()).negate();for(var e=I.ZERO,t=this;t.greaterThanOrEqual(n);){for(var r=Math.max(1,Math.floor(t.toNumber()/n.toNumber())),i=Math.ceil(Math.log(r)/Math.LN2),s=i<=48?1:Math.pow(2,i-48),o=I.fromNumber(r),a=o.multiply(n);a.isNegative()||a.greaterThan(t);)r-=s,o=I.fromNumber(r),a=o.multiply(n);o.isZero()&&(o=I.ONE),e=e.add(o),t=t.subtract(a)}return e};I.prototype.modulo=function(n){return this.subtract(this.divide(n).multiply(n))};I.prototype.not=function(){for(var n=this.bits_.length,e=[],t=0;t<n;t++)e[t]=~this.bits_[t];return new I(e,~this.sign_)};I.prototype.and=function(n){for(var e=Math.max(this.bits_.length,n.bits_.length),t=[],r=0;r<e;r++)t[r]=this.getBits(r)&n.getBits(r);return new I(t,this.sign_&n.sign_)};I.prototype.or=function(n){for(var e=Math.max(this.bits_.length,n.bits_.length),t=[],r=0;r<e;r++)t[r]=this.getBits(r)|n.getBits(r);return new I(t,this.sign_|n.sign_)};I.prototype.xor=function(n){for(var e=Math.max(this.bits_.length,n.bits_.length),t=[],r=0;r<e;r++)t[r]=this.getBits(r)^n.getBits(r);return new I(t,this.sign_^n.sign_)};I.prototype.shiftLeft=function(n){for(var e=n>>5,t=n%32,r=this.bits_.length+e+(t>0?1:0),i=[],s=0;s<r;s++)t>0?i[s]=this.getBits(s-e)<<t|this.getBits(s-e-1)>>>32-t:i[s]=this.getBits(s-e);return new I(i,this.sign_)};I.prototype.shiftRight=function(n){for(var e=n>>5,t=n%32,r=this.bits_.length-e,i=[],s=0;s<r;s++)t>0?i[s]=this.getBits(s+e)>>>t|this.getBits(s+e+1)<<32-t:i[s]=this.getBits(s+e);return new I(i,this.sign_)};I.prototype.inspect=function(){return this.constructor.name+": "+this.toString()};I.prototype.abs=function(){return this.sign_===0?this:this.negate()};I.prototype.toJSON=function(){return this.toString()};ml.exports=I});var _l=C((VC,wl)=>{"use strict";var It=ks(),yl=O();function W(n,e){typeof n=="number"&&(n=It.fromNumber(n)),this._intVal=n,this._scale=e}W.fromBuffer=function(n){let e=n.readInt32BE(0),t=It.fromBuffer(n.slice(4));return new W(t,e)};W.toBuffer=function(n){let e=It.toBuffer(n._intVal),t=yl.allocBufferUnsafe(4);return t.writeInt32BE(n._scale,0),Buffer.concat([t,e],t.length+e.length)};W.fromString=function(n){if(!n)throw new TypeError("Invalid null or undefined value");n=n.trim();let e=n.indexOf("."),t=0;return e>=0&&(t=n.length-1-e,n=n.substr(0,e)+n.substr(e+1)),new W(It.fromString(n),t)};W.fromNumber=function(n){if(isNaN(n))return new W(It.ZERO,0);let e=n.toString();return e.indexOf("e")>=0&&(e=n.toFixed(20)),W.fromString(e)};W.prototype.equals=function(n){return n instanceof W&&this.compare(n)===0};W.prototype.inspect=function(){return this.constructor.name+": "+this.toString()};W.prototype.notEquals=function(n){return!this.equals(n)};W.prototype.compare=function(n){let e=this.subtract(n);return e.isNegative()?-1:e.isZero()?0:1};W.prototype.subtract=function(n){let e=this;if(e._scale===n._scale)return new W(e._intVal.subtract(n._intVal),e._scale);let t,r;return e._scale<n._scale?(t=n._scale-e._scale,r=e._intVal.multiply(It.fromNumber(Math.pow(10,t))).subtract(n._intVal),new W(r,n._scale)):(t=e._scale-n._scale,r=e._intVal.subtract(n._intVal.multiply(It.fromNumber(Math.pow(10,t)))),new W(r,e._scale))};W.prototype.add=function(n){let e=this;if(e._scale===n._scale)return new W(e._intVal.add(n._intVal),e._scale);let t,r;return e._scale<n._scale?(t=n._scale-e._scale,r=e._intVal.multiply(It.fromNumber(Math.pow(10,t))).add(n._intVal),new W(r,n._scale)):(t=e._scale-n._scale,r=e._intVal.add(n._intVal.multiply(It.fromNumber(Math.pow(10,t)))),new W(r,e._scale))};W.prototype.greaterThan=function(n){return this.compare(n)===1};W.prototype.isNegative=function(){return this._intVal.isNegative()};W.prototype.isZero=function(){return this._intVal.isZero()};W.prototype.toString=function(){let n=this._intVal.toString();if(this._scale===0)return n;let e="";n.charAt(0)==="-"&&(e="-",n=n.substr(1));let t=n.length-this._scale;return t<=0&&(n=yl.stringRepeat("0",-t+1)+n,t=n.length-this._scale),e+n.substr(0,t)+"."+n.substr(t)};W.prototype.toNumber=function(){return parseFloat(this.toString())};W.prototype.toJSON=function(){return this.toString()};wl.exports=W});var Cl=C((zC,Sl)=>{"use strict";var me=Ft(),Mt=require("util"),ir=O(),Nn=ir.VIntCoding,vn={months:ir.allocBuffer(9),days:ir.allocBuffer(9),nanoseconds:ir.allocBuffer(9)},Vs=2147483647,zs=me.fromInt(1e3),ni=zs,ri=zs.multiply(ni),ii=zs.multiply(ri),si=me.fromInt(60).multiply(ii),Us=me.fromInt(60).multiply(si),El=7,Ms=12,Tl=/(\d+)(y|mo|w|d|h|s|ms|us|µs|ns|m)/gi,Oy=/P((\d+)Y)?((\d+)M)?((\d+)D)?(T((\d+)H)?((\d+)M)?((\d+)S)?)?/,Ry=/P(\d+)W/,Ly=/P(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})/;function Et(n,e,t){this.months=n,this.days=e,this.nanoseconds=typeof t=="number"?me.fromNumber(t):t}Et.prototype.equals=function(n){return n instanceof Et?this.months===n.months&&this.days===n.days&&this.nanoseconds.equals(n.nanoseconds):!1};Et.prototype.toBuffer=function(){let n=Nn.writeVInt(me.fromNumber(this.months),vn.months),e=Nn.writeVInt(me.fromNumber(this.days),vn.days),t=Nn.writeVInt(this.nanoseconds,vn.nanoseconds),r=ir.allocBufferUnsafe(n+e+t);vn.months.copy(r,0,0,n);let i=n;return vn.days.copy(r,i,0,e),i+=e,vn.nanoseconds.copy(r,i,0,t),r};Et.prototype.toString=function(){let n="";function e(i,s,o){return i===0||i<s?i:(n+=(i/s).toFixed(0)+o,i%s)}function t(i,s,o){return i.equals(me.ZERO)||i.lessThan(s)?i:(n+=i.divide(s).toString()+o,i.modulo(s))}(this.months<0||this.days<0||this.nanoseconds.isNegative())&&(n="-");let r=e(Math.abs(this.months),Ms,"y");if(e(r,1,"mo"),e(Math.abs(this.days),1,"d"),!this.nanoseconds.equals(me.ZERO)){let i=this.nanoseconds.isNegative()?this.nanoseconds.negate():this.nanoseconds;r=t(i,Us,"h"),r=t(r,si,"m"),r=t(r,ii,"s"),r=t(r,ri,"ms"),r=t(r,ni,"us"),t(r,me.ONE,"ns")}return n};Et.fromBuffer=function(n){let e={value:0},t=Nn.readVInt(n,e).toNumber(),r=Nn.readVInt(n,e).toNumber(),i=Nn.readVInt(n,e);return new Et(t,r,i)};Et.fromString=function(n){let e=n.charAt(0)==="-",t=e?n.substr(1):n;return t.charAt(0)==="P"?t.charAt(t.length-1)==="W"?Fy(e,t):t.indexOf("-")>0?ky(e,t):Dy(e,t):qy(e,t)};function qy(n,e){let t=new ee(n);Tl.lastIndex=0;let r;for(;(r=Tl.exec(e))&&r.length<=3;)t.add(r[1],r[2]);return t.build()}function Dy(n,e){let t=Oy.exec(e);if(!t||t[0]!==e)throw new TypeError(Mt.format("Unable to convert '%s' to a duration",e));let r=new ee(n);return t[1]&&r.addYears(t[2]),t[3]&&r.addMonths(t[4]),t[5]&&r.addDays(t[6]),t[7]&&(t[8]&&r.addHours(t[9]),t[10]&&r.addMinutes(t[11]),t[12]&&r.addSeconds(t[13])),r.build()}function Fy(n,e){let t=Ry.exec(e);if(!t||t[0]!==e)throw new TypeError(Mt.format("Unable to convert '%s' to a duration",e));return new ee(n).addWeeks(t[1]).build()}function ky(n,e){let t=Ly.exec(e);if(!t||t[0]!==e)throw new TypeError(Mt.format("Unable to convert '%s' to a duration",e));return new ee(n).addYears(t[1]).addMonths(t[2]).addDays(t[3]).addHours(t[4]).addMinutes(t[5]).addSeconds(t[6]).build()}function ee(n){this._isNegative=n,this._unitIndex=0,this._months=0,this._days=0,this._nanoseconds=me.ZERO,this._addMethods={y:this.addYears,mo:this.addMonths,w:this.addWeeks,d:this.addDays,h:this.addHours,m:this.addMinutes,s:this.addSeconds,ms:this.addMillis,\u00B5s:this.addMicros,us:this.addMicros,ns:this.addNanos},this._unitByIndex=[null,"years","months","weeks","days","hours","minutes","seconds","milliseconds","microseconds","nanoseconds"]}ee.prototype._validateOrder=function(n){if(n===this._unitIndex)throw new TypeError(Mt.format("Invalid duration. The %s are specified multiple times",this._getUnitName(n)));if(n<=this._unitIndex)throw new TypeError(Mt.format("Invalid duration. The %s should be after %s",this._getUnitName(this._unitIndex),this._getUnitName(n)));this._unitIndex=n};ee.prototype._validateMonths=function(n,e){this._validate32(n,(Vs-this._months)/e,"months")};ee.prototype._validateDays=function(n,e){this._validate32(n,(Vs-this._days)/e,"days")};ee.prototype._validateNanos=function(n,e){this._validate64(n,me.MAX_VALUE.subtract(this._nanoseconds).divide(e),"nanoseconds")};ee.prototype._validate32=function(n,e,t){if(n>e)throw new TypeError(Mt.format("Invalid duration. The total number of %s must be less or equal to %s",t,Vs))};ee.prototype._validate64=function(n,e,t){if(n.greaterThan(e))throw new TypeError(Mt.format("Invalid duration. The total number of %s must be less or equal to %s",t,me.MAX_VALUE.toString()))};ee.prototype._getUnitName=function(n){let e=this._unitByIndex[+n];if(!e)throw new Error("unknown unit index: "+n);return e};ee.prototype.add=function(n,e){let t=this._addMethods[e.toLowerCase()];if(!t)throw new TypeError(Mt.format("Unknown duration symbol '%s'",e));return t.call(this,n)};ee.prototype.addYears=function(n){let e=+n;return this._validateOrder(1),this._validateMonths(e,Ms),this._months+=e*Ms,this};ee.prototype.addMonths=function(n){let e=+n;return this._validateOrder(2),this._validateMonths(e,1),this._months+=e,this};ee.prototype.addWeeks=function(n){let e=+n;return this._validateOrder(3),this._validateDays(e,El),this._days+=e*El,this};ee.prototype.addDays=function(n){let e=+n;return this._validateOrder(4),this._validateDays(e,1),this._days+=e,this};ee.prototype.addHours=function(n){let e=typeof n=="string"?me.fromString(n):n;return this._validateOrder(5),this._validateNanos(e,Us),this._nanoseconds=this._nanoseconds.add(e.multiply(Us)),this};ee.prototype.addMinutes=function(n){let e=typeof n=="string"?me.fromString(n):n;return this._validateOrder(6),this._validateNanos(e,si),this._nanoseconds=this._nanoseconds.add(e.multiply(si)),this};ee.prototype.addSeconds=function(n){let e=typeof n=="string"?me.fromString(n):n;return this._validateOrder(7),this._validateNanos(e,ii),this._nanoseconds=this._nanoseconds.add(e.multiply(ii)),this};ee.prototype.addMillis=function(n){let e=typeof n=="string"?me.fromString(n):n;return this._validateOrder(8),this._validateNanos(e,ri),this._nanoseconds=this._nanoseconds.add(e.multiply(ri)),this};ee.prototype.addMicros=function(n){let e=typeof n=="string"?me.fromString(n):n;return this._validateOrder(9),this._validateNanos(e,ni),this._nanoseconds=this._nanoseconds.add(e.multiply(ni)),this};ee.prototype.addNanos=function(n){let e=typeof n=="string"?me.fromString(n):n;return this._validateOrder(10),this._validateNanos(e,me.ONE),this._nanoseconds=this._nanoseconds.add(e),this};ee.prototype.build=function(){return this._isNegative?new Et(-this._months,-this._days,this._nanoseconds.negate()):new Et(this._months,this._days,this._nanoseconds)};Sl.exports=Et});var bl=C((HC,xl)=>{"use strict";var Hs=O();function dt(n){if(!(n instanceof Buffer)||n.length!==4&&n.length!==16)throw new TypeError("The ip address must contain 4 or 16 bytes");this.buffer=n,this.length=n.length,this.version=n.length===4?4:6}dt.fromString=function(n){if(!n)return new dt(Hs.allocBufferFromArray([0,0,0,0]));let e=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,t=/^[\da-f:.]+$/i,r;if(e.test(n))return r=n.split("."),new dt(Hs.allocBufferFromArray(r));if(!t.test(n))throw new TypeError("Value could not be parsed as InetAddress: "+n);if(r=n.split(":"),r.length<3)throw new TypeError("Value could not be parsed as InetAddress: "+n);let i=Hs.allocBufferUnsafe(16),s=8-r.length+1,o=!1,a=0,c=e.test(r[r.length-1]);c&&(s-=1);function u(f){i.writeUInt8(+f,a++)}for(let f=0;f<r.length;f++){let g=r[f];if(g){if(c&&f===r.length-1){g.split(".").forEach(u);break}i.writeUInt16BE(parseInt(g,16),a),a=a+2;continue}o&&(s=1),o=!0;for(let S=0;S<s;S++)i[a++]=0,i[a++]=0}if(c&&!Uy(i))throw new TypeError("Only IPv4-Mapped IPv6 addresses are allowed as IPv6 address with embedded IPv4 address");return new dt(i)};dt.prototype.equals=function(n){return n instanceof dt?this.buffer.length===n.buffer.length&&this.buffer.toString("hex")===n.buffer.toString("hex"):!1};dt.prototype.getBuffer=function(){return this.buffer};dt.prototype.inspect=function(){return this.constructor.name+": "+this.toString()};dt.prototype.toString=function(n){if(n==="hex")return this.buffer.toString("hex");if(this.buffer.length===4)return this.buffer[0]+"."+this.buffer[1]+"."+this.buffer[2]+"."+this.buffer[3];let e=-1,t={length:0,start:-1};function r(s){if(e>=0){let o=s-e;o>t.length&&(t.length=o,t.start=e,e=-1)}}for(let s=0;s<this.buffer.length;s=s+2){if(this.buffer[s]===0&&this.buffer[s+1]===0){e<0&&(e=s),s===this.buffer.length-2&&r(s+2);continue}r(s)}let i="";for(let s=0;s<this.buffer.length;s=s+2){if(s===t.start){i+=":";continue}s<t.start+t.length&&s>t.start||(i.length>0&&(i+=":"),i+=(this.buffer[s]<<8|this.buffer[s+1]).toString(16))}return i.charAt(i.length-1)===":"&&(i+=":"),i};dt.prototype.toJSON=function(){return this.toString()};function Uy(n){for(let e=0;e<n.length-6;e++)if(n[e]!==0)return!1;return!(n[10]!==255||n[11]!==255)}xl.exports=dt});var Il=C((KC,Al)=>{"use strict";var My=require("util"),vl=O(),ai=864e5,Nl=Math.pow(2,31);function ye(n,e,t){if(typeof n=="number"&&typeof e=="number"&&typeof t=="number"){if(this.date=new Date,this.date.setUTCHours(0,0,0,0),this.date.setUTCFullYear(n,e-1,t),isNaN(this.date.getTime()))throw new Error(My.format("%d-%d-%d does not form a valid ES5 date!",n,e,t))}else if(typeof e>"u"&&typeof t>"u"&&typeof n=="number"){if(n<-2147483648||n>2147483647)throw new Error("You must provide a valid value for days since epoch (-2147483648 <= value <= 2147483647).");this.date=new Date(n*ai)}if(typeof this.date>"u")throw new Error("You must provide a valid year, month and day");this._value=isNaN(this.date.getTime())?n:null,this.year=this.date.getUTCFullYear(),this.month=this.date.getUTCMonth()+1,this.day=this.date.getUTCDate()}ye.now=function(){return ye.fromDate(new Date)};ye.utcNow=function(){return new ye(Date.now())};ye.fromDate=function(n){if(isNaN(n.getTime()))throw new TypeError("Invalid date: "+n);return new ye(n.getFullYear(),n.getMonth()+1,n.getDate())};ye.fromString=function(n){if((n.match(/-/g)||[]).length>=2){let t=1;n[0]==="-"&&(n=n.substring(1),t=-1);let r=n.split("-");return new ye(t*parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10))}if(n.match(/^-?\d+$/))return new ye(parseInt(n,10));throw new Error("Invalid input '"+n+"'.")};ye.fromBuffer=function(n){return new ye(n.readUInt32BE(0)-Nl)};ye.prototype.compare=function(n){let e=isNaN(this.date.getTime())?this._value*ai:this.date.getTime(),t=isNaN(n.date.getTime())?n._value*ai:n.date.getTime(),r=e-t;return r<0?-1:r>0?1:0};ye.prototype.equals=function(n){return n instanceof ye&&this.compare(n)===0};ye.prototype.inspect=function(){return this.constructor.name+": "+this.toString()};ye.prototype.toBuffer=function(){let e=(isNaN(this.date.getTime())?this._value:Math.floor(this.date.getTime()/ai))+Nl,t=vl.allocBufferUnsafe(4);return t.writeUInt32BE(e,0),t};ye.prototype.toString=function(){let n;return isNaN(this.date.getTime())?this._value.toString():(this.year<0?n="-"+oi((this.year*-1).toString(),4):n=oi(this.year.toString(),4),n+="-"+oi(this.month.toString(),2)+"-"+oi(this.day.toString(),2),n)};ye.prototype.toJSON=function(){return this.toString()};function oi(n,e){return n.length>=e?n:vl.stringRepeat("0",e-n.length)+n}Al.exports=ye});var Rl=C((jC,Ol)=>{"use strict";var Vt=Ft(),Bl=require("util"),Ks=O(),Vy=Vt.fromString("86399999999999"),Pl=Vt.fromNumber(1e9),zy=Vt.fromNumber(1e6),Hy=864e5;function pe(n){if(!(n instanceof Vt))throw new Error("You must specify a Long value as totalNanoseconds");if(n.lessThan(Vt.ZERO)||n.greaterThan(Vy))throw new Error("Total nanoseconds out of range");this.value=n,this.hour=this._getParts()[0],this.minute=this._getParts()[1],this.second=this._getParts()[2],this.nanosecond=this._getParts()[3]}pe.fromString=function(n){if(typeof n!="string")throw new Error("Argument type invalid: "+Bl.inspect(n));let e=n.split(":"),t=parseInt(e[0],10)*36e5+parseInt(e[1],10)*6e4,r;if(e.length===3){let i=e[2].split(".");t+=parseInt(i[0],10)*1e3,i.length===2&&(r=i[1],r=r+Ks.stringRepeat("0",9-r.length))}return pe.fromMilliseconds(t,parseInt(r,10)||0)};pe.now=function(n){return pe.fromDate(new Date,n)};pe.fromDate=function(n,e){if(!(n instanceof Date))throw new Error("Not a valid date");let t=(n.getTime()+n.getTimezoneOffset()*-6e4)%Hy;return pe.fromMilliseconds(t,e)};pe.fromMilliseconds=function(n,e){return typeof e!="number"&&(e=0),new pe(Vt.fromNumber(n).multiply(zy).add(Vt.fromNumber(e)))};pe.fromBuffer=function(n){if(!(n instanceof Buffer))throw new TypeError("Expected Buffer, obtained "+Bl.inspect(n));return new pe(new Vt(n.readInt32BE(4),n.readInt32BE(0)))};pe.prototype.compare=function(n){return this.value.compare(n.value)};pe.prototype.equals=function(n){return n instanceof pe&&this.compare(n)===0};pe.prototype.getTotalNanoseconds=function(){return this.value};pe.prototype.inspect=function(){return this.constructor.name+": "+this.toString()};pe.prototype.toBuffer=function(){let n=Ks.allocBufferUnsafe(8);return n.writeUInt32BE(this.value.getHighBitsUnsigned(),0),n.writeUInt32BE(this.value.getLowBitsUnsigned(),4),n};pe.prototype.toString=function(){return Ky(this._getParts())};pe.prototype.toJSON=function(){return this.toString()};pe.prototype._getParts=function(){if(!this._partsCache){let n=[0,0,0,0],e=this.value.div(Pl);n[3]=this.value.subtract(e.multiply(Pl)).toNumber(),n[2]=e.toNumber(),n[2]>=60&&(n[1]=Math.floor(n[2]/60),n[2]=n[2]%60),n[1]>=60&&(n[0]=Math.floor(n[1]/60),n[1]=n[1]%60),this._partsCache=n}return this._partsCache};function Ky(n){let e;if(n[0]<10?e="0"+n[0]+":":e=n[0]+":",n[1]<10?e+="0"+n[1]+":":e+=n[1]+":",n[2]<10?e+="0"+n[2]:e+=n[2],n[3]>0){let t=n[3].toString();t.length<9&&(t=Ks.stringRepeat("0",9-t.length)+t);let r;for(let i=t.length-1;i>0&&t[i]==="0";i--)r=i;r&&(t=t.substring(0,r)),e+="."+t}return e}Ol.exports=pe});var ql=C((GC,Ll)=>{"use strict";var jy=O(),Gy=j(),Wy=Symbol.asyncIterator||"@@asyncIterator";function zt(n,e,t,r,i,s){r===-1&&(r=0),this.info={queriedHost:e,triedHosts:t,speculativeExecutions:r,achievedConsistency:i,traceId:null,warnings:null,customPayload:null,isSchemaInAgreement:s},n.flags&&(this.info.traceId=n.flags.traceId,this.info.warnings=n.flags.warnings,this.info.customPayload=n.flags.customPayload),this.rows=n.rows,this.rowLength=this.rows?this.rows.length:n.rowLength,this.columns=null,this.pageState=null,this.nextPage=void 0,this.nextPageAsync=void 0;let o=n.meta;o&&(this.columns=o.columns,o.pageState&&(this.pageState=o.pageState.toString("hex"),Object.defineProperty(this,"rawPageState",{value:o.pageState,enumerable:!1})))}zt.prototype.first=function(){return this.rows&&this.rows.length?this.rows[0]:null};zt.prototype.getPageState=function(){return this.pageState};zt.prototype.getColumns=function(){return this.columns};zt.prototype.wasApplied=function(){if(!this.rows||this.rows.length===0)return!0;let e=this.rows[0]["[applied]"];return typeof e=="boolean"?e:!0};zt.prototype[Symbol.iterator]=function(){return this.rows?this.rows[Symbol.iterator]():jy.emptyArray[Symbol.iterator]()};zt.prototype[Wy]=function(){let e=0,t=this.rawPageState,r=this.rows;if(!r||r.length===0)return{next:()=>Promise.resolve({done:!0})};let i=this;return{async next(){if(e>=r.length&&t){if(!i.nextPageAsync)throw new Gy.DriverInternalError("Property nextPageAsync should be set when pageState is defined");let s=await i.nextPageAsync(t);r=s.rows,e=0,t=s.rawPageState}return e<r.length?{done:!1,value:r[e++]}:{done:!0}}}};zt.prototype.isPaged=function(){return!!this.rawPageState};Ll.exports=zt});var Fl=C((WC,Dl)=>{"use strict";var{Readable:$y}=require("stream"),Qy=O(),Zy=j(),Yy=sr(),js=class extends $y{constructor(e){super(e),this.buffer=[],this.paused=!0,this._cancelAllowed=!1,this._handlersObject=null,this._highWaterMarkRows=0}_read(){for(this.paused=!1,this.buffer.length===0&&(this._readableState.reading=!1);!this.paused&&this.buffer.length>0;)this.paused=!this.push(this.buffer.shift());this._checkBelowHighWaterMark(),!this.paused&&!this.buffer.length&&this._readNext&&(this._readNext(),this._readNext=null)}_valve(e){this._readNext=null,e&&(this.paused||this.buffer.length?this._readNext=e:e())}add(e){let t=this.buffer.push(e);return this.read(0),this._checkAboveHighWaterMark(),t}_checkAboveHighWaterMark(){!this._handlersObject||!this._handlersObject.resumeReadingHandler||this._highWaterMarkRows===0||this.buffer.length!==this._highWaterMarkRows||this._handlersObject.resumeReadingHandler(!1)}_checkBelowHighWaterMark(){!this._handlersObject||!this._handlersObject.resumeReadingHandler||this._highWaterMarkRows===0||this.buffer.length>=this._highWaterMarkRows||this._handlersObject.resumeReadingHandler(!0)}cancel(e){if(!this._cancelAllowed){let t=new Error("You can only cancel streaming executions when continuous paging is enabled");if(!e)throw t;return e(t)}if(!this._handlersObject)throw new Zy.DriverInternalError("ResultStream cancel is allowed but the cancel options were not set");if(e=e||Qy.noop,!this._handlersObject.cancelHandler){this._handlersObject.cancelHandler=e;return}this._handlersObject.cancelHandler(e)}setHandlers(e){e.continuousPaging&&(this._cancelAllowed=!0,this._handlersObject=e,this._highWaterMarkRows=e.continuousPaging.highWaterMarkRows||Yy.continuousPageDefaultHighWaterMark)}};Dl.exports=js});var Ul=C(($C,kl)=>{"use strict";function or(n){if(!n)throw new Error("Columns not defined");Object.defineProperty(this,"__columns",{value:n,enumerable:!1,writable:!1})}or.prototype.get=function(n){return typeof n=="number"?this[this.__columns[n].name]:this[n]};or.prototype.values=function(){let n=[];return this.forEach(function(e){n.push(e)}),n};or.prototype.keys=function(){let n=[];return this.forEach(function(e,t){n.push(t)}),n};or.prototype.forEach=function(n){for(let e in this)this.hasOwnProperty(e)&&n(this[e],e)};kl.exports=or});var Vl=C((QC,Ml)=>{"use strict";function en(...n){if(this.elements=n,this.elements.length===0)throw new TypeError("Tuple must contain at least one value");this.length=this.elements.length}en.fromArray=function(n){return new en(...n)};en.prototype.get=function(n){return this.elements[n||0]};en.prototype.toString=function(){return"("+this.elements.reduce(function(n,e,t){return n+(t>0?",":"")+e.toString()},"")+")"};en.prototype.toJSON=function(){return this.elements};en.prototype.values=function(){return this.elements.slice(0)};Ml.exports=en});var Gs=C((ZC,zl)=>{"use strict";var Xy=require("node:util"),ci=class n{constructor(e,t){if(e instanceof Float32Array)this.elements=Array.from(e);else if(Array.isArray(e))this.elements=e;else throw new TypeError("Vector must be constructed with a Float32Array or an Array");if(this.elements.length===0)throw new TypeError("Vector must contain at least one value");return this.length=this.elements.length,this.subtype=t,new Proxy(this,{get:function(r,i){return i==="IDENTITY"?"Vector":typeof i=="string"&&Number.isInteger(Number(i))?r.elements[i]:r[i]},set:function(r,i,s){return typeof i=="string"&&Number.isInteger(Number(i))?r.elements[i]=s:r[i]=s},ownKeys:function(r){return Reflect.ownKeys(e)},getOwnPropertyDescriptor(r,i){return typeof i=="string"&&Number.isInteger(Number(i))?{enumerable:!0,configurable:!0}:Reflect.getOwnPropertyDescriptor(r,i)}})}toString(){return"[".concat(this.elements.toString(),"]")}at(e){return this.elements[e]}[Symbol.iterator](){return this.elements[Symbol.iterator]()}static get[Symbol.species](){return n}forEach(e){return this.elements.forEach(e)}getSubtype(){return this.subtype}};Object.defineProperty(ci,Symbol.hasInstance,{value:function(n){return Xy.types.isProxy(n)&&n.IDENTITY==="Vector"||n instanceof Float32Array}});zl.exports=ci});var H=C(z=>{"use strict";var ur=require("util"),ar=j(),Hl=hl(),Ws=Ls(),hi=pl(),cr=O(),Xe=Ft(),Je={any:0,one:1,two:2,three:3,quorum:4,all:5,localQuorum:6,eachQuorum:7,serial:8,localSerial:9,localOne:10},et={};et[Je.any]="ANY";et[Je.one]="ONE";et[Je.two]="TWO";et[Je.three]="THREE";et[Je.quorum]="QUORUM";et[Je.all]="ALL";et[Je.localQuorum]="LOCAL_QUORUM";et[Je.eachQuorum]="EACH_QUORUM";et[Je.serial]="SERIAL";et[Je.localSerial]="LOCAL_SERIAL";et[Je.localOne]="LOCAL_ONE";var An={custom:0,ascii:1,bigint:2,blob:3,boolean:4,counter:5,decimal:6,double:7,float:8,int:9,text:10,timestamp:11,uuid:12,varchar:13,varint:14,timeuuid:15,inet:16,date:17,time:18,smallint:19,tinyint:20,duration:21,list:32,map:33,set:34,udt:48,tuple:49,getByName:function(n){if(n=n.toLowerCase(),n.indexOf("<")>0){let t=/^(list|set)<(.+)>$/.exec(n);if(t)return{code:this[t[1]],info:this.getByName(t[2])};let r=/^(map)< *(.+) *, *(.+)>$/.exec(n);if(r)return{code:this[r[1]],info:[this.getByName(r[2]),this.getByName(r[3])]};let i=/^(udt)<(.+)>$/.exec(n);if(i)return{code:this[i[1]],info:i[2]};let s=/^(tuple)<(.+)>$/.exec(n);if(s)return{code:this[s[1]],info:s[2].split(",").map(function(a){return this.getByName(a.trim())},this)};let o=/^vector<\s*(.+)\s*,\s*(\d+)\s*>$/.exec(n);if(o)return{code:this.custom,customTypeName:"vector",info:[this.getByName(o[1]),parseInt(o[2],10)]}}let e={code:this[n]};if(typeof e.code!="number")throw new TypeError("Data type with name "+n+" not valid");return e}},Jy=function(){let n={};for(let e in An){if(!An.hasOwnProperty(e))continue;let t=An[e];typeof t=="number"&&(n[t]=e)}return n}(),ew={local:0,remote:1,ignored:2},tw={error:0,startup:1,ready:2,authenticate:3,credentials:4,options:5,supported:6,query:7,result:8,prepare:9,execute:10,register:11,event:12,batch:13,authChallenge:14,authResponse:15,authSuccess:16,cancel:255,isInRange:function(n){return n>this.error&&n>this.event}},nw={topologyChange:"TOPOLOGY_CHANGE",statusChange:"STATUS_CHANGE",schemaChange:"SCHEMA_CHANGE"},rw={serverError:0,protocolError:10,badCredentials:256,unavailableException:4096,overloaded:4097,isBootstrapping:4098,truncateError:4099,writeTimeout:4352,readTimeout:4608,readFailure:4864,functionFailure:5120,writeFailure:5376,syntaxError:8192,unauthorized:8448,invalid:8704,configError:8960,alreadyExists:9216,unprepared:9472,clientWriteFailure:32768},iw={voidResult:1,rows:2,setKeyspace:3,prepared:4,schemaChange:5},sw={compression:1,tracing:2,customPayload:4,warning:8},ow=Object.freeze({unset:!0}),aw=Xe.fromInt(1e3),ui=0;function cw(n,e,t){let r,i,s,o;n&&(typeof n.msecs=="number"&&(r=new Date(n.msecs)),n.msecs instanceof Date&&(r=n.msecs),Array.isArray(n.node)&&(s=cr.allocBufferFromArray(n.node)),typeof n.clockseq=="number"&&(o=cr.allocBufferUnsafe(2),o.writeUInt16BE(n.clockseq,0)),typeof n.nsecs=="number"&&(i=n.nsecs));let a=new Hl(r,i,s,o);return e instanceof Buffer?(a.getBuffer().copy(e,t||0),e):a.toString()}function uw(n,e,t){let r;return n&&Array.isArray(n.random)&&(r=new Ws(cr.allocBufferFromArray(n.random))),r||(r=Ws.random()),e instanceof Buffer?(r.getBuffer().copy(e,t||0),e):r.toString()}function li(n){if(!n||typeof n.code!="number")throw new ar.ArgumentError("Invalid signature type definition");let e=Jy[n.code];if(!e)throw new ar.ArgumentError(ur.format("Type with code %d not found",n.code));return!("info"in n)||!n.info?e:n.code===An.custom&&"customTypeName"in n&&n.customTypeName==="vector"?"vector<"+li(n.info[0])+", "+n.info[1]+">":Array.isArray(n.info)?e+"<"+n.info.map(function(t){return li(t)}).join(", ")+">":typeof n.info.code=="number"?e+"<"+li(n.info)+">":n.code===An.udt?n.info.name:e}function tn(n,e,t,r,i){this.version=n,this.flags=e,this.streamId=t,this.opcode=r,this.bodyLength=i}tn.size=function(n){return hi.uses2BytesStreamIds(n)?9:8};tn.getProtocolVersion=function(n){return n[0]&127};tn.fromBuffer=function(n,e){let t=0;e||(e=0);let r=n[e++]&127,i=n.readUInt8(e++);return hi.uses2BytesStreamIds(r)?(t=n.readInt16BE(e),e+=2):t=n.readInt8(e++),new tn(r,i,t,n.readUInt8(e++),n.readUInt32BE(e))};tn.prototype.toBuffer=function(){let n=cr.allocBufferUnsafe(tn.size(this.version));n.writeUInt8(this.version,0),n.writeUInt8(this.flags,1);let e=3;return hi.uses2BytesStreamIds(this.version)?(n.writeInt16BE(this.streamId,2),e=4):n.writeInt8(this.streamId,2),n.writeUInt8(this.opcode,e++),n.writeUInt32BE(this.bodyLength,e),n};Xe.fromBuffer=function(n){if(!(n instanceof Buffer))throw new TypeError("Expected Buffer, obtained "+ur.inspect(n));return new Xe(n.readInt32BE(4),n.readInt32BE(0))};Xe.toBuffer=function(n){if(!(n instanceof Xe))throw new TypeError("Expected Long, obtained "+ur.inspect(n));let e=cr.allocBufferUnsafe(8);return e.writeUInt32BE(n.getHighBitsUnsigned(),0),e.writeUInt32BE(n.getLowBitsUnsigned(),4),e};Xe.prototype.inspect=function(){return"Long: "+this.toString()};Xe.prototype.toJSON=function(){return this.toString()};function lw(n,e){n||(n=new Date);let t=Xe.ZERO;return typeof e=="number"&&e>=0&&e<1e3?t=Xe.fromInt(e):(ui>999&&(ui=0),t=Xe.fromInt(ui),ui++),Xe.fromNumber(n.getTime()).multiply(aw).add(t)}function Kl(n){Kl.super_.call(this,n.message,this.constructor),this.internalError=n}ur.inherits(Kl,ar.DriverError);function $s(n){$s.super_.call(this,n,this.constructor),this.info="Represents an error that happens when the maximum amount of time for an operation passed."}ur.inherits($s,ar.DriverError);z.opcodes=tw;z.consistencies=Je;z.consistencyToString=et;z.dataTypes=An;z.getDataTypeNameByCode=li;z.distance=ew;z.frameFlags=sw;z.protocolEvents=nw;z.protocolVersion=hi;z.responseErrorCodes=rw;z.resultKind=iw;z.timeuuid=cw;z.uuid=uw;z.BigDecimal=_l();z.Duration=Cl();z.FrameHeader=tn;z.InetAddress=bl();z.Integer=ks();z.LocalDate=Il();z.LocalTime=Rl();z.Long=Xe;z.ResultSet=ql();z.ResultStream=Fl();z.Row=Ul();z.DriverError=ar.DriverError;z.TimeoutError=$s;z.TimeUuid=Hl;z.Tuple=Vl();z.Vector=Gs();z.Uuid=Ws;z.unset=ow;z.generateTimestamp=lw});var $l=C((XC,Wl)=>{"use strict";var lr=require("util"),Pt=H(),fi=O(),Qs=j(),Ys=Object.freeze({done:!0}),hw=6e4;function pt(){}pt.prototype.init=function(n,e,t){this.client=n,this.hosts=e,t()};pt.prototype.getDistance=function(n){return Pt.distance.local};pt.prototype.newQueryPlan=function(n,e,t){t(new Error("You must implement a query plan for the LoadBalancingPolicy class"))};pt.prototype.getOptions=function(){return new Map};function Xs(){this.index=0}lr.inherits(Xs,pt);Xs.prototype.newQueryPlan=function(n,e,t){if(!this.hosts)return t(new Error("Load balancing policy not initialized"));let r=this.hosts.values(),i=this,s=0,o=i.index%r.length;i.index+=1,i.index>=fi.maxInt&&(i.index=0),t(null,{next:function(){return++s>r.length?Ys:{value:r[o++%r.length],done:!1}}})};function Bt(n){this.localDc=n,this.index=0,this.localHostsArray=null}lr.inherits(Bt,pt);Bt.prototype.init=function(n,e,t){this.client=n,this.hosts=e,e.on("add",this._cleanHostCache.bind(this)),e.on("remove",this._cleanHostCache.bind(this));try{Gl(this,n,this.hosts)}catch(r){return t(r)}t()};Bt.prototype.getDistance=function(n){return n.datacenter===this.localDc?Pt.distance.local:Pt.distance.ignored};Bt.prototype._cleanHostCache=function(){this.localHostsArray=null};Bt.prototype._resolveLocalHosts=function(){let n=this.hosts.values();this.localHostsArray||(this.localHostsArray=[],n.forEach(function(e){e.datacenter&&e.datacenter===this.localDc&&this.localHostsArray.push(e)},this))};Bt.prototype.newQueryPlan=function(n,e,t){if(!this.hosts)return t(new Error("Load balancing policy not initialized"));this.index+=1,this.index>=fi.maxInt&&(this.index=0),this._resolveLocalHosts();let r=this.localHostsArray,i=this.index,s=0;t(null,{next:function(){let o;return s++<r.length?(o=r[i++%r.length],{value:o,done:!1}):Ys}})};Bt.prototype.getOptions=function(){return new Map([["localDataCenter",this.localDc]])};function In(n){if(!n)throw new Error("You must specify a child load balancing policy");this.childPolicy=n}lr.inherits(In,pt);In.prototype.init=function(n,e,t){this.client=n,this.hosts=e,this.childPolicy.init(n,e,t)};In.prototype.getDistance=function(n){return this.childPolicy.getDistance(n)};In.prototype.newQueryPlan=function(n,e,t){let r;e&&(r=e.getRoutingKey(),e.getKeyspace()&&(n=e.getKeyspace()));let i;if(r&&(i=this.client.getReplicas(n,r)),!r||!i)return this.childPolicy.newQueryPlan(n,e,t);new Js(n,e,i,this.childPolicy).iterate(t)};function Js(n,e,t,r){this.keyspace=n,this.childPolicy=r,this.options=e,this.localReplicas=[],this.replicaIndex=0,this.replicaMap={},this.childIterator=null;for(let i=0;i<t.length;i++){let s=t[i];this.childPolicy.getDistance(s)===Pt.distance.local&&(this.replicaMap[s.address]=!0,this.localReplicas.push(s))}this.startIndex=Math.floor(Math.random()*this.localReplicas.length)}Js.prototype.iterate=function(n){let e=this;this.childPolicy.newQueryPlan(this.keyspace,this.options,function(t,r){if(t)return n(t);e.childIterator=r,n(null,{next:function(){return e.computeNext()}})})};Js.prototype.computeNext=function(){let n;if(this.replicaIndex<this.localReplicas.length)return n=this.localReplicas[(this.startIndex+this.replicaIndex++)%this.localReplicas.length],{value:n,done:!1};let e;for(;(e=this.childIterator.next())&&!e.done;)if(!this.replicaMap[e.value.address])return e;return Ys};In.prototype.getOptions=function(){let n=new Map([["childPolicy",this.childPolicy.constructor!==void 0?this.childPolicy.constructor.name:null]]);return this.childPolicy instanceof Bt&&n.set("localDataCenter",this.childPolicy.localDc),n};function Tt(n,e){if(!n)throw new Error("You must specify a child load balancing policy");if(!Array.isArray(e))throw new Error("You must provide the list of allowed host addresses");this.childPolicy=n,this.allowList=new Map(e.map(t=>[t,!0]))}lr.inherits(Tt,pt);Tt.prototype.init=function(n,e,t){this.childPolicy.init(n,e,t)};Tt.prototype.getDistance=function(n){return this._contains(n)?this.childPolicy.getDistance(n):Pt.distance.ignored};Tt.prototype._contains=function(n){return!!this.allowList.get(n.address)};Tt.prototype.newQueryPlan=function(n,e,t){let r=this;this.childPolicy.newQueryPlan(n,e,function(i,s){if(i)return t(i);t(null,r._filter(s))})};Tt.prototype._filter=function(n){let e=this;return{next:function(){let t=n.next();return!t.done&&!e._contains(t.value)?this.next():t}}};Tt.prototype.getOptions=function(){return new Map([["childPolicy",this.childPolicy.constructor!==void 0?this.childPolicy.constructor.name:null],["allowList",Array.from(this.allowList.keys())]])};function jl(n,e){Tt.call(this,n,e)}lr.inherits(jl,Tt);var Zs=class n extends pt{constructor(e){super(),typeof e=="string"?e={localDc:e}:e||(e=fi.emptyObject),this._client=null,this._hosts=null,this._filteredHosts=null,this._preferredHost=null,this._index=0,this.localDc=e.localDc,this._filter=e.filter||this._defaultFilter,e.isHostNewlyUp&&(this._isHostNewlyUp=e.isHostNewlyUp),e.healthCheck&&(this._healthCheck=e.healthCheck),e.compare&&(this._compare=e.compare),e.getReplicas&&(this._getReplicas=e.getReplicas)}init(e,t,r){this._client=e,this._hosts=t,this._hosts.on("add",()=>this._filteredHosts=null),this._hosts.on("remove",()=>this._filteredHosts=null);try{Gl(this,e,this._hosts)}catch(i){return r(i)}r()}getDistance(e){return this._preferredHost!==null&&e===this._preferredHost||this._filter(e)&&e.datacenter===this.localDc?Pt.distance.local:Pt.distance.ignored}newQueryPlan(e,t,r){let i,s;t&&(i=t.getRoutingKey(),t.getKeyspace()&&(e=t.getKeyspace()),s=t.getPreferredHost());let o;return!e||!i?o=this._getLocalHosts():o=this._getReplicasAndLocalHosts(e,i),s&&(this._preferredHost=s,o=n._getPreferredHostFirst(s,o)),r(null,o)}static*_getPreferredHostFirst(e,t){yield e;for(let r of t)r!==e&&(yield r)}*_getLocalHosts(e){let t=this._getFilteredLocalHosts(),r=this._getIndex(),i=e?s=>e.indexOf(s)===-1:s=>!0;for(let s=0;s<t.length;s++){let o=t[(s+r)%t.length];i(o)&&o.isUp()&&(yield o)}}_getReplicasAndLocalHosts(e,t){let r=this._getReplicas(e,t);if(r===null)return this._getLocalHosts();let i=[],s=null,o=Number.MIN_SAFE_INTEGER,a=0;for(let u=0;u<r.length;u++){let f=r[u];if(!this._filter(f)||f.datacenter!==this.localDc||!f.isUp())continue;let g=this._isHostNewlyUp(f);g!==null&&g>o&&(s=f,o=g),s===null&&!this._healthCheck(f)&&a++,i.push(f)}if(r=i,fi.shuffleArray(r),r.length<3)return this.yieldReplicasFirst(r);let c;if(s===null)a>0&&a<Math.floor(r.length/2+1)&&this._sendUnhealthyToTheBack(r,a);else if((s===r[0]||s===r[1])&&Math.random()*4>=1){let u=s===r[0]?0:1;c=r[r.length-1],r[r.length-1]=r[u],r[u]=c}return this._compare(r[1],r[0])>0&&(c=r[0],r[0]=r[1],r[1]=c),this.yieldReplicasFirst(r)}*yieldReplicasFirst(e){for(let t=0;t<e.length;t++)yield e[t];yield*this._getLocalHosts(e)}_isHostNewlyUp(e){return e.isUpSince!==null&&Date.now()-e.isUpSince<hw?e.isUpSince:null}_healthCheck(e){return!(e.getInFlight()>=10&&e.getResponseCount()<=1)}_compare(e,t){return e.getInFlight()<t.getInFlight()?1:-1}_getReplicas(e,t){return this._client.getReplicas(e,t)}_getFilteredLocalHosts(){return this._filteredHosts===null&&(this._filteredHosts=this._hosts.values().filter(e=>this._filter(e)&&e.datacenter===this.localDc)),this._filteredHosts}_getIndex(){let e=this._index++;return this._index===2147483647&&(this._index=0),e}_sendUnhealthyToTheBack(e,t){let r=0;for(let i=e.length-1;i>=0&&r<t;i--){let s=e[i];if(this._healthCheck(s))continue;let o=e.length-1-r;if(o!==i){let a=e[o];e[o]=s,e[i]=a}r++}}_defaultFilter(){return!0}getOptions(){return new Map([["localDataCenter",this.localDc],["filterFunction",this._filter!==this._defaultFilter]])}};function Gl(n,e,t){if(!(n instanceof pt))throw new Qs.DriverInternalError("LoadBalancingPolicy instance was not provided");e&&e.options&&(n.localDc&&!e.options.localDataCenter&&e.log("info",`Local data center '${n.localDc}' was provided as an argument to the load-balancing policy. It is preferable to specify the local data center using 'localDataCenter' in Client options instead when your application is targeting a single data center.`),n.localDc=n.localDc||e.options.localDataCenter);let r=fw(t);if(!n.localDc)throw new Qs.ArgumentError(`'localDataCenter' is not defined in Client options and also was not specified in constructor. At least one is required. Available DCs are: [${Array.from(r)}]`);if(!r.has(n.localDc))throw new Qs.ArgumentError(`Datacenter ${n.localDc} was not found. Available DCs are: [${Array.from(r)}]`)}function fw(n){return new Set(n.values().map(e=>e.datacenter))}Wl.exports={AllowListPolicy:Tt,DCAwareRoundRobinPolicy:Bt,DefaultLoadBalancingPolicy:Zs,LoadBalancingPolicy:pt,RoundRobinPolicy:Xs,TokenAwarePolicy:In,WhiteListPolicy:jl}});var Zl=C(pi=>{"use strict";var Ql=require("util");function hr(){}hr.prototype.newSchedule=function(){throw new Error("You must implement a new schedule for the Reconnection class")};hr.prototype.getOptions=function(){return new Map};function di(n){this.delay=n}Ql.inherits(di,hr);di.prototype.newSchedule=function(){let n=this;return{next:function(){return{value:n.delay,done:!1}}}};di.prototype.getOptions=function(){return new Map([["delay",this.delay]])};function fr(n,e,t){this.baseDelay=n,this.maxDelay=e,this.startWithNoDelay=t}Ql.inherits(fr,hr);fr.prototype.newSchedule=function*(){let n=this.startWithNoDelay?-1:0;for(;;){let e=0;n>=64?e=this.maxDelay:n!==-1&&(e=Math.min(Math.pow(2,n)*this.baseDelay,this.maxDelay)),n++,yield this._addJitter(e)}};fr.prototype._addJitter=function(n){if(n===0)return n;let e=.85,t=.3;return!this.startWithNoDelay&&n===this.baseDelay?(e=1,t=.15):n===this.maxDelay&&(t=.15),Math.floor(n*(Math.random()*t+e))};fr.prototype.getOptions=function(){return new Map([["baseDelay",this.baseDelay],["maxDelay",this.maxDelay],["startWithNoDelay",this.startWithNoDelay]])};pi.ReconnectionPolicy=hr;pi.ConstantReconnectionPolicy=di;pi.ExponentialReconnectionPolicy=fr});var eo=C(gi=>{"use strict";var Yl=require("util");function Ke(){}Ke.prototype.onUnavailable=function(n,e,t,r){return n.nbRetry>0?this.rethrowResult():this.retryResult(void 0,!1)};Ke.prototype.onReadTimeout=function(n,e,t,r,i){return n.nbRetry>0?this.rethrowResult():t>=r&&!i?this.retryResult():this.rethrowResult()};Ke.prototype.onWriteTimeout=function(n,e,t,r,i){return n.nbRetry>0?this.rethrowResult():i==="BATCH_LOG"?this.retryResult():this.rethrowResult()};Ke.prototype.onRequestError=function(n,e,t){return this.retryResult(void 0,!1)};Ke.prototype.retryResult=function(n,e){return{decision:Ke.retryDecision.retry,consistency:n,useCurrentHost:e!==!1}};Ke.prototype.rethrowResult=function(){return{decision:Ke.retryDecision.rethrow}};Ke.retryDecision={rethrow:0,retry:1,ignore:2};function Pn(n){this._childPolicy=n||new Ke}Yl.inherits(Pn,Ke);Pn.prototype.onReadTimeout=function(n,e,t,r,i){return this._childPolicy.onReadTimeout(n,e,t,r,i)};Pn.prototype.onRequestError=function(n,e,t){return n.executionOptions.isIdempotent()?this._childPolicy.onRequestError(n,e,t):this.rethrowResult()};Pn.prototype.onUnavailable=function(n,e,t,r){return this._childPolicy.onUnavailable(n,e,t,r)};Pn.prototype.onWriteTimeout=function(n,e,t,r,i){return n.executionOptions.isIdempotent()?this._childPolicy.onWriteTimeout(n,e,t,r,i):this.rethrowResult()};function Bn(){}Yl.inherits(Bn,Ke);Bn.prototype.onReadTimeout=function(){return this.rethrowResult()};Bn.prototype.onRequestError=function(){return this.rethrowResult()};Bn.prototype.onUnavailable=function(){return this.rethrowResult()};Bn.prototype.onWriteTimeout=function(){return this.rethrowResult()};gi.IdempotenceAwareRetryPolicy=Pn;gi.FallthroughRetryPolicy=Bn;gi.RetryPolicy=Ke});var eh=C(yi=>{"use strict";var Jl=require("util"),Xl=j();function nn(){}nn.prototype.init=function(n){};nn.prototype.shutdown=function(){};nn.prototype.newPlan=function(n,e){throw new Error("You must implement newPlan() method in the SpeculativeExecutionPolicy")};nn.prototype.getOptions=function(){return new Map};function to(){this._plan={nextExecution:function(){return-1}}}Jl.inherits(to,nn);to.prototype.newPlan=function(){return this._plan};function mi(n,e){if(!(n>=0))throw new Xl.ArgumentError("delay must be a positive number or zero");if(!(e>0))throw new Xl.ArgumentError("maxSpeculativeExecutions must be a positive number");this._delay=n,this._maxSpeculativeExecutions=e}Jl.inherits(mi,nn);mi.prototype.newPlan=function(){let n=0,e=this;return{nextExecution:function(){return n++<e._maxSpeculativeExecutions?e._delay:-1}}};mi.prototype.getOptions=function(){return new Map([["delay",this._delay],["maxSpeculativeExecutions",this._maxSpeculativeExecutions]])};yi.NoSpeculativeExecutionPolicy=to;yi.SpeculativeExecutionPolicy=nn;yi.ConstantSpeculativeExecutionPolicy=mi});var nh=C(io=>{"use strict";var th=require("util"),{Long:no}=H(),dw=j(),pw=9007199254740,gw=no.fromInt(1e3);function ro(){}ro.prototype.next=function(n){throw new Error("next() must be implemented")};function dr(n,e){if(n<0)throw new dw.ArgumentError("warningThreshold can not be lower than 0");this._warningThreshold=n||1e3,this._minLogInterval=1e3,typeof e=="number"&&(this._minLogInterval=e),this._micros=-1,this._lastDate=0,this._lastLogDate=0}th.inherits(dr,ro);dr.prototype.getDate=function(){return Date.now()};dr.prototype.next=function(n){let e=this.getDate(),t=0;if(e>this._lastDate)return this._micros=0,this._lastDate=e,this._generateMicroseconds();e<this._lastDate&&(t=this._lastDate-e,e=this._lastDate),++this._micros===1e3&&(this._micros=0,e===this._lastDate&&(e++,t++));let r=this._lastDate;this._lastDate=e;let i=this._generateMicroseconds();if(t>=this._warningThreshold){let s=Date.now();if(this._minLogInterval>0&&this._lastLogDate+this._minLogInterval<=s){let o=th.format("Timestamp generated using current date was %d milliseconds behind the last generated timestamp (which millisecond portion was %d), the returned value (%s) is being artificially incremented to guarantee monotonicity.",t,r,i);this._lastLogDate=s,n.log("warning",o)}}return i};dr.prototype._generateMicroseconds=function(){return this._lastDate<pw?this._lastDate*1e3+this._micros:no.fromNumber(this._lastDate).multiply(gw).add(no.fromInt(this._micros))};io.TimestampGenerator=ro;io.MonotonicTimestampGenerator=dr});var wi=C(je=>{"use strict";var mw=je.addressResolution=tl(),yw=je.loadBalancing=$l(),ww=je.reconnection=Zl(),_w=je.retry=eo(),Ew=je.speculativeExecution=eh(),Tw=je.timestampGeneration=nh();je.defaultAddressTranslator=function(){return new mw.AddressTranslator};je.defaultLoadBalancingPolicy=function(n){return new yw.DefaultLoadBalancingPolicy(n)};je.defaultRetryPolicy=function(){return new _w.RetryPolicy};je.defaultReconnectionPolicy=function(){return new ww.ExponentialReconnectionPolicy(1e3,10*60*1e3,!1)};je.defaultSpeculativeExecutionPolicy=function(){return new Ew.NoSpeculativeExecutionPolicy};je.defaultTimestampGenerator=function(){return new Tw.MonotonicTimestampGenerator}});var oo=C((ix,rh)=>{"use strict";var so=class{onSuccess(e,t,r,i,s,o,a){}onError(e,t,r,i,s,o,a){}shutdown(){}};rh.exports=so});var uh=C((sx,ch)=>{"use strict";var Sw=require("events"),Cw=oo(),xw=j(),{format:pr}=require("util"),bw=1e6,vw=500,Nw=50,ih=200,ao=class extends Cw{constructor(e){if(super(),!e)throw new xw.ArgumentError("RequestLogger options parameter is required");this._options=e,this.logNormalRequests=this._options.logNormalRequests,this.logErroredRequests=this._options.logErroredRequests,this.emitter=new Sw.EventEmitter}onSuccess(e,t,r,i,s,o,a){this._options.slowThreshold>0&&On(a)>this._options.slowThreshold?this._logSlow(e,t,r,i,s,o,a):this._options.requestSizeThreshold>0&&s>this._options.requestSizeThreshold?this._logLargeRequest(e,t,r,i,s,o,a):this.logNormalRequests&&this._logNormalRequest(e,t,r,i,s,o,a)}onError(e,t,r,i,s,o,a){this._options.requestSizeThreshold>0&&s>this._options.requestSizeThreshold?this._logLargeErrorRequest(e,t,r,i,s,o,a):this.logErroredRequests&&this._logErrorRequest(e,t,r,i,s,o,a)}_logSlow(e,t,r,i,s,o,a){let c=pr("[%s] Slow request, took %d ms (%s): %s",e.address,Math.floor(On(a)),mr(s,o),gr(t,r,i,this._options));this.emitter.emit("slow",c)}_logLargeRequest(e,t,r,i,s,o,a){let c=pr("[%s] Request exceeded length, %s (took %d ms): %s",e.address,mr(s,o),~~On(a),gr(t,r,i,this._options));this.emitter.emit("large",c)}_logNormalRequest(e,t,r,i,s,o,a){let c=pr("[%s] Request completed normally, took %d ms (%s): %s",e.address,~~On(a),mr(s,o),gr(t,r,i,this._options));this.emitter.emit("normal",c)}_logLargeErrorRequest(e,t,r,i,s,o,a){let c=this._options.messageMaxErrorStackTraceLength||ih,u=pr("[%s] Request exceeded length and execution failed, %s (took %d ms): %s; error: %s",e.address,mr(s),~~On(a),gr(t,r,i,this._options),o.stack.substr(0,c));this.emitter.emit("large",u)}_logErrorRequest(e,t,r,i,s,o,a){let c=this._options.messageMaxErrorStackTraceLength||ih,u=pr("[%s] Request execution failed, took %d ms (%s): %s; error: %s",e.address,~~On(a),mr(s),gr(t,r,i,this._options),o.stack.substr(0,c));this.emitter.emit("failure",u)}};function On(n){return n[0]*1e3+n[1]/bw}function gr(n,e,t,r){let i=r.messageMaxQueryLength||vw,s=r.messageMaxParameterValueLength||Nw;if(Array.isArray(n))return Aw(n,t,i,s);let o=n.substr(0,i),a=i-o.length-1;return o+=ah(e,a,s),t.isPrepared()||(o+=" (not prepared)"),o}function Aw(n,e,t,r){let i=(e.isBatchLogged()?"LOGGED ":"")+"BATCH w/ "+n.length+(e.isPrepared()?"":" not prepared")+" queries (",s=t,o;for(o=0;o<n.length&&s>0;o++){let a=n[o],c=a.params;typeof a!="string"&&(a=a.query),o>0&&(i+=",",s--);let u=Math.min(s,a.length);if(i+=a.substr(0,u),s-=u,s<=0)break;let f=ah(c,s,r);s-=f.length,i+=f}return i+=o<n.length?",...)":")",i}function ah(n,e,t){if(e<=3)return" [...]";if(!n)return" []";let r=(o,a)=>sh(n[o],a);if(!Array.isArray(n)){let o=n;n=Object.keys(n),r=(a,c)=>{let u=n[a],f=u.substr(0,c),g=c-f.length-1;return g<=0||(f+=":"+sh(o[u],g)),f}}let i=" [",s;for(s=0;e>0&&s<n.length;s++){s>0&&(i+=",",e--);let o=r(s,Math.min(t,e));e-=o.length,i+=o}return s<n.length&&(i+="..."),i+="]",i}function sh(n,e){return n===void 0?"undefined":n===null?"null":n.toString().substr(0,e)}function mr(n,e){let t="request size "+oh(n);return e!==void 0&&(t+=" / response size "+oh(e)),t}function oh(n){return n>1e3?Math.round(n/1024)+" KB":n+" bytes"}ch.exports=ao});var uo=C(co=>{"use strict";co.RequestLogger=uh();co.RequestTracker=oo()});var ho=C((ax,lh)=>{"use strict";var lo=class{onAuthenticationError(e){}onClientTimeoutError(e){}onConnectionError(e){}onOtherError(e){}onReadTimeoutError(e){}onWriteTimeoutError(e){}onUnavailableError(e){}onClientTimeoutRetry(e){}onOtherErrorRetry(e){}onReadTimeoutRetry(e){}onUnavailableRetry(e){}onWriteTimeoutRetry(e){}onIgnoreError(e){}onSpeculativeExecution(){}onSuccessfulResponse(e){}onResponse(e){}};lh.exports=lo});var fh=C((cx,hh)=>{"use strict";var Iw=ho(),Se=require("events"),fo=class extends Iw{constructor(){super(),this.errors=new Se,this.errors.authentication=new Se,this.errors.clientTimeout=new Se,this.errors.connection=new Se,this.errors.other=new Se,this.errors.readTimeout=new Se,this.errors.unavailable=new Se,this.errors.writeTimeout=new Se,this.retries=new Se,this.retries.clientTimeout=new Se,this.retries.other=new Se,this.retries.readTimeout=new Se,this.retries.unavailable=new Se,this.retries.writeTimeout=new Se,this.speculativeExecutions=new Se,this.ignoredErrors=new Se,this.responses=new Se,this.responses.success=new Se}onAuthenticationError(e){this.errors.authentication.emit("increment",e),this.errors.emit("increment",e)}onConnectionError(e){this.errors.connection.emit("increment",e),this.errors.emit("increment",e)}onReadTimeoutError(e){this.errors.readTimeout.emit("increment",e),this.errors.emit("increment",e)}onWriteTimeoutError(e){this.errors.writeTimeout.emit("increment",e),this.errors.emit("increment",e)}onUnavailableError(e){this.errors.unavailable.emit("increment",e),this.errors.emit("increment",e)}onClientTimeoutError(e){this.errors.clientTimeout.emit("increment",e),this.errors.emit("increment",e)}onOtherError(e){this.errors.other.emit("increment",e),this.errors.emit("increment",e)}onClientTimeoutRetry(e){this.retries.clientTimeout.emit("increment",e),this.retries.emit("increment",e)}onOtherErrorRetry(e){this.retries.other.emit("increment",e),this.retries.emit("increment",e)}onReadTimeoutRetry(e){this.retries.readTimeout.emit("increment",e),this.retries.emit("increment",e)}onUnavailableRetry(e){this.retries.unavailable.emit("increment",e),this.retries.emit("increment",e)}onWriteTimeoutRetry(e){this.retries.writeTimeout.emit("increment",e),this.retries.emit("increment",e)}onIgnoreError(e){this.ignoredErrors.emit("increment",e)}onSpeculativeExecution(){this.speculativeExecutions.emit("increment")}onSuccessfulResponse(e){this.responses.success.emit("increment",e)}onResponse(e){this.responses.emit("increment",e)}};hh.exports=fo});var po=C((ux,dh)=>{"use strict";var Pw=ho(),Bw=fh();dh.exports={ClientMetrics:Pw,DefaultMetrics:Bw}});var rn=C(go=>{"use strict";function ph(){}ph.prototype.newAuthenticator=function(n,e){throw new Error("This is an abstract class, you must implement newAuthenticator method or use another auth provider that inherits from this class")};function _i(){}_i.prototype.initialResponse=function(n){n(new Error("Not implemented"))};_i.prototype.evaluateChallenge=function(n,e){e(new Error("Not implemented"))};_i.prototype.onAuthenticationSuccess=function(n){};go.AuthProvider=ph;go.Authenticator=_i});var yo=C((hx,yh)=>{"use strict";var gh=require("util"),mh=rn(),Ei=O(),Ow=mh.AuthProvider,Rw=mh.Authenticator;function mo(n,e){this.username=n,this.password=e}gh.inherits(mo,Ow);mo.prototype.newAuthenticator=function(){return new yr(this.username,this.password)};function yr(n,e){this.username=n,this.password=e}gh.inherits(yr,Rw);yr.prototype.initialResponse=function(n){let e=Buffer.concat([Ei.allocBufferFromArray([0]),Ei.allocBufferFromString(this.username,"utf8"),Ei.allocBufferFromArray([0]),Ei.allocBufferFromString(this.password,"utf8")]);n(null,e)};yr.prototype.evaluateChallenge=function(n,e){e()};yh.exports={PlainTextAuthenticator:yr,PlainTextAuthProvider:mo}});var wo=C((fx,wh)=>{"use strict";var Lw=require("util"),{Authenticator:qw}=rn(),Dw="com.datastax.bdp.cassandra.auth.DseAuthenticator";function Rn(n){this.authenticatorName=n}Lw.inherits(Rn,qw);Rn.prototype.getMechanism=function(){throw new Error("Not implemented")};Rn.prototype.getInitialServerChallenge=function(){throw new Error("Not implemented")};Rn.prototype.initialResponse=function(n){if(!this._isDseAuthenticator())return this.evaluateChallenge(this.getInitialServerChallenge(),n);n(null,this.getMechanism())};Rn.prototype._isDseAuthenticator=function(){return this.authenticatorName===Dw};wh.exports=Rn});var Th=C((dx,Eh)=>{"use strict";var Fw=require("util"),_h=O(),Ti=class{constructor(e,t){this.authorizationId=e,this.service=t!==void 0?t:"dse"}init(e,t){throw new Error("Not implemented")}evaluateChallenge(e,t){throw new Error("Not implemented")}shutdown(e){throw new Error("Not implemented")}static createNew(e,t,r){return new _o(e,t,r)}},_o=class extends Ti{constructor(e,t,r){if(typeof e.initializeClient!="function")throw new Error("The driver expects version 1.x of the kerberos library");super(t,r),this.kerberos=e,this.transitionIndex=0}init(e,t){this.host=e;let r=this.service;this.host&&(r=Fw.format("%s@%s",this.service,this.host));let i={gssFlags:this.kerberos.GSS_C_MUTUAL_FLAG};this.kerberos.initializeClient(r,i,(s,o)=>{if(s)return t(s);this.kerberosClient=o,t()})}evaluateChallenge(e,t){this["transition"+this.transitionIndex](e,(r,i)=>{if(r)return t(r);this.transitionIndex++,t(null,i?_h.allocBufferFromString(i,"base64"):_h.allocBuffer(0))})}transition0(e,t){this.kerberosClient.step("",t)}transition1(e,t){let r=e.toString("base64");this.kerberosClient.step(r,t)}transition2(e,t){this.kerberosClient.unwrap(e.toString("base64"),(r,i)=>{if(r)return t(r,!1);let s=function(o,a){if(o)return t(o);t(null,a)};this.authorizationId!==void 0?this.kerberosClient.wrap(i,{user:this.authorizationId},s):this.kerberosClient.wrap(i,null,s)})}shutdown(e){this.kerberosClient=null,e()}};Eh.exports=Ti});var vh=C((px,bh)=>{"use strict";var Sh=require("util"),{AuthProvider:kw}=rn(),Ch=wo(),Uw=Th(),Eo=require("dns"),wr=O(),Mw=wr.allocBufferFromString("GSSAPI"),xh="GSSAPI-START",Vw=wr.allocBuffer(0);function Ht(n){try{this._kerberos=require("kerberos")}catch(e){if(e.code==="MODULE_NOT_FOUND"){let t=new Error('You must install module "kerberos" to use GSSAPI auth provider: https://www.npmjs.com/package/kerberos');throw t.code=e.code,t}throw e}n=n||wr.emptyObject,this.authorizationId=n.authorizationId||n.user,this.service=n.service,this.hostNameResolver=n.hostNameResolver||Ht.lookupServiceResolver}Sh.inherits(Ht,kw);Ht.prototype.newAuthenticator=function(n,e){let t=n;return n.indexOf(":")>0&&(t=n.split(":")[0]),new sn(this._kerberos,t,e,this.authorizationId,this.service,this.hostNameResolver)};Ht.lookupServiceResolver=function(n,e){if(!Eo.lookupService)return Ht.reverseDnsResolver(n,e);Eo.lookupService(n,0,function(t,r){if(t)return e(t);if(!r)return e(null,n);e(null,r)})};Ht.reverseDnsResolver=function(n,e){Eo.reverse(n,function(t,r){if(t)return e(t);if(!r||!r.length)return e(null,n);e(null,r[0])})};Ht.useIpResolver=function(n,e){e(null,n)};function sn(n,e,t,r,i,s){Ch.call(this,t),this.authorizationId=r,this.address=e,this.client=Uw.createNew(n,r,i),this.hostNameResolver=s}Sh.inherits(sn,Ch);sn.prototype.getMechanism=function(){return Mw};sn.prototype.getInitialServerChallenge=function(){return wr.allocBufferFromString(xh)};sn.prototype.initialResponse=function(n){let e=this,t=this.address;wr.series([function(i){e.hostNameResolver(e.address,function(s,o){!s&&o&&(t=o),i()})},function(i){e.client.init(t,function(s){if(s)return i(s);if(!e._isDseAuthenticator())return e.evaluateChallenge(e.getInitialServerChallenge(),i);i(null,e.getMechanism())})}],n)};sn.prototype.evaluateChallenge=function(n,e){(!n||n.toString()===xh)&&(n=Vw),this.client.evaluateChallenge(n,e)};sn.prototype.onAuthenticationSuccess=function(n){this.client.shutdown(function(){})};bh.exports=Ht});var Oh=C((gx,Bh)=>{"use strict";var Ah=require("util"),{AuthProvider:zw}=rn(),Ih=wo(),Ln=O(),Hw=Ln.allocBufferFromString("PLAIN"),Nh=Ln.allocBufferFromArray([0]),Ph="PLAIN-START";function To(n,e,t){if(typeof n!="string"||typeof e!="string")throw new TypeError("Username and password must be a string");this.username=n,this.password=e,this.authorizationId=t}Ah.inherits(To,zw);To.prototype.newAuthenticator=function(n,e){return new _r(e,this.username,this.password,this.authorizationId)};function _r(n,e,t,r){Ih.call(this,n),this.authenticatorId=Ln.allocBufferFromString(e),this.password=Ln.allocBufferFromString(t),this.authorizationId=Ln.allocBufferFromString(r||"")}Ah.inherits(_r,Ih);_r.prototype.getMechanism=function(){return Hw};_r.prototype.getInitialServerChallenge=function(){return Ln.allocBufferFromString(Ph)};_r.prototype.evaluateChallenge=function(n,e){if(!n||n.toString()!==Ph)return e(new Error("Incorrect SASL challenge from server"));e(null,Buffer.concat([this.authorizationId,Nh,this.authenticatorId,Nh,this.password]))};Bh.exports=To});var Lh=C((mx,Rh)=>{"use strict";var{AuthProvider:Kw,Authenticator:jw}=rn(),{PlainTextAuthenticator:Gw}=yo(),Ww=j(),$w="com.datastax.bdp.cassandra.auth.DseAuthenticator",So=class extends Kw{newAuthenticator(e,t){return t===$w?new xo:new Co(e)}},Co=class extends jw{constructor(e){super(),this.endpoint=e}initialResponse(e){e(new Ww.AuthenticationError(`Host ${this.endpoint} requires authentication, but no authenticator found in the options`))}},xo=class extends Gw{constructor(){super("","")}};Rh.exports=So});var Er=C((yx,qh)=>{"use strict";var{Authenticator:Qw,AuthProvider:Zw}=rn(),{PlainTextAuthProvider:Yw}=yo(),Xw=vh(),Jw=Oh(),e_=Lh();qh.exports={Authenticator:Qw,AuthProvider:Zw,DseGssapiAuthProvider:Xw,DsePlainTextAuthProvider:Jw,NoAuthProvider:e_,PlainTextAuthProvider:Yw}});var sr=C(yt=>{"use strict";var Dh=require("util"),gt=wi(),mt=H(),Fh=O(),t_=uo(),kh=po(),bo=Er(),Uh={[mt.distance.local]:2,[mt.distance.remote]:1,[mt.distance.ignored]:0},Mh={[mt.distance.local]:1,[mt.distance.remote]:1,[mt.distance.ignored]:0},Vh=128,zh=2048,n_="bytes",r_=5e3,i_=1e4;function Hh(){return{policies:{addressResolution:gt.defaultAddressTranslator(),loadBalancing:gt.defaultLoadBalancingPolicy(),reconnection:gt.defaultReconnectionPolicy(),retry:gt.defaultRetryPolicy(),speculativeExecution:gt.defaultSpeculativeExecutionPolicy(),timestampGeneration:gt.defaultTimestampGenerator()},queryOptions:{fetchSize:5e3,prepare:!1,captureStackTrace:!1},protocolOptions:{port:9042,maxSchemaAgreementWaitSeconds:10,maxVersion:0,noCompact:!1},pooling:{heartBeatInterval:3e4,warmup:!0},socketOptions:{connectTimeout:5e3,defunctReadTimeoutThreshold:64,keepAlive:!0,keepAliveDelay:0,readTimeout:12e3,tcpNoDelay:!0,coalescingThreshold:65536},authProvider:null,requestTracker:null,metrics:new kh.DefaultMetrics,maxPrepared:500,refreshSchemaDelay:1e3,isMetadataSyncEnabled:!0,prepareOnAllHosts:!0,rePrepareOnUp:!0,encoding:{copyBuffer:!0,useUndefinedAsUnset:!0},monitorReporting:{enabled:!0}}}function s_(n,e){arguments.length===1&&(e=arguments[0],n={});let t=Fh.deepExtend(n,Hh(),e);if(t.cloud)o_(t);else{if(!Array.isArray(t.contactPoints)||t.contactPoints.length===0)throw new TypeError("Contacts points are not defined.");for(let r=0;r<t.contactPoints.length;r++){let i=t.contactPoints[r];if(!i)throw new TypeError(Dh.format("Contact point %s (%s) is not a valid host name, the following values are valid contact points: ipAddress, hostName or ipAddress:port",r,i))}t.sni=void 0}if(t.logEmitter||(t.logEmitter=function(){}),!t.queryOptions)throw new TypeError("queryOptions not defined in options");if(t.requestTracker!==null&&!(t.requestTracker instanceof t_.RequestTracker))throw new TypeError("requestTracker must be an instance of RequestTracker");if(!(t.metrics instanceof kh.ClientMetrics))throw new TypeError("metrics must be an instance of ClientMetrics");if(a_(t.policies),c_(t.protocolOptions),u_(t.socketOptions),l_(t),t.encoding=t.encoding||{},h_(t.encoding),t.profiles&&!Array.isArray(t.profiles))throw new TypeError("profiles must be an Array of ExecutionProfile instances");return f_(t),d_(t),t}function o_(n){let e=n.cloud.secureConnectBundle;if(!(typeof e=="string"||typeof URL<"u"&&e instanceof URL))throw new TypeError("secureConnectBundle in cloud options must be of type string");if(n.contactPoints)throw new TypeError("Contact points can not be defined when cloud settings are provided");if(n.sslOptions)throw new TypeError("SSL options can not be defined when cloud settings are provided")}function a_(n){if(!n)throw new TypeError("policies not defined in options");if(!(n.loadBalancing instanceof gt.loadBalancing.LoadBalancingPolicy))throw new TypeError("Load balancing policy must be an instance of LoadBalancingPolicy");if(!(n.reconnection instanceof gt.reconnection.ReconnectionPolicy))throw new TypeError("Reconnection policy must be an instance of ReconnectionPolicy");if(!(n.retry instanceof gt.retry.RetryPolicy))throw new TypeError("Retry policy must be an instance of RetryPolicy");if(!(n.addressResolution instanceof gt.addressResolution.AddressTranslator))throw new TypeError("Address resolution policy must be an instance of AddressTranslator");if(n.timestampGeneration!==null&&!(n.timestampGeneration instanceof gt.timestampGeneration.TimestampGenerator))throw new TypeError("Timestamp generation policy must be an instance of TimestampGenerator")}function c_(n){if(!n)throw new TypeError("protocolOptions not defined in options");let e=n.maxVersion;if(e&&(typeof e!="number"||!mt.protocolVersion.isSupported(e)))throw new TypeError(Dh.format("protocolOptions.maxVersion provided (%s) is invalid",e))}function u_(n){if(!n)throw new TypeError("socketOptions not defined in options");if(typeof n.readTimeout!="number")throw new TypeError("socketOptions.readTimeout must be a Number");if(typeof n.coalescingThreshold!="number"||n.coalescingThreshold<=0)throw new TypeError("socketOptions.coalescingThreshold must be a positive Number")}function l_(n){if(n.authProvider){if(!(n.authProvider instanceof bo.AuthProvider))throw new TypeError("options.authProvider must be an instance of AuthProvider")}else{let e=n.credentials;if(e){if(typeof e.username!="string"||typeof e.password!="string")throw new TypeError("credentials username and password must be a string");n.authProvider=new bo.PlainTextAuthProvider(e.username,e.password)}else n.authProvider=new bo.NoAuthProvider}}function h_(n){if(n.map){let e=n.map;if(typeof e!="function"||typeof e.prototype.forEach!="function"||typeof e.prototype.set!="function")throw new TypeError("Map constructor not valid")}if(n.set){let e=n.set;if(typeof e!="function"||typeof e.prototype.forEach!="function"||typeof e.prototype.add!="function")throw new TypeError("Set constructor not valid")}if((n.useBigIntAsLong||n.useBigIntAsVarint)&&typeof BigInt>"u")throw new TypeError("BigInt is not supported by the JavaScript engine")}function f_(n){function e(t){let r=n[t];if(r!=null&&typeof r!="string")throw new TypeError(`${t} should be a String`)}if(e("applicationName"),e("applicationVersion"),n.id!==null&&n.id!==void 0&&!(n.id instanceof mt.Uuid))throw new TypeError("Client id must be a Uuid")}function d_(n){let e=n.monitorReporting;if(e===null||typeof e!="object")throw new TypeError(`Monitor reporting must be an object, obtained: ${e}`)}function p_(n){let e=n.controlConnection.protocolVersion,t=Mh,r=zh;mt.protocolVersion.uses2BytesStreamIds(e)||(t=Uh,r=Vh),n.options.queryOptions.consistency===void 0&&(n.options.queryOptions.consistency=n.metadata.isDbaas()?mt.consistencies.localQuorum:mt.consistencies.localOne),n.options.pooling=Fh.deepExtend({},{coreConnectionsPerHost:t,maxRequestsPerConnection:r},n.options.pooling)}yt.extend=s_;yt.defaultOptions=Hh;yt.coreConnectionsPerHostV2=Uh;yt.coreConnectionsPerHostV3=Mh;yt.maxRequestsPerConnectionV2=Vh;yt.maxRequestsPerConnectionV3=zh;yt.setMetadataDependent=p_;yt.continuousPageUnitBytes=n_;yt.continuousPageDefaultSize=r_;yt.continuousPageDefaultHighWaterMark=i_});var Ao=C((_x,Gh)=>{"use strict";var Kh=O(),jh=H(),g_=Be();function vo(n,e){if(typeof n!="string")throw new TypeError("Execution profile name must be a string");e=e||Kh.emptyObject;let t=e.graphOptions||Kh.emptyObject;this.name=n,this.consistency=e.consistency,this.loadBalancing=e.loadBalancing,this.readTimeout=e.readTimeout,this.retry=e.retry,this.serialConsistency=e.serialConsistency,this.graphOptions={language:t.language,results:t.results,name:t.name,readConsistency:t.readConsistency,source:t.source,writeConsistency:t.writeConsistency}}var No=class{constructor(e){this._profiles=e.profiles||[],this._defaultConfiguredRetryPolicy=void 0,this._setDefault(e),this._loadBalancingPolicies=[],this._profilesMap={},this._customPayloadCache={},this._graphOptionsCache={},this._profiles.forEach(function(t){return this._profilesMap[t.name]=t,t.loadBalancing=t.loadBalancing||this._defaultProfile.loadBalancing,this._loadBalancingPolicies.indexOf(t.loadBalancing)===-1&&this._loadBalancingPolicies.push(t.loadBalancing),t},this)}async init(e,t){for(let r of this._loadBalancingPolicies)await g_.fromCallback(i=>r.init(e,t,i))}getDistance(e){let t=jh.distance.ignored;for(let r=0;r<this._loadBalancingPolicies.length;r++){let i=this._loadBalancingPolicies[r].getDistance(e);if(i<t&&(t=i,t===jh.distance.local))break}return e.setDistance(t),t}getProfile(e){return e instanceof vo?e:this._profilesMap[e||"default"]}getDefault(){return this._defaultProfile}getDefaultLoadBalancing(){return this._defaultProfile.loadBalancing}getOrCreateGraphOptions(e,t){let r=this._graphOptionsCache[e.name];return r||(r=this._graphOptionsCache[e.name]=t()),r}_setDefault(e){this._defaultProfile=this._profiles.filter(function(t){return t.name==="default"})[0],this._defaultProfile||this._profiles.push(this._defaultProfile=new vo("default")),this._defaultConfiguredRetryPolicy=this._defaultProfile.retry,this._defaultProfile.loadBalancing=this._defaultProfile.loadBalancing||e.policies.loadBalancing,this._defaultProfile.retry=this._defaultProfile.retry||e.policies.retry}getAll(){return this._profiles}getDefaultConfiguredRetryPolicy(){return this._defaultConfiguredRetryPolicy}};Gh.exports={ProfileManager:No,ExecutionProfile:vo}});var Bo=C((Ex,Wh)=>{"use strict";var m_=require("events"),Si=H(),qn=O(),y_=Si.FrameHeader,Io=class{constructor(e){if(!e)throw new Error("Opcode not provided");this.buffers=[],this.opcode=e,this.bodyLength=0}add(e){this.buffers.push(e),this.bodyLength+=e.length}writeShort(e){let t=qn.allocBufferUnsafe(2);t.writeUInt16BE(e,0),this.add(t)}writeInt(e){let t=qn.allocBufferUnsafe(4);t.writeInt32BE(e,0),this.add(t)}writeLong(e){this.add(Si.Long.toBuffer(e))}writeBytes(e){if(e===null){this.writeInt(-1);return}if(e===Si.unset){this.writeInt(-2);return}this.writeInt(e.length),this.add(e)}writeShortBytes(e){if(e===null){this.writeShort(-1);return}this.writeShort(e.length),this.add(e)}writeByte(e){this.add(qn.allocBufferFromArray([e]))}writeString(e){if(typeof e>"u")throw new Error("can not write undefined");let t=Buffer.byteLength(e,"utf8"),r=qn.allocBufferUnsafe(2+t);r.writeUInt16BE(t,0),r.write(e,2,r.length-2,"utf8"),this.add(r)}writeLString(e){let t=Buffer.byteLength(e,"utf8"),r=qn.allocBufferUnsafe(4+t);r.writeInt32BE(t,0),r.write(e,4,r.length-4,"utf8"),this.add(r)}writeStringList(e){this.writeShort(e.length),e.forEach(this.writeString,this)}writeCustomPayload(e){let t=Object.keys(e);this.writeShort(t.length),t.forEach(r=>{this.writeString(r),this.writeBytes(e[r])})}writeStringMap(e){let t=[];for(let r in e)e.hasOwnProperty(r)&&t.push(r);this.writeShort(t.length);for(let r=0;r<t.length;r++){let i=t[r];this.writeString(i),this.writeString(e[i])}}write(e,t,r){let s=new y_(e,r||0,t,this.opcode,this.bodyLength).toBuffer();return this.buffers.unshift(s),Buffer.concat(this.buffers,s.length+this.bodyLength)}},Po=class extends m_.EventEmitter{constructor(e,t,r){super(),this.netClient=e,this.encoder=t,this.isRunning=!1,this.queue=[],this.coalescingThreshold=r.socketOptions.coalescingThreshold,this.error=null,this.canWrite=!0,e.on("drain",()=>{this.canWrite=!0,this.run()})}push(e,t){let r=this;if(this.error)return process.nextTick(function(){t(r.error)});this.queue.push({operation:e,callback:t}),this.run()}run(){!this.isRunning&&this.canWrite&&(this.isRunning=!0,process.nextTick(()=>this.process()))}process(){if(this.error)return;let e=[],t=[],r=0;for(;this.queue.length>0&&r<this.coalescingThreshold;){let i=this.queue.shift();if(!i.operation.canBeWritten()){i.callback(new Error("The operation was already cancelled or timeout elapsed"));continue}let s;try{s=i.operation.request.write(this.encoder,i.operation.streamId)}catch(o){i.callback(o);continue}r+=s.length,e.push(s),t.push(i.callback)}if(r===0){this.isRunning=!1;return}for(let i=0;i<t.length;i++)t[i]();this.canWrite=this.netClient.write(Buffer.concat(e,r),i=>{if(i){this.setWriteError(i);return}if(this.queue.length===0||!this.canWrite){this.isRunning=!1;return}setImmediate(()=>this.process())})}setWriteError(e){e.isSocketError=!0,this.error=new Si.DriverError("Socket was closed"),this.error.isSocketError=!0,this.error.requestNotWritten=!0,this.error.innerError=e;let t=this.queue;this.queue=qn.emptyArray;for(let r=0;r<t.length;r++)t[r].callback(this.error)}};Wh.exports={FrameWriter:Io,WriteQueue:Po}});var Kt=C((Tx,Qh)=>{"use strict";var Tr=O(),$h=H(),w_=j(),Ci="ProxyExecute",xi=class n{constructor(){}static empty(){return new n}getCaptureStackTrace(){}getConsistency(){}getCustomPayload(){}getFetchSize(){}getFixedHost(){}getHints(){}isAutoPage(){}isBatchCounter(){}isBatchLogged(){}isIdempotent(){}isPrepared(){}isQueryTracing(){}getKeyspace(){}getLoadBalancingPolicy(){}getPageState(){}getPreferredHost(){}getRawQueryOptions(){}getReadTimeout(){}getRetryPolicy(){}getRowCallback(){}getOrGenerateTimestamp(){}getRoutingIndexes(){}getRoutingKey(){}getRoutingNames(){}getSerialConsistency(){}getTimestamp(){}setHints(e){}setKeyspace(e){}setPageState(){}setPreferredHost(){}setRoutingIndexes(e){}setRoutingKey(e){}},Oo=class n extends xi{constructor(e,t,r){if(super(),this._queryOptions=e,this._rowCallback=r,this._routingKey=this._queryOptions.routingKey,this._hints=this._queryOptions.hints,this._keyspace=this._queryOptions.keyspace,this._routingIndexes=this._queryOptions.routingIndexes,this._pageState=typeof this._queryOptions.pageState=="string"?Tr.allocBufferFromString(this._queryOptions.pageState,"hex"):this._queryOptions.pageState,this._preferredHost=null,this._client=t,this._defaultQueryOptions=t.options.queryOptions,this._profile=t.profileManager.getProfile(this._queryOptions.executionProfile),this._customPayload=n.createCustomPayload(this._queryOptions,this._defaultQueryOptions),!this._profile)throw new w_.ArgumentError(`Execution profile "${this._queryOptions.executionProfile}" not found`)}static createCustomPayload(e,t){let r=e.customPayload||t.customPayload,i=e.executeAs||t.executeAs;return i&&(r?r[Ci]||(r=Tr.extend({},r),r[Ci]=Tr.allocBufferFromString(i)):(r={},r[Ci]=Tr.allocBufferFromString(i))),r}static create(e,t,r){return(!e||typeof e=="function")&&(e=Tr.emptyObject),new n(e,t,r)}getCaptureStackTrace(){return on(this._queryOptions.captureStackTrace,this._defaultQueryOptions.captureStackTrace)}getConsistency(){return Sr(this._queryOptions.consistency,this._profile.consistency,this._defaultQueryOptions.consistency)}getCustomPayload(){return this._customPayload}getFetchSize(){return on(this._queryOptions.fetchSize,this._defaultQueryOptions.fetchSize)}getFixedHost(){return this._queryOptions.host}getHints(){return this._hints}isAutoPage(){return on(this._queryOptions.autoPage,this._defaultQueryOptions.autoPage)}isBatchCounter(){return on(this._queryOptions.counter,!1)}isBatchLogged(){return Sr(this._queryOptions.logged,this._defaultQueryOptions.logged,!0)}isIdempotent(){return on(this._queryOptions.isIdempotent,this._defaultQueryOptions.isIdempotent)}isPrepared(){return on(this._queryOptions.prepare,this._defaultQueryOptions.prepare)}isQueryTracing(){return on(this._queryOptions.traceQuery,this._defaultQueryOptions.traceQuery)}getKeyspace(){return this._keyspace}getLoadBalancingPolicy(){return this._profile.loadBalancing}getOrGenerateTimestamp(){let e=this.getTimestamp();if(e===void 0){let t=this._client.options.policies.timestampGeneration;$h.protocolVersion.supportsTimestamp(this._client.controlConnection.protocolVersion)&&t?e=t.next(this._client):e=null}return typeof e=="number"?$h.Long.fromNumber(e):e}getPageState(){return this._pageState}getProfile(){return this._profile}getRawQueryOptions(){return this._queryOptions}getReadTimeout(){return Sr(this._queryOptions.readTimeout,this._profile.readTimeout,this._client.options.socketOptions.readTimeout)}getRetryPolicy(){return Sr(this._queryOptions.retry,this._profile.retry,this._client.options.policies.retry)}getRoutingIndexes(){return this._routingIndexes}getRoutingKey(){return this._routingKey}getRoutingNames(){return this._queryOptions.routingNames}getRowCallback(){return this._rowCallback}getSerialConsistency(){return Sr(this._queryOptions.serialConsistency,this._profile.serialConsistency,this._defaultQueryOptions.serialConsistency)}getTimestamp(){return this._queryOptions.timestamp}setCustomPayload(e){this._customPayload=e}setHints(e){this._hints=e}setKeyspace(e){this._keyspace=e}setPageState(e){this._pageState=e}setRoutingIndexes(e){this._routingIndexes=e}setRoutingKey(e){this._routingKey=e}};function on(n,e){return n!==void 0?n:e}function Sr(n,e,t){return n!==void 0?n:e!==void 0?e:t}Qh.exports={ExecutionOptions:xi,DefaultExecutionOptions:Oo,proxyExecuteKey:Ci}});var Dn=C((Sx,__)=>{__.exports={name:"cassandra-driver",version:"4.8.0",description:"DataStax Node.js Driver for Apache Cassandra",author:"DataStax",keywords:["cassandra","cql","cql3","connection","gremlin","datastax","nosql","driver","database","dse","graph","graphdb"],license:"Apache-2.0",types:"./index.d.ts",dependencies:{"@types/node":"^18.11.18","adm-zip":"~0.5.10",long:"~5.2.3"},devDependencies:{chai:"~4.3.8",kerberos:"~2.0.3",mocha:"~10.2.0","mocha-jenkins-reporter":"~0.4.8",proxyquire:"~2.1.3",sinon:"~15.2.0",temp:">= 0.8.3"},repository:{type:"git",url:"https://github.com/datastax/nodejs-driver.git"},bugs:{url:"https://groups.google.com/a/lists.datastax.com/forum/#!forum/nodejs-driver-user"},scripts:{test:"./node_modules/.bin/mocha test/unit -R spec -t 5000 --recursive",unit:"./node_modules/.bin/mocha test/unit -R spec -t 5000 --recursive",integration_short:"./node_modules/.bin/mocha test/integration/short -R spec -t 5000 --recursive",integration_long:"./node_modules/.bin/mocha test/integration/long -R spec -t 5000 --recursive",ci_jenkins:"./node_modules/.bin/mocha test/unit test/integration/short --recursive -R mocha-jenkins-reporter --exit",ci_appveyor:'.\\"node_modules/.bin/mocha" test/unit test/integration/short --recursive -R mocha-appveyor-reporter --exit',ci_unit_appveyor:'.\\"node_modules/.bin/mocha" test/unit --recursive -R mocha-appveyor-reporter --exit',server_api:"./node_modules/.bin/mocha test/integration/short -g '@SERVER_API' --recursive --exit",eslint:"eslint lib test"},engines:{node:">=18"}}});var jt=C(nt=>{"use strict";var Xh=require("util"),{FrameWriter:St}=Bo(),$=H(),Lo=O(),{ExecutionOptions:E_}=Kt(),Zh=Dn(),Ge={values:1,skipMetadata:2,pageSize:4,withPagingState:8,withSerialConsistency:16,withDefaultTimestamp:32,withNameForValues:64,withKeyspace:128,withPageSizeBytes:1073741824,withContinuousPaging:2147483648},Fn={withSerialConsistency:16,withDefaultTimestamp:32,withNameForValues:64,withKeyspace:128},Yh={withKeyspace:1},Ro={logged:0,unlogged:1,counter:2},tt=class{constructor(){this.length=0}write(e,t){throw new Error("Method must be implemented")}clone(){let e=new this.constructor,t=Object.keys(this);for(let r=0;r<t.length;r++){let i=t[r];e[i]=this[i]}return e}},bi=class extends tt{constructor(e,t,r,i,s){super(),this.query=e,this.queryId=t,this.params=r,this.meta=s,this.options=i||E_.empty(),this.consistency=this.options.getConsistency()||$.consistencies.one,this.namedParameters=!1}getParamType(e){let t=this.meta.columns[e];return t?t.type:null}write(e,t){let r=new St($.opcodes.execute),i=this.options.isQueryTracing()?$.frameFlags.tracing:0;return this.options.getCustomPayload()&&(i|=$.frameFlags.customPayload,r.writeCustomPayload(this.options.getCustomPayload())),r.writeShortBytes(this.queryId),$.protocolVersion.supportsResultMetadataId(e.protocolVersion)&&r.writeShortBytes(this.meta.resultId),this.writeQueryParameters(r,e),this.length=r.bodyLength,r.write(e.protocolVersion,t,i)}writeQueryParameters(e,t,r){let i=0,s=this.options.getOrGenerateTimestamp();if($.protocolVersion.supportsPaging(t.protocolVersion)){i|=this.params&&this.params.length?Ge.values:0,i|=this.options.getFetchSize()>0?Ge.pageSize:0,i|=this.options.getPageState()?Ge.withPagingState:0,i|=this.options.getSerialConsistency()?Ge.withSerialConsistency:0,i|=s!=null?Ge.withDefaultTimestamp:0,i|=this.namedParameters?Ge.withNameForValues:0;let o=r&&$.protocolVersion.supportsKeyspaceInRequest(t.protocolVersion);i|=o&&this.options.getKeyspace()?Ge.withKeyspace:0,e.writeShort(this.consistency),$.protocolVersion.uses4BytesQueryFlags(t.protocolVersion)?e.writeInt(i):e.writeByte(i)}if(this.params&&this.params.length){e.writeShort(this.params.length);for(let o=0;o<this.params.length;o++){let a=this.params[o];i&Ge.withNameForValues&&(e.writeString(a.name),a=a.value),e.writeBytes(t.encode(a,this.getParamType(o)))}}if(!$.protocolVersion.supportsPaging(t.protocolVersion)){(!this.params||!this.params.length)&&e.writeShort(0),e.writeShort(this.consistency);return}i&Ge.pageSize&&e.writeInt(this.options.getFetchSize()),i&Ge.withPagingState&&e.writeBytes(this.options.getPageState()),i&Ge.withSerialConsistency&&e.writeShort(this.options.getSerialConsistency()),i&Ge.withDefaultTimestamp&&e.writeLong(s),i&Ge.withKeyspace&&e.writeString(this.options.getKeyspace())}},qo=class extends bi{constructor(e,t,r,i){super(e,null,t,r,null),this.hints=this.options.getHints()||Lo.emptyArray,this.namedParameters=i}getParamType(e){return this.hints[e]}write(e,t){let r=new St($.opcodes.query),i=this.options.isQueryTracing()?$.frameFlags.tracing:0;return this.options.getCustomPayload()&&(i|=$.frameFlags.customPayload,r.writeCustomPayload(this.options.getCustomPayload())),r.writeLString(this.query),$.protocolVersion.supportsPaging(e.protocolVersion)?this.writeQueryParameters(r,e,!0):r.writeShort(this.consistency),this.length=r.bodyLength,r.write(e.protocolVersion,t,i)}},Do=class extends tt{constructor(e,t){super(),this.query=e,this.keyspace=t}write(e,t){let r=new St($.opcodes.prepare);if(r.writeLString(this.query),$.protocolVersion.supportsPrepareFlags(e.protocolVersion)){let i=this.keyspace&&$.protocolVersion.supportsKeyspaceInRequest(e.protocolVersion)?Yh.withKeyspace:0;r.writeInt(i),i&Yh.withKeyspace&&r.writeString(this.keyspace)}return r.write(e.protocolVersion,t)}},Fo=class extends tt{constructor(e){super(),this.options=e||{}}write(e,t){let r=new St($.opcodes.startup),i={CQL_VERSION:this.options.cqlVersion||"3.0.0",DRIVER_NAME:Zh.description,DRIVER_VERSION:Zh.version};return this.options.noCompact&&(i.NO_COMPACT="true"),this.options.clientId&&(i.CLIENT_ID=this.options.clientId.toString()),this.options.applicationName&&(i.APPLICATION_NAME=this.options.applicationName),this.options.applicationVersion&&(i.APPLICATION_VERSION=this.options.applicationVersion),r.writeStringMap(i),r.write(e.protocolVersion,t)}},ko=class extends tt{constructor(e){super(),this.events=e}write(e,t){let r=new St($.opcodes.register);return r.writeStringList(this.events),r.write(e.protocolVersion,t)}},Uo=class extends tt{constructor(e){super(),this.token=e}write(e,t){let r=new St($.opcodes.authResponse);return r.writeBytes(this.token),r.write(e.protocolVersion,t)}},Mo=class extends tt{constructor(e,t){super(),this.username=e,this.password=t}write(e,t){let r=new St($.opcodes.credentials);return r.writeStringMap({username:this.username,password:this.password}),r.write(e.protocolVersion,t)}},Vo=class n extends tt{constructor(e,t){super(),this.queries=e,this.options=t,this.hints=t.getHints()||Lo.emptyArray,this.type=Ro.logged,t.isBatchCounter()?this.type=Ro.counter:t.isBatchLogged()||(this.type=Ro.unlogged)}write(e,t){if(!this.queries||!(this.queries.length>0))throw new TypeError(Xh.format("Invalid queries provided %s",this.queries));let r=new St($.opcodes.batch),i=this.options.isQueryTracing()?$.frameFlags.tracing:0;this.options.getCustomPayload()&&(i|=$.frameFlags.customPayload,r.writeCustomPayload(this.options.getCustomPayload())),r.writeByte(this.type),r.writeShort(this.queries.length);let s=this;if(this.queries.forEach(function(a,c){let u=s.hints[c],f=a.params||Lo.emptyArray,g;a.queryId?(r.writeByte(1),r.writeShortBytes(a.queryId),g=S=>a.meta.columns[S].type):(r.writeByte(0),r.writeLString(a.query),g=u?S=>u[S]:()=>null),r.writeShort(f.length),f.forEach((S,p)=>r.writeBytes(e.encode(S,g(p))))},this),r.writeShort(this.options.getConsistency()),$.protocolVersion.supportsTimestamp(e.protocolVersion)){let o=this.options.getSerialConsistency()?Fn.withSerialConsistency:0,a=this.options.getOrGenerateTimestamp();o|=a!=null?Fn.withDefaultTimestamp:0,o|=this.options.getKeyspace()&&$.protocolVersion.supportsKeyspaceInRequest(e.protocolVersion)?Fn.withKeyspace:0,$.protocolVersion.uses4BytesQueryFlags(e.protocolVersion)?r.writeInt(o):r.writeByte(o),o&Fn.withSerialConsistency&&r.writeShort(this.options.getSerialConsistency()),o&Fn.withDefaultTimestamp&&r.writeLong(a),o&Fn.withKeyspace&&r.writeString(this.options.getKeyspace())}return this.length=r.bodyLength,r.write(e.protocolVersion,t,i)}clone(){return new n(this.queries,this.options)}};function Ho(n){this.streamId=null,this.operationId=n}Xh.inherits(Ho,tt);Ho.prototype.write=function(n,e){let t=new St($.opcodes.cancel);return t.writeInt(1),t.writeInt(this.operationId),t.write(n.protocolVersion,e)};var zo=class extends tt{write(e,t){return new St($.opcodes.options).write(e.protocolVersion,t,0)}clone(){return this}},T_=new zo;nt.AuthResponseRequest=Uo;nt.BatchRequest=Vo;nt.CancelRequest=Ho;nt.CredentialsRequest=Mo;nt.ExecuteRequest=bi;nt.PrepareRequest=Do;nt.QueryRequest=qo;nt.Request=tt;nt.RegisterRequest=ko;nt.StartupRequest=Fo;nt.options=T_});var tf=C((xx,ef)=>{"use strict";var S_=require("util"),Jh=j(),Ko=class n{constructor(e,t,r){this._hosts=e,this._openConnections=t,this._inFlightQueries=r}getConnectedHosts(){return this._hosts}getOpenConnections(e){if(!e)throw new Jh.ArgumentError("Host is not defined");return this._openConnections[e.address]||0}getInFlightQueries(e){if(!e)throw new Jh.ArgumentError("Host is not defined");return this._inFlightQueries[e.address]||0}toString(){return S_.format('{"hosts": %j, "openConnections": %j, "inFlightQueries": %j}',this._hosts.map(function(e){return e.address}),this._openConnections,this._inFlightQueries)}static from(e){let t={},r={},i=[];return e.hosts.forEach(s=>{s.pool.connections.length!==0&&(i.push(s),t[s.address]=s.pool.connections.length,r[s.address]=s.getInFlight())}),new n(i,t,r)}};ef.exports=Ko});var Go=C((bx,rf)=>{"use strict";var C_=Ft(),nf=65536,jo=nf*nf,Cr=class n{constructor(e,t,r,i){this._arr=[e&65535,t&65535,r&65535,i&65535]}toString(){return this.toImmutable().toString()}compare(e){let t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this._compareBits(e)}_compareBits(e){for(let t=3;t>=0;t--){if(this._arr[t]>e._arr[t])return 1;if(this._arr[t]<e._arr[t])return-1}return 0}getUint16(e){return this._arr[e]}getLowBitsUnsigned(){return(this._arr[0]|(this._arr[1]&65535)<<16)>>>0}getHighBitsUnsigned(){return(this._arr[2]|this._arr[3]<<16)>>>0}toNumber(){return(this._arr[3]<<16|this._arr[2])*jo+((this._arr[1]<<16|this._arr[0])>>>0)}not(){return this._arr[0]=~this._arr[0]&65535,this._arr[1]=~this._arr[1]&65535,this._arr[2]=~this._arr[2]&65535,this._arr[3]=~this._arr[3]&65535,this}add(e){let t=0,r=0,i=0,s=0;return s+=this._arr[0]+e._arr[0],this._arr[0]=s&65535,i+=s>>>16,i+=this._arr[1]+e._arr[1],this._arr[1]=i&65535,r+=i>>>16,r+=this._arr[2]+e._arr[2],this._arr[2]=r&65535,t+=r>>>16,t+=this._arr[3]+e._arr[3],this._arr[3]=t&65535,this}shiftLeft(e){if(e===0)return this;if(e>=64)return this.toZero();let t=e%16,r=Math.floor(e/16);return r>0&&(this._arr[3]=this._arr[3-r],this._arr[2]=r>2?0:this._arr[2-r],this._arr[1]=r>1?0:this._arr[0],this._arr[0]=0),t>0&&(this._arr[3]=(this._arr[3]<<t|this._arr[2]>>>16-t)&65535,this._arr[2]=(this._arr[2]<<t|this._arr[1]>>>16-t)&65535,this._arr[1]=(this._arr[1]<<t|this._arr[0]>>>16-t)&65535,this._arr[0]=this._arr[0]<<t&65535),this}shiftRightUnsigned(e){if(e===0)return this;if(e>=64)return this.toZero();let t=e%16,r=Math.floor(e/16);return r>0&&(this._arr[0]=this._arr[r],this._arr[1]=r>2?0:this._arr[1+r],this._arr[2]=r>1?0:this._arr[3],this._arr[3]=0),t>0&&(this._arr[0]=this._arr[0]>>>t|this._arr[1]<<16-t&65535,this._arr[1]=this._arr[1]>>>t|this._arr[2]<<16-t&65535,this._arr[2]=this._arr[2]>>>t|this._arr[3]<<16-t&65535,this._arr[3]=this._arr[3]>>>t),this}or(e){return this._arr[0]|=e._arr[0],this._arr[1]|=e._arr[1],this._arr[2]|=e._arr[2],this._arr[3]|=e._arr[3],this}xor(e){return this._arr[0]^=e._arr[0],this._arr[1]^=e._arr[1],this._arr[2]^=e._arr[2],this._arr[3]^=e._arr[3],this}clone(){return new n(this._arr[0],this._arr[1],this._arr[2],this._arr[3])}multiply(e){let t=!1;if(this.isZero()||e.isZero())return this.toZero();this.isNegative()&&(this.negate(),t=!t),e.isNegative()&&(e=e.clone().negate(),t=!t);let r=0,i=0,s=0,o=0;return o+=this._arr[0]*e._arr[0],s+=o>>>16,s+=this._arr[1]*e._arr[0],i+=s>>>16,s&=65535,s+=this._arr[0]*e._arr[1],i+=s>>>16,i+=this._arr[2]*e._arr[0],r+=i>>>16,i&=65535,i+=this._arr[1]*e._arr[1],r+=i>>>16,i&=65535,i+=this._arr[0]*e._arr[2],r+=i>>>16,r+=this._arr[3]*e._arr[0]+this._arr[2]*e._arr[1]+this._arr[1]*e._arr[2]+this._arr[0]*e._arr[3],this._arr[0]=o&65535,this._arr[1]=s&65535,this._arr[2]=i&65535,this._arr[3]=r&65535,t&&this.negate(),this}toZero(){return this._arr[3]=this._arr[2]=this._arr[1]=this._arr[0]=0,this}isZero(){return this._arr[3]===0&&this._arr[2]===0&&this._arr[1]===0&&this._arr[0]===0}isNegative(){return(this._arr[3]&32768)>0}negate(){return this.not().add(n.one)}equals(e){return e instanceof n?this._arr[0]===e._arr[0]&&this._arr[1]===e._arr[1]&&this._arr[2]===e._arr[2]&&this._arr[3]===e._arr[3]:!1}toImmutable(){return C_.fromBits(this.getLowBitsUnsigned(),this.getHighBitsUnsigned(),!1)}static fromNumber(e){if(isNaN(e)||!isFinite(e))return new n;if(e<0)return n.fromNumber(-e).negate();let t=e%jo,r=e/jo;return n.fromBits(t,r)}static fromBits(e,t){return new n(e,e>>>16,t,t>>>16)}static fromString(e,t){if(typeof e!="string")throw new Error("String format is not valid: "+e);if(e.length===0)throw Error("number format error: empty string");if(e==="NaN"||e==="Infinity"||e==="+Infinity"||e==="-Infinity")return new n;if(t=t||10,t<2||t>36)throw Error("radix out of range: "+t);let r;if((r=e.indexOf("-"))>0)throw Error('number format error: interior "-" character: '+e);if(r===0)return n.fromString(e.substring(1),t).negate();let i=n.fromNumber(Math.pow(t,8)),s=new n;for(let o=0;o<e.length;o+=8){let a=Math.min(8,e.length-o),c=parseInt(e.substring(o,o+a),t);if(a<8){let u=n.fromNumber(Math.pow(t,a));s.multiply(u).add(n.fromNumber(c));break}s.multiply(i),s.add(n.fromNumber(c))}return s}};Cr.one=new Cr(1,0,0,0);rf.exports=Cr});var xr=C(Un=>{"use strict";var Yo=H(),sf=require("util"),x_=Yo.dataTypes.getByName("bigint"),b_=Yo.dataTypes.getByName("varint"),v_=Yo.dataTypes.getByName("blob"),kn=class{constructor(e){this._value=e}getType(){throw new Error("You must implement a getType function for this Token instance")}getValue(){return this._value}toString(){return this._value.toString()}compare(e){return this._value.compare(e._value)}equals(e){return this.compare(e)===0}inspect(){return this.constructor.name+" { "+this.toString()+" }"}},Wo=class extends kn{constructor(e){super(e)}getType(){return x_}},$o=class extends kn{constructor(e){super(e)}getType(){return b_}},Qo=class extends kn{constructor(e){super(e)}getType(){return v_}toString(){return this._value.toString("hex").toUpperCase()}},Zo=class n{constructor(e,t,r){this.start=e,this.end=t,Object.defineProperty(this,"_tokenizer",{value:r,enumerable:!1})}splitEvenly(e){if(e<1)throw new Error(sf.format("numberOfSplits (%d) must be greater than 0.",e));if(this.isEmpty())throw new Error("Can't split empty range "+this.toString());let t=[],r=this._tokenizer.split(this.start,this.end,e),i=this.start,s;for(let o=0;o<r.length;o++)s=r[o],t.push(new n(i,s,this._tokenizer)),i=s;return t.push(new n(i,this.end,this._tokenizer)),t}isEmpty(){return this.start.equals(this.end)&&!this.start.equals(this._tokenizer.minToken())}isWrappedAround(){return this.start.compare(this.end)>0&&!this.end.equals(this._tokenizer.minToken())}unwrap(){return this.isWrappedAround()?[new n(this.start,this._tokenizer.minToken(),this._tokenizer),new n(this._tokenizer.minToken(),this.end,this._tokenizer)]:[this]}contains(e){if(this.isEmpty())return!1;let t=this._tokenizer.minToken();if(this.end.equals(t))return this.start.equals(t)||e.equals(t)?!0:e.compare(this.start)>0;let r=e.compare(this.start)>0,i=e.compare(this.end)<=0;return this.isWrappedAround()?r||i:r&&i}equals(e){return e===this?!0:e instanceof n?this.compare(e)===0:!1}compare(e){let t=this.start.compare(e.start);return t!==0?t:this.end.compare(e.end)}toString(){return sf.format("]%s, %s]",this.start.toString(),this.end.toString())}};Un.Token=kn;Un.TokenRange=Zo;Un.ByteOrderedToken=Qo;Un.Murmur3Token=Wo;Un.RandomToken=$o});var af=C(br=>{"use strict";var Xo=O(),of=Ft(),N_=/^[-+]?(\d{1,6})(?:-(\d{1,2}))?(?:-(\d{1,2}))?(?:T(\d{1,2}?)?(?::(\d{1,2}))?(?::(\d{1,2})(?:\.(\d{1,3}))?)?)?Z?$/,A_=/^\[(.+?) TO (.+)]$/,Fe=Object.freeze(new se(null,-1)),Re={singleValue:0,closedRange:1,openRangeHigh:2,openRangeLow:3,openBoth:4,openSingle:5},J={year:0,month:1,day:2,hour:3,minute:4,second:5,millisecond:6};function We(n,e){if(!n)throw new TypeError("The lower boundaries must be defined");this.lowerBound=n,this.upperBound=e||null,this.upperBound===null?this.lowerBound!==Fe?this._type=Re.singleValue:this._type=Re.openSingle:this.lowerBound!==Fe?this._type=this.upperBound!==Fe?Re.closedRange:Re.openRangeHigh:this._type=this.upperBound!==Fe?Re.openRangeLow:Re.openBoth}We.prototype.equals=function(n){return n instanceof We?n.lowerBound.equals(this.lowerBound)&&(n.upperBound?n.upperBound.equals(this.upperBound):!this.upperBound):!1};We.prototype.toString=function(){return this.upperBound===null?this.lowerBound.toString():"["+this.lowerBound.toString()+" TO "+this.upperBound.toString()+"]"};We.prototype.toBuffer=function(){if(this._type===Re.openBoth||this._type===Re.openSingle)return Xo.allocBufferFromArray([this._type]);let n,e=0;if(this._type!==Re.closedRange){let t=this._type!==Re.openRangeLow?this.lowerBound:this.upperBound;return n=Xo.allocBufferUnsafe(10),n.writeUInt8(this._type,e++),e=Jo(t.date,n,e),n.writeUInt8(t.precision,e),n}return n=Xo.allocBufferUnsafe(19),n.writeUInt8(this._type,e++),e=Jo(this.lowerBound.date,n,e),n.writeUInt8(this.lowerBound.precision,e++),e=Jo(this.upperBound.date,n,e),n.writeUInt8(this.upperBound.precision,e),n};We.fromString=function(n){let e=A_.exec(n);return e?new We(se.toLowerBound(se.fromString(e[1])),se.toUpperBound(se.fromString(e[2]))):new We(se.toLowerBound(se.fromString(n)))};We.fromBuffer=function(n){if(n.length===0)throw new TypeError("DateRange serialized value must have at least 1 byte");let e=n.readUInt8(0);if(e===Re.openBoth)return new We(Fe,Fe);if(e===Re.openSingle)return new We(Fe);let t=1,r,i,s=null;if(e!==Re.closedRange)return r=ea(n,t),t+=8,i=new se(r,n.readUInt8(t)),e===Re.openRangeLow?(s=i,i=Fe):s=e===Re.openRangeHigh?Fe:null,new We(i,s);r=ea(n,t),t+=8,i=new se(r,n.readUInt8(t++));let o=ea(n,t);return t+=8,s=new se(o,n.readUInt8(t)),new We(i,s)};function Jo(n,e,t){let r=of.fromNumber(n.getTime());return e.writeUInt32BE(r.getHighBitsUnsigned(),t),e.writeUInt32BE(r.getLowBitsUnsigned(),t+4),t+8}function ea(n,e){let t=new of(n.readInt32BE(e+4),n.readInt32BE(e));return new Date(t.toNumber())}function se(n,e){this.date=n,this.precision=e}se.prototype.toString=function(){if(this.precision===-1)return"*";let n=0,e=this.date.toISOString(),t,r;for(t=4;t<e.length&&n<=this.precision;t++){if(r=e.charAt(t),n===J.day&&r==="T"){n=J.hour;continue}if(n>=J.hour&&r===":"||r==="."){n++;continue}n<J.day&&r==="-"&&n++}let i=0,s=e.charAt(0),o="",a=4;if(s==="+"||s==="-")for(o=s,s==="-"&&(a=3),i=1;i<a&&e.charAt(i)==="0";i++);return this.precision!==J.millisecond&&t--,o+e.substring(i,t)};se.prototype.equals=function(n){return!(n instanceof se)||n.precision!==this.precision?!1:I_(n.date,this.date)};function I_(n,e){let t=n?n.getTime():null,r=e?e.getTime():null;return t===r}se.prototype.isUnbounded=function(){return this.precision===-1};se.fromString=function(n){if(!n)return null;if(n==="*")return Fe;let e=N_.exec(n);if(!e)throw TypeError("String provided is not a valid date "+n);if(e[7]!==void 0&&e[5]===void 0)throw new TypeError("String representation of the date contains the milliseconds portion but not the seconds: "+n);let t=new ta(n.charAt(0)==="-");for(let r=1;r<e.length;r++)t.set(r-1,e[r],n);return t.build()};se.unbounded=Fe;se.toLowerBound=function(n){if(n===Fe)return n;let e=new Date(n.date.getTime());switch(n.precision){case J.year:e.setUTCMonth(0);case J.month:e.setUTCDate(1);case J.day:e.setUTCHours(0);case J.hour:e.setUTCMinutes(0);case J.minute:e.setUTCSeconds(0);case J.second:e.setUTCMilliseconds(0)}return new se(e,n.precision)};se.toUpperBound=function(n){if(n===Fe)return n;let e=new Date(n.date.getTime());switch(n.precision){case J.year:e.setUTCMonth(11);case J.month:e.setUTCMonth(e.getUTCMonth()+1,0);case J.day:e.setUTCHours(23);case J.hour:e.setUTCMinutes(59);case J.minute:e.setUTCSeconds(59);case J.second:e.setUTCMilliseconds(999)}return new se(e,n.precision)};function ta(n){this._sign=n?-1:1,this._index=0,this._values=new Int32Array(7)}ta.prototype.set=function(n,e,t){if(e===void 0)return;if(n>6)throw new TypeError("Index out of bounds: "+n);n>this._index&&(this._index=n);let r=+e;switch(n){case J.month:if(r<1||r>12)throw new TypeError("Month portion is not valid for date: "+t);break;case J.day:if(r<1||r>31)throw new TypeError("Day portion is not valid for date: "+t);break;case J.hour:if(r>23)throw new TypeError("Hour portion is not valid for date: "+t);break;case J.minute:case J.second:if(r>59)throw new TypeError("Minute/second portion is not valid for date: "+t);break;case J.millisecond:if(r>999)throw new TypeError("Millisecond portion is not valid for date: "+t);break}this._values[n]=r};ta.prototype.build=function(){let n=new Date(0),e=this._values[1];return e&&e--,n.setUTCFullYear(this._sign*this._values[0],e,this._values[2]||1),n.setUTCHours(this._values[3],this._values[4],this._values[5],this._values[6]),new se(n,this._index)};br.unbounded=Fe;br.dateRangePrecision=J;br.DateRange=We;br.DateRangeBound=se});var ra=C(vi=>{"use strict";var na=af();vi.DateRange=na.DateRange;vi.DateRangeBound=na.DateRangeBound;vi.dateRangePrecision=na.dateRangePrecision});var vr=C((Ix,cf)=>{"use strict";var P_={0:"BE",1:"LE"};function Ot(){}Ot.types={Point2D:1,LineString:2,Polygon:3};Ot.getEndianness=function(n){let e=P_[n.toString()];if(typeof e>"u")throw new TypeError("Invalid endianness with code "+n);return e};Ot.readInt32=function(n,e,t){return e==="BE"?n.readInt32BE(t,!0):n.readInt32LE(t,!0)};Ot.readDouble=function(n,e,t){return e==="BE"?n.readDoubleBE(t,!0):n.readDoubleLE(t,!0)};Ot.prototype.writeInt32=function(n,e,t){return this.useBESerialization()?e.writeInt32BE(n,t,!0):e.writeInt32LE(n,t,!0)};Ot.prototype.writeDouble=function(n,e,t){return this.useBESerialization()?e.writeDoubleBE(n,t,!0):e.writeDoubleLE(n,t,!0)};Ot.prototype.writeEndianness=function(n,e){return this.useBESerialization()?n.writeInt8(0,e,!0):n.writeInt8(1,e,!0)};Ot.prototype.useBESerialization=function(){throw new Error("Not Implemented")};cf.exports=Ot});var Ni=C((Px,lf)=>{"use strict";var uf=require("util"),B_=O(),an=vr();function rt(n,e){if(typeof n!="number"||typeof e!="number")throw new TypeError("X and Y must be numbers");if(isNaN(n)||isNaN(e))throw new TypeError("X and Y must be numbers");this.x=n,this.y=e}uf.inherits(rt,an);rt.fromBuffer=function(n){if(!n||n.length!==21)throw new TypeError("2D Point buffer should contain 21 bytes");let e=an.getEndianness(n.readInt8(0,!0));if(an.readInt32(n,e,1)!==an.types.Point2D)throw new TypeError("Binary representation was not a point");return new rt(an.readDouble(n,e,5),an.readDouble(n,e,13))};rt.fromString=function(n){let t=/^POINT\s?\(([-0-9.]+) ([-0-9.]+)\)$/g.exec(n);if(!t||t.length!==3)throw new TypeError("2D Point WTK should contain 2 coordinates");return new rt(parseFloat(t[1]),parseFloat(t[2]))};rt.prototype.toBuffer=function(){let n=B_.allocBufferUnsafe(21);return this.writeEndianness(n,0),this.writeInt32(an.types.Point2D,n,1),this.writeDouble(this.x,n,5),this.writeDouble(this.y,n,13),n};rt.prototype.equals=function(n){return n instanceof rt?this.x===n.x&&this.y===n.y:!1};rt.prototype.toString=function(){return uf.format("POINT (%d %d)",this.x,this.y)};rt.prototype.useBESerialization=function(){return!1};rt.prototype.toJSON=function(){return{type:"Point",coordinates:[this.x,this.y]}};lf.exports=rt});var ia=C((Bx,df)=>{"use strict";var hf=require("util"),O_=O(),Gt=vr(),ff=Ni();function ke(n){let e=Array.prototype.slice.call(arguments);if(e.length===1&&Array.isArray(e)&&Array.isArray(e[0])&&(e=e[0]),e.length===1)throw new TypeError("LineString can be either empty or contain 2 or more points");this.points=Object.freeze(e)}hf.inherits(ke,Gt);ke.fromBuffer=function(n){if(!n||n.length<9)throw new TypeError("A linestring buffer should contain at least 9 bytes");let e=Gt.getEndianness(n.readInt8(0,!0)),t=1;if(Gt.readInt32(n,e,t)!==Gt.types.LineString)throw new TypeError("Binary representation was not a LineString");t+=4;let r=Gt.readInt32(n,e,t);if(t+=4,n.length!==t+r*16)throw new TypeError(hf.format("Length of the buffer does not match %d !== %d",n.length,t+r*8));let i=new Array(r);for(let s=0;s<r;s++)i[s]=new ff(Gt.readDouble(n,e,t),Gt.readDouble(n,e,t+8)),t+=16;return new ke(i)};ke.fromString=function(n){let t=/^LINESTRING ?\(([-0-9. ,]+)\)+$/g.exec(n);if(!t||t.length!==2)throw new TypeError("Invalid WKT: "+n);let r=ke.parseSegments(t[1]);return new ke(r)};ke.parseSegments=function(n){let e=[],t=n.split(",");for(let r=0;r<t.length;r++){let i=t[r].trim();if(i.length===0)throw new TypeError("Invalid WKT segment: "+n);let s=i.split(" ").filter(function(o){return o.trim().length>0});if(s.length!==2)throw new TypeError("Invalid WKT segment: "+n);e.push(new ff(parseFloat(s[0]),parseFloat(s[1])))}return e};ke.prototype.toBuffer=function(){let n=O_.allocBufferUnsafe(9+this.points.length*16);this.writeEndianness(n,0);let e=1;return this.writeInt32(Gt.types.LineString,n,e),e+=4,this.writeInt32(this.points.length,n,e),e+=4,this.points.forEach(function(t){this.writeDouble(t.x,n,e),this.writeDouble(t.y,n,e+8),e+=16},this),n};ke.prototype.equals=function(n){if(!(n instanceof ke)||this.points.length!==n.points.length)return!1;for(let e=0;e<this.points.length;e++)if(!this.points[e].equals(n.points[e]))return!1;return!0};ke.prototype.toString=function(){return this.points.length===0?"LINESTRING EMPTY":"LINESTRING ("+this.points.map(function(n){return n.x+" "+n.y}).join(", ")+")"};ke.prototype.useBESerialization=function(){return!1};ke.prototype.toJSON=function(){return{type:"LineString",coordinates:this.points.map(function(n){return[n.x,n.y]})}};df.exports=ke});var yf=C((Ox,mf)=>{"use strict";var pf=require("util"),R_=O(),Rt=vr(),L_=Ni(),q_=ia();function it(n){let e=Array.prototype.slice.call(arguments);this.rings=Object.freeze(e)}pf.inherits(it,Rt);it.fromBuffer=function(n){if(!n||n.length<9)throw new TypeError("A Polygon buffer should contain at least 9 bytes");let e=Rt.getEndianness(n.readInt8(0,!0)),t=1;if(Rt.readInt32(n,e,t)!==Rt.types.Polygon)throw new TypeError("Binary representation was not a Polygon");t+=4;let r=Rt.readInt32(n,e,t);t+=4;let i=new Array(r);for(let s=0;s<r;s++){let o=Rt.readInt32(n,e,t);if(t+=4,n.length<t+o*16)throw new TypeError(pf.format("Length of the buffer does not match"));let a=new Array(o);for(let c=0;c<o;c++)a[c]=new L_(Rt.readDouble(n,e,t),Rt.readDouble(n,e,t+8)),t+=16;i[s]=a}return gf(i)};it.fromString=function(n){let t=/^POLYGON ?\((\(.*\))\)$/g.exec(n);function r(a){if(a)throw new TypeError("Invalid WKT: "+n)}r(!t||t.length!==2);let i=t[1],s=[],o=null;for(let a=0;a<i.length;a++){let c=i[a];if(c==="("){r(o!==null),o=a+1;continue}if(c===")"){r(o===null),s.push(i.substring(o,a)),o=null;continue}r(o===null&&c!==" "&&c!==",")}return gf(s.map(q_.parseSegments))};function gf(n){function e(){return it.apply(this,n)}return e.prototype=it.prototype,new e}it.prototype.toBuffer=function(){let n=0;this.rings.forEach(function(r){n+=4+r.length*16},this);let e=R_.allocBufferUnsafe(9+n);this.writeEndianness(e,0);let t=1;return this.writeInt32(Rt.types.Polygon,e,t),t+=4,this.writeInt32(this.rings.length,e,t),t+=4,this.rings.forEach(function(r){this.writeInt32(r.length,e,t),t+=4,r.forEach(function(i){this.writeDouble(i.x,e,t),this.writeDouble(i.y,e,t+8),t+=16},this)},this),e};it.prototype.equals=function(n){if(!(n instanceof it)||this.rings.length!==n.rings.length)return!1;for(let e=0;e<this.rings.length;e++){let t=this.rings[e],r=n.rings[e];if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(!t[e].equals(r[e]))return!1}return!0};it.prototype.useBESerialization=function(){return!1};it.prototype.toString=function(){if(this.rings.length===0)return"POLYGON EMPTY";let n="";return this.rings.forEach(function(e,t){t>0&&(n+=", "),n+="("+e.map(function(r){return r.x+" "+r.y}).join(", ")+")"}),"POLYGON ("+n+")"};it.prototype.toJSON=function(){return{type:"Polygon",coordinates:this.rings.map(function(n){return n.map(function(e){return[e.x,e.y]})})}};mf.exports=it});var Ai=C(Nr=>{"use strict";Nr.Geometry=vr();Nr.LineString=ia();Nr.Point=Ni();Nr.Polygon=yf()});var Bi=C((qx,Bf)=>{"use strict";var oe=require("util"),k=H(),T=k.dataTypes,cn=k.Long,Mn=k.Integer,Vn=k.BigDecimal,D_=Go(),Z=O(),wf=xr(),{DateRange:bf}=ra(),Pi=Ai(),_f=Gs(),F_=Pi.Geometry,vf=Pi.LineString,Nf=Pi.Point,Af=Pi.Polygon,k_=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i,zn={int16Zero:Z.allocBufferFromArray([0,0]),int32Zero:Z.allocBufferFromArray([0,0,0,0]),int8Zero:Z.allocBufferFromArray([0]),int8One:Z.allocBufferFromArray([1]),int8MaxValue:Z.allocBufferFromArray([255])},Kn=typeof BigInt<"u",Ef=Kn?BigInt(32):null,Tf=Kn?BigInt(8):null,Ii=Kn?BigInt(0):null,Sf=Kn?BigInt(-1):null,U_=Kn?BigInt(4294967295):null,sa=Kn?BigInt(255):null,Q=Object.freeze({list:"org.apache.cassandra.db.marshal.ListType",set:"org.apache.cassandra.db.marshal.SetType",map:"org.apache.cassandra.db.marshal.MapType",udt:"org.apache.cassandra.db.marshal.UserType",tuple:"org.apache.cassandra.db.marshal.TupleType",frozen:"org.apache.cassandra.db.marshal.FrozenType",reversed:"org.apache.cassandra.db.marshal.ReversedType",composite:"org.apache.cassandra.db.marshal.CompositeType",empty:"org.apache.cassandra.db.marshal.EmptyType",collection:"org.apache.cassandra.db.marshal.ColumnToCollectionType"}),we=Object.freeze({frozen:"frozen",list:"list",set:"set",map:"map",tuple:"tuple",empty:"empty",duration:"duration",vector:"vector"}),aa=Object.freeze({"org.apache.cassandra.db.marshal.UTF8Type":T.varchar,"org.apache.cassandra.db.marshal.AsciiType":T.ascii,"org.apache.cassandra.db.marshal.UUIDType":T.uuid,"org.apache.cassandra.db.marshal.TimeUUIDType":T.timeuuid,"org.apache.cassandra.db.marshal.Int32Type":T.int,"org.apache.cassandra.db.marshal.BytesType":T.blob,"org.apache.cassandra.db.marshal.FloatType":T.float,"org.apache.cassandra.db.marshal.DoubleType":T.double,"org.apache.cassandra.db.marshal.BooleanType":T.boolean,"org.apache.cassandra.db.marshal.InetAddressType":T.inet,"org.apache.cassandra.db.marshal.SimpleDateType":T.date,"org.apache.cassandra.db.marshal.TimeType":T.time,"org.apache.cassandra.db.marshal.ShortType":T.smallint,"org.apache.cassandra.db.marshal.ByteType":T.tinyint,"org.apache.cassandra.db.marshal.DateType":T.timestamp,"org.apache.cassandra.db.marshal.TimestampType":T.timestamp,"org.apache.cassandra.db.marshal.LongType":T.bigint,"org.apache.cassandra.db.marshal.DecimalType":T.decimal,"org.apache.cassandra.db.marshal.IntegerType":T.varint,"org.apache.cassandra.db.marshal.CounterColumnType":T.counter}),Lx=i0(aa),M_=Object.keys(aa).reduce(function(n,e){return e.length>n?e.length:n},0),he=Object.freeze({duration:"org.apache.cassandra.db.marshal.DurationType",lineString:"org.apache.cassandra.db.marshal.LineStringType",point:"org.apache.cassandra.db.marshal.PointType",polygon:"org.apache.cassandra.db.marshal.PolygonType",dateRange:"org.apache.cassandra.db.marshal.DateRangeType",vector:"org.apache.cassandra.db.marshal.VectorType"}),Cf=Z.allocBufferFromArray([255,255,255,255]),xf=Z.allocBufferFromArray([255,255,255,254]),V_=new Set([T.text,T.ascii,T.varchar,T.custom,T.blob]);function Hn(n,e){this.encodingOptions=e.encoding||Z.emptyObject,z_.call(this),this.setProtocolVersion(n),H_.call(this),this.encodingOptions.copyBuffer?this.handleBuffer=G_:this.handleBuffer=W_}function z_(){this.setProtocolVersion=function(t){this.protocolVersion=t,this.decodeCollectionLength=$_,this.getLengthBuffer=j_,this.collectionLengthSize=4,k.protocolVersion.uses4BytesCollectionLength(this.protocolVersion)||(this.decodeCollectionLength=Q_,this.getLengthBuffer=K_,this.collectionLengthSize=2)};let n={[he.duration]:If,[he.lineString]:Z_,[he.point]:X_,[he.polygon]:e0,[he.dateRange]:n0},e={[he.duration]:Pf,[he.lineString]:Y_,[he.point]:J_,[he.polygon]:t0,[he.dateRange]:r0};this.decodeBlob=function(t){return this.handleBuffer(t)},this.decodeCustom=function(t,r){if(!r)return this.handleBuffer(t);if("customTypeName"in r&&r.customTypeName==="vector")return this.decodeVector(t,r);if(typeof r.info=="string"&&r.info.startsWith(he.vector)){let s=this.parseFqTypeName(r.info);return this.decodeVector(t,s)}let i=n[r.info];return i?i.call(this,t):this.handleBuffer(t)},this.decodeUtf8String=function(t){return t.toString("utf8")},this.decodeAsciiString=function(t){return t.toString("ascii")},this.decodeBoolean=function(t){return!!t.readUInt8(0)},this.decodeDouble=function(t){return t.readDoubleBE(0)},this.decodeFloat=function(t){return t.readFloatBE(0)},this.decodeInt=function(t){return t.readInt32BE(0)},this.decodeSmallint=function(t){return t.readInt16BE(0)},this.decodeTinyint=function(t){return t.readInt8(0)},this._decodeCqlLongAsLong=function(t){return cn.fromBuffer(t)},this._decodeCqlLongAsBigInt=function(t){return BigInt.asIntN(64,BigInt(t.readUInt32BE(0))<<Ef|BigInt(t.readUInt32BE(4)))},this.decodeLong=this.encodingOptions.useBigIntAsLong?this._decodeCqlLongAsBigInt:this._decodeCqlLongAsLong,this._decodeVarintAsInteger=function(t){return Mn.fromBuffer(t)},this._decodeVarintAsBigInt=function(r){let i=Ii;if(r[0]<=127)for(let s=0;s<r.length;s++){let o=BigInt(r[r.length-1-s]);i=i|o<<BigInt(s*8)}else{for(let s=0;s<r.length;s++){let o=BigInt(r[r.length-1-s]);i=i|(~o&sa)<<BigInt(s*8)}i=~i}return i},this.decodeVarint=this.encodingOptions.useBigIntAsVarint?this._decodeVarintAsBigInt:this._decodeVarintAsInteger,this.decodeDecimal=function(t){return Vn.fromBuffer(t)},this.decodeTimestamp=function(t){return new Date(this._decodeCqlLongAsLong(t).toNumber())},this.decodeDate=function(t){return k.LocalDate.fromBuffer(t)},this.decodeTime=function(t){return k.LocalTime.fromBuffer(t)},this.decodeList=function(t,r){let i=r.info,s=this.decodeCollectionLength(t,0),o=this.collectionLengthSize,a=new Array(s);for(let c=0;c<s;c++){let u=this.decodeCollectionLength(t,o);o+=this.collectionLengthSize,a[c]=this.decode(t.slice(o,o+u),i),o+=u}return a},this.decodeSet=function(t,r){let i=this.decodeList(t,r);if(this.encodingOptions.set){let s=this.encodingOptions.set;return new s(i)}return i},this.decodeMap=function(t,r){let i=r.info,s,o=this.decodeCollectionLength(t,0),a=this.collectionLengthSize,c=this;function u(f,g){for(let S=0;S<o;S++){let p=c.decodeCollectionLength(t,a);a+=c.collectionLengthSize;let y=c.decode(t.slice(a,a+p),i[0]);a+=p;let _=c.decodeCollectionLength(t,a);if(a+=c.collectionLengthSize,_<0){f.call(g,y,null);continue}let w=c.decode(t.slice(a,a+_),i[1]);a+=_,f.call(g,y,w)}}if(this.encodingOptions.map){let f=this.encodingOptions.map;s=new f,u(s.set,s)}else s={},u(function(f,g){s[f]=g});return s},this.decodeUuid=function(t){return new k.Uuid(this.handleBuffer(t))},this.decodeTimeUuid=function(t){return new k.TimeUuid(this.handleBuffer(t))},this.decodeInet=function(t){return new k.InetAddress(this.handleBuffer(t))},this.decodeUdt=function(t,r){let i=r.info,s={},o=0;for(let a=0;a<i.fields.length&&o<t.length;a++){let c=t.readInt32BE(o);o+=4;let u=i.fields[a];if(c<0){s[u.name]=null;continue}s[u.name]=this.decode(t.slice(o,o+c),u.type),o+=c}return s},this.decodeTuple=function(t,r){let i=r.info,s=new Array(i.length),o=0;for(let a=0;a<i.length&&o<t.length;a++){let c=t.readInt32BE(o);if(o+=4,c<0){s[a]=null;continue}s[a]=this.decode(t.slice(o,o+c),i[a]),o+=c}return k.Tuple.fromArray(s)},this.encodeFloat=function(t){if(typeof t=="string"&&(t=parseFloat(t),Number.isNaN(t)))throw new TypeError(`Expected string representation of a number, obtained ${oe.inspect(t)}`);if(typeof t!="number")throw new TypeError("Expected Number, obtained "+oe.inspect(t));let r=Z.allocBufferUnsafe(4);return r.writeFloatBE(t,0),r},this.encodeDouble=function(t){if(typeof t=="string"&&(t=parseFloat(t),Number.isNaN(t)))throw new TypeError(`Expected string representation of a number, obtained ${oe.inspect(t)}`);if(typeof t!="number")throw new TypeError("Expected Number, obtained "+oe.inspect(t));let r=Z.allocBufferUnsafe(8);return r.writeDoubleBE(t,0),r},this.encodeTimestamp=function(t){let r=t;if(typeof t=="string"&&(t=new Date(t)),t instanceof Date&&(t=t.getTime(),isNaN(t)))throw new TypeError("Invalid date: "+r);return this.encodingOptions.useBigIntAsLong&&(t=BigInt(t)),this.encodeLong(t)},this.encodeDate=function(t){let r=t;try{typeof t=="string"&&(t=k.LocalDate.fromString(t)),t instanceof Date&&(t=k.LocalDate.fromDate(t))}catch(i){throw new TypeError("LocalDate could not be parsed "+i)}if(!(t instanceof k.LocalDate))throw new TypeError("Expected Date/String/LocalDate, obtained "+oe.inspect(r));return t.toBuffer()},this.encodeTime=function(t){let r=t;try{typeof t=="string"&&(t=k.LocalTime.fromString(t))}catch(i){throw new TypeError("LocalTime could not be parsed "+i)}if(!(t instanceof k.LocalTime))throw new TypeError("Expected String/LocalTime, obtained "+oe.inspect(r));return t.toBuffer()},this.encodeUuid=function(t){if(typeof t=="string")try{t=k.Uuid.fromString(t).getBuffer()}catch(r){throw new TypeError(r.message)}else if(t instanceof k.Uuid)t=t.getBuffer();else throw new TypeError("Not a valid Uuid, expected Uuid/String/Buffer, obtained "+oe.inspect(t));return t},this.encodeInet=function(t){if(typeof t=="string"&&(t=k.InetAddress.fromString(t)),t instanceof k.InetAddress&&(t=t.getBuffer()),!(t instanceof Buffer))throw new TypeError("Not a valid Inet, expected InetAddress/Buffer, obtained "+oe.inspect(t));return t},this._encodeBigIntFromLong=function(t){typeof t=="number"?t=cn.fromNumber(t):typeof t=="string"&&(t=cn.fromString(t));let r=null;if(t instanceof cn?r=cn.toBuffer(t):t instanceof D_&&(r=cn.toBuffer(t.toImmutable())),r===null)throw new TypeError("Not a valid bigint, expected Long/Number/String/Buffer, obtained "+oe.inspect(t));return r},this._encodeBigIntFromBigInt=function(t){if(typeof t=="string"&&(t=BigInt(t)),typeof t!="bigint")throw new TypeError("Not a valid BigInt value, obtained "+oe.inspect(t));let r=Z.allocBufferUnsafe(8);return r.writeUInt32BE(Number(t>>Ef)>>>0,0),r.writeUInt32BE(Number(t&U_),4),r},this.encodeLong=this.encodingOptions.useBigIntAsLong?this._encodeBigIntFromBigInt:this._encodeBigIntFromLong,this._encodeVarintFromInteger=function(t){typeof t=="number"&&(t=Mn.fromNumber(t)),typeof t=="string"&&(t=Mn.fromString(t));let r=null;if(t instanceof Buffer&&(r=t),t instanceof Mn&&(r=Mn.toBuffer(t)),r===null)throw new TypeError("Not a valid varint, expected Integer/Number/String/Buffer, obtained "+oe.inspect(t));return r},this._encodeVarintFromBigInt=function(t){if(typeof t=="string"&&(t=BigInt(t)),typeof t!="bigint")throw new TypeError("Not a valid varint, expected BigInt, obtained "+oe.inspect(t));if(t===Ii)return zn.int8Zero;if(t===Sf)return zn.int8MaxValue;let r=[];if(t>Ii){for(;t!==Ii;)r.unshift(Number(t&sa)),t=t>>Tf;r[0]>127&&r.unshift(0)}else{for(;t!==Sf;)r.unshift(Number(t&sa)),t=t>>Tf;r[0]<=127&&r.unshift(255)}return Z.allocBufferFromArray(r)},this.encodeVarint=this.encodingOptions.useBigIntAsVarint?this._encodeVarintFromBigInt:this._encodeVarintFromInteger,this.encodeDecimal=function(t){typeof t=="number"?t=Vn.fromNumber(t):typeof t=="string"&&(t=Vn.fromString(t));let r=null;if(t instanceof Vn)r=Vn.toBuffer(t);else throw new TypeError("Not a valid varint, expected BigDecimal/Number/String/Buffer, obtained "+oe.inspect(t));return r},this.encodeString=function(t,r){if(typeof t!="string")throw new TypeError("Not a valid text value, expected String obtained "+oe.inspect(t));return Z.allocBufferFromString(t,r)},this.encodeUtf8String=function(t){return this.encodeString(t,"utf8")},this.encodeAsciiString=function(t){return this.encodeString(t,"ascii")},this.encodeBlob=function(t){if(!(t instanceof Buffer))throw new TypeError("Not a valid blob, expected Buffer obtained "+oe.inspect(t));return t},this.encodeCustom=function(t,r){if("customTypeName"in r&&r.customTypeName==="vector")return this.encodeVector(t,r);if(typeof r.info=="string"&&r.info.startsWith(he.vector)){let s=this.parseFqTypeName(r.info);return this.encodeVector(t,s)}let i=e[r.info];if(i)return i.call(this,t);throw new TypeError("No encoding handler found for type "+r)},this.encodeBoolean=function(t){return t?zn.int8One:zn.int8Zero},this.encodeInt=function(t){if(isNaN(t))throw new TypeError("Expected Number, obtained "+oe.inspect(t));let r=Z.allocBufferUnsafe(4);return r.writeInt32BE(t,0),r},this.encodeSmallint=function(t){if(isNaN(t))throw new TypeError("Expected Number, obtained "+oe.inspect(t));let r=Z.allocBufferUnsafe(2);return r.writeInt16BE(t,0),r},this.encodeTinyint=function(t){if(isNaN(t))throw new TypeError("Expected Number, obtained "+oe.inspect(t));let r=Z.allocBufferUnsafe(1);return r.writeInt8(t,0),r},this.encodeList=function(t,r){let i=r.info;if(!Array.isArray(t))throw new TypeError("Not a valid list value, expected Array obtained "+oe.inspect(t));if(t.length===0)return null;let s=[];s.push(this.getLengthBuffer(t));for(let o=0;o<t.length;o++){let a=t[o];if(a===null||typeof a>"u"||a===k.unset)throw new TypeError("A collection can't contain null or unset values");let c=this.encode(a,i);s.push(this.getLengthBuffer(c)),s.push(c)}return Buffer.concat(s)},this.encodeSet=function(t,r){if(this.encodingOptions.set&&t instanceof this.encodingOptions.set){let i=[];return t.forEach(function(s){i.push(s)}),this.encodeList(i,r)}return this.encodeList(t,r)},this.encodeMap=function(t,r){let i=r.info,s=[],o=0,a=null,c=null,u=this;i&&(a=i[0],c=i[1]);function f(g,S){if(S===null||typeof S>"u"||S===k.unset)throw new TypeError("A map can't contain null or unset keys");if(g===null||typeof g>"u"||g===k.unset)throw new TypeError("A map can't contain null or unset values");let p=u.encode(S,a);s.push(u.getLengthBuffer(p)),s.push(p);let y=u.encode(g,c);s.push(u.getLengthBuffer(y)),y!==null&&s.push(y),o++}if(this.encodingOptions.map&&t instanceof this.encodingOptions.map)t.forEach(f);else for(let g in t){if(!t.hasOwnProperty(g))continue;let S=t[g];f(S,g)}return s.unshift(this.getLengthBuffer(o)),Buffer.concat(s)},this.encodeUdt=function(t,r){let i=r.info,s=[],o=0;for(let a=0;a<i.fields.length;a++){let c=i.fields[a],u=this.encode(t[c.name],c.type);if(!u){s.push(Cf),o+=4;continue}if(u===k.unset){s.push(xf),o+=4;continue}let f=Z.allocBufferUnsafe(4);f.writeInt32BE(u.length,0),s.push(f),s.push(u),o+=u.length+4}return Buffer.concat(s,o)},this.encodeTuple=function(t,r){let i=r.info,s=[],o=0,a=Math.min(i.length,t.length);for(let c=0;c<a;c++){let u=i[c],f=this.encode(t.get(c),u);if(!f){s.push(Cf),o+=4;continue}if(f===k.unset){s.push(xf),o+=4;continue}let g=Z.allocBufferUnsafe(4);g.writeInt32BE(f.length,0),s.push(g),s.push(f),o+=f.length+4}return Buffer.concat(s,o)},this.decodeVector=function(t,r){let i=r.info[0],s=r.info[1],o=this.serializationSizeIfFixed(i),a=[],c=0;for(let f=0;f<s;f++)if(o===-1){let[g,S]=Z.VIntCoding.uvintUnpack(t.subarray(c));if(c+=S,c+g>t.length)throw new TypeError("Not enough bytes to decode the vector");a[f]=this.decode(t.subarray(c,c+g),i),c+=g}else{if(c+o>t.length)throw new TypeError("Not enough bytes to decode the vector");a[f]=this.decode(t.subarray(c,c+o),i),c+=o}if(c!==t.length)throw new TypeError("Extra bytes found after decoding the vector");let u=k.getDataTypeNameByCode(i);return new _f(a,u)},this.serializationSizeIfFixed=function(t){switch(t.code){case T.bigint:return 8;case T.boolean:return 1;case T.timestamp:return 8;case T.double:return 8;case T.float:return 4;case T.int:return 4;case T.timeuuid:return 16;case T.uuid:return 16;case T.custom:if("customTypeName"in t&&t.customTypeName==="vector"){let r=this.serializationSizeIfFixed(t.info[0]);return r===-1?-1:r*t.info[1]}return-1;default:return-1}},this.encodeVector=function(t,r){if(!(t instanceof _f))throw new TypeError("Driver only supports Vector type when encoding a vector");let i=r.info[1];if(t.length!==i)throw new TypeError(`Expected vector with ${i} dimensions, observed size of ${t.length}`);if(t.length===0)throw new TypeError("Cannot encode empty array as vector");let s=this.serializationSizeIfFixed(r.info[0]),o=[];for(let a of t){let c=this.encode(a,r.info[0]);s===-1&&o.push(Z.VIntCoding.uvintPack(c.length)),o.push(c)}return Buffer.concat(o)},this.parseVectorTypeArgs=function(t,r,i){let s=r.length+1,o=t.length-(r.length+2),a=Ct(t,s,o);if(a.length===2)return{code:T.custom,info:[i.bind(this)(a[0].trim()),parseInt(a[1].trim(),10)],customTypeName:"vector"};throw new TypeError("Not a valid type "+t)},this.setRoutingKeyFromUser=function(t,r,i){let s=0,o=r.getRoutingKey();if(Array.isArray(o)){if(o.length===1){r.setRoutingKey(o[0]);return}s=0;for(let g=0;g<o.length;g++){let S=o[g];if(!S){r.setRoutingKey(null);return}s+=S.length+3}r.setRoutingKey(oa(o,s));return}if(o){if(o instanceof Buffer||o instanceof wf.Token||o instanceof wf.TokenRange)return;throw new TypeError(`Unexpected routingKey '${oe.inspect(o)}' provided. Expected Buffer, Array<Buffer>, Token, or TokenRange.`)}if(!t||t.length===0)return;let a=r.getRoutingIndexes();if(r.getRoutingNames()&&(a=r.getRoutingNames().map(g=>i[g])),!a)return;let c=[],u=r.getHints()||Z.emptyArray,f=i?g=>this.encode(t[g].value,u[g]):g=>this.encode(t[g],u[g]);try{s=this._encodeRoutingKeyParts(c,a,f)}catch{}s!==0&&r.setRoutingKey(oa(c,s))},this.setRoutingKeyFromMeta=function(t,r,i){let s=i.getRoutingIndexes();if(!s)return;let o=new Array(s.length),a=u=>{let f=t.columns[u];return this.encode(r[u],f?f.type:null)},c=0;try{c=this._encodeRoutingKeyParts(o,s,a)}catch{}c!==0&&i.setRoutingKey(oa(o,c))},this._encodeRoutingKeyParts=function(t,r,i){let s=0;for(let o=0;o<r.length;o++){let a=r[o];if(a===void 0)return 0;let c=i(a);if(c==null||c===k.unset)return 0;s+=c.length+3,t[o]=c}return s},this.parseTypeName=async function(t,r,i,s,o){i=i||0,s||(s=r.length);let a,c=!1;if(r.indexOf("'",i)===i){let S=r.substr(i+1,s-2);return{code:T.custom,info:S}}if(s||(s=r.length),r.indexOf(we.frozen,i)===i&&(i+=we.frozen.length+1,s-=we.frozen.length+2,c=!0),r.indexOf(we.list,i)===i){if(i+=we.list.length+1,s-=we.list.length+2,a=Ct(r,i,s,"<",">"),a.length!==1)throw new TypeError("Not a valid type "+r);let S=await this.parseTypeName(t,a[0],0,null,o);return{code:T.list,info:S,options:{frozen:c}}}if(r.indexOf(we.set,i)===i){if(i+=we.set.length+1,s-=we.set.length+2,a=Ct(r,i,s,"<",">"),a.length!==1)throw new TypeError("Not a valid type "+r);let S=await this.parseTypeName(t,a[0],0,null,o);return{code:T.set,info:S,options:{frozen:c}}}if(r.indexOf(we.map,i)===i){if(i+=we.map.length+1,s-=we.map.length+2,a=Ct(r,i,s,"<",">"),a.length!==2)throw new TypeError("Not a valid type "+r);let S=await this._parseChildTypes(t,a,o);return{code:T.map,info:S,options:{frozen:c}}}if(r.indexOf(we.tuple,i)===i){if(i+=we.tuple.length+1,s-=we.tuple.length+2,a=Ct(r,i,s,"<",">"),a.length<1)throw new TypeError("Not a valid type "+r);let S=await this._parseChildTypes(t,a,o);return{code:T.tuple,info:S,options:{frozen:c}}}if(r.indexOf(we.vector,i)===i){let S=this.parseVectorTypeArgs.bind(this)(r,we.vector,p=>p);return S.info[0]=await this.parseTypeName(t,S.info[0]),S}let u=r.indexOf('"',i)===i;u&&(i++,s-=2),i>0&&(r=r.substr(i,s)),u&&(r=r.replace('""','"'));let f=T[r];if(typeof f=="number")return{code:f,info:null};if(r===we.duration)return{code:T.custom,info:he.duration};if(r===we.empty)return{code:T.custom,info:"empty"};let g=await o(t,r);if(g)return{code:T.udt,info:g,options:{frozen:c}};throw new TypeError('Not a valid type "'+r+'"')},this._parseChildTypes=function(t,r,i){return Promise.all(r.map(s=>this.parseTypeName(t,s.trim(),0,null,i)))},this.parseFqTypeName=function(t,r,i){let s=!1,o=!1;r=r||0;let a;i||(i=t.length),i>Q.reversed.length&&t.indexOf(Q.reversed)===r&&(r+=Q.reversed.length+1,i-=Q.reversed.length+2,o=!0),i>Q.frozen.length&&t.indexOf(Q.frozen,r)===r&&(r+=Q.frozen.length+1,i-=Q.frozen.length+2,s=!0);let c={frozen:s,reversed:o};if(t===Q.empty)return{code:T.custom,info:"empty",options:c};if(i<=M_){r>0&&(t=t.substr(r,i));let f=aa[t];if(typeof f=="number")return{code:f,info:null,options:c};if(t===he.duration)return{code:T.duration,options:c};throw new TypeError('Not a valid type "'+t+'"')}if(t.indexOf(Q.list,r)===r){if(r+=Q.list.length+1,i-=Q.list.length+2,a=Ct(t,r,i),a.length!==1)throw new TypeError("Not a valid type "+t);let f=this.parseFqTypeName(a[0]);return{code:T.list,info:f,options:c}}if(t.indexOf(Q.set,r)===r){if(r+=Q.set.length+1,i-=Q.set.length+2,a=Ct(t,r,i),a.length!==1)throw new TypeError("Not a valid type "+t);let f=this.parseFqTypeName(a[0]);return{code:T.set,info:f,options:c}}if(t.indexOf(Q.map,r)===r){if(r+=Q.map.length+1,i-=Q.map.length+2,a=Ct(t,r,i),a.length!==2)throw new TypeError("Not a valid type "+t);let f=this.parseFqTypeName(a[0]),g=this.parseFqTypeName(a[1]);return{code:T.map,info:[f,g],options:c}}if(t.indexOf(Q.udt,r)===r){r+=Q.udt.length+1,i-=Q.udt.length+2;let f=this._parseUdtName(t,r,i);return f.options=c,f}if(t.indexOf(Q.tuple,r)===r){if(r+=Q.tuple.length+1,i-=Q.tuple.length+2,a=Ct(t,r,i),a.length<1)throw new TypeError("Not a valid type "+t);let f=a.map(g=>this.parseFqTypeName(g));return{code:T.tuple,info:f,options:c}}if(t.indexOf(he.vector,r)===r){let f=this.parseVectorTypeArgs.bind(this)(t,he.vector,this.parseFqTypeName);return f.options=c,f}let u=t.substr(r,i);return{code:T.custom,info:u,options:c}},this.parseKeyTypes=function(t){let r=0,i=t.length,s=t.indexOf(Q.composite)===0;s&&(r=Q.composite.length+1,i--);let o=[],a=r,c=0,u=!1,f=!1;for(;++r<i;)switch(t[r]){case",":if(c>0)break;u&&(a=t.indexOf(":",a)+1),o.push(t.substring(a,r)),a=r+1;break;case"(":if(c===0&&t.indexOf(Q.collection,a)===a){u=!0,f=!0,r++,a=r;break}c++;break;case")":if(u&&c===0){o.push(t.substring(t.indexOf(":",a)+1,r)),a=r+1;break}c--;break}return a<i&&o.push(t.substring(a,i)),{types:o.map(g=>this.parseFqTypeName(g)),hasCollections:f,isComposite:s}},this._parseUdtName=function(t,r,i){let s=Ct(t,r,i);if(s.length<2)throw new TypeError("Not a valid type "+t);let o={keyspace:s[0],name:Z.allocBufferFromString(s[1],"hex").toString(),fields:[]};for(let a=2;a<s.length;a++){let c=s[a],u=c.indexOf(":"),f=this.parseFqTypeName(c,u+1,c.length-(u+1));o.fields.push({name:Z.allocBufferFromString(c.substr(0,u),"hex").toString(),type:f})}return{code:T.udt,info:o}}}function H_(){this.decoders={[T.custom]:this.decodeCustom,[T.ascii]:this.decodeAsciiString,[T.bigint]:this.decodeLong,[T.blob]:this.decodeBlob,[T.boolean]:this.decodeBoolean,[T.counter]:this.decodeLong,[T.decimal]:this.decodeDecimal,[T.double]:this.decodeDouble,[T.float]:this.decodeFloat,[T.int]:this.decodeInt,[T.text]:this.decodeUtf8String,[T.timestamp]:this.decodeTimestamp,[T.uuid]:this.decodeUuid,[T.varchar]:this.decodeUtf8String,[T.varint]:this.decodeVarint,[T.timeuuid]:this.decodeTimeUuid,[T.inet]:this.decodeInet,[T.date]:this.decodeDate,[T.time]:this.decodeTime,[T.smallint]:this.decodeSmallint,[T.tinyint]:this.decodeTinyint,[T.duration]:If,[T.list]:this.decodeList,[T.map]:this.decodeMap,[T.set]:this.decodeSet,[T.udt]:this.decodeUdt,[T.tuple]:this.decodeTuple},this.encoders={[T.custom]:this.encodeCustom,[T.ascii]:this.encodeAsciiString,[T.bigint]:this.encodeLong,[T.blob]:this.encodeBlob,[T.boolean]:this.encodeBoolean,[T.counter]:this.encodeLong,[T.decimal]:this.encodeDecimal,[T.double]:this.encodeDouble,[T.float]:this.encodeFloat,[T.int]:this.encodeInt,[T.text]:this.encodeUtf8String,[T.timestamp]:this.encodeTimestamp,[T.uuid]:this.encodeUuid,[T.varchar]:this.encodeUtf8String,[T.varint]:this.encodeVarint,[T.timeuuid]:this.encodeUuid,[T.inet]:this.encodeInet,[T.date]:this.encodeDate,[T.time]:this.encodeTime,[T.smallint]:this.encodeSmallint,[T.tinyint]:this.encodeTinyint,[T.duration]:Pf,[T.list]:this.encodeList,[T.map]:this.encodeMap,[T.set]:this.encodeSet,[T.udt]:this.encodeUdt,[T.tuple]:this.encodeTuple}}Hn.prototype.decode=function(n,e){if(n===null||n.length===0&&!V_.has(e.code))return null;let t=this.decoders[e.code];if(!t)throw new Error("Unknown data type: "+e.code);return t.call(this,n,e)};Hn.prototype.encode=function(n,e){if(n===void 0&&(n=this.encodingOptions.useUndefinedAsUnset&&this.protocolVersion>=4?k.unset:null),n===k.unset){if(!k.protocolVersion.supportsUnset(this.protocolVersion))throw new TypeError("Unset value can not be used for this version of Cassandra, protocol version: "+this.protocolVersion);return n}if(n===null||n instanceof Buffer)return n;let t=null;if(e){if(typeof e=="number"?t={code:e}:typeof e=="string"?t=T.getByName(e):typeof e.code=="number"&&(t=e),t==null||typeof t.code!="number")throw new TypeError("Type information not valid, only String and Number values are valid hints")}else if(t=Hn.guessDataType(n),!t)throw new TypeError("Target data type could not be guessed, you should use prepared statements for accurate type mapping. Value: "+oe.inspect(n));let r=this.encoders[t.code];if(!r)throw new Error("Type not supported "+t.code);return r.call(this,n,t)};Hn.guessDataType=function(n){let e=typeof n;if(e==="number")return{code:T.double};if(e==="string")return n.length===36&&k_.test(n)?{code:T.uuid}:{code:T.text};if(e==="boolean")return{code:T.boolean};if(n instanceof Buffer)return{code:T.blob};if(n instanceof Date)return{code:T.timestamp};if(n instanceof cn)return{code:T.bigint};if(n instanceof Mn)return{code:T.varint};if(n instanceof Vn)return{code:T.decimal};if(n instanceof k.Uuid)return{code:T.uuid};if(n instanceof k.InetAddress)return{code:T.inet};if(n instanceof k.Tuple)return{code:T.tuple};if(n instanceof k.LocalDate)return{code:T.date};if(n instanceof k.LocalTime)return{code:T.time};if(n instanceof k.Duration)return{code:T.custom,info:he.duration};if(n instanceof k.Vector)if(n&&n.length>0){if(n instanceof Float32Array)return{code:T.custom,customTypeName:"vector",info:[{code:T.float},n.length]};let t=null;if(n.subtype)try{t=T.getByName(n.subtype)}catch{}if(t==null&&(t=this.guessDataType(n[0])),t!=null)return{code:T.custom,customTypeName:"vector",info:[t,n.length]};throw new TypeError("Cannot guess subtype from element "+n[0])}else throw new TypeError("Cannot guess subtype of empty vector");else{if(Array.isArray(n))return{code:T.list};if(n instanceof F_){if(n instanceof vf)return{code:T.custom,info:he.lineString};if(n instanceof Nf)return{code:T.custom,info:he.point};if(n instanceof Af)return{code:T.custom,info:he.polygon}}else if(n instanceof bf)return{code:T.custom,info:he.dateRange}}return null};function K_(n){if(!n)return zn.int16Zero;let e=Z.allocBufferUnsafe(2);return typeof n=="number"?e.writeUInt16BE(n,0):e.writeUInt16BE(n.length,0),e}function j_(n){if(!n)return zn.int32Zero;let e=Z.allocBufferUnsafe(4);return typeof n=="number"?e.writeInt32BE(n,0):e.writeInt32BE(n.length,0),e}function G_(n){return n===null?null:Z.copyBuffer(n)}function W_(n){return n}function $_(n,e){return n.readInt32BE(e)}function Q_(n,e){return n.readUInt16BE(e)}function If(n){return k.Duration.fromBuffer(n)}function Pf(n){if(!(n instanceof k.Duration))throw new TypeError("Not a valid duration, expected Duration/Buffer obtained "+oe.inspect(n));return n.toBuffer()}function Z_(n){return vf.fromBuffer(n)}function Y_(n){return n.toBuffer()}function X_(n){return Nf.fromBuffer(n)}function J_(n){return n.toBuffer()}function e0(n){return Af.fromBuffer(n)}function t0(n){return n.toBuffer()}function n0(n){return bf.fromBuffer(n)}function r0(n){return n.toBuffer()}function Ct(n,e,t,r,i){r=r||"(",i=i||")";let s=[],o=e,a=0;for(let c=e;c<e+t;c++){let u=n[c];u===r&&a++,u===i&&a--,a===0&&u===","&&(s.push(n.substr(o,c-o)),o=c+1)}return s.push(n.substr(o,t-(o-e))),s}function oa(n,e){if(e===0)return null;if(n.length===1)return n[0];let t=Z.allocBufferUnsafe(e),r=0;for(let i=0;i<n.length;i++){let s=n[i];t.writeUInt16BE(s.length,r),r+=2,s.copy(t,r),r+=s.length,t[r]=0,r++}return t}function i0(n){let e={};for(let t in n)n.hasOwnProperty(t)&&(e[n[t]]=t);return e}Hn.isTypedArray=function(n){return n instanceof Object.getPrototypeOf(Uint8Array)};Bf.exports=Hn});var Rf=C((Dx,Of)=>{"use strict";var jn=require("util"),un=O(),F=H(),s0=j(),Ar={globalTablesSpec:1,hasMorePages:2,noMetadata:4,metadataChanged:8,continuousPaging:1073741824,lastContinuousPage:2147483648},o0="Server timeout during write query at consistency %s (%d peer(s) acknowledged the write over %d required)",a0="Server timeout during batchlog write at consistency %s (%d peer(s) acknowledged the write over %d required)",c0="Server failure during write query at consistency %s (%d responses were required but only %d replicas responded, %d failed)",u0="Not enough replicas available for query at consistency %s (%d required but only %d alive)",l0="Server timeout during read query at consistency %s (%s)",h0="Server failure during read query at consistency %s (%d responses were required but only %d replicas responded, %d failed)",ca=class{constructor(e,t,r){this.header=e,this.opcode=e.opcode,this.offset=r||0,this.buf=t}remainingLength(){return this.buf.length-this.offset}getBuffer(){return this.buf}slice(e,t){return typeof t>"u"&&(t=this.buf.length),this.buf.slice(e,t)}unshift(e){if(this.offset>0)throw new Error("Can not modify the underlying buffer if already read");this.buf=Buffer.concat([e,this.buf],e.length+this.buf.length)}read(e){let t=this.buf.length;typeof e<"u"&&this.offset+e<this.buf.length&&(t=this.offset+e);let r=this.slice(this.offset,t);return this.offset=t,r}toEnd(){this.offset=this.buf.length}readInt(){let e=this.buf.readInt32BE(this.offset);return this.offset+=4,e}readShort(){let e=this.buf.readUInt16BE(this.offset);return this.offset+=2,e}readByte(){let e=this.buf.readUInt8(this.offset);return this.offset+=1,e}readString(){let e=this.readShort();this.checkOffset(e);let t=this.buf.toString("utf8",this.offset,this.offset+e);return this.offset+=e,t}checkOffset(e){if(this.offset+e>this.buf.length){let t=new RangeError("Trying to access beyond buffer length");throw t.expectedLength=e,t}}readStringList(){let e=this.readShort(),t=new Array(e);for(let r=0;r<e;r++)t[r]=this.readString();return t}readBytes(){let e=this.readInt();return e<0?null:(this.checkOffset(e),this.read(e))}readShortBytes(){let e=this.readShort();return e<0?null:(this.checkOffset(e),this.read(e))}readMap(e,t,r){if(e<0)return null;let i={};for(let s=0;s<e;s++)i[t.call(this)]=r.call(this);return i}readStringMultiMap(){let e=this.readShort();if(e<0)return null;let t={};for(let r=0;r<e;r++)t[this.readString()]=this.readStringList();return t}readType(){let e,t={code:this.readShort(),type:null};switch(t.code){case F.dataTypes.custom:t.info=this.readString();break;case F.dataTypes.list:case F.dataTypes.set:t.info=this.readType();break;case F.dataTypes.map:t.info=[this.readType(),this.readType()];break;case F.dataTypes.udt:for(t.info={keyspace:this.readString(),name:this.readString(),fields:new Array(this.readShort())},e=0;e<t.info.fields.length;e++)t.info.fields[e]={name:this.readString(),type:this.readType()};break;case F.dataTypes.tuple:for(t.info=new Array(this.readShort()),e=0;e<t.info.length;e++)t.info[e]=this.readType();break}return t}readInet(){let e=this.readByte(),t=this.read(e);return{address:new F.InetAddress(t),port:this.readInt()}}readInetAddress(){let e=this.readByte();return new F.InetAddress(this.read(e))}readFlagsInfo(){if(this.header.flags===0)return un.emptyObject;let e={};return this.header.flags&F.frameFlags.tracing&&(this.checkOffset(16),e.traceId=new F.Uuid(un.copyBuffer(this.read(16)))),this.header.flags&F.frameFlags.warning&&(e.warnings=this.readStringList()),this.header.flags&F.frameFlags.customPayload&&(e.customPayload=this.readMap(this.readShort(),this.readString,this.readBytes)),e}readMetadata(e){let t,r=e===F.resultKind.prepared,i={};F.protocolVersion.supportsResultMetadataId(this.header.version)&&r&&(i.resultId=un.copyBuffer(this.readShortBytes()));let s=this.readInt(),o=this.readInt();if(F.protocolVersion.supportsPreparedPartitionKey(this.header.version)&&r)for(i.partitionKeys=new Array(this.readInt()),t=0;t<i.partitionKeys.length;t++)i.partitionKeys[t]=this.readShort();for(s&Ar.hasMorePages&&(i.pageState=un.copyBuffer(this.readBytes())),s&Ar.metadataChanged&&(i.newResultId=un.copyBuffer(this.readShortBytes())),s&Ar.continuousPaging&&(i.continuousPageIndex=this.readInt(),i.lastContinuousPage=!!(s&Ar.lastContinuousPage)),s&Ar.globalTablesSpec&&(i.global_tables_spec=!0,i.keyspace=this.readString(),i.table=this.readString()),i.columns=new Array(o),i.columnsByName=un.emptyObject,r&&(i.columnsByName={}),t=0;t<o;t++){let a={};i.global_tables_spec||(a.ksname=this.readString(),a.tablename=this.readString()),a.name=this.readString(),a.type=this.readType(),i.columns[t]=a,r&&(i.columnsByName[a.name]=t)}return i}readError(){let e=this.readInt(),t=this.readString(),r=new s0.ResponseError(e,t);switch(e){case F.responseErrorCodes.unavailableException:r.consistencies=this.readShort(),r.required=this.readInt(),r.alive=this.readInt(),r.message=jn.format(u0,F.consistencyToString[r.consistencies],r.required,r.alive);break;case F.responseErrorCodes.readTimeout:case F.responseErrorCodes.readFailure:if(r.consistencies=this.readShort(),r.received=this.readInt(),r.blockFor=this.readInt(),e===F.responseErrorCodes.readFailure&&(F.protocolVersion.supportsFailureReasonMap(this.header.version)?(r.failures=this.readInt(),r.reasons=this.readMap(r.failures,this.readInetAddress,this.readShort)):r.failures=this.readInt()),r.isDataPresent=this.readByte(),e===F.responseErrorCodes.readTimeout){let i;r.received<r.blockFor?i=jn.format("%d replica(s) responded over %d required",r.received,r.blockFor):r.isDataPresent?i="timeout while waiting for repair of inconsistent replica":i="the replica queried for the data didn't respond",r.message=jn.format(l0,F.consistencyToString[r.consistencies],i)}else r.message=jn.format(h0,F.consistencyToString[r.consistencies],r.blockFor,r.received,r.failures);break;case F.responseErrorCodes.writeTimeout:case F.responseErrorCodes.writeFailure:if(r.consistencies=this.readShort(),r.received=this.readInt(),r.blockFor=this.readInt(),e===F.responseErrorCodes.writeFailure&&(F.protocolVersion.supportsFailureReasonMap(this.header.version)?(r.failures=this.readInt(),r.reasons=this.readMap(r.failures,this.readInetAddress,this.readShort)):r.failures=this.readInt()),r.writeType=this.readString(),e===F.responseErrorCodes.writeTimeout){let i=r.writeType==="BATCH_LOG"?a0:o0;r.message=jn.format(i,F.consistencyToString[r.consistencies],r.received,r.blockFor)}else r.message=jn.format(c0,F.consistencyToString[r.consistencies],r.blockFor,r.received,r.failures);break;case F.responseErrorCodes.unprepared:r.queryId=un.copyBuffer(this.readShortBytes());break;case F.responseErrorCodes.functionFailure:r.keyspace=this.readString(),r.functionName=this.readString(),r.argTypes=this.readStringList();break;case F.responseErrorCodes.alreadyExists:{r.keyspace=this.readString();let i=this.readString();i.length>0&&(r.table=i);break}}return r}readEvent(){let e=this.readString();switch(e){case F.protocolEvents.topologyChange:return{added:this.readString()==="NEW_NODE",inet:this.readInet(),eventType:e};case F.protocolEvents.statusChange:return{up:this.readString()==="UP",inet:this.readInet(),eventType:e};case F.protocolEvents.schemaChange:return this.parseSchemaChange()}return{eventType:e}}parseSchemaChange(){let e;if(!F.protocolVersion.supportsSchemaChangeFullMetadata(this.header.version))return e={eventType:F.protocolEvents.schemaChange,schemaChangeType:this.readString(),keyspace:this.readString(),table:this.readString()},e.isKeyspace=!e.table,e;switch(e={eventType:F.protocolEvents.schemaChange,schemaChangeType:this.readString(),target:this.readString(),keyspace:this.readString(),table:null,udt:null,signature:null},e.isKeyspace=e.target==="KEYSPACE",e.target){case"TABLE":e.table=this.readString();break;case"TYPE":e.udt=this.readString();break;case"FUNCTION":e.functionName=this.readString(),e.signature=this.readStringList();break;case"AGGREGATE":e.aggregate=this.readString(),e.signature=this.readStringList()}return e}};Of.exports={FrameReader:ca}});var Df=C(Li=>{"use strict";var ua=require("util"),{Transform:Ri,Writable:Lf}=require("stream"),xe=H(),qf=O(),Ir=j(),{FrameHeader:Oi}=xe,{FrameReader:f0}=Rf();function Pr(n){Ri.call(this,n),this.header=null,this.bodyLength=0,this.clearHeaderChunks(),this.version=0,this.headerSize=0}ua.inherits(Pr,Ri);Pr.prototype._transform=function(n,e,t){let r=null;try{this.readItems(n)}catch(i){r=i}t(r)};Pr.prototype.readItems=function(n){if(!n||n.length===0)return;this.version===0&&(this.version=Oi.getProtocolVersion(n),this.headerSize=Oi.size(this.version));let e=0,t=this.header;if(this.header=null,this.headerChunks.byteLength!==0){if(this.headerChunks.parts.push(n),this.headerChunks.byteLength+n.length<this.headerSize){this.headerChunks.byteLength+=n.length;return}t=Oi.fromBuffer(Buffer.concat(this.headerChunks.parts,this.headerSize)),e=this.headerSize-this.headerChunks.byteLength,this.clearHeaderChunks()}let r=[];for(;;){if(!t){if(this.headerSize>n.length-e){if(n.length-e<=0)break;let s=n.slice(e,n.length);this.headerChunks.parts.push(s),this.headerChunks.byteLength=s.length;break}t=Oi.fromBuffer(n,e),e+=this.headerSize}let i=n.length-e;if(t.bodyLength<=i+this.bodyLength)r.push({header:t,chunk:n,offset:e,frameEnded:!0}),e+=t.bodyLength-this.bodyLength,this.bodyLength=0;else if(i>=0){this.header=t,this.bodyLength+=i,i>0&&r.push({header:t,chunk:n,offset:e,frameEnded:!1});break}t=null}for(let i=0;i<r.length;i++)this.push(r[i])};Pr.prototype.clearHeaderChunks=function(){this.headerChunks={byteLength:0,parts:[]}};function Ue(n,e){Ri.call(this,n),this.frames={},this.encoder=e}ua.inherits(Ue,Ri);Ue.prototype._transform=function(n,e,t){let r=this.frameState(n),i=null;try{this.parseBody(r,n)}catch(s){i=s}t(i),n.frameEnded&&(r.cellBuffer&&this.push({header:r.header,error:new Ir.DriverInternalError("There was an problem while parsing streaming frame, opcode "+r.header.opcode)}),this.push({header:r.header,frameEnded:!0}))};Ue.prototype.parseBody=function(n,e){if(n.isStreaming=n.byRow&&e.header.opcode===xe.opcodes.result,!this.handleFrameBuffers(n,e))return;let t=new f0(e.header,e.chunk,e.offset);if(n.flagsInfo===void 0){let r=t.offset;try{n.flagsInfo=t.readFlagsInfo()}catch(i){return this.handleParsingError(i,n,t,r)}}switch(e.header.opcode){case xe.opcodes.result:return this.parseResult(n,t);case xe.opcodes.ready:case xe.opcodes.authSuccess:return this.push({header:n.header,ready:!0});case xe.opcodes.authChallenge:return this.push({header:n.header,authChallenge:!0,token:t.readBytes()});case xe.opcodes.authenticate:return this.push({header:n.header,mustAuthenticate:!0,authenticatorName:t.readString()});case xe.opcodes.error:return this.push({header:n.header,error:t.readError()});case xe.opcodes.supported:return this.push({header:n.header,supported:t.readStringMultiMap()});case xe.opcodes.event:return this.push({header:n.header,event:t.readEvent()});default:return this.push({header:n.header,error:new Error("Received invalid opcode: "+e.header.opcode)})}};Ue.prototype.handleFrameBuffers=function(n,e){if(!n.isStreaming)return(n.bufferLength||0)+e.chunk.length-e.offset<e.header.bodyLength?(this.addFrameBuffer(n,e),!1):(n.buffers&&(e.chunk=this.getFrameBuffer(n,e),e.offset=0),!0);if(n.cellBuffer){if(e.offset!==0)throw new Ir.DriverInternalError("Following chunks can not have an offset greater than zero");if(n.cellBuffer.parts.push(e.chunk),!n.cellBuffer.expectedLength){if(n.cellBuffer.parts.length!==2)throw new Ir.DriverInternalError("Buffer for streaming frame can not contain more than 1 item");return e.chunk=Buffer.concat(n.cellBuffer.parts,n.cellBuffer.byteLength+e.chunk.length),n.cellBuffer=null,!0}if(n.cellBuffer.expectedLength>n.cellBuffer.byteLength+e.chunk.length)return n.cellBuffer.byteLength+=e.chunk.length,!1;e.chunk=Buffer.concat(n.cellBuffer.parts,n.cellBuffer.byteLength+e.chunk.length),n.cellBuffer=null}return!0};Ue.prototype.addFrameBuffer=function(n,e){if(!n.buffers){n.buffers=[e.chunk.slice(e.offset)],n.bufferLength=e.chunk.length-e.offset;return}if(e.offset>0)throw new Ir.DriverInternalError("Following chunks can not have an offset greater than zero");n.buffers.push(e.chunk),n.bufferLength+=e.chunk.length};Ue.prototype.getFrameBuffer=function(n,e){n.buffers.push(e.chunk);let t=Buffer.concat(n.buffers,n.bodyLength);return n.buffers=null,t};Ue.prototype.parseResult=function(n,e){let t,r=e.offset;try{if(!n.meta)switch(n.kind=e.readInt(),n.kind){case xe.resultKind.voidResult:t={header:n.header,flags:n.flagsInfo};break;case xe.resultKind.rows:n.meta=e.readMetadata(n.kind);break;case xe.resultKind.setKeyspace:t={header:n.header,keyspaceSet:e.readString(),flags:n.flagsInfo};break;case xe.resultKind.prepared:{let i=qf.copyBuffer(e.readShortBytes());n.meta=e.readMetadata(n.kind),t={header:n.header,id:i,meta:n.meta,flags:n.flagsInfo};break}case xe.resultKind.schemaChange:t={header:n.header,schemaChange:e.parseSchemaChange(),flags:n.flagsInfo};break;default:throw Ir.DriverInternalError("Unexpected result kind: "+n.kind)}}catch(i){return this.handleParsingError(i,n,e,r)}if(t)return n.emitted?void 0:(n.emitted=!0,this.push(t));e.remainingLength()>0&&this.parseRows(n,e)};Ue.prototype.parseRows=function(n,e){if(n.parsingError)return;if(n.rowLength===void 0)try{n.rowLength=e.readInt()}catch(r){return this.handleParsingError(r,n,e)}if(n.rowLength===0)return this.push({header:n.header,result:{rows:qf.emptyArray,meta:n.meta,flags:n.flagsInfo}});let t=n.meta;n.rowIndex=n.rowIndex||0;for(let r=n.rowIndex;r<n.rowLength;r++){let i=e.offset,s=new xe.Row(t.columns),o;for(let a=0;a<t.columns.length;a++){let c=t.columns[a];try{o=e.readBytes()}catch(u){return this.handleParsingError(u,n,e,i,r)}try{s[c.name]=this.encoder.decode(o,c.type)}catch(u){return this.handleParsingError(u,n,null)}}this.push({header:n.header,row:s,meta:n.meta,byRow:n.byRow,length:n.rowLength,flags:n.flagsInfo})}n.byRow&&this.push({header:n.header,byRowCompleted:!0,meta:n.meta,length:n.rowLength,flags:n.flagsInfo})};Ue.prototype.setOptions=function(n,e){if(this.frames[n.toString()])throw new xe.DriverError("There was already state for this frame");this.frames[n.toString()]=e};Ue.prototype.clearOptions=function(n){delete this.frames[n.toString()]};Ue.prototype.frameState=function(n){let e=this.frames[n.header.streamId];return e?n.frameEnded&&delete this.frames[n.header.streamId]:(e={},n.frameEnded||(this.frames[n.header.streamId]=e)),e.header=n.header,e};Ue.prototype.handleParsingError=function(n,e,t,r,i){if(t&&e.isStreaming&&n instanceof RangeError)return this.bufferResultCell(e,t,r,i,n.expectedLength);e.parsingError=!0,e.cellBuffer=null,this.push({header:e.header,error:n})};Ue.prototype.bufferResultCell=function(n,e,t,r,i){!t&&t!==0&&(t=e.offset),n.rowIndex=r;let s=e.slice(t);n.cellBuffer={parts:[s],byteLength:s.length,expectedLength:i}};function Br(n){Lf.call(this,n),this.rowBuffer={}}ua.inherits(Br,Lf);Br.prototype._write=function(n,e,t){let r=null;try{this.each(n)}catch(i){r=i}t(r)};Br.prototype.each=function(n){return n.error||n.result?this.emit("result",n.header,n.error,n.result):n.frameEnded?this.emit("frameEnded",n.header):n.lastContinuousPage?this.emit("lastContinuousPage",n.header):n.byRowCompleted?this.emit("byRowCompleted",n.header,n.row,n.meta,n.flags):n.byRow?this.emit("row",n.header,n.row,n.meta,n.length,n.flags):n.row?this.bufferAndEmit(n):n.event?this.emit("nodeEvent",n.header,n.event):this.emit("result",n.header,null,n)};Br.prototype.bufferAndEmit=function(n){let e=this.rowBuffer[n.header.streamId];e||(e=this.rowBuffer[n.header.streamId]=[]),e.push(n.row),e.length===n.length&&(this.emit("result",n.header,null,{rows:e,meta:n.meta,flags:n.flags}),delete this.rowBuffer[n.header.streamId])};Li.Protocol=Pr;Li.Parser=Ue;Li.ResultEmitter=Br});var Mf=C((kx,Uf)=>{"use strict";var d0=H(),qi=128,Ff=7,la=4,p0=256,g0=5e3,ha=class{constructor(e){this.currentGroup=kf(0),this.groupIndex=0,this.groups=[this.currentGroup],this.releaseTimeout=null,this.setVersion(e),this.inUse=0,this.releaseDelay=g0}setVersion(e){this.maxGroups=d0.protocolVersion.uses2BytesStreamIds(e)?p0:1}pop(){let e=this.currentGroup.pop();if(typeof e<"u")return this.inUse++,e;for(;this.groupIndex<this.groups.length-1;)if(this.currentGroup=this.groups[++this.groupIndex],e=this.currentGroup.pop(),typeof e<"u")return this.inUse++,e;return this._tryCreateGroup()}push(e){this.inUse--;let t=e>>Ff,r=this.groups[t];r.push(e),t<this.groupIndex&&(this.groupIndex=t,this.currentGroup=r),this._tryIssueRelease()}clear(){this.releaseTimeout&&(clearTimeout(this.releaseTimeout),this.releaseTimeout=null)}_tryCreateGroup(){return this.groups.length===this.maxGroups?null:(this.groupIndex=this.groups.length,this.currentGroup=kf(this.groupIndex<<Ff),this.groups.push(this.currentGroup),this.inUse++,this.currentGroup.pop())}_tryIssueRelease(){this.releaseTimeout||this.groups.length<=la||(this.releaseTimeout=setTimeout(()=>this._releaseGroups(),this.releaseDelay))}_releaseGroups(){let e=0,t=this.groups.length-1;for(;e++<la&&this.groups.length>la&&t>this.groupIndex&&this.groups[t].length===qi;)this.groups.pop(),t--;this.releaseTimeout=null,this._tryIssueRelease()}};function kf(n){let e=new Array(qi),t=n+qi-1;for(let r=0;r<qi;r++)e[r]=t-r;return e}Uf.exports=ha});var jf=C((Ux,Kf)=>{"use strict";var m0=require("util"),Vf=O(),zf=j(),Hf=jt(),y0=Hf.ExecuteRequest,w0=Hf.QueryRequest,Lt={init:0,completed:1,timedOut:2,cancelled:3},fa=class{constructor(e,t,r){this.request=e,this._rowCallback=t,this._callback=r,this._timeout=null,this._state=Lt.init,this._rowIndex=0,this.streamId=-1}cancel(){this._state===Lt.init&&(this._timeout!==null&&clearTimeout(this._timeout),this._state=Lt.cancelled,this._callback=Vf.noop)}canBeWritten(){return this._state===Lt.init}isByRow(){return this._rowCallback&&(this.request instanceof y0||this.request instanceof w0)}setRequestTimeout(e,t,r,i,s){if(this._state!==Lt.init)return;let o=e.getReadTimeout()!==void 0?e.getReadTimeout():t;if(!(o>0))return;let a=this;this._timeout=setTimeout(function(){i();let u=m0.format("The host %s did not reply before timeout %d ms",r,o);a._markAsTimedOut(new zf.OperationTimedOutError(u,r),s)},o)}setResultRow(e,t,r,i,s){if(this._markAsCompleted(),!this._rowCallback)return this.setResult(new zf.DriverInternalError("RowCallback not found for streaming frame handler"));this._rowCallback(this._rowIndex++,e,r),this._rowIndex===r&&this._swapCallbackAndInvoke(null,{rowLength:r,meta:t,flags:i},s.bodyLength)}_markAsTimedOut(e,t){this._state===Lt.init&&(this._state=Lt.timedOut,this._swapCallbackAndInvoke(e,null,null,t))}_markAsCompleted(){this._state===Lt.init&&(this._timeout!==null&&clearTimeout(this._timeout),this._state=Lt.completed)}setResult(e,t,r){this._markAsCompleted(),this._swapCallbackAndInvoke(e,t,r)}_swapCallbackAndInvoke(e,t,r,i){let s=this._callback;this._callback=i||Vf.noop,s(e,t,r)}};Kf.exports=fa});var ga=C((Mx,Wf)=>{"use strict";var Gf=require("events"),Or=require("util"),_0=require("tls"),E0=require("net"),T0=Bi(),{WriteQueue:S0}=Bo(),Gn=jt(),da=Df(),Rr=O(),$e=H(),ln=j(),C0=Mf(),x0=jf(),b0=Be(),{ExecutionOptions:v0}=Kt(),pa=class extends Gf.EventEmitter{constructor(e,t,r){if(super(),this.setMaxListeners(0),!r)throw new Error("options is not defined");if(this.endpoint=e,this.endpointFriendlyName=this.endpoint,r.sni&&(this._serverName=e,this.endpoint=`${r.sni.addressResolver.getIp()}:${r.sni.port}`,this.endpointFriendlyName=`${this.endpoint} (${this._serverName})`),!this.endpoint||this.endpoint.indexOf(":")<0)throw new Error("EndPoint must contain the ip address and port separated by : symbol");let i=this.endpoint.lastIndexOf(":");this.address=this.endpoint.substr(0,i),this.port=this.endpoint.substr(i+1),Object.defineProperty(this,"options",{value:r,enumerable:!1,writable:!1}),t===null&&(t=$e.protocolVersion.maxSupported,r.protocolOptions.maxVersion&&(t=r.protocolOptions.maxVersion),this._checkingVersion=!0),this.log=Rr.log,this.protocolVersion=t,this._operations=new Map,this._pendingWrites=[],this._preparing=new Map,this._idleTimeout=null,this.timedOutOperations=0,this._streamIds=new C0(this.protocolVersion),this._metrics=r.metrics,this.encoder=new T0(t,r),this.keyspace=null,this.emitDrain=!1,this.connected=!1,this.isSocketOpen=!1,this.send=Or.promisify(this.sendStream),this.closeAsync=Or.promisify(this.close),this.openAsync=Or.promisify(this.open),this.prepareOnceAsync=Or.promisify(this.prepareOnce)}bindSocketListeners(){this.netClient.removeAllListeners("connect"),this.netClient.removeAllListeners("timeout"),this.isSocketOpen=!0,this.netClient.on("close",()=>{this.log("info",`Connection to ${this.endpointFriendlyName} closed`),this.isSocketOpen=!1;let t=this.connected;this.close(),t&&this.emit("socketClose")}),this.protocol=new da.Protocol({objectMode:!0}),this.parser=new da.Parser({objectMode:!0},this.encoder);let e=new da.ResultEmitter({objectMode:!0});e.on("result",this.handleResult.bind(this)),e.on("row",this.handleRow.bind(this)),e.on("frameEnded",this.freeStreamId.bind(this)),e.on("nodeEvent",this.handleNodeEvent.bind(this)),this.netClient.pipe(this.protocol).pipe(this.parser).pipe(e),this.writeQueue=new S0(this.netClient,this.encoder,this.options)}open(e){let t=this;if(this.log("info",`Connecting to ${this.endpointFriendlyName}`),!this.options.sslOptions)this.netClient=new E0.Socket({highWaterMark:this.options.socketOptions.coalescingThreshold}),this.netClient.connect(this.port,this.address,function(){t.log("verbose",`Socket connected to ${t.endpointFriendlyName}`),t.bindSocketListeners(),t.startup(e)});else{let r=Rr.extend({rejectUnauthorized:!1},this.options.sslOptions);this.options.sni&&(r.servername=this._serverName),this.netClient=_0.connect(this.port,this.address,r,function(){t.log("verbose",`Secure socket connected to ${t.endpointFriendlyName} with protocol ${t.netClient.getProtocol()}`),t.bindSocketListeners(),t.startup(e)}),this.netClient.setMaxSendFragment(this.options.socketOptions.coalescingThreshold)}this.netClient.once("error",function(i){t.errorConnecting(i,!1,e)}),this.netClient.once("timeout",function(){let i=new $e.DriverError("Connection timeout");t.errorConnecting(i,!0,e)}),this.netClient.setTimeout(this.options.socketOptions.connectTimeout),this.options.socketOptions.keepAlive&&this.netClient.setKeepAlive(!0,this.options.socketOptions.keepAliveDelay),this.netClient.setNoDelay(!!this.options.socketOptions.tcpNoDelay)}startup(e){this._checkingVersion&&this.log("info","Trying to use protocol version 0x"+this.protocolVersion.toString(16));let t=this,r=new Gn.StartupRequest({noCompact:this.options.protocolOptions.noCompact,clientId:this.options.id,applicationName:this.options.applicationName,applicationVersion:this.options.applicationVersion});this.sendStream(r,null,function(o,a){if(o&&t._checkingVersion){let c=o instanceof ln.ResponseError&&o.code===$e.responseErrorCodes.protocolError&&o.message.indexOf("Invalid or unsupported protocol version")>=0;if(!c&&$e.protocolVersion.canStartupResponseErrorBeWrapped(t.protocolVersion)&&(c=o instanceof ln.ResponseError&&o.code===$e.responseErrorCodes.serverError&&o.message.indexOf("ProtocolException: Invalid or unsupported protocol version")>0),c){let u=t.protocol.version;if(u===t.protocolVersion?u=$e.protocolVersion.getLowerSupported(t.protocolVersion):$e.protocolVersion.isSupported(t.protocol.version)||(t.log("info",`Protocol version ${t.protocol.version} not supported by this driver, downgrading`),u=$e.protocolVersion.getLowerSupported(t.protocol.version)),!u)return i(new Error("Connection was unable to STARTUP using protocol version "+t.protocolVersion));t.log("info","Protocol 0x"+t.protocolVersion.toString(16)+" not supported, using 0x"+u.toString(16)),t.decreaseVersion(u),setImmediate(function(){t.close(function(){t.open(e)})});return}}if(a&&a.mustAuthenticate)return t.startAuthenticating(a.authenticatorName,i);i(o)});function i(s){return s?t.errorConnecting(s,!1,e):t.connectionReady(e)}}errorConnecting(e,t,r){this.log("warning",`There was an error when trying to connect to the host ${this.endpointFriendlyName}`,e),t&&this.netClient.destroy(),this._metrics.onConnectionError(e),r(e)}connectionReady(e){this.emit("connected"),this.connected=!0,this.netClient.removeAllListeners("error"),this.netClient.on("error",this.handleSocketError.bind(this)),e()}decreaseVersion(e){this.protocolVersion=e,this.encoder.setProtocolVersion(e),this._streamIds.setVersion(e)}handleSocketError(e){this._metrics.onConnectionError(e),this.clearAndInvokePending(e)}clearAndInvokePending(e){this._idleTimeout&&(clearTimeout(this._idleTimeout),this._idleTimeout=null),this._streamIds.clear(),this.emitDrain&&this.emit("drain");let t=new $e.DriverError("Socket was closed");t.isSocketError=!0,e&&(t.innerError=e);let r=Array.from(this._operations.values());this._operations=new Map,r.length>0&&this.log("info","Invoking "+r.length+" pending callbacks"),Rr.each(r,function(s,o){s.setResult(t),o()});let i=this._pendingWrites;this._pendingWrites=[],Rr.each(i,function(s,o){s.setResult(t),o()})}startAuthenticating(e,t){if(!this.options.authProvider)return t(new ln.AuthenticationError("Authentication provider not set"));let r=this.options.authProvider.newAuthenticator(this.endpoint,e),i=this;r.initialResponse(function(o,a){if(o)return i.onAuthenticationError(t,o);i.authenticate(r,a,t)})}authenticate(e,t,r){let i=this,s=new Gn.AuthResponseRequest(t);if(this.protocolVersion===1){if(!e.username)return i.onAuthenticationError(r,new ln.AuthenticationError("Only plain text authenticator providers allowed under protocol v1"));s=new Gn.CredentialsRequest(e.username,e.password)}this.sendStream(s,null,function(a,c){if(a){if(a instanceof ln.ResponseError&&a.code===$e.responseErrorCodes.badCredentials){let u=new ln.AuthenticationError(a.message);u.additionalInfo=a,a=u}return i.onAuthenticationError(r,a)}if(c.ready)return e.onAuthenticationSuccess(),r();if(c.authChallenge)return e.evaluateChallenge(c.token,function(f,g){if(f)return i.onAuthenticationError(r,f);i.authenticate(e,g,r)});r(new ln.DriverInternalError("Unexpected response from Cassandra: "+Or.inspect(c)))})}onAuthenticationError(e,t){this._metrics.onAuthenticationError(t),e(t)}async changeKeyspace(e){if(!e||this.keyspace===e)return;if(this.toBeKeyspace===e)return b0.fromEvent(this,"keyspaceChanged");this.toBeKeyspace=e;let t=`USE "${e}"`;try{await this.send(new Gn.QueryRequest(t,null,null),null),this.keyspace=e,this.emit("keyspaceChanged",null,e)}catch(r){throw this.log("error",`Connection to ${this.endpointFriendlyName} could not switch active keyspace: ${r}`,r),this.emit("keyspaceChanged",r),r}finally{this.toBeKeyspace=null}}prepareOnce(e,t,r){let i=(t||"")+e,s=this._preparing.get(i);if(s)return s.once("prepared",r);s=new Gf.EventEmitter,s.setMaxListeners(0),s.once("prepared",r),this._preparing.set(i,s),this.sendStream(new Gn.PrepareRequest(e,t),null,(o,a)=>{s.emit("prepared",o,a),this._preparing.delete(i)})}sendStream(e,t,r){t=t||v0.empty();let i=new x0(e,t.getRowCallback(),(o,a,c)=>{(!o||!o.isSocketError)&&this.emit("responseDequeued"),r(o,a,c)}),s=this._getStreamId();return i.setRequestTimeout(t,this.options.socketOptions.readTimeout,this.endpoint,()=>this.timedOutOperations++,()=>this.timedOutOperations--),s===null?(this.log("info","Enqueuing "+this._pendingWrites.length+", if this message is recurrent consider configuring more connections per host or lowering the pressure"),this._pendingWrites.push(i),i):(this._write(i,s),i)}_write(e,t){e.streamId=t;let r=this;this.writeQueue.push(e,function(s){if(s)return r._streamIds.push(t),e.setResult(s);r.log("verbose","Sent stream #"+t+" to "+r.endpointFriendlyName),e.isByRow()&&r.parser.setOptions(t,{byRow:!0}),r._setIdleTimeout(),r._operations.set(t,e)})}_setIdleTimeout(){if(!this.options.pooling.heartBeatInterval)return;let e=this,t=this._idleTimeout;e._idleTimeout=setTimeout(()=>e._idleTimeoutHandler(),e.options.pooling.heartBeatInterval),t&&clearTimeout(t)}_idleTimeoutHandler(){if(this.sendingIdleQuery){this._idleTimeout=setTimeout(()=>this._idleTimeoutHandler(),this.options.pooling.heartBeatInterval);return}this.log("verbose",`Connection to ${this.endpointFriendlyName} idling, issuing a request to prevent disconnects`),this.sendingIdleQuery=!0,this.sendStream(Gn.options,null,e=>{this.sendingIdleQuery=!1,e&&(this.log("warning","Received heartbeat request error",e),this.emit("idleRequestError",e,this))})}_getStreamId(){return this._streamIds.pop()}freeStreamId(e){let t=e.streamId;t<0||(this._operations.delete(t),this._streamIds.push(t),this.emitDrain&&this._streamIds.inUse===0&&this._pendingWrites.length===0&&this.emit("drain"),this._writeNext())}_writeNext(){if(this._pendingWrites.length===0)return;let e=this._getStreamId();if(e===null)return;let t=this,r;for(;(r=this._pendingWrites.shift())&&!r.canBeWritten(););if(!r){this._streamIds.push(e);return}setImmediate(function(){t._write(r,e)})}getInFlight(){return this._streamIds.inUse}handleResult(e,t,r){let i=e.streamId;if(i<0)return this.log("verbose","event received",e);let s=this._operations.get(i);if(!s)return this.log("error","The server replied with a wrong streamId #"+i);this.log("verbose","Received frame #"+i+" from "+this.endpointFriendlyName),s.setResult(t,r,e.bodyLength)}handleNodeEvent(e,t){switch(t.eventType){case $e.protocolEvents.schemaChange:this.emit("nodeSchemaChange",t);break;case $e.protocolEvents.topologyChange:this.emit("nodeTopologyChange",t);break;case $e.protocolEvents.statusChange:this.emit("nodeStatusChange",t);break}}handleRow(e,t,r,i,s){let o=e.streamId;if(o<0)return this.log("verbose","Event received",e);let a=this._operations.get(o);if(!a)return this.log("error","The server replied with a wrong streamId #"+o);a.setResultRow(t,r,i,s,e)}close(e){if(e=e||Rr.noop,!this.connected&&!this.isSocketOpen||(this.connected=!1,this.removeAllListeners("drain"),this.clearAndInvokePending(),!this.isSocketOpen))return e();this.isSocketOpen=!1,this.log("verbose",`Closing connection to ${this.endpointFriendlyName}`);let t=this,r=setTimeout(()=>{this.log("info",`${this.endpointFriendlyName} did not respond to connection close within ${this.options.socketOptions.connectTimeout}ms, destroying connection`),this.netClient.destroy()},this.options.socketOptions.connectTimeout);this.netClient.once("close",function(i){clearTimeout(r),i&&t.log("info","The socket closed with a transmission error"),setImmediate(e)}),this.netClient.removeAllListeners("error"),this.netClient.on("error",i=>this.clearAndInvokePending(i)),this.netClient.end()}getLocalAddress(){if(this.netClient)return this.netClient.localAddress}};Wf.exports=pa});var Zf=C((Vx,Qf)=>{"use strict";var $f=require("util"),N0=require("events"),A0=ga(),Di=O(),Lr=Be(),I0=j(),P0=sr(),qr=0,B0=Math.pow(2,15),ma,Me={initial:0,closing:1,shuttingDown:2,shutDown:4},ya=class n extends N0.EventEmitter{constructor(e,t){super(),this._address=e.address,this._newConnectionTimeout=null,this._state=Me.initial,this._opening=!1,this._host=e,this.responseCounter=0,this.options=e.options,this.protocolVersion=t,this.coreConnectionsLength=1,this.connections=Di.emptyArray,this.setMaxListeners(0),this.log=Di.log}getInFlight(){let e=this.connections.length;if(e===1)return this.connections[0].getInFlight();let t=0;for(let r=0;r<e;r++)t+=this.connections[r].getInFlight();return t}borrowConnection(e){if(this.connections.length===0)throw new Error("No connection available");let t=this.options.pooling.maxRequestsPerConnection,r=n.minInFlight(this.connections,t,e);if(r.getInFlight()>=t)throw new I0.BusyConnectionError(this._address,t,this.connections.length);return r}static minInFlight(e,t,r){let i=e.length;if(i===1)return e[0];qr++,qr>=B0&&(qr=0);let s;for(let o=qr;o<qr+i;o++){s=e[o%i],s===r&&(s=e[++o%i]);let a=e[(o+1)%i];if(a===r&&(a=e[(o+2)%i]),a.getInFlight()<s.getInFlight()&&(s=a),s.getInFlight()<t)break}return s}async warmup(e){if(this.connections.length<this.coreConnectionsLength){for(;this.connections.length<this.coreConnectionsLength;)await this._attemptNewConnection();this.log("info",`Connection pool to host ${this._address} created with ${this.connections.length} connection(s)`)}else this.log("info",`Connection pool to host ${this._address} contains ${this.connections.length} connection(s)`);if(e)try{for(let t of this.connections)await t.changeKeyspace(e)}catch{this.log("warning",`Connection(s) to host ${this._address} could not be switched to keyspace ${e}`)}}_createConnection(){let e=this.options.sni?this._host.hostId.toString():this._address,t=new A0(e,this.protocolVersion,this.options);return this._addListeners(t),t}_addListeners(e){e.on("responseDequeued",()=>this.responseCounter++);let t=this;function r(){t.remove(e)}e.on("idleRequestError",r),e.on("socketClose",r)}addExistingConnection(e){this._addListeners(e),this.connections=this.connections.slice(0),this.connections.push(e)}clearNewConnectionAttempt(){this._newConnectionTimeout&&(clearTimeout(this._newConnectionTimeout),this._newConnectionTimeout=null)}async _attemptNewConnection(){if(this._opening)return await Lr.fromEvent(this,"open");this._opening=!0;let e=this._createConnection(),t;try{await e.openAsync()}catch(r){t=r,this.log("warning",`Connection to ${this._address} could not be created: ${t}`,t)}if(this.isClosing()&&(this.log("info",`Connection to ${this._address} opened successfully but pool was being closed`),t=new Error("Connection closed")),t)Lr.toBackground(e.closeAsync());else{let r=this.connections.slice(0);r.push(e),this.connections=r,this.log("info",`Connection to ${this._address} opened successfully`)}if(this._opening=!1,this.emit("open",t,e),t)throw t}attemptNewConnectionImmediate(){let e=this;function t(){e.clearNewConnectionAttempt(),e.scheduleNewConnectionAttempt(0)}if(this._state===Me.initial)return t();if(this._state===Me.closing)return this.once("close",t)}remove(e){let t=this.connections.indexOf(e);if(t<0)return;let r=this.connections.slice(0);r.splice(t,1),this.connections=r,setImmediate(function(){e.close()}),this.emit("remove")}scheduleNewConnectionAttempt(e){if(this.isClosing())return;let t=this;this._newConnectionTimeout=setTimeout(function(){if(t._newConnectionTimeout=null,!(t.connections.length>=t.coreConnectionsLength)){if(e>0&&t.options.sni){Lr.toBackground(t.options.sni.addressResolver.refresh().then(()=>t._attemptNewConnection()));return}Lr.toBackground(t._attemptNewConnection())}},e)}hasScheduledNewConnection(){return!!this._newConnectionTimeout||this._opening}increaseSize(){this.connections.length<this.coreConnectionsLength&&!this.hasScheduledNewConnection()&&this.scheduleNewConnectionAttempt(0)}getAndResetResponseCounter(){let e=this.responseCounter;return this.responseCounter=0,e}isClosing(){return this._state!==Me.initial}drainAndShutdown(){if(this.isClosing())return;if(this._state=Me.closing,this.clearNewConnectionAttempt(),this.connections.length===0)return this._afterClosing();let e=this,t=this.connections;this.connections=Di.emptyArray;let r=0;this.log("info",$f.format("Draining and closing %d connections to %s",t.length,this._address));let i=!1,s;for(let c=0;c<t.length;c++){let u=t[c];if(u.getInFlight()===0){o(u)();continue}u.emitDrain=!0,u.once("drain",o(u))}function o(c){return function(){c.close(),!(++r<t.length)&&(i||(i=!0,s&&clearTimeout(s),e._afterClosing()))}}let a=(this.options.socketOptions.readTimeout||O0().socketOptions.readTimeout)+100;s=setTimeout(function(){i=!0,t.forEach(function(f){f.close()}),e._afterClosing()},a)}_afterClosing(){let e=this;function t(){e._state===Me.shuttingDown?e._state=Me.shutDown:e._state=Me.initial,e.emit("close"),e._state===Me.shutDown&&e.emit("shutdown")}if(this._opening)return this.once("open",t);t()}async shutdown(){if(this.clearNewConnectionAttempt(),!this.connections.length){this._state=Me.shutDown;return}let e=this._state;if(this._state=Me.shuttingDown,e===Me.closing||e===Me.shuttingDown)return Lr.fromEvent(this,"shutdown");await this._closeAllConnections(),this._state=Me.shutDown,this.emit("shutdown")}async _closeAllConnections(){let e=this.connections;this.connections=Di.emptyArray,e.length!==0&&(this.log("info",$f.format("Closing %d connections to %s",e.length,this._address)),await Promise.all(e.map(t=>t.closeAsync())))}};function O0(){return ma===void 0&&(ma=P0.defaultOptions()),ma}Qf.exports=ya});var Ea=C((zx,Jf)=>{"use strict";var wa=j(),Yf=O(),R0=H(),Xf=Be(),_a=class n{constructor(e,t){this._client=e,this._loadBalancing=t,this.logEmitter=e.options.logEmitter,this.log=Yf.log}static async getPrepared(e,t,r,i){let s=e.metadata.getPreparedInfo(i,r);return s.queryId?s:s.preparing?await Xf.fromEvent(s,"prepared"):await new n(e,t)._prepare(s,r,i)}static async getPreparedMultiple(e,t,r,i){let s=[];for(let o of r){let a;if(o&&(a=typeof o=="string"?o:o.query),typeof a!="string")throw new wa.ArgumentError("Query item should be a string");let{queryId:c,meta:u}=await n.getPrepared(e,t,a,i);s.push({query:a,params:Yf.adaptNamedParamsPrepared(o.params,u.columns),queryId:c,meta:u})}return s}async _prepare(e,t,r){e.preparing=!0;let i;try{return i=await Xf.newQueryPlan(this._loadBalancing,r,null),await this._prepareWithQueryPlan(e,i,t,r)}catch(s){throw e.preparing=!1,s.query=t,e.emit("prepared",s),s}}async _prepareWithQueryPlan(e,t,r,i){let s={};for(;;){let o=n.getNextHost(t,this._client.profileManager,s);if(o===null)throw new wa.NoHostAvailableError(s);try{let c=await(await n._borrowWithKeyspace(o,i)).prepareOnceAsync(r,i);return this._client.options.prepareOnAllHosts&&await this._prepareOnAllHosts(t,r,i),e.preparing=!1,e.queryId=c.id,e.meta=c.meta,this._client.metadata.setPreparedById(e),e.emit("prepared",null,e),e}catch(a){if(s[o.address]=a,!a.isSocketError&&!(a instanceof wa.OperationTimedOutError))throw a}}}static getNextHost(e,t,r){let i;for(;;){let s=e.next();if(s.done)return null;if(i=s.value,t.getDistance(i)!==R0.distance.ignored){if(i.isUp())break;r&&(r[i.address]="Host considered as DOWN")}}return i}static async prepareAllQueries(e,t){let r=[],i=new Map;t.forEach(s=>{let o;s.keyspace?(o=i.get(s.keyspace),o||(o=[],i.set(s.keyspace,o))):o=r,o.push(s.query)});for(let[s,o]of i)await n._borrowAndPrepare(e,s,o);await n._borrowAndPrepare(e,null,r)}static async _borrowAndPrepare(e,t,r){if(r.length===0)return;let i=await n._borrowWithKeyspace(e,t);for(let s of r)await i.prepareOnceAsync(s,t)}static async _borrowWithKeyspace(e,t){let r=e.borrowConnection();return t&&r.keyspace!==t&&await r.changeKeyspace(t),r}_prepareOnAllHosts(e,t,r){let i=[t],s,o=[];for(;(s=n.getNextHost(e,this._client.profileManager))!==null;)o.push(s);return Promise.all(o.map(a=>n._borrowAndPrepare(a,r,i).catch(c=>this.log("verbose",`Unexpected error while preparing query (${t}) on ${a.address}`,c))))}};Jf.exports=_a});var nd=C((Hx,td)=>{"use strict";var ed=require("events"),Fi=O(),ki=H(),L0=Zf(),q0=Ea(),D0=Be(),F0=200,Ta=class extends ed.EventEmitter{constructor(e,t,r,i){super(),this.address=e,this.setDownAt=0,this.log=Fi.log,this.isUpSince=null,Object.defineProperty(this,"options",{value:r,enumerable:!1,writable:!1}),Object.defineProperty(this,"pool",{value:new L0(this,t),enumerable:!1}),this.pool.on("open",s=>D0.toBackground(this._onNewConnectionOpen(s))),this.pool.on("remove",()=>this._checkPoolState()),this.cassandraVersion=null,this.datacenter=null,this.rack=null,this.tokens=null,this.hostId=null,this.dseVersion=null,this.workloads=Fi.emptyArray,this._distance=ki.distance.ignored,this._healthResponseCounter=0,Object.defineProperty(this,"_metadata",{value:i,enumerable:!1}),Object.defineProperty(this,"_healthResponseCountTimer",{value:null,enumerable:!1,writable:!0}),this.reconnectionSchedule=this.options.policies.reconnection.newSchedule(),this.reconnectionDelay=0}setDown(){this.setDownAt===0&&(this.pool.isClosing()||(this.setDownAt=Date.now(),this.pool.coreConnectionsLength>0?this.log("warning",`Host ${this.address} considered as DOWN. Reconnection delay ${this.reconnectionDelay}ms.`):this.log("info",`Host ${this.address} considered as DOWN.`),this.emit("down"),this._checkPoolState()))}setUp(e){this.setDownAt&&(this.log("info",`Setting host ${this.address} as UP`),this.setDownAt=0,this.isUpSince=Date.now(),this.reconnectionSchedule=this.options.policies.reconnection.newSchedule(),e&&this.pool.clearNewConnectionAttempt(),this.emit("up"))}checkIsUp(){this.isUp()||(this.reconnectionSchedule=this.options.policies.reconnection.newSchedule(),this.reconnectionDelay=0,this.pool.attemptNewConnectionImmediate())}shutdown(e){return this._healthResponseCountTimer&&clearInterval(this._healthResponseCountTimer),e?(this.pool.drainAndShutdown(),Promise.resolve()):this.pool.shutdown()}isUp(){return!this.setDownAt}canBeConsideredAsUp(){let e=this;function t(){return new Date().getTime()-e.setDownAt>=e.reconnectionDelay}return!this.setDownAt||t()}setDistance(e){let t=this._distance;return this._distance=e||ki.distance.local,this.options.pooling.coreConnectionsPerHost?this.pool.coreConnectionsLength=this.options.pooling.coreConnectionsPerHost[this._distance]||0:this.pool.coreConnectionsLength=1,this._distance===t?this._distance:(this._healthResponseCountTimer&&clearInterval(this._healthResponseCountTimer),this._distance===ki.distance.ignored?(this.emit("ignore"),this.pool.drainAndShutdown()):(this.isUp()||this.checkIsUp(),this._healthResponseCountTimer=setInterval(()=>{this._healthResponseCounter=this.pool.getAndResetResponseCounter()},F0)),this._distance)}setProtocolVersion(e){this.pool.protocolVersion=e}borrowConnection(e){return this.pool.borrowConnection(e)}warmupPool(e){return this.pool.warmup(e)}initializePool(){this.pool.increaseSize()}getActiveConnection(){return!this.isUp()||!this.pool.connections.length?null:this.pool.connections[0]}getResponseCount(){return this._healthResponseCounter+this.pool.responseCounter}checkHealth(e){e.timedOutOperations<=this.options.socketOptions.defunctReadTimeoutThreshold||this.removeFromPool(e)}removeFromPool(e){this.pool.remove(e),this._checkPoolState()}getInFlight(){return this.pool.getInFlight()}_checkPoolState(){if(this.pool.isClosing())return;this.pool.connections.length<this.pool.coreConnectionsLength&&(this.pool.hasScheduledNewConnection()||(this.reconnectionDelay=this.reconnectionSchedule.next().value,this.pool.scheduleNewConnectionAttempt(this.reconnectionDelay))),this._distance!==ki.distance.ignored&&this.pool.coreConnectionsLength>0&&this.pool.connections.length===0&&this.setDown()}async _onNewConnectionOpen(e){if(e){this._checkPoolState();return}if(!this.isUp()&&this.options.rePrepareOnUp){this.log("info",`Re-preparing all queries on host ${this.address} before setting it as UP`);let t=this._metadata.getAllPrepared();try{await q0.prepareAllQueries(this,t)}catch(r){this.log("warning",`Failed re-preparing on host ${this.address}: ${r}`,r)}}this.setUp(),this.pool.increaseSize()}getCassandraVersion(){return this.cassandraVersion?this.cassandraVersion.split("-")[0].split(".").map(e=>parseInt(e,10)):Fi.emptyArray}getDseVersion(){return this.dseVersion?this.dseVersion.split("-")[0].split(".").map(e=>parseInt(e,10)):Fi.emptyArray}},Sa=class extends ed.EventEmitter{constructor(){super(),this._items=new Map,this._values=null,Object.defineProperty(this,"length",{get:()=>this.values().length,enumerable:!0})}forEach(e){let t=this._items;for(let[r,i]of t)e(i,r)}get(e){return this._items.get(e)}keys(){return Array.from(this._items.keys())}remove(e){let t=this._items.get(e);if(t===void 0)return;this._values=null;let r=new Map(this._items);r.delete(e),this._items=r,this.emit("remove",t)}removeMultiple(e){this._values=null;let t=new Map(this._items),r=[];for(let i of e){let s=t.get(i);s&&(r.push(s),t.delete(i))}this._items=t,r.forEach(i=>this.emit("remove",i))}set(e,t){this._values=null;let r=this._items.get(e);if(r){this._items.set(e,t),this.emit("remove",r),this.emit("add",t);return}let i=new Map(this._items);return i.set(e,t),this._items=i,this.emit("add",t),t}slice(e,t){return!e&&!t?this.values():this.values().slice(e||0,t)}push(e,t){this.set(e,t)}values(){return this._values||(this._values=Object.freeze(Array.from(this._items.values()))),this._values}clear(){let e=this.values();return this._values=null,this._items=new Map,e.forEach(t=>this.emit("remove",t)),e}inspect(){return this._items}toJSON(){if(Object.fromEntries)return Object.fromEntries(this._items);let e={};for(let[t,r]of this._items)e[t]=r;return e}};td.exports={Host:Ta,HostMap:Sa}});var id=C(Vi=>{"use strict";var k0=H(),Wt=xr(),Ca=O(),ae=Go(),{Integer:Ce}=k0,Ui=new ae(21461,4418,31633,34755),Mi=new ae(37759,10053,44355,19701),rd=ae.fromNumber(5),U0=new ae(36045,60757,45015,65361),M0=new ae(60499,6789,47614,50382),V0=ae.fromNumber(1390208809),z0=ae.fromNumber(944331445),Dr=class{constructor(){}hash(e){throw new Error("You must implement a hash function for the tokenizer")}parse(e){throw new Error("You must implement a parse function for the tokenizer")}minToken(){throw new Error("You must implement a minToken function for the tokenizer")}split(e,t,r){throw new Error("You must implement a split function for the tokenizer")}splitBase(e,t,r,i,s){let o=Ce.fromInt(s),a=t.divide(o),c=t.modulo(o),u=[],f=e,g=a.add(Ce.ONE);for(let S=1;S<s;S++)c.greaterThan(Ce.ZERO)?f=f.add(g):f=f.add(a),i&&f.greaterThan(r)&&(f=f.subtract(i)),u.push(f),c=c.subtract(Ce.ONE);return u}stringify(e){return e.getValue().toString()}},xa=class extends Dr{constructor(){super()}hash(e){let t=e,r=0,i=t.length,s=i>>4,o=new ae,a=new ae,c=new ae,u=new ae;for(let f=0;f<s;f++)c=this.getBlock(t,r,f*2),u=this.getBlock(t,r,f*2+1),c.multiply(Ui),this.rotl64(c,31),c.multiply(Mi),o.xor(c),this.rotl64(o,27),o.add(a),o.multiply(rd).add(V0),u.multiply(Mi),this.rotl64(u,33),u.multiply(Ui),a.xor(u),this.rotl64(a,31),a.add(o),a.multiply(rd).add(z0);switch(r+=s*16,c=new ae,u=new ae,i&15){case 15:u.xor(Le(t[r+14]).shiftLeft(48));case 14:u.xor(Le(t[r+13]).shiftLeft(40));case 13:u.xor(Le(t[r+12]).shiftLeft(32));case 12:u.xor(Le(t[r+11]).shiftLeft(24));case 11:u.xor(Le(t[r+10]).shiftLeft(16));case 10:u.xor(Le(t[r+9]).shiftLeft(8));case 9:u.xor(Le(t[r+8])),u.multiply(Mi),this.rotl64(u,33),u.multiply(Ui),a.xor(u);case 8:c.xor(Le(t[r+7]).shiftLeft(56));case 7:c.xor(Le(t[r+6]).shiftLeft(48));case 6:c.xor(Le(t[r+5]).shiftLeft(40));case 5:c.xor(Le(t[r+4]).shiftLeft(32));case 4:c.xor(Le(t[r+3]).shiftLeft(24));case 3:c.xor(Le(t[r+2]).shiftLeft(16));case 2:c.xor(Le(t[r+1]).shiftLeft(8));case 1:c.xor(Le(t[r])),c.multiply(Ui),this.rotl64(c,31),c.multiply(Mi),o.xor(c)}return o.xor(ae.fromNumber(i)),a.xor(ae.fromNumber(i)),o.add(a),a.add(o),this.fmix(o),this.fmix(a),o.add(a),new Wt.Murmur3Token(o)}getBlock(e,t,r){let i=r<<3,s=t+i;return new ae(e[s]|e[s+1]<<8,e[s+2]|e[s+3]<<8,e[s+4]|e[s+5]<<8,e[s+6]|e[s+7]<<8)}rotl64(e,t){let r=e.clone().shiftLeft(t);e.shiftRightUnsigned(64-t).or(r)}fmix(e){e.xor(new ae(e.getUint16(2)>>>1|e.getUint16(3)<<15&65535,e.getUint16(3)>>>1,0,0)),e.multiply(U0);let t=new ae(e.getUint16(2)>>>1|e.getUint16(3)<<15&65535,e.getUint16(3)>>>1,0,0);e.xor(t),e.multiply(M0),e.xor(new ae(e.getUint16(2)>>>1|e.getUint16(3)<<15&65535,e.getUint16(3)>>>1,0,0))}parse(e){return new Wt.Murmur3Token(ae.fromString(e))}minToken(){return this._minToken||(this._minToken=this.parse("-9223372036854775808")),this._minToken}maxToken(){return this._maxToken||(this._maxToken=this.parse("9223372036854775807")),this._maxToken}maxValue(){return this._maxValue||(this._maxValue=Ce.fromString("9223372036854775807")),this._maxValue}minValue(){return this._minValue||(this._minValue=Ce.fromString("-9223372036854775808")),this._minValue}ringLength(){return this._ringLength||(this._ringLength=this.maxValue().subtract(this.minValue())),this._ringLength}split(e,t,r){e.equals(t)&&e.equals(this.minToken())&&(t=this.maxToken());let i=Ce.fromString(e.getValue().toString()),o=Ce.fromString(t.getValue().toString()).subtract(i);return o.isNegative()&&(o=o.add(this.ringLength())),this.splitBase(i,o,this.maxValue(),this.ringLength(),r).map(c=>this.parse(c.toString()))}stringify(e){let t=e.getValue();return t.getUint16(0)+","+t.getUint16(1)+","+t.getUint16(2)+","+t.getUint16(3)}},ba=class extends Dr{constructor(){super(),this._crypto=require("crypto")}hash(e){Array.isArray(e)&&(e=Ca.allocBufferFromArray(e));let t=this._crypto.createHash("md5").update(e).digest();return new Wt.RandomToken(Ce.fromBuffer(t).abs())}parse(e){return new Wt.RandomToken(Ce.fromString(e))}minToken(){return this._minToken||(this._minToken=this.parse("-1")),this._minToken}maxValue(){return this._maxValue||(this._maxValue=Ce.fromNumber(Math.pow(2,127))),this._maxValue}maxToken(){return this._maxToken||(this._maxToken=new Wt.RandomToken(this.maxValue())),this._maxToken}ringLength(){return this._ringLength||(this._ringLength=this.maxValue().add(Ce.ONE)),this._ringLength}split(e,t,r){e.equals(t)&&e.equals(this.minToken())&&(t=this.maxToken());let i=e.getValue(),o=t.getValue().subtract(i);return o.lessThan(Ce.ZERO)&&(o=o.add(this.ringLength())),this.splitBase(i,o,this.maxValue(),this.ringLength(),r).map(c=>new Wt.RandomToken(c))}},va=class extends Dr{constructor(){super()}hash(e){Array.isArray(e)&&(e=Ca.allocBufferFromArray(e));let t=e.length;for(let r=e.length-1;r>0&&e[r]===0;r--)t=r;return new Wt.ByteOrderedToken(e.slice(0,t))}stringify(e){return e.getValue().toString("hex")}parse(e){return this.hash(Ca.allocBufferFromString(e,"hex"))}minToken(){return this._minToken||(this._minToken=this.hash([])),this._minToken}_toNumber(e,t){let r=e;e.length!==t&&(r=Buffer.alloc(t),e.copy(r));let i=new Array(Math.ceil(r.length/4));for(let s=0;s<i.length;s++){let o=r.length-(s+1)*4,a;if(o<0){o=o+4,a=0;for(let c=0;c<o;c++){let u=r[c];a=a|u<<(o-c-1)*8}}else a=r.readInt32BE(o);i[s]=a}return new Ce(i,0)}_toBuffer(e,t){let r=Ce.toBuffer(e);if(r.length===t)return r;let i,s;r[0]===0?(i=1,s=r.length-1):(i=0,s=r.length);let o=Buffer.alloc(t);return r.copy(o,t-s,i,s+i),o}split(e,t,r){let i=e.compare(t);if(i===0&&e.equals(this.minToken()))throw new Error("Cannot split whole ring with ordered partitioner");let s,o,a,c,u,f=Ce.fromNumber(r),g=Math.max(e.getValue().length,t.getValue().length);if(i<0){let p=0;for(;s=this._toNumber(e.getValue(),g),o=this._toNumber(t.getValue(),g),a=o.subtract(s),!(p===4||a.compare(f)>=0);)g+=1,p+=1}else{let p=0;for(;s=this._toNumber(e.getValue(),g),o=this._toNumber(t.getValue(),g),c=Ce.fromNumber(Math.pow(2,g*8)),u=c.subtract(Ce.ONE),a=o.subtract(s).add(c),!(p===4||a.compare(f)>=0);)g+=1,p+=1}return this.splitBase(s,a,u,c,r).map(p=>new Wt.ByteOrderedToken(this._toBuffer(p,g)))}};function Le(n){return n<128?new ae(n,0,0,0):new ae(n-256&65535,65535,65535,65535)}Vi.Murmur3Tokenizer=xa;Vi.RandomTokenizer=ba;Vi.ByteOrderedTokenizer=va});var Na=C((jx,ad)=>{"use strict";var H0=require("util"),sd=require("events");function od(n){sd.EventEmitter.call(this),this.setMaxListeners(0),Object.defineProperty(this,"loading",{value:!1,enumerable:!1,writable:!0}),Object.defineProperty(this,"loaded",{value:!1,enumerable:!1,writable:!0}),this.name=n,this.bloomFilterFalsePositiveChance=0,this.caching=null,this.comment=null,this.gcGraceSeconds=0,this.compactionClass=null,this.compactionOptions=null,this.compression=null,this.localReadRepairChance=0,this.readRepairChance=0,this.extensions=null,this.crcCheckChance=null,this.populateCacheOnFlush=!1,this.defaultTtl=0,this.speculativeRetry="NONE",this.minIndexInterval=128,this.maxIndexInterval=2048,this.columns=null,this.columnsByName=null,this.partitionKeys=[],this.clusteringKeys=[],this.clusteringOrder=[],this.nodesync=null}H0.inherits(od,sd.EventEmitter);ad.exports=od});var hd=C((Gx,ld)=>{"use strict";var K0=require("util"),cd=Na();function ud(n){cd.call(this,n),this.replicateOnWrite=!0,this.memtableFlushPeriod=0,this.indexInterval=null,this.isCompact=!1,this.indexes=null,this.cdc=null,this.virtual=!1}K0.inherits(ud,cd);ld.exports=ud});var dd=C((Wx,fd)=>{"use strict";function j0(){this.name=null,this.keyspaceName=null,this.signature=null,this.argumentTypes=null,this.stateFunction=null,this.stateType=null,this.finalFunction=null,this.initConditionRaw=null,this.initCondition=null,this.returnType=null,this.deterministic=null}fd.exports=j0});var gd=C(($x,pd)=>{"use strict";function G0(){this.name=null,this.keyspaceName=null,this.signature=null,this.argumentNames=null,this.argumentTypes=null,this.body=null,this.calledOnNullInput=null,this.language=null,this.returnType=null,this.deterministic=null,this.monotonic=null,this.monotonicOn=null}pd.exports=G0});var yd=C((Qx,md)=>{"use strict";var Aa=require("util"),W0=O(),Ia=H(),Fr={custom:0,keys:1,composites:2};function $t(n,e,t,r){this.name=n,this.target=e,this.kind=typeof t=="string"?Pa(t):t,this.options=r}$t.prototype.isCompositesKind=function(){return this.kind===Fr.composites};$t.prototype.isKeysKind=function(){return this.kind===Fr.keys};$t.prototype.isCustomKind=function(){return this.kind===Fr.custom};$t.fromRows=function(n){return!n||n.length===0?W0.emptyArray:n.map(function(e){let t=e.options;return new $t(e.index_name,t.target,Pa(e.kind),t)})};$t.fromColumnRows=function(n,e){let t=[];for(let r=0;r<n.length;r++){let i=n[r],s=i.index_name;if(!s)continue;let o=e[i.column_name],a,c=JSON.parse(i.index_options);c!==null&&c.index_keys!==void 0?a=Aa.format("keys(%s)",o.name):c!==null&&c.index_keys_and_values!==void 0?a=Aa.format("entries(%s)",o.name):o.type.options.frozen&&(o.type.code===Ia.dataTypes.map||o.type.code===Ia.dataTypes.list||o.type.code===Ia.dataTypes.set)?a=Aa.format("full(%s)",o.name):a=o.name,t.push(new $t(s,a,Pa(i.index_type),c))}return t};function Pa(n){return n?Fr[n.toLowerCase()]:Fr.custom}md.exports=$t});var Td=C((Zx,Ed)=>{"use strict";var $0=require("util"),wd=Na();function _d(n){wd.call(this,n),this.tableName=null,this.whereClause=null,this.includeAllColumns=!1}$0.inherits(_d,wd);Ed.exports=_d});var Bd=C(Ra=>{"use strict";var kr=require("util"),Sd=require("events"),Q0=H(),be=O(),Z0=j(),zi=Be(),Y0=hd(),bd=dd(),vd=gd(),Nd=yd(),Cd=Td(),{format:hn}=kr,X0="SELECT * FROM system.schema_keyspaces",J0="SELECT * FROM system.schema_keyspaces where keyspace_name = '%s'",Ad="SELECT * FROM system_schema.keyspaces",Id="SELECT * FROM system_schema.keyspaces where keyspace_name = '%s'",eE="SELECT * FROM system.schema_columnfamilies WHERE keyspace_name='%s' AND columnfamily_name='%s'",tE="SELECT * FROM system_schema.tables WHERE keyspace_name='%s' AND table_name='%s'",nE="SELECT * FROM system.schema_columns WHERE keyspace_name='%s' AND columnfamily_name='%s'",rE="SELECT * FROM system_schema.columns WHERE keyspace_name='%s' AND table_name='%s'",iE="SELECT * FROM system_schema.indexes WHERE keyspace_name='%s' AND table_name='%s'",sE="SELECT * FROM system.schema_usertypes WHERE keyspace_name='%s' AND type_name='%s'",oE="SELECT * FROM system_schema.types WHERE keyspace_name='%s' AND type_name='%s'",aE="SELECT * FROM system.schema_functions WHERE keyspace_name = '%s' AND function_name = '%s'",cE="SELECT * FROM system_schema.functions WHERE keyspace_name = '%s' AND function_name = '%s'",uE="SELECT * FROM system.schema_aggregates WHERE keyspace_name = '%s' AND aggregate_name = '%s'",lE="SELECT * FROM system_schema.aggregates WHERE keyspace_name = '%s' AND aggregate_name = '%s'",hE="SELECT * FROM system_schema.views WHERE keyspace_name = '%s' AND view_name = '%s'",fE="SELECT * FROM system_virtual_schema.keyspaces",dE="SELECT * FROM system_virtual_schema.keyspaces where keyspace_name = '%s'",xd="SELECT * FROM system_virtual_schema.tables where keyspace_name = '%s' and table_name='%s'",pE="SELECT * FROM system_virtual_schema.columns where keyspace_name = '%s' and table_name='%s'",Hi=class{constructor(e,t){this.cc=t,this.encodingOptions=e.encoding,this.selectTable=null,this.selectColumns=null,this.selectIndexes=null,this.selectUdt=null,this.selectAggregates=null,this.selectFunctions=null,this.supportsVirtual=!1}_createKeyspace(e,t,r,i,s){return{name:e,durableWrites:t,strategy:r,strategyOptions:i,virtual:s===!0,udts:{},tables:{},functions:{},aggregates:{},views:{},tokenToReplica:yE(r,i),graphEngine:void 0}}getKeyspace(e){}getKeyspaces(e){}async getTable(e,t,r,i){let s=r&&r[t];if(s||(s=new Y0(t),r&&(r[t]=s)),s.loaded)return s;if(s.loading)return zi.fromEvent(s,"load");try{s.loading=!0;let o,a=i,c=a?xd:this.selectTable,u=kr.format(c,e,t),f=await this._getFirstRow(u);if(!f&&this.supportsVirtual&&a===void 0){let p=kr.format(xd,e,t);try{f=await this._getFirstRow(p)}catch{}f&&(a=!0)}if(!f)return s.loading=!1,s.emit("load",null,null),null;let g=a?pE:this.selectColumns,S=await this._getRows(kr.format(g,e,t));return this.selectIndexes&&!a&&(o=await this._getRows(kr.format(this.selectIndexes,e,t))),await this._parseTableOrView(s,f,S,o,a),s.loaded=!0,s.emit("load",null,s),s}catch(o){throw s.emit("load",o,null),o}finally{s.loading=!1}}async _getFirstRow(e){return(await this._getRows(e))[0]}async _getRows(e){return(await this.cc.query(e)).rows}async getUdt(e,t,r){let i=r&&r[t];if(i||(i=new Sd.EventEmitter,r&&(r[t]=i),i.setMaxListeners(0),i.loading=!1,i.name=t,i.keyspace=e,i.fields=null),i.fields)return i;if(i.loading)return zi.fromEvent(i,"load");i.loading=!0;let s=hn(this.selectUdt,e,t);try{let o=await this._getFirstRow(s);return o?(await this._parseUdt(i,o),i.emit("load",null,i),i):(i.loading=!1,i.emit("load",null,null),null)}catch(o){throw i.emit("load",o),o}finally{i.loading=!1}}_parseUdt(e,t){}async _parseTableOrView(e,t,r,i,s){}getMaterializedView(e,t,r){}async getFunctions(e,t,r,i){let s=this.selectFunctions,o=c=>this._parseFunction(c);r&&(s=this.selectAggregates,o=c=>this._parseAggregate(c));let a=i&&i[t];if(a||(a=new Sd.EventEmitter,i&&(i[t]=a),a.setMaxListeners(0)),a.values)return a.values;if(a.loading)return zi.fromEvent(a,"load");a.loading=!0;try{let c=await this._getRows(hn(s,e,t)),u=await Promise.all(c.map(o)),f=new Map;return c.length>0&&(a.values=f),u.forEach(g=>a.values.set(g.signature.join(","),g)),a.emit("load",null,f),f}catch(c){throw a.emit("load",c),c}finally{a.loading=!1}}_parseAggregate(e){}_parseFunction(e){}_asMap(e){return e?this.encodingOptions.map&&e instanceof this.encodingOptions.map?e:new Map(Object.keys(e).map(t=>[t,e[t]])):new Map}_mapAsObject(e){if(!e)return e;if(this.encodingOptions.map&&e instanceof this.encodingOptions.map){let t={};return e.forEach((r,i)=>t[i]=r),t}return e}},Ba=class extends Hi{constructor(e,t){super(e,t),this.selectTable=eE,this.selectColumns=nE,this.selectUdt=sE,this.selectAggregates=uE,this.selectFunctions=aE}async getKeyspaces(e){let t={},r=await this.cc.query(X0,e);for(let i=0;i<r.rows.length;i++){let s=r.rows[i],o=this._createKeyspace(s.keyspace_name,s.durable_writes,s.strategy_class,JSON.parse(s.strategy_options||null));t[o.name]=o}return t}async getKeyspace(e){let t=await this._getFirstRow(hn(J0,e));return t?this._createKeyspace(t.keyspace_name,t.durable_writes,t.strategy_class,JSON.parse(t.strategy_options)):null}async _parseTableOrView(e,t,r,i,s){let o,a,c,u=this.cc.getEncoder(),f={},g=[],S=[];e.bloomFilterFalsePositiveChance=t.bloom_filter_fp_chance,e.caching=t.caching,e.comment=t.comment,e.compactionClass=t.compaction_strategy_class,e.compactionOptions=JSON.parse(t.compaction_strategy_options),e.compression=JSON.parse(t.compression_parameters),e.gcGraceSeconds=t.gc_grace_seconds,e.localReadRepairChance=t.local_read_repair_chance,e.readRepairChance=t.read_repair_chance,e.populateCacheOnFlush=t.populate_io_cache_on_flush||e.populateCacheOnFlush,e.memtableFlushPeriod=t.memtable_flush_period_in_ms||e.memtableFlushPeriod,e.defaultTtl=t.default_time_to_live||e.defaultTtl,e.speculativeRetry=t.speculative_retry||e.speculativeRetry,e.indexInterval=t.index_interval||e.indexInterval,typeof t.min_index_interval<"u"?(e.minIndexInterval=t.min_index_interval||e.minIndexInterval,e.maxIndexInterval=t.max_index_interval||e.maxIndexInterval):(e.minIndexInterval=null,e.maxIndexInterval=null),typeof t.replicate_on_write<"u"&&(e.replicateOnWrite=t.replicate_on_write),e.columns=[];for(let _=0;_<r.length;_++){let w=r[_],E=u.parseFqTypeName(w.validator);switch(o={name:w.column_name,type:E,isStatic:!1},e.columns.push(o),f[o.name]=o,w.type){case"partition_key":g.push({c:o,index:w.component_index||0});break;case"clustering_key":S.push({c:o,index:w.component_index||0,order:o.type.options.reversed?"DESC":"ASC"});break;case"static":o.isStatic=!0;break}}g.length>0&&(e.partitionKeys=g.sort(be.propCompare("index")).map(_=>_.c),S.sort(be.propCompare("index")),e.clusteringKeys=S.map(_=>_.c),e.clusteringOrder=S.map(_=>_.order));let p=e.partitionKeys.length===0;if(p&&t.key_aliases){g=JSON.parse(t.key_aliases),c=u.parseKeyTypes(t.key_validator).types;for(let _=0;_<g.length;_++)a=g[_],o=f[a],o||(o={name:a,type:c[_]},e.columns.push(o)),e.partitionKeys.push(o)}let y=u.parseKeyTypes(t.comparator);if(p&&t.column_aliases){S=JSON.parse(t.column_aliases);for(let _=0;_<S.length;_++)a=S[_],o=f[a],o||(o={name:a,type:y.types[_]},e.columns.push(o)),e.clusteringKeys.push(o),e.clusteringOrder.push(o.type.options.reversed?"DESC":"ASC")}e.isCompact=!!t.is_dense,e.isCompact||(e.isCompact=!y.isComposite||!y.hasCollections&&e.clusteringKeys.length!==y.types.length-1),a=t.value_alias,e.isCompact&&a&&!f[a]&&(o={name:a,type:u.parseFqTypeName(t.default_validator)},e.columns.push(o),f[a]=o),e.columnsByName=f,e.indexes=Nd.fromColumnRows(r,e.columnsByName)}getMaterializedView(e,t,r){return Promise.reject(new Z0.NotSupportedError("Materialized views are not supported on Cassandra versions below 3.0"))}async _parseAggregate(e){let t=this.cc.getEncoder(),r=new bd;r.name=e.aggregate_name,r.keyspaceName=e.keyspace_name,r.signature=e.signature||be.emptyArray,r.stateFunction=e.state_func,r.finalFunction=e.final_func,r.initConditionRaw=e.initcond,r.argumentTypes=(e.argument_types||be.emptyArray).map(s=>t.parseFqTypeName(s)),r.stateType=t.parseFqTypeName(e.state_type);let i=t.decode(r.initConditionRaw,r.stateType);return i!==null&&typeof i<"u"&&(r.initCondition=i.toString()),r.returnType=t.parseFqTypeName(e.return_type),r}async _parseFunction(e){let t=this.cc.getEncoder(),r=new vd;return r.name=e.function_name,r.keyspaceName=e.keyspace_name,r.signature=e.signature||be.emptyArray,r.argumentNames=e.argument_names||be.emptyArray,r.body=e.body,r.calledOnNullInput=e.called_on_null_input,r.language=e.language,r.argumentTypes=(e.argument_types||be.emptyArray).map(i=>t.parseFqTypeName(i)),r.returnType=t.parseFqTypeName(e.return_type),r}async _parseUdt(e,t){let r=this.cc.getEncoder(),i=t.field_names,s=t.field_types,o=new Array(i.length);for(let a=0;a<i.length;a++)o[a]={name:i[a],type:r.parseFqTypeName(s[a])};return e.fields=o,e}},Ki=class extends Hi{constructor(e,t,r){super(e,t),this.udtResolver=r,this.selectTable=tE,this.selectColumns=rE,this.selectUdt=oE,this.selectAggregates=lE,this.selectFunctions=cE,this.selectIndexes=iE}async getKeyspaces(e){let t={},r=await this.cc.query(Ad,e);for(let i=0;i<r.rows.length;i++){let s=this._parseKeyspace(r.rows[i]);t[s.name]=s}return t}async getKeyspace(e){let t=await this._getFirstRow(hn(Id,e));return t?this._parseKeyspace(t):null}async getMaterializedView(e,t,r){let i=r&&r[t];if(i||(i=new Cd(t),r&&(r[t]=i)),i.loaded)return i;if(i.loading)return zi.fromEvent(i,"load");i.loading=!0;try{let s=await this._getFirstRow(hn(hE,e,t));if(!s)return i.emit("load",null,null),i.loading=!1,null;let o=await this._getRows(hn(this.selectColumns,e,t));return await this._parseTableOrView(i,s,o,null,!1),i.loaded=!0,i.emit("load",null,i),i}catch(s){throw i.emit("load",s),s}finally{i.loading=!1}}_parseKeyspace(e,t){let r=e.replication,i,s;if(r){i=r.class,s={};for(let a in r)!r.hasOwnProperty(a)||a==="class"||(s[a]=r[a])}let o=this._createKeyspace(e.keyspace_name,e.durable_writes,i,s,t);return o.graphEngine=e.graph_engine,o}async _parseTableOrView(e,t,r,i,s){let o=this.cc.getEncoder(),a={},c=[],u=[];if(e.columns=await Promise.all(r.map(async E=>{let v=await o.parseTypeName(t.keyspace_name,E.type,0,null,this.udtResolver),l={name:E.column_name,type:v,isStatic:!1};switch(a[l.name]=l,E.kind){case"partition_key":c.push({c:l,index:E.position||0});break;case"clustering":u.push({c:l,index:E.position||0,order:E.clustering_order==="desc"?"DESC":"ASC"});break;case"static":l.isStatic=!0;break}return l})),e.columnsByName=a,e.partitionKeys=c.sort(be.propCompare("index")).map(E=>E.c),u.sort(be.propCompare("index")),e.clusteringKeys=u.map(E=>E.c),e.clusteringOrder=u.map(E=>E.order),s){e.virtual=!0;return}let f=e instanceof Cd;e.bloomFilterFalsePositiveChance=t.bloom_filter_fp_chance,e.caching=JSON.stringify(t.caching),e.comment=t.comment;let g=this._asMap(t.compaction);if(g&&(e.compactionOptions={},e.compactionClass=g.get("class"),g.forEach((E,v)=>{v!=="class"&&(e.compactionOptions[v]=g.get(v))})),e.compression=this._mapAsObject(t.compression),e.gcGraceSeconds=t.gc_grace_seconds,e.localReadRepairChance=t.dclocal_read_repair_chance,e.readRepairChance=t.read_repair_chance,e.extensions=this._mapAsObject(t.extensions),e.crcCheckChance=t.crc_check_chance,e.memtableFlushPeriod=t.memtable_flush_period_in_ms||e.memtableFlushPeriod,e.defaultTtl=t.default_time_to_live||e.defaultTtl,e.speculativeRetry=t.speculative_retry||e.speculativeRetry,e.minIndexInterval=t.min_index_interval||e.minIndexInterval,e.maxIndexInterval=t.max_index_interval||e.maxIndexInterval,e.nodesync=t.nodesync||e.nodesync,!f){let E=t.cdc;E!==void 0&&(e.cdc=E)}if(f){e.tableName=t.base_table_name,e.whereClause=t.where_clause,e.includeAllColumns=t.include_all_columns;return}e.indexes=this._getIndexes(i);let S=t.flags;Array.isArray(S)&&(S=new Set(S));let p=S.has("dense"),y=S.has("super"),_=S.has("compound");e.isCompact=y||p||!_,!y&&!p&&!_?gE(e):p&&mE(e)}_getIndexes(e){return!e||e.length===0?be.emptyArray:e.map(t=>{let r=this._mapAsObject(t.options);return new Nd(t.index_name,r.target,t.kind,r)})}async _parseAggregate(e){let t=this.cc.getEncoder(),r=new bd;return r.name=e.aggregate_name,r.keyspaceName=e.keyspace_name,r.signature=e.argument_types||be.emptyArray,r.stateFunction=e.state_func,r.finalFunction=e.final_func,r.initConditionRaw=e.initcond,r.initCondition=r.initConditionRaw,r.deterministic=e.deterministic||!1,r.argumentTypes=await Promise.all(r.signature.map(i=>t.parseTypeName(e.keyspace_name,i,0,null,this.udtResolver))),r.stateType=await t.parseTypeName(e.keyspace_name,e.state_type,0,null,this.udtResolver),r.returnType=await t.parseTypeName(e.keyspace_name,e.return_type,0,null,this.udtResolver),r}async _parseFunction(e){let t=this.cc.getEncoder(),r=new vd;return r.name=e.function_name,r.keyspaceName=e.keyspace_name,r.signature=e.argument_types||be.emptyArray,r.argumentNames=e.argument_names||be.emptyArray,r.body=e.body,r.calledOnNullInput=e.called_on_null_input,r.language=e.language,r.deterministic=e.deterministic||!1,r.monotonic=e.monotonic||!1,r.monotonicOn=e.monotonic_on||be.emptyArray,r.argumentTypes=await Promise.all(r.signature.map(i=>t.parseTypeName(e.keyspace_name,i,0,null,this.udtResolver))),r.returnType=await t.parseTypeName(e.keyspace_name,e.return_type,0,null,this.udtResolver),r}async _parseUdt(e,t){let r=this.cc.getEncoder(),i=t.field_types,s=t.keyspace_name;return e.fields=await Promise.all(t.field_names.map(async(o,a)=>{let c=await r.parseTypeName(s,i[a],0,null,this.udtResolver);return{name:o,type:c}})),e}},Oa=class extends Ki{constructor(e,t,r){super(e,t,r),this.supportsVirtual=!0}async getKeyspaces(e){let t={},r=[{query:Ad,virtual:!1},{query:fE,virtual:!0}];return await Promise.all(r.map(async i=>{let s=null;try{s=await this.cc.query(i.query,e)}catch(o){if(i.virtual)return;throw o}for(let o=0;o<s.rows.length;o++){let a=this._parseKeyspace(s.rows[o],i.virtual);t[a.name]=a}})),t}async getKeyspace(e){let t=await this._getKeyspace(Id,e,!1);return t||this._getKeyspace(dE,e,!0)}async _getKeyspace(e,t,r){try{let i=await this._getFirstRow(hn(e,t));return i?this._parseKeyspace(i,r):null}catch(i){if(r)return null;throw i}}};function gE(n){let e,t;for(e=0;e<n.clusteringKeys.length;e++){t=n.clusteringKeys[e];let r=n.columns.indexOf(t);n.columns.splice(r,1),delete n.columnsByName[t.name]}for(n.clusteringKeys=be.emptyArray,n.clusteringOrder=be.emptyArray,e=n.columns.length;e--;){if(t=n.columns[e],!t.isStatic&&n.partitionKeys.indexOf(t)===-1){n.columns.splice(e,1),delete n.columnsByName[t.name];continue}t.isStatic=!1}}function mE(n){let e=n.columns.length;for(;e--;){let t=n.columns[e];if(!t.isStatic&&t.type.code===Q0.dataTypes.custom&&t.type.info==="empty"){n.columns.splice(e,1),delete n.columnsByName[t.name];continue}t.isStatic=!1}}function yE(n,e){if(/SimpleStrategy$/.test(n)){let t=parseInt(e.replication_factor,10);if(t>1)return wE(t)}return/NetworkTopologyStrategy$/.test(n)?_E(e):function(r,i,s){let o={};for(let a in s)s.hasOwnProperty(a)&&(o[a]=[s[a]]);return o}}function wE(n){return function(t,r,i){let s=r.length,o=Math.min(n,s),a={};for(let c=0;c<s;c++){let u=r[c],f=[i[u]];for(let g=1;g<s&&f.length<o;g++){let S=c+g;S>=s&&(S=S%s);let p=i[r[S]];f.indexOf(p)===-1&&f.push(p)}a[u]=f}return a}}function _E(n){return function(t,r,i,s){let o={},a=r.length;for(let c=0;c<a;c++){let u=r[c],f=[],g={},S={},p=[];for(let y=0;y<a;y++){let _=c+y;_>=a&&(_=_%a);let w=i[r[_]];if(f.indexOf(w)!==-1)continue;let E=w.datacenter,v=parseInt(n[E],10);if(!v)continue;v=Math.min(v,s[E].hostLength);let l=g[E]||0;if(l>=v)continue;let d=S[E];if(d||(d=S[E]=new be.HashSet),w.rack&&d.contains(w.rack)&&d.length<s[E].racks.length){p.length<v-l&&p.push(w);continue}if(g[w.datacenter]=++l,f.push(w),w.rack&&d.add(w.rack)&&d.length===s[E].racks.length&&(g[E]+=EE(v,l,f,p)),Pd(n,s,g))break}o[u]=f}return o}}function EE(n,e,t,r){let i;for(i=0;i<n-e&&i<r.length;i++)t.push(r[i]);return i}function Pd(n,e,t){let r=Object.keys(n);for(let i=0;i<r.length;i++){let s=r[i],o=e[s];if(!o)continue;let a=Math.min(parseInt(n[s],10),o.hostLength);if(a>0&&(!t[s]||t[s]<a))return!1}return!0}function TE(n,e,t,r,i){let s=Ba;return r&&r[0]===3?s=Ki:r&&r[0]>=4&&(s=Oa),!i||!(i instanceof s)?new s(n,e,t):i}Ra.getByVersion=TE;Ra.isDoneForToken=Pd});var ka=C((Xx,Ld)=>{"use strict";var SE=require("events"),La=require("util"),qa=id(),ji=O(),Ur=j(),Wn=H(),Gi=jt(),Od=Bd(),st=Be(),{TokenRange:Wi}=xr(),{ExecutionOptions:CE}=Kt(),xE="SELECT * FROM system_traces.sessions WHERE session_id=%s",bE="SELECT * FROM system_traces.events WHERE session_id=%s",vE="SELECT schema_version FROM system.peers",NE="SELECT schema_version FROM system.local",Rd=5,AE=400,Da=class{constructor(e,t){if(!e)throw new Ur.ArgumentError("Options are not defined");Object.defineProperty(this,"options",{value:e,enumerable:!1,writable:!1}),Object.defineProperty(this,"controlConnection",{value:t,enumerable:!1,writable:!1}),this.keyspaces={},this.initialized=!1,this._isDbaas=!1,this._schemaParser=Od.getByVersion(e,t,this.getUdt.bind(this)),this.log=ji.log,this._preparedQueries=new Fa(e.maxPrepared,(...r)=>this.log(...r))}setCassandraVersion(e){this._schemaParser=Od.getByVersion(this.options,this.controlConnection,this.getUdt.bind(this),e,this._schemaParser)}isDbaas(){return this._isDbaas}setProductTypeAsDbaas(){this._isDbaas=!0}setPartitioner(e){return/RandomPartitioner$/.test(e)?this.tokenizer=new qa.RandomTokenizer:/ByteOrderedPartitioner$/.test(e)?this.tokenizer=new qa.ByteOrderedTokenizer:this.tokenizer=new qa.Murmur3Tokenizer}buildTokens(e){if(!this.tokenizer)return this.log("error","Tokenizer could not be determined");let t=[],r={},i=e.values(),s=this.tokenizer.stringify,o={};i.forEach(c=>{if(!c.tokens)return;c.tokens.forEach(f=>{let g=this.tokenizer.parse(f);ji.insertSorted(t,g,(S,p)=>S.compare(p)),r[s(g)]=c});let u=o[c.datacenter];u||(u=o[c.datacenter]={hostLength:0,racks:new ji.HashSet}),u.hostLength++,u.racks.add(c.rack)}),this.primaryReplicas=r,this.ring=t;let a=new Set;if(this.ring.length===1){let c=this.tokenizer.minToken();a.add(new Wi(c,c,this.tokenizer))}else for(let c=0;c<this.ring.length;c++){let u=this.ring[c],f=this.ring[(c+1)%this.ring.length];a.add(new Wi(u,f,this.tokenizer))}this.tokenRanges=a,this.ringTokensAsStrings=new Array(t.length);for(let c=0;c<t.length;c++)this.ringTokensAsStrings[c]=s(t[c]);this.datacenters=o}refreshKeyspace(e,t){return st.optionalCallback(this._refreshKeyspace(e),t)}async _refreshKeyspace(e){if(!this.initialized)throw this._uninitializedError();this.log("info",La.format("Retrieving keyspace %s metadata",e));try{let t=await this._schemaParser.getKeyspace(e);return t?(this.keyspaces[t.name]=t,t):(delete this.keyspaces[e],null)}catch(t){throw this.log("error","There was an error while trying to retrieve keyspace information",t),t}}refreshKeyspaces(e,t){if((typeof e=="function"||typeof e>"u")&&(t=e,e=!0),!this.initialized){let r=this._uninitializedError();return t?t(r):Promise.reject(r)}return st.optionalCallback(this.refreshKeyspacesInternal(e),t)}async refreshKeyspacesInternal(e){this.log("info","Retrieving keyspaces metadata");try{return this.keyspaces=await this._schemaParser.getKeyspaces(e),this.keyspaces}catch(t){throw this.log("error","There was an error while trying to retrieve keyspaces information",t),t}}_getKeyspaceReplicas(e){return e.replicas||(e.replicas=e.tokenToReplica(this.tokenizer,this.ringTokensAsStrings,this.primaryReplicas,this.datacenters)),e.replicas}getReplicas(e,t){if(!this.ring)return null;Buffer.isBuffer(t)&&(t=this.tokenizer.hash(t)),t instanceof Wi&&(t=t.end);let r;if(e&&(r=this.keyspaces[e],!r))return null;let i=ji.binarySearch(this.ring,t,(a,c)=>a.compare(c));i<0&&(i=~i),i>=this.ring.length&&(i=i%this.ring.length);let s=this.ringTokensAsStrings[i];return e?this._getKeyspaceReplicas(r)[s]:[this.primaryReplicas[s]]}getTokenRanges(){return this.tokenRanges}getTokenRangesForHost(e,t){if(!this.ring)return null;let r;if(e&&(r=this.keyspaces[e],!r))return null;if(this.ring.length===1)return this.getTokenRanges();let i=this._getKeyspaceReplicas(r),s=new Set;return this.tokenRanges.forEach(o=>{i[this.tokenizer.stringify(o.end)].indexOf(t)!==-1&&s.add(o)}),s}newToken(e){if(!this.tokenizer)throw new Error("Partitioner not established.  This should only happen if metadata was disabled or you have not connected yet.");return Array.isArray(e)?this.tokenizer.hash(Buffer.concat(e)):typeof e=="string"?this.tokenizer.parse(e):this.tokenizer.hash(e)}newTokenRange(e,t){if(!this.tokenizer)throw new Error("Partitioner not established.  This should only happen if metadata was disabled or you have not connected yet.");return new Wi(e,t,this.tokenizer)}getPreparedInfo(e,t){return this._preparedQueries.getOrAdd(e,t)}clearPrepared(){this._preparedQueries.clear()}getPreparedById(e){return this._preparedQueries.getById(e)}setPreparedById(e){return this._preparedQueries.setById(e)}getAllPrepared(){return this._preparedQueries.getAll()}_uninitializedError(){return new Error("Metadata has not been initialized.  This could only happen if you have not connected yet.")}getUdt(e,t,r){return st.optionalCallback(this._getUdt(e,t),r)}async _getUdt(e,t){if(!this.initialized)throw this._uninitializedError();let r;if(this.options.isMetadataSyncEnabled){let i=this.keyspaces[e];if(!i)return null;r=i.udts}return await this._schemaParser.getUdt(e,t,r)}getTable(e,t,r){return st.optionalCallback(this._getTable(e,t),r)}async _getTable(e,t){if(!this.initialized)throw this._uninitializedError();let r,i;if(this.options.isMetadataSyncEnabled){let s=this.keyspaces[e];if(!s)return null;r=s.tables,i=s.virtual}return await this._schemaParser.getTable(e,t,r,i)}getFunctions(e,t,r){return st.optionalCallback(this._getFunctionsWrapper(e,t),r)}async _getFunctionsWrapper(e,t){if(!e||!t)throw new Ur.ArgumentError("You must provide the keyspace name and cql function name to retrieve the metadata");let r=await this._getFunctions(e,t,!1);return Array.from(r.values())}getFunction(e,t,r,i){return st.optionalCallback(this._getSingleFunction(e,t,r,!1),i)}getAggregates(e,t,r){return st.optionalCallback(this._getAggregates(e,t),r)}async _getAggregates(e,t){if(!e||!t)throw new Ur.ArgumentError("You must provide the keyspace name and cql aggregate name to retrieve the metadata");let r=await this._getFunctions(e,t,!0);return Array.from(r.values())}getAggregate(e,t,r,i){return st.optionalCallback(this._getSingleFunction(e,t,r,!0),i)}getMaterializedView(e,t,r){return st.optionalCallback(this._getMaterializedView(e,t),r)}async _getMaterializedView(e,t){if(!this.initialized)throw this._uninitializedError();let r;if(this.options.isMetadataSyncEnabled){let i=this.keyspaces[e];if(!i)return null;r=i.views}return await this._schemaParser.getMaterializedView(e,t,r)}async _getFunctions(e,t,r){if(!this.initialized)throw this._uninitializedError();let i;if(this.options.isMetadataSyncEnabled){let s=this.keyspaces[e];if(!s)return new Map;i=r?s.aggregates:s.functions}return await this._schemaParser.getFunctions(e,t,r,i)}async _getSingleFunction(e,t,r,i){if(!e||!t)throw new Ur.ArgumentError("You must provide the keyspace name and cql function name to retrieve the metadata");if(!Array.isArray(r))throw new Ur.ArgumentError("Signature must be an array of types");return r=r.map(o=>typeof o=="string"?o:Wn.getDataTypeNameByCode(o)),(await this._getFunctions(e,t,i)).get(r.join(","))||null}getTrace(e,t,r){return!r&&typeof t=="function"&&(r=t,t=null),st.optionalCallback(this._getTrace(e,t),r)}async _getTrace(e,t){if(!this.initialized)throw this._uninitializedError();let r,i=0,s=CE.empty();s.getConsistency=()=>t;let o=new Gi.QueryRequest(La.format(xE,e),null,s),a=new Gi.QueryRequest(La.format(bE,e),null,s);for(;!r&&i++<Rd;){let u=(await this.controlConnection.query(o)).rows[0];if(!u||typeof u.duration!="number"){await st.delay(AE);continue}r={requestType:u.request,coordinator:u.coordinator,parameters:u.parameters,startedAt:u.started_at,duration:u.duration,clientAddress:u.client,events:null};let f=await this.controlConnection.query(a);r.events=f.rows.map(g=>({id:g.event_id,activity:g.activity,source:g.source,elapsed:g.source_elapsed,thread:g.thread}))}if(!r)throw new Error(`Trace ${e.toString()} could not fully retrieved after ${Rd} attempts`);return r}checkSchemaAgreement(e){return st.optionalCallback(this._checkSchemaAgreement(),e)}async _checkSchemaAgreement(){let e=this.controlConnection.connection;if(!e)return!1;try{return await this.compareSchemaVersions(e)}catch{return!1}}async adaptUserHints(e,t){if(!Array.isArray(t))return;let r=[];for(let i=0;i<t.length;i++){let s=t[i];if(typeof s!="string")continue;let o=Wn.dataTypes.getByName(s);this._checkUdtTypes(r,o,e),t[i]=o}for(let i of r){let s=await this.getUdt(i.info.keyspace,i.info.name);if(!s)throw new TypeError("User defined type not found: "+i.info.keyspace+"."+i.info.name);i.info=s}}_checkUdtTypes(e,t,r){if(t.code===Wn.dataTypes.udt){let i=t.info.split(".");if(t.info={keyspace:i[0],name:i[1]},!t.info.name){if(!r)throw new TypeError("No keyspace specified for udt: "+i.join("."));t.info.name=t.info.keyspace,t.info.keyspace=r}e.push(t);return}if(t.info){if(t.code===Wn.dataTypes.list||t.code===Wn.dataTypes.set)return this._checkUdtTypes(e,t.info,r);t.code===Wn.dataTypes.map&&(this._checkUdtTypes(e,t.info[0],r),this._checkUdtTypes(e,t.info[1],r))}}async compareSchemaVersions(e){let t=new Set,r=await e.send(new Gi.QueryRequest(NE),null);r&&r.rows&&r.rows.length===1&&t.add(r.rows[0].schema_version.toString());let i=await e.send(new Gi.QueryRequest(vE),null);if(i&&i.rows)for(let s of i.rows){let o=s.schema_version;o&&t.add(o.toString())}return t.size===1}},Fa=class{constructor(e,t){this.length=0,this._maxPrepared=e,this._mapByKey=new Map,this._mapById=new Map,this._logger=t}_getKey(e,t){return(e||"")+t}getOrAdd(e,t){let r=this._getKey(e,t),i=this._mapByKey.get(r);return i||(this._validateOverflow(),i=new SE.EventEmitter,i.setMaxListeners(0),i.query=t,i.keyspace=e,this._mapByKey.set(r,i),this.length++,i)}_validateOverflow(){if(this.length<this._maxPrepared)return;let e=[];this._logger("warning","Prepared statements exceeded maximum. This could be caused by preparing queries that contain parameters");let t=this.length-this._maxPrepared+1;for(let[r,i]of this._mapByKey){if(!i.queryId)continue;if(e.push([r,i])>=t)break}for(let[r,i]of e)this._mapByKey.delete(r),this._mapById.delete(i.queryId.toString("hex")),this.length--}setById(e){this._mapById.set(e.queryId.toString("hex"),e)}getById(e){return this._mapById.get(e.toString("hex"))}clear(){this._mapByKey=new Map,this._mapById=new Map,this.length=0}getAll(){return Array.from(this._mapByKey.values()).filter(e=>!!e.queryId)}};Ld.exports=Da});var Fd=C((Jx,Dd)=>{"use strict";var IE=require("util"),PE=O(),Ua=Be(),qd=1e3,Ma=class{constructor(e,t){this._delay=e,this._logger=t,this._queue=null,this._timeout=null}eventReceived(e,t){return new Promise((r,i)=>{e.callback=Ua.getCallback(r,i),this._queue=this._queue||{callbacks:[],keyspaces:{}};let s=t?0:this._delay;if(e.all&&(this._queue.mainEvent=e),this._queue.callbacks.length===qd&&this._logger("warn",IE.format("Event debouncer queue exceeded %d events",qd)),this._queue.callbacks.push(e.callback),this._queue.mainEvent)return this._slideDelay(s);let o=this._queue.keyspaces[e.keyspace];o||(o=this._queue.keyspaces[e.keyspace]={events:[]}),e.cqlObject===void 0&&(o.mainEvent=e),o.events.push(e),this._slideDelay(s)})}_slideDelay(e){let t=this;function r(){let s=t._queue;t._queue=null,t._timeout=null,BE(s)}if(e===0)return this._timeout&&clearTimeout(this._timeout),r();let i=this._timeout;this._timeout=setTimeout(r,e),i&&clearTimeout(i)}shutdown(){this._queue&&(this._queue.callbacks.forEach(function(e){e()}),this._queue=null,clearTimeout(this._timeout),this._timeout=null)}};function BE(n){if(n.mainEvent)return Ua.toCallback(n.mainEvent.handler(),e=>{for(let t=0;t<n.callbacks.length;t++)n.callbacks[t](e)});PE.each(Object.keys(n.keyspaces),function(t,r){let i=n.keyspaces[t];if(i.mainEvent)return Ua.toCallback(i.mainEvent.handler(),function(o){for(let a=0;a<i.events.length;a++)i.events[a].callback(o);r()});i.events.forEach(s=>{s.handler(),s.callback()}),r()})}Dd.exports=Ma});var Kd=C((eb,Hd)=>{"use strict";var OE=require("events"),Zi=require("util"),kd=require("net"),$i=require("dns"),ot=j(),{Host:Ud,HostMap:RE}=nd(),LE=ka(),qE=Fd(),DE=ga(),Mr=jt(),Qt=O(),Qi=H(),fn=Be(),Md=Zi.format,FE="SELECT * FROM system.peers",kE="SELECT * FROM system.local WHERE key='local'",Vd=1e3,UE=2e3,ME={created:"CREATED",updated:"UPDATED",dropped:"DROPPED"},VE="PRODUCT_TYPE",zE="DATASTAX_APOLLO",Va=class extends OE.EventEmitter{constructor(e,t,r){super(),this.protocolVersion=null,this.hosts=new RE,this.setMaxListeners(0),this.log=Qt.log,Object.defineProperty(this,"options",{value:e,enumerable:!1,writable:!1}),this.metadata=new LE(this.options,this),this.initialized=!1,this.host=null,this.connection=null,this._addressTranslator=this.options.policies.addressResolution,this._reconnectionPolicy=this.options.policies.reconnection,this._reconnectionSchedule=this._reconnectionPolicy.newSchedule(),this._isShuttingDown=!1,this._encoder=null,this._debouncer=new qE(e.refreshSchemaDelay,this.log.bind(this)),this._profileManager=t,this._triedHosts=null,this._resolvedContactPoints=new Map,this._contactPoints=new Set,this._topologyChangeTimeout=null,this._nodeStatusChangeTimeout=null,r&&r.borrowHostConnection&&(this._borrowHostConnection=r.borrowHostConnection),r&&r.createConnection&&(this._createConnection=r.createConnection)}_addContactPoint(e,t,r,i){if(e===null){this._resolvedContactPoints.set(r,Qt.emptyArray);return}let s=parseInt(t,10)||this.options.protocolOptions.port,o=`${e}:${s}`;this._contactPoints.add(o);let a=i?`[${e}]:${s}`:o,c=this._resolvedContactPoints.get(r);(c===void 0||c===Qt.emptyArray)&&(c=[],this._resolvedContactPoints.set(r,c)),c.push(a)}async _parseContactPoint(e){let t=e,r=null;if(e.indexOf("[")===0&&e.indexOf("]:")>1){let s=e.lastIndexOf("]:");t=e.substr(1,s-1),r=e.substr(s+2)}else if(e.indexOf(":")>0){let s=e.split(":");s.length===2&&(t=s[0],r=s[1])}if(kd.isIP(t)){this._addContactPoint(t,r,e,kd.isIPv6(t));return}let i=await this._resolveAll(t);i.length>0?i.forEach(s=>this._addContactPoint(s.address,r,e,s.isIPv6)):this._addContactPoint(null,null,e,!1)}async init(){if(!this.initialized){if(!this.options.sni)await Promise.all(this.options.contactPoints.map(e=>this._parseContactPoint(e)));else{this.options.contactPoints.forEach(i=>this._contactPoints.add(i));let e=this.options.sni.address,t=e.lastIndexOf(":");if(t===-1)throw new new ot.DriverInternalError("The SNI endpoint address should contain ip/name and port");let r=e.substr(0,t);this.options.sni.port=e.substr(t+1),this.options.sni.addressResolver=new Qt.AddressResolver({nameOrIp:r,dns:$i}),await this.options.sni.addressResolver.init()}if(this._contactPoints.size===0)throw new ot.NoHostAvailableError({},"No host could be resolved");await this._initializeConnection()}}_setHealthListeners(e,t){let r=this,i=0;function s(){e.removeListener("down",a),e.removeListener("ignore",a),t.removeListener("socketClose",c)}function o(u){i++===0&&(s(),!r._isShuttingDown&&(u?r.log("warning",`Host ${e.address} used by the ControlConnection DOWN, connection to ${t.endpointFriendlyName} will not longer be used`):r.log("warning",`Connection to ${t.endpointFriendlyName} used by the ControlConnection was closed`),fn.toBackground(r._refresh())))}function a(){o(!0)}function c(){o(!1)}e.once("down",a),e.once("ignore",a),t.once("socketClose",c)}_borrowAConnection(e){let t=null;for(;!t;){let r=e.next(),i=r.value;if(r.done)throw new ot.NoHostAvailableError(this._triedHosts);let s=this._profileManager.getDistance(i);if(!(!i.isUp()||s===Qi.distance.ignored))try{t=this._borrowHostConnection(i)}catch(o){this._triedHosts[i.address]=o}}return t}async _borrowFirstConnection(e){let t=null;for(;!t;){let r=e.next(),i=r.value;if(r.done)throw new ot.NoHostAvailableError(this._triedHosts);try{t=await this._createConnection(i)}catch(s){this._triedHosts[i]=s}}if(!t){let r=new ot.NoHostAvailableError(this._triedHosts);throw this.log("error","ControlConnection failed to acquire a connection"),r}this.protocolVersion=t.protocolVersion,this._encoder=t.encoder,this.connection=t}_borrowHostConnection(e){return e.borrowConnection()}async _createConnection(e){let t=new DE(e,null,this.options);try{await t.openAsync()}catch(r){throw fn.toBackground(t.closeAsync()),r}return t}async _refreshHosts(e,t){let r=this.connection;if(!r){if(t)throw new ot.DriverInternalError("Connection reference has been lost when reconnecting");return}this.log("info","Refreshing local and peers info");let i=await r.send(new Mr.QueryRequest(kE),null);if(this._setLocalInfo(e,t,r,i),!this.host)throw new ot.DriverInternalError("Information from system.local could not be retrieved");let s=await r.send(new Mr.QueryRequest(FE),null);if(await this.setPeersInfo(e,s),!this.initialized){let o=Qi.protocolVersion.getHighestCommon(r,this.hosts),a=o!==this.protocolVersion;if(this.protocolVersion=o,this.hosts.forEach(c=>c.setProtocolVersion(this.protocolVersion)),a){this.log("info",`Reconnecting since the protocol version changed to 0x${o.toString(16)}`),r.decreaseVersion(this.protocolVersion),await r.closeAsync();try{await r.openAsync()}catch(c){throw fn.toBackground(r.closeAsync()),c}}if(this.metadata.setCassandraVersion(this.host.getCassandraVersion()),this.metadata.buildTokens(this.hosts),!this.options.isMetadataSyncEnabled){this.metadata.initialized=!0;return}await this.metadata.refreshKeyspacesInternal(!1),this.metadata.initialized=!0}}async _refreshControlConnection(e){if(this.options.sni)this.connection=this._borrowAConnection(e);else try{this.connection=this._borrowAConnection(e)}catch{this.log("info","ControlConnection could not reconnect using existing connections.  Refreshing contact points and retrying"),this._contactPoints.clear(),this._resolvedContactPoints.clear(),await Promise.all(this.options.contactPoints.map(i=>this._parseContactPoint(i)));let r=Array.from(this._contactPoints).join(",");this.log("info",`Refreshed contact points: ${r}`),await this._initializeConnection()}}async _refresh(e){if(this._isShuttingDown){this.log("info","The ControlConnection will not be refreshed as the Client is being shutdown");return}this.host=null,this.connection=null;try{e||(this.log("info","Trying to acquire a connection to a new host"),this._triedHosts={},e=await fn.newQueryPlan(this._profileManager.getDefaultLoadBalancing(),null,null)),await this._refreshControlConnection(e)}catch(t){if(this.log("error","ControlConnection failed to acquire a connection",t),!this._isShuttingDown){let r=this._reconnectionSchedule.next().value;this.log("warning",`ControlConnection could not reconnect, scheduling reconnection in ${r}ms`),setTimeout(()=>this._refresh(),r),this.emit("newConnection",t)}return}this.log("info",`ControlConnection connected to ${this.connection.endpointFriendlyName}`);try{await this._refreshHosts(!1,!0),await this._registerToConnectionEvents()}catch(t){return this.log("error","ControlConnection failed to retrieve topology and keyspaces information",t),this._triedHosts[this.connection.endpoint]=t,t.isSocketError&&this.host&&this.host.removeFromPool(this.connection),await this._refresh(e)}this._reconnectionSchedule=this._reconnectionPolicy.newSchedule(),this._setHealthListeners(this.host,this.connection),this.emit("newConnection",null,this.connection,this.host),this.log("info",`ControlConnection connected to ${this.connection.endpointFriendlyName} and up to date`)}async _initializeConnection(){this.log("info","Getting first connection"),this.host=null,this.connection=null,this._triedHosts={};let e=Qt.shuffleArray(Array.from(this._contactPoints))[Symbol.iterator]();for(;;){await this._borrowFirstConnection(e),this.log("info",`ControlConnection using protocol version 0x${this.protocolVersion.toString(16)}, connected to ${this.connection.endpointFriendlyName}`);try{await this._getSupportedOptions(),await this._refreshHosts(!0,!0),await this._registerToConnectionEvents();break}catch(t){this.log("error","ControlConnection failed to retrieve topology and keyspaces information",t),this._triedHosts[this.connection.endpoint]=t}}this.host.pool.addExistingConnection(this.connection),this.initialized=!0,this._setHealthListeners(this.host,this.connection),this.log("info",`ControlConnection connected to ${this.connection.endpointFriendlyName}`)}async _getSupportedOptions(){let e=await this.connection.send(Mr.options,null),t=e.supported&&e.supported[VE];Array.isArray(t)&&t[0]===zE&&this.metadata.setProductTypeAsDbaas()}async _registerToConnectionEvents(){this.connection.on("nodeTopologyChange",this._nodeTopologyChangeHandler.bind(this)),this.connection.on("nodeStatusChange",this._nodeStatusChangeHandler.bind(this)),this.connection.on("nodeSchemaChange",this._nodeSchemaChangeHandler.bind(this));let e=new Mr.RegisterRequest(["TOPOLOGY_CHANGE","STATUS_CHANGE","SCHEMA_CHANGE"]);await this.connection.send(e,null)}_nodeTopologyChangeHandler(e){this.log("info","Received topology change",e),clearTimeout(this._topologyChangeTimeout),this._topologyChangeTimeout=setTimeout(()=>fn.toBackground(this._scheduleRefreshHosts()),Vd)}_nodeStatusChangeHandler(e){let t=this,r=e.inet.address.toString(),i=this.options.protocolOptions.port;this._addressTranslator.translate(r,i,function(o){let a=t.hosts.get(o);if(!a){t.log("warning","Received status change event but host was not found: "+r);return}let c=t._profileManager.getDistance(a);if(e.up){if(c===Qi.distance.ignored)return a.setUp(!0);clearTimeout(t._nodeStatusChangeTimeout),t._nodeStatusChangeTimeout=setTimeout(()=>a.checkIsUp(),Vd);return}if(c===Qi.distance.ignored)return a.setDown();t.log("warning","Received status change to DOWN for host "+a.address)})}_nodeSchemaChangeHandler(e){this.log("info","Schema change",e),this.options.isMetadataSyncEnabled&&fn.toBackground(this.handleSchemaChange(e,!1))}handleSchemaChange(e,t){let r=this,i,s;if(e.isKeyspace)return e.schemaChangeType===ME.dropped?(i=function(){delete r.metadata.keyspaces[e.keyspace]},this._scheduleObjectRefresh(i,e.keyspace,null,t)):this._scheduleKeyspaceRefresh(e.keyspace,t);let o=this.metadata.keyspaces[e.keyspace];return!o||(e.table?(s=e.table,i=function(){delete o.tables[e.table],delete o.views[e.table]}):e.udt?(s=e.udt,i=function(){delete o.udts[e.udt]}):e.functionName?(s=e.functionName,i=function(){delete o.functions[e.functionName]}):e.aggregate&&(s=e.aggregate,i=function(){delete o.aggregates[e.aggregate]}),!i)?Promise.resolve():this._scheduleObjectRefresh(i,e.keyspace,s,t)}_scheduleObjectRefresh(e,t,r,i){return this._debouncer.eventReceived({handler:e,keyspace:t,cqlObject:r},i)}_scheduleKeyspaceRefresh(e,t){return this._debouncer.eventReceived({handler:()=>this.metadata.refreshKeyspace(e),keyspace:e},t)}_scheduleRefreshHosts(){return this._debouncer.eventReceived({handler:()=>this._refreshHosts(!1,!1),all:!0},!1)}_setLocalInfo(e,t,r,i){if(!i||!i.rows||!i.rows.length){this.log("warning","No local info could be obtained");return}let s=i.rows[0],o,a=this.options.sni?`${s.rpc_address}:${this.options.protocolOptions.port}`:r.endpoint;if(e)o=new Ud(a,this.protocolVersion,this.options,this.metadata),this.hosts.set(a,o),this.log("info",`Adding host ${a}`);else if(o=this.hosts.get(a),!o){this.log("error","Localhost could not be found");return}o.datacenter=s.data_center,o.rack=s.rack,o.tokens=s.tokens,o.hostId=s.host_id,o.cassandraVersion=s.release_version,zd(o,s),this.metadata.setPartitioner(s.partitioner),this.log("info","Local info retrieved"),t&&(this.host=o)}async setPeersInfo(e,t){if(!t||!t.rows)return;let r={},i=this.options.protocolOptions.port,s=new Set;this.host&&this.host.datacenter&&s.add(this.host.datacenter);for(let o of t.rows){let a=await this.getAddressForPeerHost(o,i);if(!a)continue;r[a]=!0;let c=this.hosts.get(a),u=!c;u&&(c=new Ud(a,this.protocolVersion,this.options,this.metadata),this.log("info",`Adding host ${a}`),u=!0),c.datacenter=o.data_center,c.rack=o.rack,c.tokens=o.tokens,c.hostId=o.host_id,c.cassandraVersion=o.release_version,zd(c,o),c.datacenter&&s.add(c.datacenter),u&&(this.hosts.set(a,c),e||(this._profileManager.getDistance(c),c.setDown()))}if(this.hosts.length>t.rows.length+1){this.log("info","Removing nodes from the pool");let o=[];this.hosts.forEach(a=>{!r[a.address]&&a!==this.host&&(this.log("info","Removing host "+a.address),o.push(a.address),a.shutdown(!0))}),this.hosts.removeMultiple(o)}if(e&&this.options.localDataCenter){let o=this.options.localDataCenter;if(!s.has(o))throw new ot.ArgumentError(`localDataCenter was configured as '${o}', but only found hosts in data centers: [${Array.from(s).join(", ")}]`)}this.log("info","Peers info retrieved")}getAddressForPeerHost(e,t){return new Promise(r=>{let i=e.rpc_address,s=e.peer,o="0.0.0.0";if(!i)return this.log("error",Md("No rpc_address found for host %s in %s's peers system table. %s will be ignored.",s,this.host.address,s)),r(null);i.toString()===o&&(this.log("warning",Md("Found host with 0.0.0.0 as rpc_address, using listen_address (%s) to contact it instead. If this is incorrect you should avoid the use of 0.0.0.0 server side.",s)),i=s),this._addressTranslator.translate(i.toString(),t,r)})}async _resolveAll(e){let t=[],r=Zi.promisify($i.resolve4),i=Zi.promisify($i.resolve6),s=Zi.promisify($i.lookup),o=r(e).catch(()=>{}).then(u=>u||Qt.emptyArray),a=i(e).catch(()=>{}).then(u=>u||Qt.emptyArray),c;if(c=await o,c.forEach(u=>t.push({address:u,isIPv6:!1})),c=await a,c.forEach(u=>t.push({address:u,isIPv6:!0})),t.length===0)try{c=await s(e,{all:!0}),c.forEach(({address:u,family:f})=>t.push({address:u,isIPv6:f===6}))}catch(u){this.log("error",`Host with name ${e} could not be resolved`,u)}return t}_waitForReconnection(){return new Promise((e,t)=>{let r=fn.getCallback(e,t),i;function s(o){clearTimeout(i),r(o)}this.once("newConnection",s),i=setTimeout(()=>{this.removeListener("newConnection",s),r(new ot.OperationTimedOutError("A connection could not be acquired before timeout."))},UE)})}async query(e,t=!0){let r=async()=>{if(!this.connection||this._isShuttingDown)throw new ot.NoHostAvailableError({},"ControlConnection is not connected at the time");let i=typeof e=="string"?new Mr.QueryRequest(e,null,null):e;return await this.connection.send(i,null)};return!this.connection&&t&&await this._waitForReconnection(),await r()}getEncoder(){if(!this._encoder)throw new ot.DriverInternalError("Encoder is not defined");return this._encoder}shutdown(){this._isShuttingDown=!0,this._debouncer.shutdown(),this.emit("newConnection",new ot.DriverError("ControlConnection is being shutdown")),clearTimeout(this._topologyChangeTimeout),clearTimeout(this._nodeStatusChangeTimeout)}async reset(){let e=this.hosts.clear();this._isShuttingDown=!0,await Promise.all(e.map(t=>t.shutdown())),this.initialized=!1,this._isShuttingDown=!1}getResolvedContactPoints(){return this._resolvedContactPoints}getLocalAddress(){if(this.connection)return this.connection.getLocalAddress()}getEndpoint(){if(this.connection)return this.connection.endpoint}};function zd(n,e){e.workloads!==void 0?n.workloads=e.workloads:e.workload?n.workloads=[e.workload]:n.workloads=Qt.emptyArray,e.dse_version!==void 0&&(n.dseVersion=e.dse_version)}Hd.exports=Va});var Wd=C((tb,Gd)=>{"use strict";var Vr=j(),jd=jt(),Yi=eo(),qt=H(),HE=O(),za=Be(),KE=Object.freeze({decision:Yi.RetryPolicy.retryDecision.retry,useCurrentHost:!0,consistency:void 0}),Ha=Object.freeze({decision:Yi.RetryPolicy.retryDecision.rethrow}),U={none:0,socketError:1,socketErrorBeforeRequestWritten:2,clientTimeout:3,serverErrorUnprepared:4,serverErrorOverloaded:5,serverErrorReadTimeout:6,serverErrorUnavailable:7,serverErrorWriteTimeout:8,serverErrorOther:9},jE=new Map([[U.none,(n,e,t)=>n.onSuccessfulResponse(t)],[U.socketError,(n,e)=>n.onConnectionError(e)],[U.clientTimeout,(n,e)=>n.onClientTimeoutError(e)],[U.serverErrorOverloaded,(n,e)=>n.onOtherError(e)],[U.serverErrorReadTimeout,(n,e)=>n.onReadTimeoutError(e)],[U.serverErrorUnavailable,(n,e)=>n.onUnavailableError(e)],[U.serverErrorWriteTimeout,(n,e)=>n.onWriteTimeoutError(e)],[U.serverErrorOther,(n,e)=>n.onOtherError(e)]]),GE=new Map([[U.socketError,(n,e)=>n.onOtherErrorRetry(e)],[U.clientTimeout,(n,e)=>n.onClientTimeoutRetry(e)],[U.serverErrorOverloaded,(n,e)=>n.onOtherErrorRetry(e)],[U.serverErrorReadTimeout,(n,e)=>n.onReadTimeoutRetry(e)],[U.serverErrorUnavailable,(n,e)=>n.onUnavailableRetry(e)],[U.serverErrorWriteTimeout,(n,e)=>n.onWriteTimeoutRetry(e)],[U.serverErrorOther,(n,e)=>n.onOtherErrorRetry(e)]]),Ka=class n{constructor(e,t,r){this._parent=e,this._operation=null,this._host=t,this._connection=r,this._cancelled=!1,this._startTime=null,this._retryCount=0,this._request=this._parent.request,e.speculativeExecutions++}start(){this._sendOnConnection()}async restart(){try{let{host:t,connection:r}=this._parent.getNextConnection();this._connection=r,this._host=t}catch(t){return this._parent.handleNoHostAvailable(t,this)}let e=this._parent.client.keyspace;if(e&&e!==this._connection.keyspace)try{await this._connection.changeKeyspace(e)}catch(t){return this._handleError(t,n._getErrorCode(t))}this._cancelled||this._sendOnConnection()}_sendOnConnection(){this._startTime=process.hrtime(),this._operation=this._connection.sendStream(this._request,this._parent.executionOptions,(e,t,r)=>{let i=n._getErrorCode(e);if(this._trackResponse(process.hrtime(this._startTime),i,e,r),!this._cancelled){if(i!==U.none)return this._handleError(i,e);if(t.schemaChange)return za.toBackground(this._parent.client.handleSchemaAgreementAndRefresh(this._connection,t.schemaChange).then(s=>{this._cancelled||this._parent.setCompleted(null,this._getResultSet(t,s))}));if(t.keyspaceSet&&(this._parent.client.keyspace=t.keyspaceSet),t.meta&&t.meta.newResultId&&this._request.queryId){let s=this._parent.client.metadata.getPreparedById(this._request.queryId);s.meta.resultId=t.meta.newResultId}this._parent.setCompleted(null,this._getResultSet(t))}})}_trackResponse(e,t,r,i){n._invokeMetricsHandler(t,this._parent.client.metrics,r,e);let s=this._parent.client.options.requestTracker;if(s===null)return;let o=this._request.query||this._request.queries,a=this._request.params,c=this._request.length;r?s.onError(this._host,o,a,this._parent.executionOptions,c,r,e):s.onSuccess(this._host,o,a,this._parent.executionOptions,c,i,e)}_getResultSet(e,t){let r=new qt.ResultSet(e,this._host.address,this._parent.triedHosts,this._parent.speculativeExecutions,this._request.consistency,t===void 0||t);return r.rawPageState&&(r.nextPageAsync=this._parent.getNextPageHandler()),r}static _invokeMetricsHandler(e,t,r,i){let s=jE.get(e);s!==void 0&&s(t,r,i),(!r||r instanceof Vr.ResponseError)&&t.onResponse(i)}static _invokeMetricsHandlerForRetry(e,t,r){let i=GE.get(e);i!==void 0&&i(t,r)}cancel(){this._cancelled=!0,this._operation!==null&&this._operation.cancel()}wasCancelled(){return this._cancelled}_handleError(e,t){if(this._parent.triedHosts[this._host.address]=t,t.coordinator=this._host.address,e===U.serverErrorUnprepared)return this._prepareAndRetry(t.queryId);e===U.socketError||e===U.socketErrorBeforeRequestWritten?this._host.removeFromPool(this._connection):e===U.clientTimeout&&(this._parent.log("warning",t.message),this._host.checkHealth(this._connection));let r=this._getDecision(e,t);if(!r||r.decision===Yi.RetryPolicy.retryDecision.rethrow)return(this._request instanceof jd.QueryRequest||this._request instanceof jd.ExecuteRequest)&&(t.query=this._request.query),this._parent.setCompleted(t);let i=this._parent.client.metrics;return r.decision===Yi.RetryPolicy.retryDecision.ignore?(i.onIgnoreError(t),this._parent.setCompleted(null,this._getResultSet(HE.emptyObject))):(n._invokeMetricsHandlerForRetry(e,i,t),this._retry(r.consistency,r.useCurrentHost))}_getDecision(e,t){let r={query:this._request&&this._request.query,executionOptions:this._parent.executionOptions,nbRetry:this._retryCount},i=r.executionOptions.getRetryPolicy();switch(e){case U.socketErrorBeforeRequestWritten:return KE;case U.socketError:case U.clientTimeout:case U.serverErrorOverloaded:return r.executionOptions.isIdempotent()?i.onRequestError(r,this._request.consistency,t):Ha;case U.serverErrorUnavailable:return i.onUnavailable(r,t.consistencies,t.required,t.alive);case U.serverErrorReadTimeout:return i.onReadTimeout(r,t.consistencies,t.received,t.blockFor,t.isDataPresent);case U.serverErrorWriteTimeout:return r.executionOptions.isIdempotent()?i.onWriteTimeout(r,t.consistencies,t.received,t.blockFor,t.writeType):Ha;default:return Ha}}static _getErrorCode(e){if(!e)return U.none;if(e.isSocketError)return e.requestNotWritten?U.socketErrorBeforeRequestWritten:U.socketError;if(e instanceof Vr.OperationTimedOutError)return U.clientTimeout;if(e instanceof Vr.ResponseError)switch(e.code){case qt.responseErrorCodes.overloaded:case qt.responseErrorCodes.isBootstrapping:case qt.responseErrorCodes.truncateError:return U.serverErrorOverloaded;case qt.responseErrorCodes.unavailableException:return U.serverErrorUnavailable;case qt.responseErrorCodes.readTimeout:return U.serverErrorReadTimeout;case qt.responseErrorCodes.writeTimeout:return U.serverErrorWriteTimeout;case qt.responseErrorCodes.unprepared:return U.serverErrorUnprepared}return U.serverErrorOther}_retry(e,t,r){if(!this._cancelled){if(this._parent.log("info","Retrying request"),this._retryCount++,(r||typeof e=="number"&&this._request.consistency!==e)&&(this._request=this._request.clone(),typeof e=="number"&&(this._request.consistency=e),r&&(this._request.meta=r)),t!==!1){try{this._connection=this._host.borrowConnection(this._connection)}catch{return za.toBackground(this.restart())}return this._sendOnConnection()}za.toBackground(this.restart())}}_prepareAndRetry(e){let t=this._connection;this._parent.log("info",`Query 0x${e.toString("hex")} not prepared on host ${t.endpointFriendlyName}, preparing and retrying`);let r=this._parent.client.metadata.getPreparedById(e);if(!r)return this._parent.setCompleted(new Vr.DriverInternalError(`Unprepared response invalid, id: 0x${e.toString("hex")}`));let i=this._connection.protocolVersion;if(!qt.protocolVersion.supportsKeyspaceInRequest(i)&&r.keyspace&&r.keyspace!==t.keyspace)return this._parent.setCompleted(new Error(`Query was prepared on keyspace ${r.keyspace}, can't execute it on ${t.keyspace} (${r.query})`));let s=this;this._connection.prepareOnce(r.query,r.keyspace,function(o,a){if(o)return!o.isSocketError&&o instanceof Vr.OperationTimedOutError&&s._parent.log("warning",`Unexpected timeout error when re-preparing query on host ${t.endpointFriendlyName}`),s._retry(void 0,!1);r.meta=a.meta,s._retry(void 0,!0,a.meta)})}};Gd.exports=Ka});var Zd=C((nb,Qd)=>{"use strict";var WE=require("util"),$d=j(),$E=H(),ja=O(),QE=Wd(),Xi=Be(),Ga=class n{constructor(e,t,r){this.client=r,this._speculativeExecutionPlan=r.options.policies.speculativeExecution.newPlan(r.keyspace,e.query||e.queries),this.logEmitter=r.options.logEmitter,this.log=ja.log,this.request=e,this.executionOptions=t,this.stackContainer=null,this.triedHosts={},this.speculativeExecutions=-1,this._hostIterator=null,this._resolveCallback=null,this._rejectCallback=null,this._newExecutionTimeout=null,this._executions=[]}static send(e,t,r){return new n(e,t,r).send()}getNextConnection(){let e,t,r=this._hostIterator;for(;;){let i=r.next();if(i.done)throw new $d.NoHostAvailableError(this.triedHosts);if(e=i.value,this.client.profileManager.getDistance(e)!==$E.distance.ignored){if(!e.isUp()){this.triedHosts[e.address]="Host considered as DOWN";continue}try{t=e.borrowConnection(),this.triedHosts[e.address]=null;break}catch(o){this.triedHosts[e.address]=o}}}return{connection:t,host:e}}send(){return this.executionOptions.getCaptureStackTrace()&&Error.captureStackTrace(this.stackContainer={}),new Promise((e,t)=>{this._resolveCallback=e,this._rejectCallback=t;let r=this.executionOptions.getLoadBalancingPolicy(),i=this.executionOptions.getFixedHost();i?(this._hostIterator=ja.arrayIterator([i]),Xi.toBackground(this._startNewExecution())):r.newQueryPlan(this.client.keyspace,this.executionOptions,(s,o)=>{if(s)return t(s);this._hostIterator=o,Xi.toBackground(this._startNewExecution())})})}async _startNewExecution(e){e&&this.client.metrics.onSpeculativeExecution();let t,r;try{({host:t,connection:r}=this.getNextConnection())}catch(s){return this.handleNoHostAvailable(s,null)}if(e&&this._executions.length>=0&&this._executions[0].wasCancelled())return;if(this.client.keyspace&&this.client.keyspace!==r.keyspace)try{await r.changeKeyspace(this.client.keyspace)}catch(s){return this.triedHosts[t.address]=s,this._startNewExecution(e)}let i=new QE(this,t,r);this._executions.push(i),i.start(),this.executionOptions.isIdempotent()&&this._scheduleSpeculativeExecution(t)}_scheduleSpeculativeExecution(e){let t=this._speculativeExecutionPlan.nextExecution(e);if(!(typeof t!="number"||t<0)){if(t===0)return process.nextTick(()=>{Xi.toBackground(this._startNewExecution(!0))});this._newExecutionTimeout=setTimeout(()=>Xi.toBackground(this._startNewExecution(!0)),t)}}static setKeyspace(e){let t;for(let r of e.hosts.values())if(t=r.getActiveConnection(),t)break;if(!t)throw new $d.DriverInternalError("No active connection found");return t.changeKeyspace(e.keyspace)}setCompleted(e,t){this._newExecutionTimeout!==null&&clearTimeout(this._newExecutionTimeout);for(let r of this._executions)r.cancel();if(e)return this.executionOptions.getCaptureStackTrace()&&ja.fixStack(this.stackContainer.stack,e),this._rejectCallback(e);t.info.warnings&&t.info.warnings.forEach(function(r,i,s){this.log("warning",WE.format('Received warning (%d of %d) "%s" for "%s"',i+1,s.length,r,this.request.query||"batch"))},this),this._resolveCallback(t)}handleNoHostAvailable(e,t){if(t!==null){let r=this._executions.indexOf(t);this._executions.splice(r,1)}this._executions.length===0&&this.setCompleted(e)}getNextPageHandler(){let e=this.request,t=this.executionOptions,r=this.client;return function(s){return t.setPageState(s),new n(e,t,r).send()}}};Qd.exports=Ga});var sp=C((rb,ip)=>{"use strict";var $n=require("os"),Yd=require("path"),ZE=require("fs"),Qa=O(),YE=Be(),dn=H(),Xd=jt(),{ExecutionOptions:Jd}=Kt(),ep=Dn(),ts=Fs(),{NoAuthProvider:XE}=Er(),Wa;try{Wa=require("kerberos")}catch{}var JE=new ts(6,0,5),eT=new ts(5,1,13),tT=new ts(6,0,0),tp="CALL InsightsRpc.reportInsight(?)",nT=5,$a=class{constructor(e,t){this._client=e,this._sessionId=dn.Uuid.random().toString(),this._enabled=!1,this._closed=!1,this._firstTimeout=null,this._recurrentTimeout=null,this._statusErrorLogs=0,t=t||{},this._statusEventDelay=t.statusEventDelay||3e5,this._errorCallback=t.errorCallback||Qa.noop}init(){this._enabled=this._client.options.monitorReporting.enabled&&this._dseSupportsInsights(),this._enabled&&YE.toBackground(this._init())}async _init(){try{if(await this._sendStartupEvent(),this._closed)return;let e=Math.floor(this._statusEventDelay-.1*this._statusEventDelay*Math.random());this._firstTimeout=setTimeout(()=>{this._sendStatusEvent(),this._recurrentTimeout=setInterval(()=>this._sendStatusEvent(),this._statusEventDelay)},e)}catch(e){if(this._closed)return;this._client.log("verbose",`Insights startup message could not be sent (${e})`,e),this._errorCallback(e)}}async _sendStartupEvent(){let e=await this._getStartupMessage(),t=new Xd.QueryRequest(tp,[e],Jd.empty());await this._client.controlConnection.query(t,!1)}async _sendStatusEvent(){let e=new Xd.QueryRequest(tp,[this._getStatusEvent()],Jd.empty());try{await this._client.controlConnection.query(e,!1)}catch(t){if(this._closed)return;this._statusErrorLogs<nT&&(this._client.log("warning",`Insights status message could not be sent (${t})`,t),this._statusErrorLogs++),this._errorCallback(t)}}_dseSupportsInsights(){return this._client.hosts.length===0?!1:this._client.hosts.values().reduce((e,t)=>{if(!e)return e;let r=t.getDseVersion();if(r.length===0)return!1;let i=new ts(...r);return i.compare(JE)>=0||i.compare(tT)<0&&i.compare(eT)>=0},!0)}async _getStartupMessage(){let e=this._client.controlConnection,t=this._client.options,r=await this._getAppInfo(t),i={metadata:{name:"driver.startup",insightMappingId:"v1",insightType:"EVENT",timestamp:Date.now(),tags:{language:"nodejs"}},data:{driverName:ep.description,driverVersion:ep.version,clientId:t.id,sessionId:this._sessionId,applicationName:r.applicationName,applicationVersion:r.applicationVersion,applicationNameWasGenerated:r.applicationNameWasGenerated,contactPoints:rp(e.getResolvedContactPoints()),dataCenters:this._getDataCenters(),initialControlConnection:e.host?e.host.address:void 0,protocolVersion:e.protocolVersion,localAddress:e.getLocalAddress(),hostName:$n.hostname(),executionProfiles:iT(this._client),poolSizeByHostDistance:{local:t.pooling.coreConnectionsPerHost[dn.distance.local],remote:t.pooling.coreConnectionsPerHost[dn.distance.remote]},heartbeatInterval:t.pooling.heartBeatInterval,compression:"NONE",reconnectionPolicy:es(t.policies.reconnection),ssl:{enabled:!!t.sslOptions,certValidation:t.sslOptions?!!t.sslOptions.rejectUnauthorized:void 0},authProvider:{type:t.authProvider instanceof XE?void 0:rT(t.authProvider)},otherOptions:{coalescingThreshold:t.socketOptions.coalescingThreshold},platformInfo:{os:{name:$n.platform(),version:$n.release(),arch:$n.arch()},cpus:{length:$n.cpus().length,model:$n.cpus()[0].model},runtime:{node:process.versions.node,v8:process.versions.v8,uv:process.versions.uv,openssl:process.versions.openssl,kerberos:Wa?Wa.version:void 0}},configAntiPatterns:this._getConfigAntiPatterns(),periodicStatusInterval:Math.floor(this._statusEventDelay/1e3)}};return JSON.stringify(i)}_getConfigAntiPatterns(){let e=this._client.options,t={};return e.sslOptions&&!e.sslOptions.rejectUnauthorized&&(t.sslWithoutCertValidation="Client-to-node encryption is enabled but server certificate validation is disabled"),t}_getDataCenters(){let e=this._client.options.pooling.coreConnectionsPerHost[dn.distance.remote],t=new Set;return this._client.hosts.values().forEach(r=>{let i=this._client.profileManager.getDistance(r);(i===dn.distance.local||i===dn.distance.remote&&e>0)&&t.add(r.datacenter)}),Array.from(t)}async _getAppInfo(e){if(typeof e.applicationName=="string")return Promise.resolve({applicationName:e.applicationName,applicationVersion:e.applicationVersion,applicationNameWasGenerated:!1});let t=Promise.resolve();if(require.main&&require.main.filename){let o=Yd.dirname(require.main.filename);t=this._readPackageInfoFile(o)}let r=await t,i="Default Node.js Application",s;if(r)try{let o=JSON.parse(r);o.name&&(i=o.name,s=o.version)}catch{}return{applicationName:i,applicationVersion:s,applicationNameWasGenerated:!0}}_readPackageInfoFile(e){return new Promise(t=>{ZE.readFile(Yd.join(e,"package.json"),"utf8",(r,i)=>{t(i)})})}_getStatusEvent(){let e=this._client.controlConnection,t=this._client.options,r=this._client.getState(),i={};r.getConnectedHosts().forEach(o=>{i[o.address]={connections:r.getOpenConnections(o),inFlightQueries:r.getInFlightQueries(o)}});let s={metadata:{name:"driver.status",insightMappingId:"v1",insightType:"EVENT",timestamp:Date.now(),tags:{language:"nodejs"}},data:{clientId:t.id,sessionId:this._sessionId,controlConnection:e.host?e.host.address:void 0,connectedNodes:i}};return JSON.stringify(s)}shutdown(){this._enabled&&(this._closed=!0,this._firstTimeout!==null&&clearTimeout(this._firstTimeout),this._recurrentTimeout!==null&&clearInterval(this._recurrentTimeout))}};ip.exports=$a;function rp(n){let e={};return n.forEach((t,r)=>e[r]=t),e}function es(n){if(!n)return;let e=n.getOptions&&n.getOptions();return{type:n.constructor.name,options:e instanceof Map?rp(e):Qa.emptyObject}}function Ji(n){if(typeof n=="number")return dn.consistencyToString[n]}function rT(n){return n?n.constructor.name:void 0}function iT(n){let e={},t=n.profileManager.getDefault();return np(n,e,t,t),n.profileManager.getAll().filter(r=>r!==t).forEach(r=>np(n,e,r,t)),e}function np(n,e,t,r){let i=e[t.name]={};if(xt(i,t,r,"readTimeout"),xt(i,t,r,"loadBalancing",es),xt(i,t,r,"retry",es),xt(i,t,r,"consistency",Ji),xt(i,t,r,"serialConsistency",Ji),t===r&&(i.speculativeExecution=es(n.options.policies.speculativeExecution)),t.graphOptions){i.graphOptions={};let s=r.graphOptions||Qa.emptyObject;xt(i.graphOptions,t.graphOptions,s,"language"),xt(i.graphOptions,t.graphOptions,s,"name"),xt(i.graphOptions,t.graphOptions,s,"readConsistency",Ji),xt(i.graphOptions,t.graphOptions,s,"source"),xt(i.graphOptions,t.graphOptions,s,"writeConsistency",Ji),Object.keys(i.graphOptions).length===0&&(i.graphOptions=void 0)}}function xt(n,e,t,r,i){let s=e[r];i=i||(o=>o),(e===t&&s!==void 0||s!==t[r])&&(n[r]=i(s))}});var Za=C((ib,op)=>{op.exports={LOCHDR:30,LOCSIG:67324752,LOCVER:4,LOCFLG:6,LOCHOW:8,LOCTIM:10,LOCCRC:14,LOCSIZ:18,LOCLEN:22,LOCNAM:26,LOCEXT:28,EXTSIG:134695760,EXTHDR:16,EXTCRC:4,EXTSIZ:8,EXTLEN:12,CENHDR:46,CENSIG:33639248,CENVEM:4,CENVER:6,CENFLG:8,CENHOW:10,CENTIM:12,CENCRC:16,CENSIZ:20,CENLEN:24,CENNAM:28,CENEXT:30,CENCOM:32,CENDSK:34,CENATT:36,CENATX:38,CENOFF:42,ENDHDR:22,ENDSIG:101010256,ENDSUB:8,ENDTOT:10,ENDSIZ:12,ENDOFF:16,ENDCOM:20,END64HDR:20,END64SIG:117853008,END64START:4,END64OFF:8,END64NUMDISKS:16,ZIP64SIG:101075792,ZIP64HDR:56,ZIP64LEAD:12,ZIP64SIZE:4,ZIP64VEM:12,ZIP64VER:14,ZIP64DSK:16,ZIP64DSKDIR:20,ZIP64SUB:24,ZIP64TOT:32,ZIP64SIZB:40,ZIP64OFF:48,ZIP64EXTRA:56,STORED:0,SHRUNK:1,REDUCED1:2,REDUCED2:3,REDUCED3:4,REDUCED4:5,IMPLODED:6,DEFLATED:8,ENHANCED_DEFLATED:9,PKWARE:10,BZIP2:12,LZMA:14,IBM_TERSE:18,IBM_LZ77:19,AES_ENCRYPT:99,FLG_ENC:1,FLG_COMP1:2,FLG_COMP2:4,FLG_DESC:8,FLG_ENH:16,FLG_PATCH:32,FLG_STR:64,FLG_EFS:2048,FLG_MSK:4096,FILE:2,BUFFER:1,NONE:0,EF_ID:0,EF_SIZE:2,ID_ZIP64:1,ID_AVINFO:7,ID_PFS:8,ID_OS2:9,ID_NTFS:10,ID_OPENVMS:12,ID_UNIX:13,ID_FORK:14,ID_PATCH:15,ID_X509_PKCS7:20,ID_X509_CERTID_F:21,ID_X509_CERTID_C:22,ID_STRONGENC:23,ID_RECORD_MGT:24,ID_X509_PKCS7_RL:25,ID_IBM1:101,ID_IBM2:102,ID_POSZIP:18064,EF_ZIP64_OR_32:4294967295,EF_ZIP64_OR_16:65535,EF_ZIP64_SUNCOMP:0,EF_ZIP64_SCOMP:8,EF_ZIP64_RHO:16,EF_ZIP64_DSN:24}});var ns=C(cp=>{var ap={INVALID_LOC:"Invalid LOC header (bad signature)",INVALID_CEN:"Invalid CEN header (bad signature)",INVALID_END:"Invalid END header (bad signature)",DESCRIPTOR_NOT_EXIST:"No descriptor present",DESCRIPTOR_UNKNOWN:"Unknown descriptor format",DESCRIPTOR_FAULTY:"Descriptor data is malformed",NO_DATA:"Nothing to decompress",BAD_CRC:"CRC32 checksum failed {0}",FILE_IN_THE_WAY:"There is a file in the way: {0}",UNKNOWN_METHOD:"Invalid/unsupported compression method",AVAIL_DATA:"inflate::Available inflate data did not terminate",INVALID_DISTANCE:"inflate::Invalid literal/length or distance code in fixed or dynamic block",TO_MANY_CODES:"inflate::Dynamic block code description: too many length or distance codes",INVALID_REPEAT_LEN:"inflate::Dynamic block code description: repeat more than specified lengths",INVALID_REPEAT_FIRST:"inflate::Dynamic block code description: repeat lengths with no first length",INCOMPLETE_CODES:"inflate::Dynamic block code description: code lengths codes incomplete",INVALID_DYN_DISTANCE:"inflate::Dynamic block code description: invalid distance code lengths",INVALID_CODES_LEN:"inflate::Dynamic block code description: invalid literal/length code lengths",INVALID_STORE_BLOCK:"inflate::Stored block length did not match one's complement",INVALID_BLOCK_TYPE:"inflate::Invalid block type (type == 3)",CANT_EXTRACT_FILE:"Could not extract the file",CANT_OVERRIDE:"Target file already exists",DISK_ENTRY_TOO_LARGE:"Number of disk entries is too large",NO_ZIP:"No zip file was loaded",NO_ENTRY:"Entry doesn't exist",DIRECTORY_CONTENT_ERROR:"A directory cannot have content",FILE_NOT_FOUND:'File not found: "{0}"',NOT_IMPLEMENTED:"Not implemented",INVALID_FILENAME:"Invalid filename",INVALID_FORMAT:"Invalid or unsupported zip format. No END header found",INVALID_PASS_PARAM:"Incompatible password parameter",WRONG_PASSWORD:"Wrong Password",COMMENT_TOO_LONG:"Comment is too long",EXTRA_FIELD_PARSE_ERROR:"Extra field parsing error"};function sT(n){return function(...e){return e.length&&(n=n.replace(/\{(\d)\}/g,(t,r)=>e[r]||"")),new Error("ADM-ZIP: "+n)}}for(let n of Object.keys(ap))cp[n]=sT(ap[n])});var dp=C((ob,fp)=>{var oT=require("fs"),_e=require("path"),up=Za(),aT=ns(),cT=typeof process=="object"&&process.platform==="win32",lp=n=>typeof n=="object"&&n!==null,hp=new Uint32Array(256).map((n,e)=>{for(let t=0;t<8;t++)(e&1)!==0?e=3988292384^e>>>1:e>>>=1;return e>>>0});function ce(n){this.sep=_e.sep,this.fs=oT,lp(n)&&lp(n.fs)&&typeof n.fs.statSync=="function"&&(this.fs=n.fs)}fp.exports=ce;ce.prototype.makeDir=function(n){let e=this;function t(r){let i=r.split(e.sep)[0];r.split(e.sep).forEach(function(s){if(!(!s||s.substr(-1,1)===":")){i+=e.sep+s;var o;try{o=e.fs.statSync(i)}catch{e.fs.mkdirSync(i)}if(o&&o.isFile())throw aT.FILE_IN_THE_WAY(`"${i}"`)}})}t(n)};ce.prototype.writeFileTo=function(n,e,t,r){let i=this;if(i.fs.existsSync(n)){if(!t)return!1;var s=i.fs.statSync(n);if(s.isDirectory())return!1}var o=_e.dirname(n);i.fs.existsSync(o)||i.makeDir(o);var a;try{a=i.fs.openSync(n,"w",438)}catch{i.fs.chmodSync(n,438),a=i.fs.openSync(n,"w",438)}if(a)try{i.fs.writeSync(a,e,0,e.length,0)}finally{i.fs.closeSync(a)}return i.fs.chmodSync(n,r||438),!0};ce.prototype.writeFileToAsync=function(n,e,t,r,i){typeof r=="function"&&(i=r,r=void 0);let s=this;s.fs.exists(n,function(o){if(o&&!t)return i(!1);s.fs.stat(n,function(a,c){if(o&&c.isDirectory())return i(!1);var u=_e.dirname(n);s.fs.exists(u,function(f){f||s.makeDir(u),s.fs.open(n,"w",438,function(g,S){g?s.fs.chmod(n,438,function(){s.fs.open(n,"w",438,function(p,y){s.fs.write(y,e,0,e.length,0,function(){s.fs.close(y,function(){s.fs.chmod(n,r||438,function(){i(!0)})})})})}):S?s.fs.write(S,e,0,e.length,0,function(){s.fs.close(S,function(){s.fs.chmod(n,r||438,function(){i(!0)})})}):s.fs.chmod(n,r||438,function(){i(!0)})})})})})};ce.prototype.findFiles=function(n){let e=this;function t(r,i,s){typeof i=="boolean"&&(s=i,i=void 0);let o=[];return e.fs.readdirSync(r).forEach(function(a){let c=_e.join(r,a),u=e.fs.statSync(c);(!i||i.test(c))&&o.push(_e.normalize(c)+(u.isDirectory()?e.sep:"")),u.isDirectory()&&s&&(o=o.concat(t(c,i,s)))}),o}return t(n,void 0,!0)};ce.prototype.findFilesAsync=function(n,e){let t=this,r=[];t.fs.readdir(n,function(i,s){if(i)return e(i);let o=s.length;if(!o)return e(null,r);s.forEach(function(a){a=_e.join(n,a),t.fs.stat(a,function(c,u){if(c)return e(c);u&&(r.push(_e.normalize(a)+(u.isDirectory()?t.sep:"")),u.isDirectory()?t.findFilesAsync(a,function(f,g){if(f)return e(f);r=r.concat(g),--o||e(null,r)}):--o||e(null,r))})})})};ce.prototype.getAttributes=function(){};ce.prototype.setAttributes=function(){};ce.crc32update=function(n,e){return hp[(n^e)&255]^n>>>8};ce.crc32=function(n){typeof n=="string"&&(n=Buffer.from(n,"utf8"));let e=n.length,t=-1;for(let r=0;r<e;)t=ce.crc32update(t,n[r++]);return~t>>>0};ce.methodToString=function(n){switch(n){case up.STORED:return"STORED ("+n+")";case up.DEFLATED:return"DEFLATED ("+n+")";default:return"UNSUPPORTED ("+n+")"}};ce.canonical=function(n){if(!n)return"";let e=_e.posix.normalize("/"+n.split("\\").join("/"));return _e.join(".",e)};ce.zipnamefix=function(n){if(!n)return"";let e=_e.posix.normalize("/"+n.split("\\").join("/"));return _e.posix.join(".",e)};ce.findLast=function(n,e){if(!Array.isArray(n))throw new TypeError("arr is not array");let t=n.length>>>0;for(let r=t-1;r>=0;r--)if(e(n[r],r,n))return n[r]};ce.sanitize=function(n,e){n=_e.resolve(_e.normalize(n));for(var t=e.split("/"),r=0,i=t.length;r<i;r++){var s=_e.normalize(_e.join(n,t.slice(r,i).join(_e.sep)));if(s.indexOf(n)===0)return s}return _e.normalize(_e.join(n,_e.basename(e)))};ce.toBuffer=function(e,t){return Buffer.isBuffer(e)?e:e instanceof Uint8Array?Buffer.from(e):typeof e=="string"?t(e):Buffer.alloc(0)};ce.readBigUInt64LE=function(n,e){var t=Buffer.from(n.slice(e,e+8));return t.swap64(),parseInt(`0x${t.toString("hex")}`)};ce.fromDOS2Date=function(n){return new Date((n>>25&127)+1980,Math.max((n>>21&15)-1,0),Math.max(n>>16&31,1),n>>11&31,n>>5&63,(n&31)<<1)};ce.fromDate2DOS=function(n){let e=0,t=0;return n.getFullYear()>1979&&(e=(n.getFullYear()-1980&127)<<9|n.getMonth()+1<<5|n.getDate(),t=n.getHours()<<11|n.getMinutes()<<5|n.getSeconds()>>1),e<<16|t};ce.isWin=cT;ce.crcTable=hp});var gp=C((ab,pp)=>{var uT=require("path");pp.exports=function(n,{fs:e}){var t=n||"",r=s(),i=null;function s(){return{directory:!1,readonly:!1,hidden:!1,executable:!1,mtime:0,atime:0}}return t&&e.existsSync(t)?(i=e.statSync(t),r.directory=i.isDirectory(),r.mtime=i.mtime,r.atime=i.atime,r.executable=(73&i.mode)!==0,r.readonly=(128&i.mode)===0,r.hidden=uT.basename(t)[0]==="."):console.warn("Invalid path: "+t),{get directory(){return r.directory},get readOnly(){return r.readonly},get hidden(){return r.hidden},get mtime(){return r.mtime},get atime(){return r.atime},get executable(){return r.executable},decodeAttributes:function(){},encodeAttributes:function(){},toJSON:function(){return{path:t,isDirectory:r.directory,isReadOnly:r.readonly,isHidden:r.hidden,isExecutable:r.executable,mTime:r.mtime,aTime:r.atime}},toString:function(){return JSON.stringify(this.toJSON(),null,"	")}}}});var yp=C((cb,mp)=>{mp.exports={efs:!0,encode:n=>Buffer.from(n,"utf8"),decode:n=>n.toString("utf8")}});var Zn=C((ub,Qn)=>{Qn.exports=dp();Qn.exports.Constants=Za();Qn.exports.Errors=ns();Qn.exports.FileAttr=gp();Qn.exports.decoder=yp()});var _p=C((lb,wp)=>{var Zt=Zn(),B=Zt.Constants;wp.exports=function(){var n=20,e=10,t=0,r=0,i=0,s=0,o=0,a=0,c=0,u=0,f=0,g=0,S=0,p=0,y=0;n|=Zt.isWin?2560:768,t|=B.FLG_EFS;let _={extraLen:0},w=l=>Math.max(0,l)>>>0,E=l=>Math.max(0,l)&65535,v=l=>Math.max(0,l)&255;return i=Zt.fromDate2DOS(new Date),{get made(){return n},set made(l){n=l},get version(){return e},set version(l){e=l},get flags(){return t},set flags(l){t=l},get flags_efs(){return(t&B.FLG_EFS)>0},set flags_efs(l){l?t|=B.FLG_EFS:t&=~B.FLG_EFS},get flags_desc(){return(t&B.FLG_DESC)>0},set flags_desc(l){l?t|=B.FLG_DESC:t&=~B.FLG_DESC},get method(){return r},set method(l){switch(l){case B.STORED:this.version=10;case B.DEFLATED:default:this.version=20}r=l},get time(){return Zt.fromDOS2Date(this.timeval)},set time(l){this.timeval=Zt.fromDate2DOS(l)},get timeval(){return i},set timeval(l){i=w(l)},get timeHighByte(){return v(i>>>8)},get crc(){return s},set crc(l){s=w(l)},get compressedSize(){return o},set compressedSize(l){o=w(l)},get size(){return a},set size(l){a=w(l)},get fileNameLength(){return c},set fileNameLength(l){c=l},get extraLength(){return u},set extraLength(l){u=l},get extraLocalLength(){return _.extraLen},set extraLocalLength(l){_.extraLen=l},get commentLength(){return f},set commentLength(l){f=l},get diskNumStart(){return g},set diskNumStart(l){g=w(l)},get inAttr(){return S},set inAttr(l){S=w(l)},get attr(){return p},set attr(l){p=w(l)},get fileAttr(){return(p||0)>>16&4095},get offset(){return y},set offset(l){y=w(l)},get encrypted(){return(t&B.FLG_ENC)===B.FLG_ENC},get centralHeaderSize(){return B.CENHDR+c+u+f},get realDataOffset(){return y+B.LOCHDR+_.fnameLen+_.extraLen},get localHeader(){return _},loadLocalHeaderFromBinary:function(l){var d=l.slice(y,y+B.LOCHDR);if(d.readUInt32LE(0)!==B.LOCSIG)throw Zt.Errors.INVALID_LOC();_.version=d.readUInt16LE(B.LOCVER),_.flags=d.readUInt16LE(B.LOCFLG),_.method=d.readUInt16LE(B.LOCHOW),_.time=d.readUInt32LE(B.LOCTIM),_.crc=d.readUInt32LE(B.LOCCRC),_.compressedSize=d.readUInt32LE(B.LOCSIZ),_.size=d.readUInt32LE(B.LOCLEN),_.fnameLen=d.readUInt16LE(B.LOCNAM),_.extraLen=d.readUInt16LE(B.LOCEXT);let m=y+B.LOCHDR+_.fnameLen,N=m+_.extraLen;return l.slice(m,N)},loadFromBinary:function(l){if(l.length!==B.CENHDR||l.readUInt32LE(0)!==B.CENSIG)throw Zt.Errors.INVALID_CEN();n=l.readUInt16LE(B.CENVEM),e=l.readUInt16LE(B.CENVER),t=l.readUInt16LE(B.CENFLG),r=l.readUInt16LE(B.CENHOW),i=l.readUInt32LE(B.CENTIM),s=l.readUInt32LE(B.CENCRC),o=l.readUInt32LE(B.CENSIZ),a=l.readUInt32LE(B.CENLEN),c=l.readUInt16LE(B.CENNAM),u=l.readUInt16LE(B.CENEXT),f=l.readUInt16LE(B.CENCOM),g=l.readUInt16LE(B.CENDSK),S=l.readUInt16LE(B.CENATT),p=l.readUInt32LE(B.CENATX),y=l.readUInt32LE(B.CENOFF)},localHeaderToBinary:function(){var l=Buffer.alloc(B.LOCHDR);return l.writeUInt32LE(B.LOCSIG,0),l.writeUInt16LE(e,B.LOCVER),l.writeUInt16LE(t,B.LOCFLG),l.writeUInt16LE(r,B.LOCHOW),l.writeUInt32LE(i,B.LOCTIM),l.writeUInt32LE(s,B.LOCCRC),l.writeUInt32LE(o,B.LOCSIZ),l.writeUInt32LE(a,B.LOCLEN),l.writeUInt16LE(c,B.LOCNAM),l.writeUInt16LE(_.extraLen,B.LOCEXT),l},centralHeaderToBinary:function(){var l=Buffer.alloc(B.CENHDR+c+u+f);return l.writeUInt32LE(B.CENSIG,0),l.writeUInt16LE(n,B.CENVEM),l.writeUInt16LE(e,B.CENVER),l.writeUInt16LE(t,B.CENFLG),l.writeUInt16LE(r,B.CENHOW),l.writeUInt32LE(i,B.CENTIM),l.writeUInt32LE(s,B.CENCRC),l.writeUInt32LE(o,B.CENSIZ),l.writeUInt32LE(a,B.CENLEN),l.writeUInt16LE(c,B.CENNAM),l.writeUInt16LE(u,B.CENEXT),l.writeUInt16LE(f,B.CENCOM),l.writeUInt16LE(g,B.CENDSK),l.writeUInt16LE(S,B.CENATT),l.writeUInt32LE(p,B.CENATX),l.writeUInt32LE(y,B.CENOFF),l},toJSON:function(){let l=function(d){return d+" bytes"};return{made:n,version:e,flags:t,method:Zt.methodToString(r),time:this.time,crc:"0x"+s.toString(16).toUpperCase(),compressedSize:l(o),size:l(a),fileNameLength:l(c),extraLength:l(u),commentLength:l(f),diskNumStart:g,inAttr:S,attr:p,offset:y,centralHeaderSize:l(B.CENHDR+c+u+f)}},toString:function(){return JSON.stringify(this.toJSON(),null,"	")}}}});var Tp=C((hb,Ep)=>{var Yn=Zn(),te=Yn.Constants;Ep.exports=function(){var n=0,e=0,t=0,r=0,i=0;return{get diskEntries(){return n},set diskEntries(s){n=e=s},get totalEntries(){return e},set totalEntries(s){e=n=s},get size(){return t},set size(s){t=s},get offset(){return r},set offset(s){r=s},get commentLength(){return i},set commentLength(s){i=s},get mainHeaderSize(){return te.ENDHDR+i},loadFromBinary:function(s){if((s.length!==te.ENDHDR||s.readUInt32LE(0)!==te.ENDSIG)&&(s.length<te.ZIP64HDR||s.readUInt32LE(0)!==te.ZIP64SIG))throw Yn.Errors.INVALID_END();s.readUInt32LE(0)===te.ENDSIG?(n=s.readUInt16LE(te.ENDSUB),e=s.readUInt16LE(te.ENDTOT),t=s.readUInt32LE(te.ENDSIZ),r=s.readUInt32LE(te.ENDOFF),i=s.readUInt16LE(te.ENDCOM)):(n=Yn.readBigUInt64LE(s,te.ZIP64SUB),e=Yn.readBigUInt64LE(s,te.ZIP64TOT),t=Yn.readBigUInt64LE(s,te.ZIP64SIZE),r=Yn.readBigUInt64LE(s,te.ZIP64OFF),i=0)},toBinary:function(){var s=Buffer.alloc(te.ENDHDR+i);return s.writeUInt32LE(te.ENDSIG,0),s.writeUInt32LE(0,4),s.writeUInt16LE(n,te.ENDSUB),s.writeUInt16LE(e,te.ENDTOT),s.writeUInt32LE(t,te.ENDSIZ),s.writeUInt32LE(r,te.ENDOFF),s.writeUInt16LE(i,te.ENDCOM),s.fill(" ",te.ENDHDR),s},toJSON:function(){let s=function(o,a){let c=o.toString(16).toUpperCase();for(;c.length<a;)c="0"+c;return"0x"+c};return{diskEntries:n,totalEntries:e,size:t+" bytes",offset:s(r,4),commentLength:i}},toString:function(){return JSON.stringify(this.toJSON(),null,"	")}}}});var Xa=C(Ya=>{Ya.EntryHeader=_p();Ya.MainHeader=Tp()});var Cp=C((db,Sp)=>{Sp.exports=function(n){var e=require("zlib"),t={chunkSize:(parseInt(n.length/1024)+1)*1024};return{deflate:function(){return e.deflateRawSync(n,t)},deflateAsync:function(r){var i=e.createDeflateRaw(t),s=[],o=0;i.on("data",function(a){s.push(a),o+=a.length}),i.on("end",function(){var a=Buffer.alloc(o),c=0;a.fill(0);for(var u=0;u<s.length;u++){var f=s[u];f.copy(a,c),c+=f.length}r&&r(a)}),i.end(n)}}}});var bp=C((pb,xp)=>{var lT=+(process.versions?process.versions.node:"").split(".")[0]||0;xp.exports=function(n,e){var t=require("zlib");let r=lT>=15&&e>0?{maxOutputLength:e}:{};return{inflate:function(){return t.inflateRawSync(n,r)},inflateAsync:function(i){var s=t.createInflateRaw(r),o=[],a=0;s.on("data",function(c){o.push(c),a+=c.length}),s.on("end",function(){var c=Buffer.alloc(a),u=0;c.fill(0);for(var f=0;f<o.length;f++){var g=o[f];g.copy(c,u),u+=g.length}i&&i(c)}),s.end(n)}}}});var Pp=C((gb,Ip)=>{"use strict";var{randomFillSync:vp}=require("crypto"),hT=ns(),fT=new Uint32Array(256).map((n,e)=>{for(let t=0;t<8;t++)(e&1)!==0?e=e>>>1^3988292384:e>>>=1;return e>>>0}),Ap=(n,e)=>Math.imul(n,e)>>>0,Np=(n,e)=>fT[(n^e)&255]^n>>>8,zr=()=>typeof vp=="function"?vp(Buffer.alloc(12)):zr.node();zr.node=()=>{let n=Buffer.alloc(12),e=n.length;for(let t=0;t<e;t++)n[t]=Math.random()*256&255;return n};var rs={genSalt:zr};function is(n){let e=Buffer.isBuffer(n)?n:Buffer.from(n);this.keys=new Uint32Array([305419896,591751049,878082192]);for(let t=0;t<e.length;t++)this.updateKeys(e[t])}is.prototype.updateKeys=function(n){let e=this.keys;return e[0]=Np(e[0],n),e[1]+=e[0]&255,e[1]=Ap(e[1],134775813)+1,e[2]=Np(e[2],e[1]>>>24),n};is.prototype.next=function(){let n=(this.keys[2]|2)>>>0;return Ap(n,n^1)>>8&255};function dT(n){let e=new is(n);return function(t){let r=Buffer.alloc(t.length),i=0;for(let s of t)r[i++]=e.updateKeys(s^e.next());return r}}function pT(n){let e=new is(n);return function(t,r,i=0){r||(r=Buffer.alloc(t.length));for(let s of t){let o=e.next();r[i++]=s^o,e.updateKeys(s)}return r}}function gT(n,e,t){if(!n||!Buffer.isBuffer(n)||n.length<12)return Buffer.alloc(0);let r=dT(t),i=r(n.slice(0,12)),s=(e.flags&8)===8?e.timeHighByte:e.crc>>>24;if(i[11]!==s)throw hT.WRONG_PASSWORD();return r(n.slice(12))}function mT(n){Buffer.isBuffer(n)&&n.length>=12?rs.genSalt=function(){return n.slice(0,12)}:n==="node"?rs.genSalt=zr.node:rs.genSalt=zr}function yT(n,e,t,r=!1){n==null&&(n=Buffer.alloc(0)),Buffer.isBuffer(n)||(n=Buffer.from(n.toString()));let i=pT(t),s=rs.genSalt();s[11]=e.crc>>>24&255,r&&(s[10]=e.crc>>>16&255);let o=Buffer.alloc(n.length+12);return i(s,o),i(n,o,12)}Ip.exports={decrypt:gT,encrypt:yT,_salter:mT}});var Bp=C(ss=>{ss.Deflater=Cp();ss.Inflater=bp();ss.ZipCrypto=Pp()});var ec=C((yb,Op)=>{var G=Zn(),wT=Xa(),ue=G.Constants,Ja=Bp();Op.exports=function(n,e){var t=new wT.EntryHeader,r=Buffer.alloc(0),i=Buffer.alloc(0),s=!1,o=null,a=Buffer.alloc(0),c=Buffer.alloc(0),u=!0;let f=n,g=typeof f.decoder=="object"?f.decoder:G.decoder;u=g.hasOwnProperty("efs")?g.efs:!1;function S(){return!e||!(e instanceof Uint8Array)?Buffer.alloc(0):(c=t.loadLocalHeaderFromBinary(e),e.slice(t.realDataOffset,t.realDataOffset+t.compressedSize))}function p(l){if(t.flags_desc){let d={},m=t.realDataOffset+t.compressedSize;if(e.readUInt32LE(m)==ue.LOCSIG||e.readUInt32LE(m)==ue.CENSIG)throw G.Errors.DESCRIPTOR_NOT_EXIST();if(e.readUInt32LE(m)==ue.EXTSIG)d.crc=e.readUInt32LE(m+ue.EXTCRC),d.compressedSize=e.readUInt32LE(m+ue.EXTSIZ),d.size=e.readUInt32LE(m+ue.EXTLEN);else if(e.readUInt16LE(m+12)===19280)d.crc=e.readUInt32LE(m+ue.EXTCRC-4),d.compressedSize=e.readUInt32LE(m+ue.EXTSIZ-4),d.size=e.readUInt32LE(m+ue.EXTLEN-4);else throw G.Errors.DESCRIPTOR_UNKNOWN();if(d.compressedSize!==t.compressedSize||d.size!==t.size||d.crc!==t.crc)throw G.Errors.DESCRIPTOR_FAULTY();if(G.crc32(l)!==d.crc)return!1}else if(G.crc32(l)!==t.localHeader.crc)return!1;return!0}function y(l,d,m){if(typeof d>"u"&&typeof l=="string"&&(m=l,l=void 0),s)return l&&d&&d(Buffer.alloc(0),G.Errors.DIRECTORY_CONTENT_ERROR()),Buffer.alloc(0);var N=S();if(N.length===0)return l&&d&&d(N),N;if(t.encrypted){if(typeof m!="string"&&!Buffer.isBuffer(m))throw G.Errors.INVALID_PASS_PARAM();N=Ja.ZipCrypto.decrypt(N,t,m)}var A=Buffer.alloc(t.size);switch(t.method){case G.Constants.STORED:if(N.copy(A),p(A))return l&&d&&d(A),A;throw l&&d&&d(A,G.Errors.BAD_CRC()),G.Errors.BAD_CRC();case G.Constants.DEFLATED:var L=new Ja.Inflater(N,t.size);if(l)L.inflateAsync(function(R){R.copy(R,0),d&&(p(R)?d(R):d(R,G.Errors.BAD_CRC()))});else{if(L.inflate(A).copy(A,0),!p(A))throw G.Errors.BAD_CRC(`"${g.decode(r)}"`);return A}break;default:throw l&&d&&d(Buffer.alloc(0),G.Errors.UNKNOWN_METHOD()),G.Errors.UNKNOWN_METHOD()}}function _(l,d){if((!o||!o.length)&&Buffer.isBuffer(e))return l&&d&&d(S()),S();if(o.length&&!s){var m;switch(t.method){case G.Constants.STORED:return t.compressedSize=t.size,m=Buffer.alloc(o.length),o.copy(m),l&&d&&d(m),m;default:case G.Constants.DEFLATED:var N=new Ja.Deflater(o);if(l)N.deflateAsync(function(L){m=Buffer.alloc(L.length),t.compressedSize=L.length,L.copy(m),d&&d(m)});else{var A=N.deflate();return t.compressedSize=A.length,A}N=null;break}}else if(l&&d)d(Buffer.alloc(0));else return Buffer.alloc(0)}function w(l,d){return(l.readUInt32LE(d+4)<<4)+l.readUInt32LE(d)}function E(l){try{for(var d=0,m,N,A;d+4<l.length;)m=l.readUInt16LE(d),d+=2,N=l.readUInt16LE(d),d+=2,A=l.slice(d,d+N),d+=N,ue.ID_ZIP64===m&&v(A)}catch{throw G.Errors.EXTRA_FIELD_PARSE_ERROR()}}function v(l){var d,m,N,A;l.length>=ue.EF_ZIP64_SCOMP&&(d=w(l,ue.EF_ZIP64_SUNCOMP),t.size===ue.EF_ZIP64_OR_32&&(t.size=d)),l.length>=ue.EF_ZIP64_RHO&&(m=w(l,ue.EF_ZIP64_SCOMP),t.compressedSize===ue.EF_ZIP64_OR_32&&(t.compressedSize=m)),l.length>=ue.EF_ZIP64_DSN&&(N=w(l,ue.EF_ZIP64_RHO),t.offset===ue.EF_ZIP64_OR_32&&(t.offset=N)),l.length>=ue.EF_ZIP64_DSN+4&&(A=l.readUInt32LE(ue.EF_ZIP64_DSN),t.diskNumStart===ue.EF_ZIP64_OR_16&&(t.diskNumStart=A))}return{get entryName(){return g.decode(r)},get rawEntryName(){return r},set entryName(l){r=G.toBuffer(l,g.encode);var d=r[r.length-1];s=d===47||d===92,t.fileNameLength=r.length},get efs(){return typeof u=="function"?u(this.entryName):u},get extra(){return a},set extra(l){a=l,t.extraLength=l.length,E(l)},get comment(){return g.decode(i)},set comment(l){if(i=G.toBuffer(l,g.encode),t.commentLength=i.length,i.length>65535)throw G.Errors.COMMENT_TOO_LONG()},get name(){var l=g.decode(r);return s?l.substr(l.length-1).split("/").pop():l.split("/").pop()},get isDirectory(){return s},getCompressedData:function(){return _(!1,null)},getCompressedDataAsync:function(l){_(!0,l)},setData:function(l){o=G.toBuffer(l,G.decoder.encode),!s&&o.length?(t.size=o.length,t.method=G.Constants.DEFLATED,t.crc=G.crc32(l),t.changed=!0):t.method=G.Constants.STORED},getData:function(l){return t.changed?o:y(!1,null,l)},getDataAsync:function(l,d){t.changed?l(o):y(!0,l,d)},set attr(l){t.attr=l},get attr(){return t.attr},set header(l){t.loadFromBinary(l)},get header(){return t},packCentralHeader:function(){t.flags_efs=this.efs,t.extraLength=a.length;var l=t.centralHeaderToBinary(),d=G.Constants.CENHDR;return r.copy(l,d),d+=r.length,a.copy(l,d),d+=t.extraLength,i.copy(l,d),l},packLocalHeader:function(){let l=0;t.flags_efs=this.efs,t.extraLocalLength=c.length;let d=t.localHeaderToBinary(),m=Buffer.alloc(d.length+r.length+t.extraLocalLength);return d.copy(m,l),l+=d.length,r.copy(m,l),l+=r.length,c.copy(m,l),l+=c.length,m},toJSON:function(){let l=function(d){return"<"+(d&&d.length+" bytes buffer"||"null")+">"};return{entryName:this.entryName,name:this.name,comment:this.comment,isDirectory:this.isDirectory,header:t.toJSON(),compressedData:l(e),data:l(o)}},toString:function(){return JSON.stringify(this.toJSON(),null,"	")}}}});var qp=C((wb,Lp)=>{var Rp=ec(),_T=Xa(),ve=Zn();Lp.exports=function(n,e){var t=[],r={},i=Buffer.alloc(0),s=new _T.MainHeader,o=!1,a=null;let c=new Set,u=e,{noSort:f,decoder:g}=u;n?y(u.readEntries):o=!0;function S(){let w=new Set;for(let E of Object.keys(r)){let v=E.split("/");if(v.pop(),!!v.length)for(let l=0;l<v.length;l++){let d=v.slice(0,l+1).join("/")+"/";w.add(d)}}for(let E of w)if(!(E in r)){let v=new Rp(u);v.entryName=E,v.attr=16,v.temporary=!0,t.push(v),r[v.entryName]=v,c.add(v)}}function p(){if(o=!0,r={},s.diskEntries>(n.length-s.offset)/ve.Constants.CENHDR)throw ve.Errors.DISK_ENTRY_TOO_LARGE();t=new Array(s.diskEntries);for(var w=s.offset,E=0;E<t.length;E++){var v=w,l=new Rp(u,n);l.header=n.slice(v,v+=ve.Constants.CENHDR),l.entryName=n.slice(v,v+=l.header.fileNameLength),l.header.extraLength&&(l.extra=n.slice(v,v+=l.header.extraLength)),l.header.commentLength&&(l.comment=n.slice(v,v+l.header.commentLength)),w+=l.header.centralHeaderSize,t[E]=l,r[l.entryName]=l}c.clear(),S()}function y(w){var E=n.length-ve.Constants.ENDHDR,v=Math.max(0,E-65535),l=v,d=n.length,m=-1,N=0;for((typeof u.trailingSpace=="boolean"?u.trailingSpace:!1)&&(v=0),E;E>=l;E--)if(n[E]===80){if(n.readUInt32LE(E)===ve.Constants.ENDSIG){m=E,N=E,d=E+ve.Constants.ENDHDR,l=E-ve.Constants.END64HDR;continue}if(n.readUInt32LE(E)===ve.Constants.END64SIG){l=v;continue}if(n.readUInt32LE(E)===ve.Constants.ZIP64SIG){m=E,d=E+ve.readBigUInt64LE(n,E+ve.Constants.ZIP64SIZE)+ve.Constants.ZIP64LEAD;break}}if(m==-1)throw ve.Errors.INVALID_FORMAT();s.loadFromBinary(n.slice(m,d)),s.commentLength&&(i=n.slice(N+ve.Constants.ENDHDR)),w&&p()}function _(){t.length>1&&!f&&t.sort((w,E)=>w.entryName.toLowerCase().localeCompare(E.entryName.toLowerCase()))}return{get entries(){return o||p(),t.filter(w=>!c.has(w))},get comment(){return g.decode(i)},set comment(w){i=ve.toBuffer(w,g.encode),s.commentLength=i.length},getEntryCount:function(){return o?t.length:s.diskEntries},forEach:function(w){this.entries.forEach(w)},getEntry:function(w){return o||p(),r[w]||null},setEntry:function(w){o||p(),t.push(w),r[w.entryName]=w,s.totalEntries=t.length},deleteFile:function(w,E=!0){o||p();let v=r[w];this.getEntryChildren(v,E).map(d=>d.entryName).forEach(this.deleteEntry)},deleteEntry:function(w){o||p();let E=r[w],v=t.indexOf(E);v>=0&&(t.splice(v,1),delete r[w],s.totalEntries=t.length)},getEntryChildren:function(w,E=!0){if(o||p(),typeof w=="object")if(w.isDirectory&&E){let v=[],l=w.entryName;for(let d of t)d.entryName.startsWith(l)&&v.push(d);return v}else return[w];return[]},getChildCount:function(w){if(w&&w.isDirectory){let E=this.getEntryChildren(w);return E.includes(w)?E.length-1:E.length}return 0},compressToBuffer:function(){o||p(),_();let w=[],E=[],v=0,l=0;s.size=0,s.offset=0;let d=0;for(let A of this.entries){let L=A.getCompressedData();A.header.offset=l;let R=A.packLocalHeader(),D=R.length+L.length;l+=D,w.push(R),w.push(L);let x=A.packCentralHeader();E.push(x),s.size+=x.length,v+=D+x.length,d++}v+=s.mainHeaderSize,s.offset=l,s.totalEntries=d,l=0;let m=Buffer.alloc(v);for(let A of w)A.copy(m,l),l+=A.length;for(let A of E)A.copy(m,l),l+=A.length;let N=s.toBinary();return i&&i.copy(N,ve.Constants.ENDHDR),N.copy(m,l),n=m,o=!1,m},toAsyncBuffer:function(w,E,v,l){try{o||p(),_();let d=[],m=[],N=0,A=0,L=0;s.size=0,s.offset=0;let R=function(D){if(D.length>0){let x=D.shift(),ut=x.entryName+x.extra.toString();v&&v(ut),x.getCompressedDataAsync(function(b){l&&l(ut),x.header.offset=A;let h=x.packLocalHeader(),P=h.length+b.length;A+=P,d.push(h),d.push(b);let V=x.packCentralHeader();m.push(V),s.size+=V.length,N+=P+V.length,L++,R(D)})}else{N+=s.mainHeaderSize,s.offset=A,s.totalEntries=L,A=0;let x=Buffer.alloc(N);d.forEach(function(b){b.copy(x,A),A+=b.length}),m.forEach(function(b){b.copy(x,A),A+=b.length});let ut=s.toBinary();i&&i.copy(ut,ve.Constants.ENDHDR),ut.copy(x,A),n=x,o=!1,w(x)}};R(Array.from(this.entries))}catch(d){E(d)}}}}});var kp=C((_b,Fp)=>{var ne=Zn(),le=require("path"),ET=ec(),TT=qp(),pn=(...n)=>ne.findLast(n,e=>typeof e=="boolean"),Dp=(...n)=>ne.findLast(n,e=>typeof e=="string"),ST=(...n)=>ne.findLast(n,e=>typeof e=="function"),CT={noSort:!1,readEntries:!1,method:ne.Constants.NONE,fs:null};Fp.exports=function(n,e){let t=null,r=Object.assign(Object.create(null),CT);n&&typeof n=="object"&&(n instanceof Uint8Array||(Object.assign(r,n),n=r.input?r.input:void 0,r.input&&delete r.input),Buffer.isBuffer(n)&&(t=n,r.method=ne.Constants.BUFFER,n=void 0)),Object.assign(r,e);let i=new ne(r);if((typeof r.decoder!="object"||typeof r.decoder.encode!="function"||typeof r.decoder.decode!="function")&&(r.decoder=ne.decoder),n&&typeof n=="string")if(i.fs.existsSync(n))r.method=ne.Constants.FILE,r.filename=n,t=i.fs.readFileSync(n);else throw ne.Errors.INVALID_FILENAME();let s=new TT(t,r),{canonical:o,sanitize:a,zipnamefix:c}=ne;function u(p){if(p&&s){var y;if(typeof p=="string"&&(y=s.getEntry(le.posix.normalize(p))),typeof p=="object"&&typeof p.entryName<"u"&&typeof p.header<"u"&&(y=s.getEntry(p.entryName)),y)return y}return null}function f(p){let{join:y,normalize:_,sep:w}=le.posix;return y(".",_(w+p.split("\\").join(w)+w))}function g(p){return p instanceof RegExp?function(y){return function(_){return y.test(_)}}(p):typeof p!="function"?()=>!0:p}let S=(p,y)=>{let _=y.slice(-1);return _=_===i.sep?i.sep:"",le.relative(p,y)+_};return{readFile:function(p,y){var _=u(p);return _&&_.getData(y)||null},childCount:function(p){let y=u(p);if(y)return s.getChildCount(y)},readFileAsync:function(p,y){var _=u(p);_?_.getDataAsync(y):y(null,"getEntry failed for:"+p)},readAsText:function(p,y){var _=u(p);if(_){var w=_.getData();if(w&&w.length)return w.toString(y||"utf8")}return""},readAsTextAsync:function(p,y,_){var w=u(p);w?w.getDataAsync(function(E,v){if(v){y(E,v);return}E&&E.length?y(E.toString(_||"utf8")):y("")}):y("")},deleteFile:function(p,y=!0){var _=u(p);_&&s.deleteFile(_.entryName,y)},deleteEntry:function(p){var y=u(p);y&&s.deleteEntry(y.entryName)},addZipComment:function(p){s.comment=p},getZipComment:function(){return s.comment||""},addZipEntryComment:function(p,y){var _=u(p);_&&(_.comment=y)},getZipEntryComment:function(p){var y=u(p);return y&&y.comment||""},updateFile:function(p,y){var _=u(p);_&&_.setData(y)},addLocalFile:function(p,y,_,w){if(i.fs.existsSync(p)){y=y?f(y):"";let E=le.win32.basename(le.win32.normalize(p));y+=_||E;let v=i.fs.statSync(p),l=v.isFile()?i.fs.readFileSync(p):Buffer.alloc(0);v.isDirectory()&&(y+=i.sep),this.addFile(y,l,w,v)}else throw ne.Errors.FILE_NOT_FOUND(p)},addLocalFileAsync:function(p,y){p=typeof p=="object"?p:{localPath:p};let _=le.resolve(p.localPath),{comment:w}=p,{zipPath:E,zipName:v}=p,l=this;i.fs.stat(_,function(d,m){if(d)return y(d,!1);E=E?f(E):"";let N=le.win32.basename(le.win32.normalize(_));if(E+=v||N,m.isFile())i.fs.readFile(_,function(A,L){return A?y(A,!1):(l.addFile(E,L,w,m),setImmediate(y,void 0,!0))});else if(m.isDirectory())return E+=i.sep,l.addFile(E,Buffer.alloc(0),w,m),setImmediate(y,void 0,!0)})},addLocalFolder:function(p,y,_){if(_=g(_),y=y?f(y):"",p=le.normalize(p),i.fs.existsSync(p)){let w=i.findFiles(p),E=this;if(w.length)for(let v of w){let l=le.join(y,S(p,v));_(l)&&E.addLocalFile(v,le.dirname(l))}}else throw ne.Errors.FILE_NOT_FOUND(p)},addLocalFolderAsync:function(p,y,_,w){w=g(w),_=_?f(_):"",p=le.normalize(p);var E=this;i.fs.open(p,"r",function(v){if(v&&v.code==="ENOENT")y(void 0,ne.Errors.FILE_NOT_FOUND(p));else if(v)y(void 0,v);else{var l=i.findFiles(p),d=-1,m=function(){if(d+=1,d<l.length){var N=l[d],A=S(p,N).split("\\").join("/");A=A.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\x20-\x7E]/g,""),w(A)?i.fs.stat(N,function(L,R){L&&y(void 0,L),R.isFile()?i.fs.readFile(N,function(D,x){D?y(void 0,D):(E.addFile(_+A,x,"",R),m())}):(E.addFile(_+A+"/",Buffer.alloc(0),"",R),m())}):process.nextTick(()=>{m()})}else y(!0,void 0)};m()}})},addLocalFolderAsync2:function(p,y){let _=this;p=typeof p=="object"?p:{localPath:p},localPath=le.resolve(f(p.localPath));let{zipPath:w,filter:E,namefix:v}=p;E instanceof RegExp?E=function(m){return function(N){return m.test(N)}}(E):typeof E!="function"&&(E=function(){return!0}),w=w?f(w):"",v=="latin1"&&(v=m=>m.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\x20-\x7E]/g,"")),typeof v!="function"&&(v=m=>m);let l=m=>le.join(w,v(S(localPath,m))),d=m=>le.win32.basename(le.win32.normalize(v(m)));i.fs.open(localPath,"r",function(m){m&&m.code==="ENOENT"?y(void 0,ne.Errors.FILE_NOT_FOUND(localPath)):m?y(void 0,m):i.findFilesAsync(localPath,function(N,A){if(N)return y(N);A=A.filter(L=>E(l(L))),A.length||y(void 0,!1),setImmediate(A.reverse().reduce(function(L,R){return function(D,x){if(D||x===!1)return setImmediate(L,D,!1);_.addLocalFileAsync({localPath:R,zipPath:le.dirname(l(R)),zipName:d(R)},L)}},y))})})},addLocalFolderPromise:function(p,y){return new Promise((_,w)=>{this.addLocalFolderAsync2(Object.assign({localPath:p},y),(E,v)=>{E&&w(E),v&&_(this)})})},addFile:function(p,y,_,w){p=c(p);let E=u(p),v=E!=null;v||(E=new ET(r),E.entryName=p),E.comment=_||"";let l=typeof w=="object"&&w instanceof i.fs.Stats;l&&(E.header.time=w.mtime);var d=E.isDirectory?16:0;let m=E.isDirectory?16384:32768;return l?m|=4095&w.mode:typeof w=="number"?m|=4095&w:m|=E.isDirectory?493:420,d=(d|m<<16)>>>0,E.attr=d,E.setData(y),v||s.setEntry(E),E},getEntries:function(p){return s.password=p,s?s.entries:[]},getEntry:function(p){return u(p)},getEntryCount:function(){return s.getEntryCount()},forEach:function(p){return s.forEach(p)},extractEntryTo:function(p,y,_,w,E,v){w=pn(!1,w),E=pn(!1,E),_=pn(!0,_),v=Dp(E,v);var l=u(p);if(!l)throw ne.Errors.NO_ENTRY();var d=o(l.entryName),m=a(y,v&&!l.isDirectory?v:_?d:le.basename(d));if(l.isDirectory){var N=s.getEntryChildren(l);return N.forEach(function(R){if(R.isDirectory)return;var D=R.getData();if(!D)throw ne.Errors.CANT_EXTRACT_FILE();var x=o(R.entryName),ut=a(y,_?x:le.basename(x));let b=E?R.header.fileAttr:void 0;i.writeFileTo(ut,D,w,b)}),!0}var A=l.getData(s.password);if(!A)throw ne.Errors.CANT_EXTRACT_FILE();if(i.fs.existsSync(m)&&!w)throw ne.Errors.CANT_OVERRIDE();let L=E?p.header.fileAttr:void 0;return i.writeFileTo(m,A,w,L),!0},test:function(p){if(!s)return!1;for(var y in s.entries)try{if(y.isDirectory)continue;var _=s.entries[y].getData(p);if(!_)return!1}catch{return!1}return!0},extractAllTo:function(p,y,_,w){if(_=pn(!1,_),w=Dp(_,w),y=pn(!1,y),!s)throw ne.Errors.NO_ZIP();s.entries.forEach(function(E){var v=a(p,o(E.entryName));if(E.isDirectory){i.makeDir(v);return}var l=E.getData(w);if(!l)throw ne.Errors.CANT_EXTRACT_FILE();let d=_?E.header.fileAttr:void 0;i.writeFileTo(v,l,y,d);try{i.fs.utimesSync(v,E.header.time,E.header.time)}catch{throw ne.Errors.CANT_EXTRACT_FILE()}})},extractAllToAsync:function(p,y,_,w){if(w=ST(y,_,w),_=pn(!1,_),y=pn(!1,y),!w)return new Promise((m,N)=>{this.extractAllToAsync(p,y,_,function(A){A?N(A):m(this)})});if(!s){w(ne.Errors.NO_ZIP());return}p=le.resolve(p);let E=m=>a(p,le.normalize(o(m.entryName))),v=(m,N)=>new Error(m+': "'+N+'"'),l=[],d=[];s.entries.forEach(m=>{m.isDirectory?l.push(m):d.push(m)});for(let m of l){let N=E(m),A=_?m.header.fileAttr:void 0;try{i.makeDir(N),A&&i.fs.chmodSync(N,A),i.fs.utimesSync(N,m.header.time,m.header.time)}catch{w(v("Unable to create folder",N))}}d.reverse().reduce(function(m,N){return function(A){if(A)m(A);else{let L=le.normalize(o(N.entryName)),R=a(p,L);N.getDataAsync(function(D,x){if(x)m(x);else if(!D)m(ne.Errors.CANT_EXTRACT_FILE());else{let ut=_?N.header.fileAttr:void 0;i.writeFileToAsync(R,D,y,ut,function(b){b||m(v("Unable to write file",R)),i.fs.utimes(R,N.header.time,N.header.time,function(h){h?m(v("Unable to set times",R)):m()})})}})}}},w)()},writeZip:function(p,y){if(arguments.length===1&&typeof p=="function"&&(y=p,p=""),!p&&r.filename&&(p=r.filename),!!p){var _=s.compressToBuffer();if(_){var w=i.writeFileTo(p,_,!0);typeof y=="function"&&y(w?null:new Error("failed"),"")}}},writeZipPromise:function(p,y){let{overwrite:_,perm:w}=Object.assign({overwrite:!0},y);return new Promise((E,v)=>{!p&&r.filename&&(p=r.filename),p||v("ADM-ZIP: ZIP File Name Missing"),this.toBufferPromise().then(l=>{let d=m=>m?E(m):v("ADM-ZIP: Wasn't able to write zip file");i.writeFileToAsync(p,l,_,w,d)},v)})},toBufferPromise:function(){return new Promise((p,y)=>{s.toAsyncBuffer(p,y)})},toBuffer:function(p,y,_,w){return typeof p=="function"?(s.toAsyncBuffer(p,y,_,w),null):s.compressToBuffer()}}}});var Hp=C((Eb,zp)=>{"use strict";var xT=require("https"),bT=require("fs"),Mp=require("util"),vT=kp(),{URL:NT}=require("url"),AT=j(),Up=O(),{DsePlainTextAuthProvider:IT,NoAuthProvider:PT}=Er(),BT=Mp.promisify(bT.readFile);async function OT(n){if(!n.cloud)return;let e=new nc(n);await RT(e),await qT(e),e.clientOptions.sslOptions.checkServerIdentity||(e.clientOptions.sslOptions.checkServerIdentity=(t,r)=>Vp(r,e.clientOptions.sni.address))}var nc=class{constructor(e){this.clientOptions=e,e.cloud.secureConnectBundle?(this.secureConnectBundle=e.cloud.secureConnectBundle,this.serviceUrl=null):this.serviceUrl=e.cloud.endpoint,this.logEmitter=e.logEmitter,this.contactPoints=null,this.localDataCenter=null}setSslOptions(e){this.clientOptions.sslOptions=Object.assign({ca:[e.get("ca.crt")],cert:e.get("cert"),key:e.get("key"),rejectUnauthorized:!0},this.clientOptions.sslOptions)}setAuthProvider(e,t){!e||!t||this.clientOptions.authProvider&&!(this.clientOptions.authProvider instanceof PT)||(this.clientOptions.authProvider=new IT(e,t))}};async function RT(n){if(n.serviceUrl)return;if(!n.secureConnectBundle)throw new TypeError("secureConnectBundle must be provided");let e=await BT(n.secureConnectBundle),t=new vT(e),r=new Map(t.getEntries().map(s=>[s.entryName,s.getData()]));if(!r.get("config.json"))throw new TypeError("Config file must be contained in secure bundle");let i=JSON.parse(r.get("config.json").toString("utf8"));if(!i.host||!i.port)throw new TypeError("Config file must include host and port information");n.serviceUrl=`${i.host}:${i.port}/metadata`,n.setSslOptions(r),n.setAuthProvider(i.username,i.password)}function LT(n,e){let r=/^(.+?):(\d+)(.*)$/.exec(n.serviceUrl);if(e=Up.callbackOnce(e),!r||r.length!==4)throw new TypeError("url should be composed of host, port number and path, without scheme");let i=Object.assign({hostname:r[1],port:r[2],path:r[3]||void 0,timeout:n.clientOptions.socketOptions.connectTimeout},n.clientOptions.sslOptions),s=xT.get(i,o=>{let a="";Up.log("verbose",`Connected to metadata service with SSL/TLS protocol ${o.socket.getProtocol()}`,{},n),o.on("data",c=>a+=c.toString()).on("end",()=>{if(o.statusCode!==200)return e(tc(new Error(`Obtained http status ${o.statusCode}`),i));let c;try{if(c=JSON.parse(a),!c||!c.contact_info)throw new TypeError("contact_info should be defined in response")}catch(f){return e(tc(f,i,!0))}let u=c.contact_info;n.clientOptions.contactPoints=u.contact_points,n.clientOptions.localDataCenter=u.local_dc,n.clientOptions.sni={address:u.sni_proxy_address},e()})});s.on("error",o=>e(tc(o,i))),s.setTimeout(n.clientOptions.socketOptions.connectTimeout,()=>s.abort())}var qT=Mp.promisify(LT);function tc(n,e,t){let r=t?"There was an error while parsing the metadata service information":"There was an error fetching the metadata information",i=`${e.hostname}:${e.port}${e.path?e.path:"/"}`;return new AT.NoHostAvailableError({[i]:n},r)}function Vp(n,e){let t=e.split(":")[0],r=n.subjectaltname,i=n.subject.CN;if(t===i)return;let s=[];if(r)for(let u of r.split(", "))u.startsWith("DNS:")?s.push(u.slice(4)):u.startsWith("URI:")&&s.push(new NT(u.slice(4)).hostname);let o=t.split("."),a=u=>DT(o,u),c;if(s.length>0?c=s.some(a):c=a(i),!c){let u=new Error(`Host: ${t} is not cert's CN/altnames: ${i} / ${r}`);return u.reason=u.message,u.host=t,u.cert=n,u}}function DT(n,e){if(!e)return!1;let t=e.split(".");if(n.length!==t.length)return!1;for(let c=n.length-1;c>0;c-=1)if(n[c]!==t[c])return!1;let r=n[0],i=t[0],s=i.split("*");if(s.length===1||i.includes("xn--"))return r===i;if(s.length>2||t.length<=2)return!1;let[o,a]=s;return!(o.length+a.length>r.length||!r.startsWith(o)||!r.endsWith(a))}zp.exports={checkServerIdentity:Vp,init:OT}});var rc=C((Tb,Gp)=>{"use strict";var Kp=O();function jp(n,e){this.info=n.info;let t=n.rows;e=e||FT,this.length=n.rowLength,this.pageState=n.pageState,this.first=function(){let s=this.values().next();return s.done?null:s.value},this.forEach=function(i,s){if(!t.length)return;let o=this.values(),a=o.next(),c=0;for(;!a.done;)i.call(s||this,a.value,c++),a=o.next()},this.toArray=function(){return t.length?Kp.iteratorToArray(this.values()):Kp.emptyArray},this.values=function*(){for(let i of this.getTraversers()){let s=i.bulk||1;for(let o=0;o<s;o++)yield i.object}},this.getTraversers=function*(){for(let r of t)yield e(r)}}typeof Symbol<"u"&&typeof Symbol.iterator=="symbol"&&(jp.prototype[Symbol.iterator]=function(){return this.values()});function FT(n){let e=JSON.parse(n.gremlin);return{object:e.result,bulk:e.bulk||1}}Gp.exports=jp});var cs=C((Sb,Wp)=>{"use strict";var kT=H(),{dataTypes:as}=kT,gn=class{constructor(e,t){this.value=e,this.typeInfo=typeof t=="number"?{code:t}:t}},os=class{constructor(e,t){if(this.value=e,!t||!t.name||!t.keyspace||!t.fields)throw new TypeError("udtInfo must be an object with name, keyspace and field properties defined");this.udtInfo=t}};function UT(n){return new gn(n,as.int)}function MT(n){return new gn(n,as.double)}function VT(n){return new gn(n,as.float)}function zT(n){return new gn(n,as.timestamp)}function HT(n,e){return new os(n,e)}Wp.exports={asInt:UT,asDouble:MT,asFloat:VT,asTimestamp:zT,asUdt:HT,UdtGraphWrapper:os,GraphTypeWrapper:gn}});var Yp=C((Cb,Zp)=>{"use strict";var{GraphTypeWrapper:KT,UdtGraphWrapper:jT}=cs(),us=H(),GT=Bi(),{dataTypes:Xn}=us;function ic(n){if(n instanceof us.Tuple)return{cqlType:"tuple",definition:n.elements.map(ic)};if(n instanceof Map){let t={cqlType:"map"};if(n.size>0){let r=n.entries().next().value;t.definition=r.map(ic)}return t}if(n instanceof jT)return Qp(n);let e;return n instanceof KT?e=n.typeInfo:e=GT.guessDataType(n),e?ls(e):null}function ls(n){return n.code===Xn.udt?$p(n.info):n.code===Xn.tuple||n.code===Xn.map?{cqlType:us.getDataTypeNameByCode(n),definition:n.info.map(ls)}:n.code===Xn.list||n.code===Xn.set?{cqlType:n.code===Xn.list?"list":"set",definition:[ls(n.info)]}:{cqlType:us.getDataTypeNameByCode(n)}}function $p(n){return{cqlType:"udt",keyspace:n.keyspace,name:n.name,definition:n.fields.map(e=>Object.assign({fieldName:e.name},ls(e.type)))}}function Qp(n){return $p(n.udtInfo)}Zp.exports={getTypeDefinitionByValue:ic,getUdtTypeDefinitionByValue:Qp}});var oc=C((xb,tg)=>{"use strict";var sc=require("util");function mn(n,e){this.id=n,this.label=e}function Xp(n,e,t){mn.call(this,n,e),this.properties=t}sc.inherits(Xp,mn);function Jp(n,e,t,r,i,s,o){mn.call(this,n,r),this.outV=e,this.outVLabel=t,this.inV=i,this.inVLabel=s,this.properties={},function(c){if(o){let u=Object.keys(o);for(let f=0;f<u.length;f++){let g=u[f];c.properties[g]=o[g].value}}}(this)}sc.inherits(Jp,mn);function eg(n,e,t,r){mn.call(this,n,e),this.value=t,this.key=this.label,this.properties=r}sc.inherits(eg,mn);function WT(n,e){this.key=n,this.value=e}function $T(n,e){this.labels=n,this.objects=e}tg.exports={Edge:Jp,Element:mn,Path:$T,Property:WT,Vertex:Xp,VertexProperty:eg}});var xc=C((bb,rg)=>{"use strict";var bt=H(),QT=O(),{getTypeDefinitionByValue:ZT,getUdtTypeDefinitionByValue:YT}=Yp(),{Point:XT,Polygon:JT,LineString:eS}=Ai(),{Edge:tS}=oc(),{GraphTypeWrapper:nS,UdtGraphWrapper:rS}=cs(),{Tuple:ng,dataTypes:Hr}=bt,wn="@type",Ve="@value",ac=class{constructor(){this.key="g:Edge"}deserialize(e){let t=e[Ve];return new tS(this.reader.read(t.id),this.reader.read(t.outV),t.outVLabel,t.label,this.reader.read(t.inV),t.inVLabel,this.reader.read(t.properties))}},ze=class{constructor(e,t){if(!e)throw new Error("Deserializer must provide a type key");if(!t)throw new Error("Deserializer must provide a target type");this.key=e,this.targetType=t}deserialize(e){let t=e[Ve];return typeof t!="string"&&(t=t.toString()),this.targetType.fromString(t)}serialize(e){return{[wn]:this.key,[Ve]:e.toString()}}canBeUsedFor(e){return e instanceof this.targetType}},cc=class extends ze{constructor(){super("g:UUID",bt.Uuid)}},uc=class extends ze{constructor(){super("g:Int64",bt.Long)}},lc=class extends ze{constructor(){super("gx:BigDecimal",bt.BigDecimal)}},hc=class extends ze{constructor(){super("gx:BigInteger",bt.Integer)}},fc=class extends ze{constructor(){super("gx:InetAddress",bt.InetAddress)}},dc=class extends ze{constructor(){super("gx:LocalDate",bt.LocalDate)}},pc=class extends ze{constructor(){super("gx:LocalTime",bt.LocalTime)}},gc=class extends ze{constructor(){super("gx:Instant",Date)}serialize(e){return{[wn]:this.key,[Ve]:e.toISOString()}}deserialize(e){return new Date(e[Ve])}},mc=class extends ze{constructor(){super("dse:Blob",Buffer)}deserialize(e){return QT.allocBufferFromString(e[Ve],"base64")}serialize(e){return{[wn]:this.key,[Ve]:e.toString("base64")}}},yc=class extends ze{constructor(){super("dse:Point",XT)}},wc=class extends ze{constructor(){super("dse:LineString",eS)}},_c=class extends ze{constructor(){super("dse:Polygon",JT)}},Ec=class{constructor(){this.key="dse:Tuple"}deserialize(e){let t=e[Ve].value;if(!Array.isArray(t))throw new Error("Expected Array, obtained: "+t);let r=[];for(let i of t)r.push(this.reader.read(i));return ng.fromArray(r)}serialize(e){let t={cqlType:"tuple",definition:e.elements.map(ZT),value:e.elements.map(r=>this.writer.adaptObject(r))};return{[wn]:this.key,[Ve]:t}}canBeUsedFor(e){return e instanceof ng}},Tc=class{constructor(){this.key="dse:Duration"}deserialize(e){let t=e[Ve];return new bt.Duration(this.reader.read(t.months),this.reader.read(t.days),this.reader.read(t.nanos))}serialize(e){return{[wn]:this.key,[Ve]:{months:e.months,days:e.days,nanos:e.nanoseconds}}}canBeUsedFor(e){return e instanceof bt.Duration}},Sc=class{constructor(){this.key="dse:UDT"}deserialize(e){let t=e[Ve],r={},i=t.value;return t.definition.forEach((s,o)=>{r[s.fieldName]=this.reader.read(i[o])}),r}serialize(e){let t=YT(e);return t.value=Object.entries(e.value).map(([r,i])=>this.writer.adaptObject(i)),{[wn]:this.key,[Ve]:t}}canBeUsedFor(e){return e instanceof rS}},yn=class{constructor(e,t){this._name=e,this._transformFn=t||(r=>r)}serialize(e){return{[wn]:this._name,[Ve]:this._transformFn(e)}}},iS={[Hr.int]:new yn("g:Int32"),[Hr.bigint]:new yn("g:Int64"),[Hr.double]:new yn("g:Double"),[Hr.float]:new yn("g:Float"),[Hr.timestamp]:new yn("g:Timestamp",n=>n.getTime())},Cc=class{constructor(){this.key="client:wrapper"}serialize(e){let t=iS[e.typeInfo.code];if(!t)throw new Error(`No serializer found for wrapped value ${e}`);return t.serialize(e.value)}canBeUsedFor(e){return e instanceof nS}},sS=[ac,cc,uc,lc,hc,fc,dc,pc,gc,mc,yc,wc,_c,Ec,Sc,Cc,Tc];function oS(){let n={};return sS.forEach(e=>{let t=new e;if(!t.key)throw new TypeError(`Key for ${e} instance not set`);n[t.key]=t}),n}rg.exports=oS});var vc=C((vb,ig)=>{"use strict";var aS=rc(),cS=xc(),{asInt:uS,asDouble:lS,asFloat:hS,asTimestamp:fS,asUdt:dS,UdtGraphWrapper:pS,GraphTypeWrapper:gS}=cs(),{Edge:mS,Element:yS,Path:wS,Property:_S,Vertex:ES,VertexProperty:TS}=oc(),Dt=class{constructor(e,t){this.typeName=e,this.elementName=t}toString(){return this.elementName}},SS={id:new Dt("T","id"),key:new Dt("T","key"),label:new Dt("T","label"),value:new Dt("T","value")},bc={both:new Dt("Direction","BOTH"),in:new Dt("Direction","IN"),out:new Dt("Direction","OUT")};bc.in_=bc.in;ig.exports={Edge:mS,Element:yS,Path:wS,Property:_S,Vertex:ES,VertexProperty:TS,asInt:uS,asDouble:lS,asFloat:hS,asTimestamp:fS,asUdt:dS,direction:bc,getCustomTypeSerializers:cS,GraphResultSet:aS,GraphTypeWrapper:gS,t:SS,UdtGraphWrapper:pS}});var og=C((Nb,sg)=>{"use strict";var wt={P:Yt,TextP:Yt,Traversal:Yt,Traverser:Yt,EnumValue:Yt},CS={TraversalStrategy:Yt},xS=Yt,at=vc(),bS={Long:Yt};wt.t=at.t;wt.direction=at.direction;function Yt(){}var K="@value",Ne="@type",re=class{serialize(){throw new Error("serialize() method not implemented for "+this.constructor.name)}deserialize(){throw new Error("deserialize() method not implemented for "+this.constructor.name)}canBeUsedFor(){throw new Error("canBeUsedFor() method not implemented for "+this.constructor.name)}},Nc=class extends re{serialize(e){return isNaN(e)?{[Ne]:"g:Double",[K]:"NaN"}:e===Number.POSITIVE_INFINITY?{[Ne]:"g:Double",[K]:"Infinity"}:e===Number.NEGATIVE_INFINITY?{[Ne]:"g:Double",[K]:"-Infinity"}:e}deserialize(e){var t=e[K];return t==="NaN"?NaN:t==="Infinity"?Number.POSITIVE_INFINITY:t==="-Infinity"?Number.NEGATIVE_INFINITY:parseFloat(t)}canBeUsedFor(e){return typeof e=="number"}},Ac=class extends re{serialize(e){return{[Ne]:"g:Date",[K]:e.getTime()}}deserialize(e){return new Date(e[K])}canBeUsedFor(e){return e instanceof Date}},Ic=class extends re{serialize(e){return{[Ne]:"g:Int64",[K]:e.value}}canBeUsedFor(e){return e instanceof bS.Long}},Pc=class extends re{serialize(e){let t=e;e instanceof wt.Traversal&&(t=e.getBytecode());let r={};r[Ne]="g:Bytecode";let i=r[K]={},s=this._serializeInstructions(t.sourceInstructions);s&&(i.source=s);let o=this._serializeInstructions(t.stepInstructions);return o&&(i.step=o),r}_serializeInstructions(e){if(e.length===0)return null;let t=new Array(e.length);t[0]=e[0];for(let r=0;r<e.length;r++)t[r]=e[r].map(i=>this.writer.adaptObject(i));return t}canBeUsedFor(e){return e instanceof xS||e instanceof wt.Traversal}},Bc=class extends re{serialize(e){let t={};t[Ne]="g:P";let r=t[K]={predicate:e.operator};return e.other===void 0||e.other===null?r.value=this.writer.adaptObject(e.value):r.value=[this.writer.adaptObject(e.value),this.writer.adaptObject(e.other)],t}canBeUsedFor(e){return e instanceof wt.P}},Oc=class extends re{serialize(e){let t={};t[Ne]="g:TextP";let r=t[K]={predicate:e.operator};return e.other===void 0||e.other===null?r.value=this.writer.adaptObject(e.value):r.value=[this.writer.adaptObject(e.value),this.writer.adaptObject(e.other)],t}canBeUsedFor(e){return e instanceof wt.TextP}},Rc=class extends re{serialize(e){return{[Ne]:"g:Lambda",[K]:{arguments:e.length,language:"gremlin-javascript",script:e.toString()}}}canBeUsedFor(e){return typeof e=="function"}},Lc=class extends re{serialize(e){return{[Ne]:"g:"+e.typeName,[K]:e.elementName}}canBeUsedFor(e){return e&&e.typeName&&e instanceof wt.EnumValue}},qc=class extends re{serialize(e){return{[Ne]:"g:Traverser",[K]:{value:this.writer.adaptObject(e.object),bulk:this.writer.adaptObject(e.bulk)}}}deserialize(e){let t=e[K];return new wt.Traverser(this.reader.read(t.value),this.reader.read(t.bulk))}canBeUsedFor(e){return e instanceof wt.Traverser}},Dc=class extends re{serialize(e){return{[Ne]:"g:"+e.constructor.name,[K]:e.configuration}}canBeUsedFor(e){return e instanceof CS.TraversalStrategy}},Fc=class extends re{deserialize(e){let t=e[K];return new at.Vertex(this.reader.read(t.id),t.label,this.reader.read(t.properties))}serialize(e){return{[Ne]:"g:Vertex",[K]:{id:this.writer.adaptObject(e.id),label:e.label}}}canBeUsedFor(e){return e instanceof at.Vertex}},kc=class extends re{deserialize(e){let t=e[K];return new at.VertexProperty(this.reader.read(t.id),t.label,this.reader.read(t.value),this.reader.read(t.properties))}},Uc=class extends re{deserialize(e){let t=e[K];return new at.Property(t.key,this.reader.read(t.value))}},Mc=class extends re{deserialize(e){let t=e[K];return new at.Edge(this.reader.read(t.id),new at.Vertex(this.reader.read(t.outV),this.reader.read(t.outVLabel)),t.label,new at.Vertex(this.reader.read(t.inV),this.reader.read(t.inVLabel)),this.reader.read(t.properties))}serialize(e){return{[Ne]:"g:Edge",[K]:{id:this.writer.adaptObject(e.id),label:e.label,outV:this.writer.adaptObject(e.outV.id),outVLabel:e.outV.label,inV:this.writer.adaptObject(e.inV.id),inVLabel:e.inV.label}}}canBeUsedFor(e){return e instanceof at.Edge}},Vc=class extends re{deserialize(e){let t=e[K],r=t.objects.map(i=>this.reader.read(i));return new at.Path(this.reader.read(t.labels),r)}},zc=class extends re{deserialize(e){let t=e[K];return new at.Path(this.reader.read(t.labels),this.reader.read(t.objects))}},Hc=class extends re{deserialize(e){return wt.t[e[K]]}},Kc=class extends re{deserialize(e){return wt.direction[e[K].toLowerCase()]}},hs=class extends re{constructor(e){super(),this.typeKey=e}deserialize(e){let t=e[K];if(!Array.isArray(t))throw new Error("Expected Array, obtained: "+t);return t.map(r=>this.reader.read(r))}serialize(e){return{[Ne]:this.typeKey,[K]:e.map(t=>this.writer.adaptObject(t))}}canBeUsedFor(e){return Array.isArray(e)}},jc=class extends re{deserialize(e){let t=e[K];if(!Array.isArray(t))throw new Error("Expected Array, obtained: "+t);let r=[];for(let i=0,s=t.length;i<s;i+=2){let o=t.slice(i,i+2);r=r.concat(Array(this.reader.read(o[1])).fill(this.reader.read(o[0])))}return r}},Gc=class extends re{deserialize(e){let t=e[K];if(!Array.isArray(t))throw new Error("Expected Array, obtained: "+t);let r=new Map;for(let i=0;i<t.length;i+=2)r.set(this.reader.read(t[i]),this.reader.read(t[i+1]));return r}serialize(e){let t=[];return e.forEach((r,i)=>{t.push(this.writer.adaptObject(i)),t.push(this.writer.adaptObject(r))}),{[Ne]:"g:Map",[K]:t}}canBeUsedFor(e){return e instanceof Map}},Wc=class extends hs{constructor(){super("g:List")}},$c=class extends hs{constructor(){super("g:Set")}};sg.exports={BulkSetSerializer:jc,BytecodeSerializer:Pc,DateSerializer:Ac,DirectionSerializer:Kc,EdgeSerializer:Mc,EnumSerializer:Lc,LambdaSerializer:Rc,ListSerializer:Wc,LongSerializer:Ic,MapSerializer:Gc,NumberSerializer:Nc,Path3Serializer:zc,PathSerializer:Vc,PropertySerializer:Uc,PSerializer:Bc,TextPSerializer:Oc,SetSerializer:$c,TSerializer:Hc,TraverserSerializer:qc,TraversalStrategySerializer:Dc,typeKey:Ne,valueKey:K,VertexPropertySerializer:kc,VertexSerializer:Fc}});var lg=C((Ab,ug)=>{"use strict";var M=og(),fs=class{constructor(e){this._options=e||{},this._serializers=this.getDefaultSerializers().map(r=>{let i=new r;return i.writer=this,i});let t=this._options.serializers||{};Object.keys(t).forEach(r=>{let i=t[r];i.serialize&&(i.writer=this,this._serializers.unshift(i))})}getDefaultSerializers(){return cg}adaptObject(e){let t;for(let r=0;r<this._serializers.length;r++){let i=this._serializers[r];if(i.canBeUsedFor&&i.canBeUsedFor(e)){t=i;break}}return t?t.serialize(e):Array.isArray(e)?e.map(r=>this.adaptObject(r)):e}write(e){return JSON.stringify(this.adaptObject(e))}},ds=class extends fs{getDefaultSerializers(){return NS}},ps=class{constructor(e){this._options=e||{},this._deserializers={};let t=this.getDefaultDeserializers();if(Object.keys(t).forEach(r=>{let i=t[r],s=new i;s.reader=this,this._deserializers[r]=s}),this._options.serializers){let r=this._options.serializers||{};Object.keys(r).forEach(i=>{let s=r[i];s.deserialize&&(s.reader=this,this._deserializers[i]=s)})}}getDefaultDeserializers(){return ag}read(e){if(e===void 0)return;if(e===null)return null;if(Array.isArray(e))return e.map(r=>this.read(r));let t=e[M.typeKey];if(t){let r=this._deserializers[t];return r?r.deserialize(e):e[M.valueKey]}return e&&typeof e=="object"&&e.constructor===Object?this._deserializeObject(e):e}_deserializeObject(e){let t=Object.keys(e),r={};for(let i=0;i<t.length;i++)r[t[i]]=this.read(e[t[i]]);return r}},gs=class extends ps{getDefaultDeserializers(){return vS}},ag={"g:Traverser":M.TraverserSerializer,"g:TraversalStrategy":M.TraversalStrategySerializer,"g:Int32":M.NumberSerializer,"g:Int64":M.NumberSerializer,"g:Float":M.NumberSerializer,"g:Double":M.NumberSerializer,"g:Date":M.DateSerializer,"g:Direction":M.DirectionSerializer,"g:Vertex":M.VertexSerializer,"g:Edge":M.EdgeSerializer,"g:VertexProperty":M.VertexPropertySerializer,"g:Property":M.PropertySerializer,"g:Path":M.Path3Serializer,"g:TextP":M.TextPSerializer,"g:T":M.TSerializer,"g:BulkSet":M.BulkSetSerializer},vS=Object.assign({},ag,{"g:List":M.ListSerializer,"g:Set":M.SetSerializer,"g:Map":M.MapSerializer}),cg=[M.NumberSerializer,M.DateSerializer,M.BytecodeSerializer,M.TraverserSerializer,M.TraversalStrategySerializer,M.PSerializer,M.TextPSerializer,M.LambdaSerializer,M.EnumSerializer,M.VertexSerializer,M.EdgeSerializer,M.LongSerializer],NS=cg.concat([M.ListSerializer,M.SetSerializer,M.MapSerializer]);ug.exports={GraphSON3Writer:ds,GraphSON3Reader:gs,GraphSON2Writer:fs,GraphSON2Reader:ps,GraphSONWriter:ds,GraphSONReader:gs}});var pg=C((Ib,dg)=>{"use strict";var AS=require("util"),_n=H(),Ae=O(),{DefaultExecutionOptions:IS,proxyExecuteKey:PS}=Kt(),hg=_n.Long,Xt,BS=Object.freeze({graphson1:"graphson-1.0",graphson2:"graphson-2.0",graphson3:"graphson-3.0"}),Pe=Object.freeze({language:"graph-language",source:"graph-source",name:"graph-name",results:"graph-results",writeConsistency:"graph-write-consistency",readConsistency:"graph-read-consistency",timeout:"request-timeout"});function OS(n,e,t,r){return n.getOrCreateGraphOptions(r,function(){let s=r.graphOptions||Ae.emptyObject,o=n.getDefault(),a={customPayload:{[Pe.language]:Ae.allocBufferFromString(s.language||e.language),[Pe.source]:Ae.allocBufferFromString(s.source||e.source)},graphLanguage:s.language||e.language,graphResults:s.results||e.results,graphSource:s.source||e.source,graphName:Ae.ifUndefined(s.name,e.name)};r!==o?a.retry=r.retry||e.retry:a.retry=t||e.retry,e.executeAs&&(a.customPayload[PS]=Ae.allocBufferFromString(e.executeAs)),a.graphName&&(a.customPayload[Pe.name]=Ae.allocBufferFromString(a.graphName));let c=Ae.ifUndefined(s.results,e.graphResults);c!==void 0&&(a.customPayload[Pe.results]=Ae.allocBufferFromString(c));let u=Ae.ifUndefined(s.readConsistency,e.readConsistency);u!==void 0&&(a.customPayload[Pe.readConsistency]=Ae.allocBufferFromString(ms(u)));let f=Ae.ifUndefined(s.writeConsistency,e.writeConsistency);return f!==void 0&&(a.customPayload[Pe.writeConsistency]=Ae.allocBufferFromString(ms(f))),a.readTimeout=Ae.ifUndefined3(r.readTimeout,o.readTimeout,e.readTimeout),a.readTimeout>0&&(a.customPayload[Pe.timeout]=fg(a.readTimeout)),a})}function Jn(n,e,t,r,i){if(i=i||Ae.allocBufferFromString,r!==null){if(r!==void 0){n[t]=i(r);return}e.customPayload[t]&&(n[t]=e.customPayload[t])}}function fg(n){return n=hg.fromNumber(n),hg.toBuffer(n)}function ms(n){if(n==null)return;RS();let e=Xt[n];if(!e)throw new Error(AS.format("Consistency %s not found, use values defined as properties in types.consistencies object",n));return e}function RS(){if(Xt)return;Xt={};let n=Object.keys(_n.consistencies);for(let e=0;e<n.length;e++){let t=n[e];Xt[_n.consistencies[t]]=t.toUpperCase()}Xt[_n.consistencies.localQuorum]="LOCAL_QUORUM",Xt[_n.consistencies.eachQuorum]="EACH_QUORUM",Xt[_n.consistencies.localSerial]="LOCAL_SERIAL",Xt[_n.consistencies.localOne]="LOCAL_ONE"}var Qc=class extends IS{constructor(e,t,r,i){e=e||Ae.emptyObject,super(e,t,null),this._defaultGraphOptions=OS(t.profileManager,r,i,this.getProfile()),this._preferredHost=null,this._graphSubProtocol=e.graphResults||this._defaultGraphOptions.graphResults,this._graphLanguage=e.graphLanguage||this._defaultGraphOptions.graphLanguage}setPreferredHost(e){this._preferredHost=e}getPreferredHost(){return this._preferredHost}getGraphSource(){return this.getRawQueryOptions().graphSource||this._defaultGraphOptions.graphSource}getGraphLanguage(){return this._graphLanguage}setGraphLanguage(e){this._graphLanguage=e}getGraphName(){return Ae.ifUndefined(this.getRawQueryOptions().graphName,this._defaultGraphOptions.graphName)}getGraphSubProtocol(){return this._graphSubProtocol}setGraphSubProtocol(e){this._graphSubProtocol=e}getReadTimeout(){return this.getRawQueryOptions().readTimeout||this._defaultGraphOptions.readTimeout}getRetryPolicy(){return this.getRawQueryOptions().retry||this._defaultGraphOptions.retry}getRowParser(){let e=this.getRawQueryOptions().rowParserFactory;return e?e(this.getGraphSubProtocol()):null}getQueryWriter(){let e=this.getRawQueryOptions().queryWriterFactory;return e?e(this.getGraphSubProtocol()):null}setGraphPayload(){let e=this.getRawQueryOptions(),t=this._defaultGraphOptions,r=Object.assign({},this.getCustomPayload());Jn(r,t,Pe.language,this.getGraphLanguage()!==this._defaultGraphOptions.graphLanguage?this.getGraphLanguage():void 0),Jn(r,t,Pe.source,e.graphSource),Jn(r,t,Pe.name,e.graphName),Jn(r,t,Pe.readConsistency,ms(e.graphReadConsistency)),Jn(r,t,Pe.writeConsistency,ms(e.graphWriteConsistency)),Jn(r,t,Pe.timeout,this.getReadTimeout()>0?this.getReadTimeout():null,fg),r[Pe.results]=t.graphResults===this.getGraphSubProtocol()?t.customPayload[Pe.results]:Ae.allocBufferFromString(this.getGraphSubProtocol()),this.setCustomPayload(r)}};dg.exports={GraphExecutionOptions:Qc,graphProtocol:BS,payloadKeys:Pe}});var Eg=C((Pb,_g)=>{"use strict";var gg=O(),LS=wi(),qS=rc(),{GraphSON2Reader:DS,GraphSON2Writer:FS,GraphSON3Reader:kS,GraphSON3Writer:US}=lg(),ys=xc(),{GraphExecutionOptions:MS,graphProtocol:vt}=pg(),mg="gremlin-groovy",VS="Core",zS=new DS({serializers:ys()}),HS=new FS({serializers:ys()}),KS=new kS({serializers:ys()}),jS=new US({serializers:ys()}),GS=new Map([[vt.graphson2,yg(zS)],[vt.graphson3,yg(KS)]]),WS=new Map([[vt.graphson1,n=>JSON.stringify(n)],[vt.graphson2,wg(HS)],[vt.graphson3,wg(jS)]]),Zc=class n{constructor(e,t,r){this._client=e,this._handler=r,this._defaultProfileRetryPolicy=e.profileManager.getDefaultConfiguredRetryPolicy(),this._graphBaseOptions=gg.extend({executeAs:e.options.queryOptions.executeAs,language:mg,source:"g",readTimeout:0,retry:new LS.retry.FallthroughRetryPolicy},t.graphOptions,e.profileManager.getDefault().graphOptions),this._graphBaseOptions.readTimeout===null&&(this._graphBaseOptions.readTimeout=e.options.socketOptions.readTimeout)}async send(e,t,r){if(Array.isArray(t))throw new TypeError("Parameters must be a Object instance as an associative array");if(!e)throw new TypeError("Query must be defined");let i=new MS(r,this._client,this._graphBaseOptions,this._defaultProfileRetryPolicy);if(i.getGraphSource()==="a"){let o=await this._getAnalyticsMaster();i.setPreferredHost(o)}let s=typeof e=="object"&&e.graphLanguage&&e.value&&e.queryWriterFactory;if(s&&i.setGraphLanguage(e.graphLanguage),this._setGraphProtocol(i),i.setGraphPayload(),t=n._buildGraphParameters(t,i.getGraphSubProtocol()),typeof e!="string"){let o=i.getQueryWriter();s?o=e.queryWriterFactory(i.getGraphSubProtocol()):o||(o=n._writerFactory(i.getGraphSubProtocol())),e=o(s?e.value:e)}return await this._executeGraphQuery(e,t,i)}async _executeGraphQuery(e,t,r){let i=await this._handler.call(this._client,e,t,r),s=r.getRowParser()||n._rowParserFactory(r.getGraphSubProtocol());return new qS(i,s)}async _getAnalyticsMaster(){try{let e=await this._client.execute("CALL DseClientTool.getAnalyticsGraphServer()",gg.emptyArray);if(e.rows.length===0)return this._client.log("verbose","Empty response querying graph analytics server, query will not be routed optimally"),null;let t=e.rows[0].result;if(!t||!t.location)return this._client.log("verbose","Unexpected response querying graph analytics server, query will not be routed optimally",e.rows[0]),null;let r=t.location.substr(0,t.location.lastIndexOf(":")),i=this._client.options.policies.addressResolution;return await new Promise(s=>{i.translate(r,this._client.options.protocolOptions.port,o=>s(this._client.hosts.get(o)))})}catch(e){return this._client.log("verbose","Error querying graph analytics server, query will not be routed optimally",e),null}}_setGraphProtocol(e){let t=e.getGraphSubProtocol();if(!t){if(e.getGraphName()){let r=this._client.metadata.keyspaces[e.getGraphName()];r&&r.graphEngine===VS&&(t=vt.graphson3)}t||(e.getGraphLanguage()===mg?t=vt.graphson1:t=vt.graphson2),e.setGraphSubProtocol(t)}}static _buildGraphParameters(e,t){if(!e||typeof e!="object")return null;let r=n._writerFactory(t);return[t!==vt.graphson1&&t!==vt.graphson2?r(new Map(Object.entries(e))):r(e)]}static _rowParserFactory(e){let t=GS.get(e);return t||null}static _writerFactory(e){let t=WS.get(e);if(!t)throw new Error(`No writer defined for protocol ${e}`);return t}};function yg(n){return e=>{let t=n.read(JSON.parse(e.gremlin));return{object:t.result,bulk:t.bulk||1}}}function wg(n){return e=>n.write(e)}_g.exports=Zc});var bg=C((Bb,xg)=>{"use strict";var Tg=require("events"),Yc=require("util"),Tn=O(),En=j(),Sn=H(),{ProfileManager:$S}=Ao(),ws=jt(),Sg=sr(),QS=tf(),ZS=Dn().description,{version:YS}=Dn(),{DefaultExecutionOptions:Xc}=Kt(),XS=Kd(),Jc=Zd(),Cg=Ea(),JS=sp(),eC=Hp(),tC=Eg(),_t=Be(),nC=32;function X(n){Tg.EventEmitter.call(this),this.options=Sg.extend({logEmitter:this.emit.bind(this),id:Sn.Uuid.random()},n),Object.defineProperty(this,"profileManager",{value:new $S(this.options)}),Object.defineProperty(this,"controlConnection",{value:new XS(this.options,this.profileManager),writable:!0}),Object.defineProperty(this,"insightsClient",{value:new JS(this)}),this.setMaxListeners(0),this.connected=!1,this.isShuttingDown=!1,this.keyspace=n.keyspace,this.metadata=this.controlConnection.metadata,this.hosts=this.controlConnection.hosts,this.metrics=this.options.metrics,this._graphExecutor=new tC(this,n,this._execute)}Yc.inherits(X,Tg.EventEmitter);X.prototype.connect=function(n){return this.connected&&n?n():_t.optionalCallback(this._connect(),n)};X.prototype._connect=async function(){if(!this.connected){if(this.isShuttingDown)throw new En.NoHostAvailableError(null,"Connecting after shutdown is not supported");if(this.connecting)return _t.fromEvent(this,"connected");this.connecting=!0,this.log("info",Yc.format("Connecting to cluster using '%s' version %s",ZS,YS));try{await eC.init(this.options),await this.controlConnection.init(),this.hosts=this.controlConnection.hosts,await this.profileManager.init(this,this.hosts),this.keyspace&&await Jc.setKeyspace(this),Sg.setMetadataDependent(this),await this._warmup()}catch(n){throw await this.controlConnection.reset(),this.connected=!1,this.connecting=!1,this.emit("connected",n),n}this._setHostListeners(),this.profileManager.getDistance(this.controlConnection.host),this.insightsClient.init(),this.connected=!0,this.connecting=!1,this.emit("connected")}};X.prototype.execute=function(n,e,t,r){r||(typeof t=="function"?(r=t,t=null):typeof e=="function"&&(r=e,e=null));try{let i=Xc.create(t,this);return _t.optionalCallback(this._execute(n,e,i),r)}catch(i){return r?r(i):Promise.reject(i)}};X.prototype.executeGraph=function(n,e,t,r){return r=r||t||e,typeof r=="function"?(e=typeof e!="function"?e:null,_t.toCallback(this._graphExecutor.send(n,e,t),r)):this._graphExecutor.send(n,e,t)};X.prototype.eachRow=function(n,e,t,r,i){!i&&r&&typeof t=="function"?(i=Tn.validateFn(r,"rowCallback"),r=t):(i=i||Tn.noop,r=Tn.validateFn(r||t||e,"rowCallback")),e=typeof e!="function"?e:null;let s;try{s=Xc.create(t,this,r)}catch(u){return i(u)}let o=0,a=()=>_t.toCallback(this._execute(n,e,s),c);function c(u,f){if(u)return i(u);if(o+=f.rowLength,f.rawPageState!==void 0){if(s.setPageState(f.rawPageState),s.isAutoPage())return a();f.nextPage=a}f.rowLength=o,i(null,f)}_t.toCallback(this._execute(n,e,s),c)};X.prototype.stream=function(n,e,t,r){r=r||Tn.noop;let i=new Sn.ResultStream({objectMode:1});function s(a,c){if(a&&i.emit("error",a),c&&c.nextPage){i._valve(function(){try{c.nextPage()}catch(f){i.emit("error",f)}});return}i._valve(null),i.add(null),r(a)}let o=!0;return this.eachRow(n,e,t,function(c,u){i.add(u)},function(c,u){if(o)return setImmediate(function(){s(c,u)});s(c,u)}),o=!1,i};X.prototype.batch=function(n,e,t){return!t&&typeof e=="function"&&(t=e,e=null),_t.optionalCallback(this._batch(n,e),t)};X.prototype._batch=async function(n,e){if(!Array.isArray(n))throw new En.ArgumentError("Queries should be an Array");if(n.length===0)throw new En.ArgumentError("Queries array should not be empty");await this._connect();let t=Xc.create(e,this),r;if(t.isPrepared()){let s=this.controlConnection.protocolVersion,o=Sn.protocolVersion.supportsKeyspaceInRequest(s)&&e.keyspace||this.keyspace;r=await Cg.getPreparedMultiple(this,t.getLoadBalancingPolicy(),n,o)}else{r=new Array(n.length);for(let s=0;s<n.length;s++){let o=n[s];if(!o)throw new En.ArgumentError(`Invalid query at index ${s}`);let a=typeof o=="string"?o:o.query;if(!a)throw new En.ArgumentError(`Invalid query at index ${s}`);r[s]={query:a,params:o.params}}}let i=await this._createBatchRequest(r,t);return await Jc.send(i,t,this)};X.prototype.getReplicas=function(n,e){return this.metadata.getReplicas(n,e)};X.prototype.getState=function(){return QS.from(this)};X.prototype.log=Tn.log;X.prototype.shutdown=function(n){return _t.optionalCallback(this._shutdown(),n)};X.prototype._shutdown=async function(){if(this.log("info","Shutting down"),!this.hosts||!this.connected){this.connected=!1;return}this.connecting&&(this.log("warning","Shutting down while connecting"),await _t.fromEvent(this,"connected")),this.connected=!1,this.isShuttingDown=!0;let n=this.hosts.values();this.insightsClient.shutdown(),this.controlConnection.shutdown(),this.options.policies.speculativeExecution.shutdown(),this.options.requestTracker&&this.options.requestTracker.shutdown(),await Promise.all(n.map(e=>e.shutdown(!1)))};X.prototype._waitForSchemaAgreement=async function(n){if(this.hosts.length===1)return!0;let e=process.hrtime(),t=this.options.protocolOptions.maxSchemaAgreementWaitSeconds;this.log("info","Waiting for schema agreement");let r;for(;!r&&process.hrtime(e)[0]<t;){if(r=await this.metadata.compareSchemaVersions(n),r){this.log("info","Schema versions match");break}await _t.delay(500)}return r};X.prototype.handleSchemaAgreementAndRefresh=async function(n,e){let t=!1;try{t=await this._waitForSchemaAgreement(n)}catch(r){this.log("warning","There was an error while waiting for the schema agreement between nodes",r)}if(!this.options.isMetadataSyncEnabled)return t;try{await this.controlConnection.handleSchemaChange(e,!0)}catch(r){this.log("warning","There was an error while handling schema change",r)}return t};X.prototype._execute=async function(n,e,t){let r=this.controlConnection.protocolVersion;if(!t.isPrepared()&&e&&!Array.isArray(e)&&!Sn.protocolVersion.supportsNamedParameters(r))throw new En.ArgumentError("Named parameters for simple statements are not supported, use prepare flag");let i;if(this.connected||await this._connect(),!t.isPrepared())i=await this._createQueryRequest(n,t,e);else{let s=t.getLoadBalancingPolicy(),o=Sn.protocolVersion.supportsKeyspaceInRequest(r)&&t.getKeyspace()||this.keyspace,{queryId:a,meta:c}=await Cg.getPrepared(this,s,n,o);i=await this._createExecuteRequest(n,a,t,e,c)}return await Jc.send(i,t,this)};X.prototype._setHostListeners=function(){function n(r,i){return()=>r.emit("hostUp",i)}function e(r,i){return()=>r.emit("hostDown",i)}let t=this;this.hosts.on("add",function(i){i.on("up",n(t,i)),i.on("down",e(t,i)),t.emit("hostAdd",i)}),this.hosts.on("remove",function(i){i.removeAllListeners(),t.emit("hostRemove",i)}),this.hosts.forEach(function(r){r.on("up",n(t,r)),r.on("down",e(t,r))})};X.prototype._warmup=function(){let n=this.hosts.values();return _t.times(n.length,nC,async e=>{let t=n[e],r=this.profileManager.getDistance(t);if(r!==Sn.distance.ignored)if(this.options.pooling.warmup&&r===Sn.distance.local)try{await t.warmupPool(this.keyspace)}catch(i){this.log("warning",`Connection pool to host ${t.address} could not be created: ${i}`,i)}else t.initializePool()})};X.prototype._getEncoder=function(){let n=this.controlConnection.getEncoder();if(!n)throw new En.DriverInternalError("Encoder is not defined");return n};X.prototype._createBatchRequest=async function(n,e){let t=n[0];return t.meta?(await this._setRoutingInfo(e,t.params,t.meta),new ws.BatchRequest(n,e)):new ws.BatchRequest(n,e)};X.prototype._createExecuteRequest=async function(n,e,t,r,i){return r=Tn.adaptNamedParamsPrepared(r,i.columns),await this._setRoutingInfo(t,r,i),new ws.ExecuteRequest(n,e,r,t,i)};X.prototype._createQueryRequest=async function(n,e,t){await this.metadata.adaptUserHints(this.keyspace,e.getHints());let r=Tn.adaptNamedParamsWithHints(t,e);return this._getEncoder().setRoutingKeyFromUser(r.params,e,r.keyIndexes),new ws.QueryRequest(n,r.params,e,r.namedParameters)};X.prototype._setRoutingInfo=async function(n,e,t){let r=this._getEncoder();if(!n.getKeyspace()&&t.keyspace&&n.setKeyspace(t.keyspace),n.getRoutingKey())return r.setRoutingKeyFromUser(e,n);if(Array.isArray(t.partitionKeys))return n.setRoutingIndexes(t.partitionKeys),r.setRoutingKeyFromMeta(t,e,n);try{let i=await this.metadata.getTable(t.keyspace,t.table);if(!i)return;n.setRoutingIndexes(i.partitionKeys.map(s=>t.columnsByName[s.name])),t.partitionKeys=n.getRoutingIndexes(),r.setRoutingKeyFromMeta(t,e,n)}catch{this.log("warning",Yc.format("Table %s.%s metadata could not be retrieved",t.keyspace,t.table))}};xg.exports=X});var tu=C((Ob,vg)=>{"use strict";var rC=require("events"),Kr=class extends rC{constructor(e,t,r){super(),this.key=e,this.value=t,this.edges=r||[]}},eu=class extends Kr{constructor(){super([],null),this.length=0}getOrCreate(e,t){typeof e.next!="function"&&(e=e[Symbol.iterator]());let r=this,i=!1,s=e.next();for(;;){let o;for(let u=1;u<r.key.length;u++){if(s.done||r.key[u]!==s.value){o=this._createBranch(r,u,s.done,t);break}s=e.next()}if(s.done){i=!0;break}if(o!==void 0)break;let a=r.edges,c;for(let u=0;u<a.length;u++){let f=a[u];if(f.key[0]===s.value){c=f,s=e.next();break}}if(c===void 0)break;r=c}if(!i){let o=t();return r.edges.push(new Kr(iC(s.value,e),o)),this._onItemAdded(),o}return r.value===null&&r.edges.length>0&&(r.value=t()),r.value}_createBranch(e,t,r,i){let s=new Kr(e.key.slice(t),e.value,e.edges);return e.key=e.key.slice(0,t),e.edges=[s],r?(e.value=i(),this._onItemAdded()):e.value=null,s}_onItemAdded(){this.length++,this.emit("add",this.length)}};function iC(n,e){let t=[n],r=e.next();for(;!r.done;)t.push(r.value),r=e.next();return t}vg.exports=eu});var Es=C(_s=>{"use strict";var sC=j(),Nt=class{constructor(e,t,r,i){this.key=e,this.value=t,this.hasChildValues=r,this.isInOperator=i}},Jt=class{constructor(e,t,r){this.sign=e,this.value=t,this.inverted=!!r}},oC={in_:function(e){if(!Array.isArray(e))throw new sC.ArgumentError("IN operator supports only Array values");return new Nt("IN",e,!1,!0)},gt:function(e){return new Nt(">",e)},gte:function(e){return new Nt(">=",e)},lt:function(e){return new Nt("<",e)},lte:function(e){return new Nt("<=",e)},notEq:function(e){return new Nt("!=",e)},and:function(n,e){return new Nt("AND",[n,e],!0)},incr:function(e){return new Jt("+",e)},decr:function(e){return new Jt("-",e)},append:function(e){return new Jt("+",e)},prepend:function(e){return new Jt("+",e,!0)},remove:function(e){return new Jt("-",e)}};_s.q=oC;_s.QueryAssignment=Jt;_s.QueryOperator=Nt});var ru=C((Lb,Ig)=>{"use strict";var Ag=Es(),Ng=Ag.QueryOperator,aC=Ag.QueryAssignment,nu=class n{static*getSelectKey(e,t,r){yield*n._yieldKeyAndOperators(e,t),yield*n._getSelectDocInfo(r)}static*getSelectAllKey(e){yield"root",yield*n._getSelectDocInfo(e)}static*_getSelectDocInfo(e){if(e&&(e.fields&&e.fields.length>0&&(yield"|f|",yield*e.fields),typeof e.limit=="number"&&(yield"|l|"),e.orderBy)){yield"|o|";let t=Object.keys(e.orderBy);for(let r=0;r<t.length;r++){let i=t[r];yield i,yield e.orderBy[i]}}}static*getInsertKey(e,t){yield*e,t&&(t.fields&&t.fields.length>0&&(yield"|f|",yield*t.fields),typeof t.ttl=="number"&&(yield"|t|"),t.ifNotExists&&(yield"|e|"))}static*getUpdateKey(e,t,r){yield*n._yieldKeyAndAllQs(e,t),r&&(r.fields&&r.fields.length>0&&(yield"|f|",yield*r.fields),typeof r.ttl=="number"&&(yield"|t|"),r.ifExists&&(yield"|e|"),r.when&&(yield*n._yieldKeyAndOperators(Object.keys(r.when),r.when)))}static*getRemoveKey(e,t,r){yield*n._yieldKeyAndOperators(e,t),r&&(r.fields&&r.fields.length>0&&(yield"|f|",yield*r.fields),r.ifExists&&(yield"|e|"),r.deleteOnlyColumns&&(yield"|dc|"),r.when&&(yield*n._yieldKeyAndOperators(Object.keys(r.when),r.when)))}static*_yieldKeyAndOperators(e,t){for(let r=0;r<e.length;r++){let i=e[r];yield i,yield*n._yieldOperators(t[i])}}static*_yieldOperators(e){e!=null&&e instanceof Ng&&(yield e.key,e.hasChildValues&&(yield*n._yieldOperators(e.value[0]),yield"|/|",yield*n._yieldOperators(e.value[1])))}static*_yieldKeyAndAllQs(e,t){for(let r=0;r<e.length;r++){let i=e[r];yield i;let s=t[i];s!=null&&(s instanceof Ng?yield*n._yieldOperators(s):s instanceof aC&&(yield s.sign,yield s.inverted))}}};Ig.exports=nu});var Ts=C((qb,Pg)=>{"use strict";var au=ru(),er=class{constructor(e,t,r,i){this.doc=e,this.docInfo=t,this.handler=r,this.cache=i}getQueries(){let e=Object.keys(this.doc),t=this.cache.getOrCreate(this.getCacheKey(e),()=>({queries:null}));return t.queries===null&&(t.queries=this.createQueries(e)),t.queries}getCacheKey(e){throw new Error("getCacheKey must be implemented")}createQueries(e){throw new Error("getCacheKey must be implemented")}pushQueries(e){let t=!0,r;return this.getQueries().then(i=>(i.forEach(s=>{t=t&&s.isIdempotent,r=s.isCounter,e.push({query:s.query,params:s.paramsGetter(this.doc,this.docInfo,this.getMappingInfo())})}),{isIdempotent:t,isCounter:r}))}getMappingInfo(){return this.handler.info}},iu=class extends er{constructor(e,t,r,i){super(e,t,r,i)}getCacheKey(e){return au.getInsertKey(e,this.docInfo)}createQueries(e){return this.handler.createInsertQueries(e,this.doc,this.docInfo)}},su=class extends er{constructor(e,t,r,i){super(e,t,r,i)}getCacheKey(e){return au.getUpdateKey(e,this.doc,this.docInfo)}createQueries(e){return this.handler.createUpdateQueries(e,this.doc,this.docInfo)}},ou=class extends er{constructor(e,t,r,i){super(e,t,r,i)}getCacheKey(e){return au.getRemoveKey(e,this.doc,this.docInfo)}createQueries(e){return this.handler.createDeleteQueries(e,this.doc,this.docInfo)}};Pg.exports={ModelBatchItem:er,InsertModelBatchItem:iu,UpdateModelBatchItem:su,RemoveModelBatchItem:ou}});var hu=C((Db,Bg)=>{"use strict";var cu=tu(),lu=Ts(),cC=lu.InsertModelBatchItem,uC=lu.UpdateModelBatchItem,lC=lu.RemoveModelBatchItem,uu=class{constructor(e){this._handler=e,this._cache={insert:new cu,update:new cu,remove:new cu}}insert(e,t){return new cC(e,t,this._handler,this._cache.insert)}update(e,t){return new uC(e,t,this._handler,this._cache.update)}remove(e,t){return new lC(e,t,this._handler,this._cache.update)}};Bg.exports=uu});var du=C((Fb,Og)=>{"use strict";var hC=hu(),fu=class{constructor(e,t){this.name=e,this._handler=t,this.batching=new hC(this._handler)}get(e,t,r){return r===void 0&&typeof t=="string"&&(r=t,t=null),this._handler.getSelectExecutor(e,t,!0).then(i=>i(e,t,r)).then(i=>i.first())}find(e,t,r){return r===void 0&&typeof t=="string"&&(r=t,t=null),this._handler.getSelectExecutor(e,t,!1).then(i=>i(e,t,r))}findAll(e,t){return t===void 0&&typeof e=="string"&&(t=e,e=null),this._handler.getSelectAllExecutor(e)(e,t)}insert(e,t,r){return r===void 0&&typeof t=="string"&&(r=t,t=null),this._handler.getInsertExecutor(e,t).then(i=>i(e,t,r))}update(e,t,r){return r===void 0&&typeof t=="string"&&(r=t,t=null),this._handler.getUpdateExecutor(e,t).then(i=>i(e,t,r))}remove(e,t,r){return r===void 0&&typeof t=="string"&&(r=t,t=null),this._handler.getDeleteExecutor(e,t).then(i=>i(e,t,r))}mapWithQuery(e,t,r){return this._handler.getExecutorFromQuery(e,t,r)}};Og.exports=fu});var Fg=C((kb,Dg)=>{"use strict";var Ss=require("vm"),qg=Es(),Rg=qg.QueryOperator,pu=qg.QueryAssignment,fC=H(),Lg=fC.dataTypes,Cs="gen-param-getter.js",gu=class n{static getSelect(e,t,r,i,s,o){let a="SELECT ";return a+=i.length>0?i.map(c=>`"${c.columnName}"`).join(", "):"*",a+=` FROM ${t}.${e}`,r.length>0&&(a+=" WHERE ",a+=n._getConditionWithOperators(r)),s.length>0&&(a+=" ORDER BY ",a+=s.map(c=>`"${c[0]}" ${c[1]}`).join(", ")),typeof o=="number"&&(a+=" LIMIT ?"),a}static selectParamsGetter(e,t){let r=`(function getParametersSelect(doc, docInfo, mappingInfo) {
`;return r+="  return [",r+=n._valueGetterExpression(e),typeof t=="number"&&(e.length>0&&(r+=", "),r+="docInfo['limit']"),r+=`];
})`,new Ss.Script(r,{filename:Cs}).runInThisContext()}static getInsert(e,t,r,i,s){let o=i&&i.ttl,a=r.filter(c=>e.columnsByName[c.columnName]!==void 0);return{query:n._getInsertQuery(e.name,t,a,s,o),paramsGetter:n._insertParamsGetter(a,i),isIdempotent:!s}}static _getInsertQuery(e,t,r,i,s){let o=`INSERT INTO ${t}.${e} (`;return o+=r.map(a=>`"${a.columnName}"`).join(", "),o+=") VALUES (",o+=r.map(()=>"?").join(", "),o+=")",i===!0&&(o+=" IF NOT EXISTS"),typeof s=="number"&&(o+=" USING TTL ?"),o}static _insertParamsGetter(e,t){let r=`(function getParametersInsert(doc, docInfo, mappingInfo) {
`;return r+="  return [",r+=n._valueGetterExpression(e),t&&typeof t.ttl=="number"&&(r+=", docInfo['ttl']"),r+=`];
})`,new Ss.Script(r,{filename:Cs}).runInThisContext()}static getUpdate(e,t,r,i,s,o){let a=i&&i.ttl,c=new Set(e.partitionKeys.concat(e.clusteringKeys).map(S=>S.name)),u=!0,f=!1,g=r.filter(S=>{let p=e.columnsByName[S.columnName];return p===void 0?!1:(p.type.code===Lg.list&&S.value instanceof pu?u=!1:p.type.code===Lg.counter&&(u=!1,f=!0),!0)});return{query:n._getUpdateQuery(e.name,t,c,g,s,o,a),isIdempotent:u&&s.length===0&&!o,paramsGetter:n._updateParamsGetter(c,g,s,a),isCounter:f}}static _getUpdateQuery(e,t,r,i,s,o,a){let c=`UPDATE ${t}.${e} `;return typeof a=="number"&&(c+="USING TTL ? "),c+="SET ",c+=i.filter(u=>!r.has(u.columnName)).map(u=>u.value instanceof pu?u.value.inverted?`"${u.columnName}" = ? ${u.value.sign} "${u.columnName}"`:`"${u.columnName}" = "${u.columnName}" ${u.value.sign} ?`:`"${u.columnName}" = ?`).join(", "),c+=" WHERE ",c+=i.filter(u=>r.has(u.columnName)).map(u=>`"${u.columnName}" = ?`).join(" AND "),o===!0?c+=" IF EXISTS":s.length>0&&(c+=" IF "+n._getConditionWithOperators(s)),c}static _updateParamsGetter(e,t,r,i){let s=`(function getParametersUpdate(doc, docInfo, mappingInfo) {
`;return s+="  return [",typeof i=="number"&&(s+="docInfo['ttl'], "),s+=n._assignmentGetterExpression(t.filter(a=>!e.has(a.columnName))),s+=", ",s+=n._valueGetterExpression(t.filter(a=>e.has(a.columnName))),r.length>0&&(s+=", "+n._valueGetterExpression(r,"docInfo.when")),s+=`];
})`,new Ss.Script(s,{filename:Cs}).runInThisContext()}static getDelete(e,t,r,i,s,o){let a=i&&i.deleteOnlyColumns,c=new Set(e.partitionKeys.concat(e.clusteringKeys).map(f=>f.name)),u=r.filter(f=>e.columnsByName[f.columnName]!==void 0);return{query:n._getDeleteQuery(e.name,t,c,u,s,o,a),paramsGetter:n._deleteParamsGetter(c,u,s),isIdempotent:s.length===0&&!o}}static _getDeleteQuery(e,t,r,i,s,o,a){let c="DELETE";if(a){let u=i.filter(f=>!r.has(f.columnName)).map(f=>`"${f.columnName}"`).join(", ");u!==""&&(c+=" "+u)}return c+=` FROM ${t}.${e} WHERE `,c+=i.filter(u=>r.has(u.columnName)).map(u=>`"${u.columnName}" = ?`).join(" AND "),o===!0?c+=" IF EXISTS":s.length>0&&(c+=" IF "+n._getConditionWithOperators(s)),c}static _deleteParamsGetter(e,t,r){let i=`(function getParametersDelete(doc, docInfo, mappingInfo) {
`;return i+="  return [",i+=n._valueGetterExpression(t.filter(o=>e.has(o.columnName))),r.length>0&&(i+=", "+n._valueGetterExpression(r,"docInfo.when")),i+=`];
})`,new Ss.Script(i,{filename:Cs}).runInThisContext()}static _valueGetterExpression(e,t){return t=t||"doc",e.map(r=>n._valueGetterSingle(`${t}['${r.propertyName}']`,r.propertyName,r.value,r.fromModel)).join(", ")}static _valueGetterSingle(e,t,r,i){let s=e;if(r instanceof Rg){if(r.hasChildValues)return`${n._valueGetterSingle(`${e}.value[0]`,t,r.value[0],i)}, ${n._valueGetterSingle(`${e}.value[1]`,t,r.value[1],i)}`;if(s=`${e}.value`,r.isInOperator&&i)return`${s}.map(v => ${n._getMappingFunctionCall(t,"v")})`}return i?n._getMappingFunctionCall(t,s):s}static _assignmentGetterExpression(e,t){return t=t||"doc",e.map(r=>{let i=`${t}['${r.propertyName}']${r.value instanceof pu?".value":""}`;return r.fromModel?n._getMappingFunctionCall(r.propertyName,i):i}).join(", ")}static _getConditionWithOperators(e){return e.map(t=>n._getSingleCondition(t.columnName,t.value)).join(" AND ")}static _getMappingFunctionCall(e,t){return`mappingInfo.getFromModelFn('${e}')(${t})`}static _getSingleCondition(e,t){return t instanceof Rg?t.hasChildValues?`${n._getSingleCondition(e,t.value[0])} ${t.key} ${n._getSingleCondition(e,t.value[1])}`:`"${e}" ${t.key} ?`:`"${e}" = ?`}};Dg.exports=gu});var wu=C((Ub,Ug)=>{"use strict";var dC=require("vm"),mu=O(),kg=H(),yu=class n{static getSelectAdapter(e,t){let r=t.columns;if(!r)throw new Error("Expected ROWS result obtained VOID");let i=`(function rowAdapter(row, info) {
  const item = info.newInstance();
`;for(let o of r)i+=`  item['${e.getPropertyName(o.name)}'] = `,e.getToModelFn(o.name)?i+=`info.getToModelFn('${o.name}')(row['${o.name}']);
`:i+=`row['${o.name}'];
`;return i+=`  return item;
})`,new dC.Script(i,{filename:"gen-result-mapper.js"}).runInThisContext()}static getMutationAdapter(e){return e.columns===null||e.columns.length===1&&e.columns[0].name==="[applied]"&&e.columns[0].type.code===kg.dataTypes.boolean?mu.noop:n._getConditionalRowAdapter(e)}static _getConditionalRowAdapter(e){return function(r,i){let s=i.newInstance();for(let o=1;o<e.columns.length;o++){let a=e.columns[o];s[i.getPropertyName(a.name)]=r[a.name]}return s}}static getCustomQueryAdapter(e,t){return t.columns===null||t.columns.length===0?{canCache:!0,fn:mu.noop}:t.columns[0].name==="[applied]"&&t.columns[0].type.code===kg.dataTypes.boolean?{canCache:!1,fn:n._getConditionalRowAdapter(t)}:{canCache:!0,fn:n.getSelectAdapter(e,t)}}};Ug.exports=yu});var xs=C((Mb,Mg)=>{"use strict";var pC=require("util"),gC=O(),mC=pC.inspect.custom||"inspect",_u=class{constructor(e,t,r){this._rs=e,this._info=t,this._rowAdapter=r,this._isEmptyLwt=e.columns!==null&&e.columns.length===1&&this._rs.rowLength===1&&e.columns[0].name==="[applied]",this.length=this._isEmptyLwt?0:e.rowLength||0,this.pageState=e.pageState}wasApplied(){return this._rs.wasApplied()}first(){return!this._rs.rowLength||this._isEmptyLwt?null:this._rowAdapter(this._rs.rows[0],this._info)}*[Symbol.iterator](){if(!this._isEmptyLwt)for(let e=0;e<this._rs.rows.length;e++)yield this._rowAdapter(this._rs.rows[e],this._info)}toArray(){return this._isEmptyLwt||!this._rs.rows?gC.emptyArray:this._rs.rows.map(e=>this._rowAdapter(e,this._info))}forEach(e,t){let r=0;t=t||this;for(let i of this)e.call(t,i,r++)}[mC](){return this.toArray()}};Mg.exports=_u});var Kg=C((Vb,Hg)=>{"use strict";var ct={all:1,none:0,some:-1},Eu=class{static getForSelect(e,t,r,i,s,o){return Promise.all(t.tables.map(a=>a.isView?e.metadata.getMaterializedView(t.keyspace,a.name):e.metadata.getTable(t.keyspace,a.name))).then(a=>{for(let u=0;u<a.length;u++){let f=a[u];if(f===null)throw new Error(`Table "${t.tables[u].name}" could not be retrieved`);if(!(tr(f.partitionKeys,i)!==ct.all||r&&tr(f.clusteringKeys,i)!==ct.all||i.length>f.partitionKeys.length&&!i.reduce((y,_)=>y&&(Tu(f.partitionKeys,w=>w.name===_.columnName)||Tu(f.clusteringKeys,w=>w.name===_.columnName)),!0)||!s.reduce((p,y)=>p&&f.columnsByName[y.columnName]!==void 0,!0)||!o.reduce((p,y,_)=>{if(!p)return!1;let w=f.clusteringKeys[_];return w&&w.name===y[0]},!0)))return f.name}let c=`No table matches the filter (${r?"all PKs have to be specified":"PKs"}): [${i.map(u=>u.columnName)}]`;throw s.length>0&&(c+=`; fields: [${s.map(u=>u.columnName)}]`),o.length>0&&(c+=`; orderBy: [${o.map(u=>u[0])}]`),new Error(c)})}static getForSelectAll(e){return e.tables[0].name}static getForInsert(e,t,r){return Promise.all(t.tables.filter(i=>!i.isView).map(i=>e.metadata.getTable(t.keyspace,i.name))).then(i=>{let s=i.filter((o,a)=>{if(o===null)throw new Error(`Table "${t.tables[a].name}" could not be retrieved`);if(tr(o.partitionKeys,r)!==ct.all)return!1;let c=tr(o.clusteringKeys,r);if(c===ct.all)return!0;if(c===ct.some)return!1;let u=zg(o);return r.length===o.partitionKeys.length+u&&u>0});if(s.length===0)throw new Error(`No table matches (all PKs have to be specified) fields: [${r.map(o=>o.columnName)}]`);return s})}static getForUpdate(e,t,r,i){return Promise.all(t.tables.filter(s=>!s.isView).map(s=>e.metadata.getTable(t.keyspace,s.name))).then(s=>{let o=s.filter((a,c)=>{if(a===null)throw new Error(`Table "${t.tables[c].name}" could not be retrieved`);if(tr(a.partitionKeys,r)!==ct.all)return!1;let u=tr(a.clusteringKeys,r);if(u===ct.some||u===ct.none&&!Vg(a))return!1;let f=r.reduce((g,S)=>g+(a.columnsByName[S.columnName]!==void 0?1:0),0);return f<=a.partitionKeys.length+a.clusteringKeys.length&&(!Vg(a)||f<=a.partitionKeys.length)?!1:i.reduce((g,S)=>g&&a.columnsByName[S.columnName]!==void 0,!0)});if(o.length===0){let a=`No table matches (all PKs and columns to set have to be specified) fields: [${r.map(c=>c.columnName)}]`;throw i.length>0&&(a+=`; condition: [${i.map(c=>c.columnName)}]`),new Error(a)}return o})}static getForDelete(e,t,r,i){return Promise.all(t.tables.filter(s=>!s.isView).map(s=>e.metadata.getTable(t.keyspace,s.name))).then(s=>{let o=s.filter((a,c)=>{if(a===null)throw new Error(`Table "${t.tables[c].name}" could not be retrieved`);let u=a.partitionKeys.concat(a.clusteringKeys).map(g=>g.name),f=r.map(g=>g.columnName);for(let g=0;g<u.length;g++)if(f.indexOf(u[g])===-1)return!1;return i.reduce((g,S)=>g&&a.columnsByName[S.columnName]!==void 0,!0)});if(o.length===0){let a=`No table matches (all PKs have to be specified) fields: [${r.map(c=>c.columnName)}]`;throw i.length>0&&(a+=`; condition: [${i.map(c=>c.columnName)}]`),new Error(a)}return o})}};function Tu(n,e){return n.filter(e).length>0}function tr(n,e){if(n.length===0)return ct.all;let t=e.reduce((r,i)=>r+(Tu(n,s=>i.columnName===s.name)?1:0),0);return t===0?ct.none:t===n.length?ct.all:ct.some}function Vg(n){return zg(n)>0}function zg(n){return n.columns.reduce((e,t)=>e+(t.isStatic?1:0),0)}Hg.exports=Eu});var Cu=C((zb,jg)=>{"use strict";var yC=j(),wC=O(),Su=class{static getPropertiesInfo(e,t,r,i){let s=e;return t&&t.fields&&t.fields.length>0&&(s=t.fields),s.map(o=>({propertyName:o,columnName:i.getColumnName(o),value:r[o],fromModel:i.getFromModelFn(o)}))}static adaptOrderBy(e,t){return!e||!e.orderBy?wC.emptyArray:Object.keys(e.orderBy).map(r=>{let i=e.orderBy[r],s=typeof i=="string"?i.toUpperCase():i;if(s!=="ASC"&&s!=="DESC")throw new yC.ArgumentError('Order must be either "ASC" or "DESC", obtained: '+i);return[t.getColumnName(r),s]})}static adaptOptions(e,t){let r={prepare:!0,executionProfile:void 0,timestamp:void 0,isIdempotent:t};return typeof e=="string"?r.executionProfile=e:e!=null&&(r.executionProfile=e.executionProfile,r.timestamp=e.timestamp,e.isIdempotent!==void 0&&(r.isIdempotent=e.isIdempotent)),r}static adaptAllOptions(e,t){let r={prepare:!0,executionProfile:void 0,fetchSize:void 0,pageState:void 0,timestamp:void 0,isIdempotent:void 0};return typeof e=="string"?r.executionProfile=e:e!=null&&(r.executionProfile=e.executionProfile,r.fetchSize=e.fetchSize,r.pageState=e.pageState,r.timestamp=e.timestamp,r.isIdempotent=e.isIdempotent),t&&(r.isIdempotent=!0),r}static adaptBatchOptions(e,t,r){let i={prepare:!0,executionProfile:void 0,timestamp:void 0,logged:void 0,isIdempotent:t,counter:r};return typeof e=="string"?i.executionProfile=e:e!=null&&(i.executionProfile=e.executionProfile,i.timestamp=e.timestamp,i.logged=e.logged!==!1,e.isIdempotent!==void 0&&(i.isIdempotent=e.isIdempotent)),i}};jg.exports=Su});var Wg=C((Hb,Gg)=>{"use strict";var Cn=O(),xn=Fg(),bs=wu(),vs=xs(),jr=ru(),Gr=tu(),Wr=Kg(),qe=Cu(),Ns=100,xu=class{constructor(e,t){this._client=e,this._cache={select:new Gr().on("add",r=>this._validateCacheLength(r)),selectAll:new Gr().on("add",r=>this._validateCacheLength(r)),insert:new Gr().on("add",r=>this._validateCacheLength(r)),update:new Gr().on("add",r=>this._validateCacheLength(r)),remove:new Gr().on("add",r=>this._validateCacheLength(r)),customQueries:new Map},this.info=t}getSelectExecutor(e,t,r){let i=Object.keys(e);if(i.length===0)return Promise.reject(new Error("Expected object with keys"));let s=jr.getSelectKey(i,e,t),o=this._cache.select.getOrCreate(s,()=>({executor:null,resultAdapter:null}));if(o.executor!==null)return Promise.resolve(o.executor);let a=qe.getPropertiesInfo(i,null,e,this.info),c=qe.getPropertiesInfo(Cn.emptyArray,t,e,this.info),u=qe.adaptOrderBy(t,this.info),f=t&&t.limit;return this._client.connect().then(()=>Wr.getForSelect(this._client,this.info,r,a,c,u)).then(g=>{let S=xn.getSelect(g,this.info.keyspace,a,c,u,f),p=xn.selectParamsGetter(a,f),y=this;return o.executor=function(w,E,v){return y._executeSelect(S,p,w,E,v,o)},o.executor})}getSelectAllExecutor(e){let t=jr.getSelectAllKey(e),r=this._cache.selectAll.getOrCreate(t,()=>({executor:null,resultAdapter:null}));if(r.executor!==null)return r.executor;let i=qe.getPropertiesInfo(Cn.emptyArray,e,Cn.emptyObject,this.info),s=qe.adaptOrderBy(e,this.info),o=e&&e.limit,a=Wr.getForSelectAll(this.info),c=xn.getSelect(a,this.info.keyspace,Cn.emptyArray,i,s,o),u=xn.selectParamsGetter(Cn.emptyArray,o),f=this;return r.executor=function(S,p){return f._executeSelect(c,u,null,S,p,r)},r.executor}_executeSelect(e,t,r,i,s,o){let a=qe.adaptAllOptions(s,!0);return this._client.execute(e,t(r,i,this.info),a).then(c=>(o.resultAdapter===null&&(o.resultAdapter=bs.getSelectAdapter(this.info,c)),new vs(c,this.info,o.resultAdapter)))}getInsertExecutor(e,t){let r=Object.keys(e);if(r.length===0)return Promise.reject(new Error("Expected object with keys"));let i=jr.getInsertKey(r,t),s=this._cache.insert.getOrCreate(i,()=>({executor:null}));return s.executor!==null?Promise.resolve(s.executor):this.createInsertQueries(r,e,t).then(o=>o.length===1?this._setSingleExecutor(s,o[0]):this._setBatchExecutor(s,o))}createInsertQueries(e,t,r){let i=qe.getPropertiesInfo(e,r,t,this.info),s=r&&r.ifNotExists;return this._client.connect().then(()=>Wr.getForInsert(this._client,this.info,i)).then(o=>{if(o.length>1&&s)throw new Error("Batch with ifNotExists conditions cannot span multiple tables");return o.map(a=>xn.getInsert(a,this.info.keyspace,i,r,s))})}getUpdateExecutor(e,t){let r=Object.keys(e);if(r.length===0)return Promise.reject(new Error("Expected object with keys"));let i=jr.getUpdateKey(r,e,t),s=this._cache.update.getOrCreate(i,()=>({executor:null}));return s.executor!==null?Promise.resolve(s.executor):this.createUpdateQueries(r,e,t).then(o=>o.length===1?this._setSingleExecutor(s,o[0]):this._setBatchExecutor(s,o))}createUpdateQueries(e,t,r){let i=qe.getPropertiesInfo(e,r,t,this.info),s=r&&r.ifExists,o=r&&r.when?qe.getPropertiesInfo(Object.keys(r.when),null,r.when,this.info):Cn.emptyArray;if(o.length>0&&s)throw new Error("Both when and ifExists conditions can not be applied to the same statement");return this._client.connect().then(()=>Wr.getForUpdate(this._client,this.info,i,o)).then(a=>{if(a.length>1&&(o.length>0||s))throw new Error("Batch with when or ifExists conditions cannot span multiple tables");return a.map(c=>xn.getUpdate(c,this.info.keyspace,i,r,o,s))})}getDeleteExecutor(e,t){let r=Object.keys(e);if(r.length===0)return Promise.reject(new Error("Expected object with keys"));let i=jr.getRemoveKey(r,e,t),s=this._cache.remove.getOrCreate(i,()=>({executor:null}));return s.executor!==null?Promise.resolve(s.executor):this.createDeleteQueries(r,e,t).then(o=>o.length===1?this._setSingleExecutor(s,o[0]):this._setBatchExecutor(s,o))}createDeleteQueries(e,t,r){let i=qe.getPropertiesInfo(e,r,t,this.info),s=r&&r.ifExists,o=r&&r.when?qe.getPropertiesInfo(Object.keys(r.when),null,r.when,this.info):Cn.emptyArray;if(o.length>0&&s)throw new Error("Both when and ifExists conditions can not be applied to the same statement");return this._client.connect().then(()=>Wr.getForDelete(this._client,this.info,i,o)).then(a=>{if(a.length>1&&(o.length>0||s))throw new Error("Batch with when or ifExists conditions cannot span multiple tables");return a.map(c=>xn.getDelete(c,this.info.keyspace,i,r,o,s))})}getExecutorFromQuery(e,t,r){let i=this,s=r?qe.adaptAllOptions(r):null;return function(a,c){let u=s||qe.adaptAllOptions(c);return i._client.execute(e,t(a),u).then(f=>{let g=i._cache.customQueries.get(e);if(g===void 0){let S=bs.getCustomQueryAdapter(i.info,f);g=S.fn,S.canCache&&(i._cache.customQueries.set(e,g),i._cache.customQueries.size===Ns&&i._client.log("warning",`Custom queries cache reached ${Ns} items, this could be caused by hard-coding parameter values inside the query, which should be avoided`))}return new vs(f,i.info,g)})}}_setSingleExecutor(e,t){let r=this;return e.executor=function(s,o,a){let c=qe.adaptOptions(a,t.isIdempotent);return r._client.execute(t.query,t.paramsGetter(s,o,r.info),c).then(u=>new vs(u,r.info,bs.getMutationAdapter(u)))},e.executor}_setBatchExecutor(e,t){let r=this,i=t.reduce((s,o)=>s&&o.isIdempotent,!0);return e.executor=function(o,a,c){let u=t.map(g=>({query:g.query,params:g.paramsGetter(o,a,r.info)})),f=qe.adaptOptions(c,i);return r._client.batch(u,f).then(g=>new vs(g,r.info,bs.getMutationAdapter(g)))},e.executor}_validateCacheLength(e){e===Ns&&this._client.log("warning",`ModelMapper cache reached ${Ns} items, this could be caused by building the object to map in different ways (with different shapes) each time. Use the same or few object structures for a model and represent unset values with undefined or types.unset`)}};Gg.exports=xu});var Nu=C(As=>{"use strict";var $r=class{newObjectInstance(){return{}}getColumnName(e){return e}getPropertyName(e){return e}},bu=class extends $r{constructor(){super()}getColumnName(e){return e.replace(/[a-z][A-Z]/g,(t,r)=>t.charAt(0)+"_"+t.charAt(1)).toLowerCase()}getPropertyName(e){return e.replace(/_[a-z]/g,(t,r)=>r===0?t:t.substr(1).toUpperCase())}},vu=class extends $r{constructor(){super()}getColumnName(e){return super.getColumnName(e)}getPropertyName(e){return super.getPropertyName(e)}newObjectInstance(){return super.newObjectInstance()}};As.TableMappings=$r;As.UnderscoreCqlToCamelCaseMappings=bu;As.DefaultTableMappings=vu});var Yg=C((jb,Zg)=>{"use strict";var Qg=Nu(),_C=Qg.TableMappings,$g=Qg.DefaultTableMappings,Au=class n{constructor(e,t,r,i){this.keyspace=e,this.tables=t,this._mappings=r,this._columns=i,this._documentProperties=new Map;for(let s of i.values())this._documentProperties.set(s.propertyName,s)}getColumnName(e){let t=this._documentProperties.get(e);return t!==void 0?t.columnName:this._mappings.getColumnName(e)}getPropertyName(e){let t=this._columns.get(e);return t!==void 0?t.propertyName:this._mappings.getPropertyName(e)}getFromModelFn(e){let t=this._documentProperties.get(e);return t!==void 0?t.fromModel:null}getToModelFn(e){let t=this._columns.get(e);return t!==void 0?t.toModel:null}newInstance(){return this._mappings.newObjectInstance()}static parse(e,t){let r=new Map;return!e||!e.models||Object.keys(e.models).forEach(i=>{let s=e.models[i];r.set(i,n._create(i,t,s))}),r}static _create(e,t,r){if(!t&&(!r||!r.keyspace))throw new Error("You should specify the keyspace of the model in the MappingOptions when the Client is not using a keyspace");if(!r)return n.createDefault(e,t);let i;if(r.tables&&r.tables.length>0?i=r.tables.map(o=>{let a={name:null,isView:!1};if(typeof o=="string"?a.name=o:o&&(a.name=o.name,a.isView=!!o.isView),!a.name)throw new Error(`Table name not specified for model '${e}'`);return a}):i=[{name:e,isView:!1}],r.mappings&&!(r.mappings instanceof _C))throw new Error("mappings should be an instance of TableMappings");let s=new Map;return r.columns!==null&&typeof r.columns=="object"&&Object.keys(r.columns).forEach(o=>{s.set(o,Iu.parse(o,r.columns[o]))}),new n(r.keyspace||t,i,r.mappings||new $g,s)}static createDefault(e,t){return new n(t,[{name:e,isView:!1}],new $g,new Map)}},Iu=class n{constructor(e,t,r,i){if(this.columnName=e,this.propertyName=t,r&&typeof r!="function")throw new TypeError(`toModel type for property '${t}' should be a function (obtained ${typeof r})`);if(i&&typeof i!="function")throw new TypeError(`fromModel type for property '${t}' should be a function (obtained ${typeof i})`);this.toModel=r,this.fromModel=i}static parse(e,t){return t?typeof t=="string"?new n(e,t):new n(e,t.name||e,t.toModel,t.fromModel):new n(e,e)}};Zg.exports=Au});var em=C((Gb,Jg)=>{"use strict";var EC=du(),TC=Wg(),SC=Cu(),CC=j(),xC=xs(),bC=wu(),Xg=Yg(),{ModelBatchItem:vC}=Ts(),Pu=class{constructor(e,t){if(!e)throw new Error("client must be defined");this.client=e,this._modelMappingInfos=Xg.parse(t,e.keyspace),this._modelMappers=new Map}forModel(e){let t=this._modelMappers.get(e);if(t===void 0){let r=this._modelMappingInfos.get(e);if(r===void 0){if(!this.client.keyspace)throw new Error(`No mapping information found for model '${e}'. Mapper is unable to create default mappings without setting the keyspace`);r=Xg.createDefault(e,this.client.keyspace),this.client.log("info",`Mapping information for model '${e}' not found, creating default mapping. Keyspace: ${r.keyspace}; Table: ${r.tables[0].name}.`)}else this.client.log("info",`Creating model mapper for '${e}' using mapping information. Keyspace: ${r.keyspace}; Table${r.tables.length>1?"s":""}: ${r.tables.map(i=>i.name)}.`);t=new EC(e,new TC(this.client,r)),this._modelMappers.set(e,t)}return t}batch(e,t){if(!Array.isArray(e)||!(e.length>0))return Promise.reject(new CC.ArgumentError("First parameter items should be an Array with 1 or more ModelBatchItem instances"));let r=[],i=!0,s;return Promise.all(e.map(o=>o instanceof vC?o.pushQueries(r).then(a=>{i=i&&a.isIdempotent,s=a.isCounter}):Promise.reject(new Error("Batch items must be instances of ModelBatchItem, use modelMapper.batching object to create each item")))).then(()=>this.client.batch(r,SC.adaptBatchOptions(t,i,s))).then(o=>{let a=e[0].getMappingInfo();return new xC(o,a,bC.getMutationAdapter(o))})}};Jg.exports=Pu});var tm=C(At=>{"use strict";At.Mapper=em();At.ModelMapper=du();At.ModelBatchMapper=hu();At.ModelBatchItem=Ts().ModelBatchItem;At.Result=xs();var Bu=Nu();At.TableMappings=Bu.TableMappings;At.DefaultTableMappings=Bu.DefaultTableMappings;At.UnderscoreCqlToCamelCaseMappings=Bu.UnderscoreCqlToCamelCaseMappings;At.q=Es().q});var rm=C(Ru=>{"use strict";var{Stream:NC}=require("stream"),nm=O();function AC(n,e,t,r){if(!n)throw new TypeError("Client instance is not defined");if(typeof e=="string"){if(Array.isArray(t))return new Is(n,e,t,r).execute();if(t instanceof NC)return new Ou(n,e,t,r).execute();throw new TypeError("parameters should be an Array or a Stream instance")}if(Array.isArray(e))return r=t,new Is(n,null,e,r).execute();throw new TypeError("A string query or query and parameters array should be provided")}var Is=class{constructor(e,t,r,i){this._client=e,this._query=t,this._parameters=r,i=i||nm.emptyObject,this._raiseOnFirstError=i.raiseOnFirstError!==!1,this._concurrencyLevel=Math.min(i.concurrencyLevel||100,this._parameters.length),this._queryOptions={prepare:!0,executionProfile:i.executionProfile},this._result=new Qr(i),this._stop=!1}execute(){let e=new Array(this._concurrencyLevel);for(let t=0;t<this._concurrencyLevel;t++)e[t]=this._executeOneAtATime(t,0);return Promise.all(e).then(()=>this._result)}_executeOneAtATime(e,t){let r=e+this._concurrencyLevel*t;if(r>=this._parameters.length||this._stop)return Promise.resolve();let i=this._parameters[r],s,o;return this._query===null?(s=i.query,o=i.params):(s=this._query,o=i),this._client.execute(s,o,this._queryOptions).then(a=>this._result.setResultItem(r,a)).catch(a=>this._setError(r,a)).then(()=>this._executeOneAtATime(e,t+1))}_setError(e,t){if(this._result.setError(e,t),this._raiseOnFirstError)throw this._stop=!0,t}},Ou=class{constructor(e,t,r,i){this._client=e,this._query=t,this._stream=r,i=i||nm.emptyObject,this._raiseOnFirstError=i.raiseOnFirstError!==!1,this._concurrencyLevel=i.concurrencyLevel||100,this._queryOptions={prepare:!0,executionProfile:i.executionProfile},this._inFlight=0,this._index=0,this._result=new Qr(i),this._resolveCallback=null,this._rejectCallback=null,this._readEnded=!1}execute(){return new Promise((e,t)=>{this._resolveCallback=e,this._rejectCallback=t,this._stream.on("data",r=>this._executeOne(r)).on("error",r=>this._setReadEnded(r)).on("end",()=>this._setReadEnded())})}_executeOne(e){if(!Array.isArray(e))return this._setReadEnded(new TypeError("Stream should be in objectMode and should emit Array instances"));if(this._readEnded)return;let t=this._index++;this._inFlight++,this._client.execute(this._query,e,this._queryOptions).then(r=>{this._result.setResultItem(t,r),this._inFlight--}).catch(r=>{this._inFlight--,this._setError(t,r)}).then(()=>{this._stream.isPaused()&&this._stream.resume(),this._readEnded&&this._inFlight===0&&this._resolveCallback(this._result)}),this._inFlight>=this._concurrencyLevel&&this._stream.pause()}_setReadEnded(e){this._readEnded||(this._readEnded=!0,e?this._rejectCallback(e):this._inFlight===0&&this._resolveCallback(this._result))}_setError(e,t){this._result.setError(e,t),this._raiseOnFirstError&&(this._readEnded=!0,this._rejectCallback(t))}},Qr=class{constructor(e){this._collectResults=e.collectResults,this._maxErrors=e.maxErrors||100,this.totalExecuted=0,this.errors=[],this._collectResults?this.resultItems=[]:Object.defineProperty(this,"resultItems",{enumerable:!1,get:()=>{throw new Error("Property resultItems can not be accessed when collectResults is set to false")}})}setResultItem(e,t){this.totalExecuted++,this._collectResults&&(this.resultItems[e]=t)}setError(e,t){this.totalExecuted++,this.errors.length<this._maxErrors&&this.errors.push(t),this._collectResults&&(this.resultItems[e]=t)}};Ru.executeConcurrent=AC;Ru.ResultSetGroup=Qr});var im=C(Lu=>{"use strict";Lu.graph=vc();Lu.search=ra()});var IC=sr();exports.Client=bg();exports.ExecutionProfile=Ao().ExecutionProfile;exports.ExecutionOptions=Kt().ExecutionOptions;exports.types=H();exports.errors=j();exports.policies=wi();exports.auth=Er();exports.mapping=tm();exports.tracker=uo();exports.metrics=po();exports.concurrent=rm();var sm=xr();exports.token={Token:sm.Token,TokenRange:sm.TokenRange};var PC=ka();exports.metadata={Metadata:PC};exports.Encoder=Bi();exports.geometry=Ai();exports.datastax=im();exports.defaultOptions=function(){return IC.defaultOptions()};exports.version=Dn().version;
/*! Bundled license information:

long/umd/index.js:
  (**
   * @license
   * Copyright 2009 The Closure Library Authors
   * Copyright 2020 Daniel Wirtz / The long.js Authors.
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *     http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *
   * SPDX-License-Identifier: Apache-2.0
   *)
*/
