"use strict";var p=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var y=p(x=>{"use strict";x.getBooleanOption=(r,e)=>{let t=!1;if(e in r&&typeof(t=r[e])!="boolean")throw new TypeError(`Expected the "${e}" option to be a boolean`);return t};x.cppdb=Symbol();x.inspect=Symbol.for("nodejs.util.inspect.custom")});var D=p((Ne,P)=>{"use strict";var B={value:"SqliteError",writable:!0,enumerable:!1,configurable:!0};function w(r,e){if(new.target!==w)return new w(r,e);if(typeof e!="string")throw new TypeError("Expected second argument to be a string");Error.call(this,r),B.value=""+r,Object.defineProperty(this,"message",B),Error.captureStackTrace(this,w),this.code=e}Object.setPrototypeOf(w,Error);Object.setPrototypeOf(w.prototype,Error.prototype);Object.defineProperty(w.prototype,"name",B);P.exports=w});var F=p((Ge,A)=>{var O=require("path").sep||"/";A.exports=he;function he(r){if(typeof r!="string"||r.length<=7||r.substring(0,7)!="file://")throw new TypeError("must pass in a file:// URI to convert to a file path");var e=decodeURI(r.substring(7)),t=e.indexOf("/"),o=e.substring(0,t),i=e.substring(t+1);return o=="localhost"&&(o=""),o&&(o=O+O+o),i=i.replace(/^(.+)\|/,"$1:"),O=="\\"&&(i=i.replace(/\//g,"\\")),/^.+\:/.test(i)||(i=O+i),o+i}});var U=p((m,M)=>{var k=require("fs"),_=require("path"),ye=F(),v=_.join,be=_.dirname,V=k.accessSync&&function(r){try{k.accessSync(r)}catch{return!1}return!0}||k.existsSync||_.existsSync,L={arrow:process.env.NODE_BINDINGS_ARROW||" \u2192 ",compiled:process.env.NODE_BINDINGS_COMPILED_DIR||"compiled",platform:process.platform,arch:process.arch,nodePreGyp:"node-v"+process.versions.modules+"-"+process.platform+"-"+process.arch,version:process.versions.node,bindings:"bindings.node",try:[["module_root","build","bindings"],["module_root","build","Debug","bindings"],["module_root","build","Release","bindings"],["module_root","out","Debug","bindings"],["module_root","Debug","bindings"],["module_root","out","Release","bindings"],["module_root","Release","bindings"],["module_root","build","default","bindings"],["module_root","compiled","version","platform","arch","bindings"],["module_root","addon-build","release","install-root","bindings"],["module_root","addon-build","debug","install-root","bindings"],["module_root","addon-build","default","install-root","bindings"],["module_root","lib","binding","nodePreGyp","bindings"]]};function ge(r){typeof r=="string"?r={bindings:r}:r||(r={}),Object.keys(L).map(function(a){a in r||(r[a]=L[a])}),r.module_root||(r.module_root=m.getRoot(m.getFileName())),_.extname(r.bindings)!=".node"&&(r.bindings+=".node");for(var e=typeof __webpack_require__=="function"?__non_webpack_require__:require,t=[],o=0,i=r.try.length,n,s,u;o<i;o++){n=v.apply(null,r.try[o].map(function(a){return r[a]||a})),t.push(n);try{return s=r.path?e.resolve(n):e(n),r.path||(s.path=n),s}catch(a){if(a.code!=="MODULE_NOT_FOUND"&&a.code!=="QUALIFIED_PATH_RESOLUTION_FAILED"&&!/not find/i.test(a.message))throw a}}throw u=new Error(`Could not locate the bindings file. Tried:
`+t.map(function(a){return r.arrow+a}).join(`
`)),u.tries=t,u}M.exports=m=ge;m.getFileName=function(e){var t=Error.prepareStackTrace,o=Error.stackTraceLimit,i={},n;Error.stackTraceLimit=10,Error.prepareStackTrace=function(u,a){for(var c=0,f=a.length;c<f;c++)if(n=a[c].getFileName(),n!==__filename)if(e){if(n!==e)return}else return},Error.captureStackTrace(i),i.stack,Error.prepareStackTrace=t,Error.stackTraceLimit=o;var s="file://";return n.indexOf(s)===0&&(n=ye(n)),n};m.getRoot=function(e){for(var t=be(e),o;;){if(t==="."&&(t=process.cwd()),V(v(t,"package.json"))||V(v(t,"node_modules")))return t;if(o===t)throw new Error('Could not find module root given file: "'+e+'". Do you have a `package.json` file? ');o=t,t=v(t,"..")}}});var C=p(b=>{"use strict";var{cppdb:d}=y();b.prepare=function(e){return this[d].prepare(e,this,!1)};b.key=function(r){if(!Buffer.isBuffer(r))throw new TypeError("Expected first argument to be a Buffer");return this[d].key(r,r.length)};b.rekey=function(e){if(!Buffer.isBuffer(e))throw new TypeError("Expected first argument to be a Buffer");return this[d].rekey(e,e.length)};b.exec=function(e){return this[d].exec(e),this};b.close=function(){return this[d].close(),this};b.loadExtension=function(...e){return this[d].loadExtension(...e),this};b.defaultSafeIntegers=function(...e){return this[d].defaultSafeIntegers(...e),this};b.unsafeMode=function(...e){return this[d].unsafeMode(...e),this};b.getters={name:{get:function(){return this[d].name},enumerable:!0},open:{get:function(){return this[d].open},enumerable:!0},inTransaction:{get:function(){return this[d].inTransaction},enumerable:!0},readonly:{get:function(){return this[d].readonly},enumerable:!0},memory:{get:function(){return this[d].memory},enumerable:!0}}});var G=p((Ke,N)=>{"use strict";var{cppdb:we}=y(),z=new WeakMap;N.exports=function(e){if(typeof e!="function")throw new TypeError("Expected first argument to be a function");let t=this[we],o=me(t,this),{apply:i}=Function.prototype,n={default:{value:j(i,e,t,o.default)},deferred:{value:j(i,e,t,o.deferred)},immediate:{value:j(i,e,t,o.immediate)},exclusive:{value:j(i,e,t,o.exclusive)},database:{value:this,enumerable:!0}};return Object.defineProperties(n.default.value,n),Object.defineProperties(n.deferred.value,n),Object.defineProperties(n.immediate.value,n),Object.defineProperties(n.exclusive.value,n),n.default.value};var me=(r,e)=>{let t=z.get(r);if(!t){let o={commit:r.prepare("COMMIT",e,!1),rollback:r.prepare("ROLLBACK",e,!1),savepoint:r.prepare("SAVEPOINT `	_bs3.	`",e,!1),release:r.prepare("RELEASE `	_bs3.	`",e,!1),rollbackTo:r.prepare("ROLLBACK TO `	_bs3.	`",e,!1)};z.set(r,t={default:Object.assign({begin:r.prepare("BEGIN",e,!1)},o),deferred:Object.assign({begin:r.prepare("BEGIN DEFERRED",e,!1)},o),immediate:Object.assign({begin:r.prepare("BEGIN IMMEDIATE",e,!1)},o),exclusive:Object.assign({begin:r.prepare("BEGIN EXCLUSIVE",e,!1)},o)})}return t},j=(r,e,t,{begin:o,commit:i,rollback:n,savepoint:s,release:u,rollbackTo:a})=>function(){let f,h,T;t.inTransaction?(f=s,h=u,T=a):(f=o,h=i,T=n),f.run();try{let S=r.call(e,this,arguments);return h.run(),S}catch(S){throw t.inTransaction&&(T.run(),T!==n&&h.run()),S}}});var K=p((We,H)=>{"use strict";var{getBooleanOption:Ee,cppdb:Te}=y();H.exports=function(e,t){if(t==null&&(t={}),typeof e!="string")throw new TypeError("Expected first argument to be a string");if(typeof t!="object")throw new TypeError("Expected second argument to be an options object");let o=Ee(t,"simple"),i=this[Te].prepare(`PRAGMA ${e}`,this,!0);return o?i.pluck().get():i.all()}});var X=p((Qe,Q)=>{"use strict";var xe=require("fs"),Oe=require("path"),{promisify:ve}=require("util"),{cppdb:_e}=y(),W=ve(xe.access);Q.exports=async function(e,t){if(t==null&&(t={}),typeof e!="string")throw new TypeError("Expected first argument to be a string");if(typeof t!="object")throw new TypeError("Expected second argument to be an options object");e=e.trim();let o="attached"in t?t.attached:"main",i="progress"in t?t.progress:null;if(!e)throw new TypeError("Backup filename cannot be an empty string");if(e===":memory:")throw new TypeError('Invalid backup filename ":memory:"');if(typeof o!="string")throw new TypeError('Expected the "attached" option to be a string');if(!o)throw new TypeError('The "attached" option cannot be an empty string');if(i!=null&&typeof i!="function")throw new TypeError('Expected the "progress" option to be a function');await W(Oe.dirname(e)).catch(()=>{throw new TypeError("Cannot save backup because the directory does not exist")});let n=await W(e).then(()=>!1,()=>!0);return je(this[_e].backup(this,o,e,n),i||null)};var je=(r,e)=>{let t=0,o=!0;return new Promise((i,n)=>{setImmediate(function s(){try{let u=r.transfer(t);if(!u.remainingPages){r.close(),i(u);return}if(o&&(o=!1,t=100),e){let a=e(u);if(a!==void 0)if(typeof a=="number"&&a===a)t=Math.max(0,Math.min(2147483647,Math.round(a)));else throw new TypeError("Expected progress callback to return a number or undefined")}setImmediate(s)}catch(u){r.close(),n(u)}})})}});var Y=p((Xe,J)=>{"use strict";var{cppdb:Ie}=y();J.exports=function(e){if(e==null&&(e={}),typeof e!="object")throw new TypeError("Expected first argument to be an options object");let t="attached"in e?e.attached:"main";if(typeof t!="string")throw new TypeError('Expected the "attached" option to be a string');if(!t)throw new TypeError('The "attached" option cannot be an empty string');return this[Ie].serialize(t)}});var ee=p((Je,Z)=>{"use strict";var{getBooleanOption:I,cppdb:qe}=y();Z.exports=function(e,t,o){if(t==null&&(t={}),typeof t=="function"&&(o=t,t={}),typeof e!="string")throw new TypeError("Expected first argument to be a string");if(typeof o!="function")throw new TypeError("Expected last argument to be a function");if(typeof t!="object")throw new TypeError("Expected second argument to be an options object");if(!e)throw new TypeError("User-defined function name cannot be an empty string");let i="safeIntegers"in t?+I(t,"safeIntegers"):2,n=I(t,"deterministic"),s=I(t,"directOnly"),u=I(t,"varargs"),a=-1;if(!u){if(a=o.length,!Number.isInteger(a)||a<0)throw new TypeError("Expected function.length to be a positive integer");if(a>100)throw new RangeError("User-defined functions cannot have more than 100 arguments")}return this[qe].function(o,e,a,i,n,s),this}});var ne=p((Ye,re)=>{"use strict";var{getBooleanOption:q,cppdb:$e}=y();re.exports=function(e,t){if(typeof e!="string")throw new TypeError("Expected first argument to be a string");if(typeof t!="object"||t===null)throw new TypeError("Expected second argument to be an options object");if(!e)throw new TypeError("User-defined function name cannot be an empty string");let o="start"in t?t.start:null,i=R(t,"step",!0),n=R(t,"inverse",!1),s=R(t,"result",!1),u="safeIntegers"in t?+q(t,"safeIntegers"):2,a=q(t,"deterministic"),c=q(t,"directOnly"),f=q(t,"varargs"),h=-1;if(!f&&(h=Math.max(te(i),n?te(n):0),h>0&&(h-=1),h>100))throw new RangeError("User-defined functions cannot have more than 100 arguments");return this[$e].aggregate(o,i,n,s,e,h,u,a,c),this};var R=(r,e,t)=>{let o=e in r?r[e]:null;if(typeof o=="function")return o;if(o!=null)throw new TypeError(`Expected the "${e}" option to be a function`);if(t)throw new TypeError(`Missing required option "${e}"`);return null},te=({length:r})=>{if(Number.isInteger(r)&&r>=0)return r;throw new TypeError("Expected function.length to be a positive integer")}});var se=p((Ze,ae)=>{"use strict";var{cppdb:Se}=y();ae.exports=function(e,t){if(typeof e!="string")throw new TypeError("Expected first argument to be a string");if(!e)throw new TypeError("Virtual table module name cannot be an empty string");let o=!1;if(typeof t=="object"&&t!==null)o=!0,t=Ve(ie(t,"used",e));else{if(typeof t!="function")throw new TypeError("Expected second argument to be a function or a table definition object");t=Be(t)}return this[Se].table(t,e,o),this};function Be(r){return function(t,o,i,...n){let s={module:t,database:o,table:i},u=Ae.call(r,s,n);if(typeof u!="object"||u===null)throw new TypeError(`Virtual table module "${t}" did not return a table definition object`);return ie(u,"returned",t)}}function ie(r,e,t){if(!E.call(r,"rows"))throw new TypeError(`Virtual table module "${t}" ${e} a table definition without a "rows" property`);if(!E.call(r,"columns"))throw new TypeError(`Virtual table module "${t}" ${e} a table definition without a "columns" property`);let o=r.rows;if(typeof o!="function"||Object.getPrototypeOf(o)!==Fe)throw new TypeError(`Virtual table module "${t}" ${e} a table definition with an invalid "rows" property (should be a generator function)`);let i=r.columns;if(!Array.isArray(i)||!(i=[...i]).every(c=>typeof c=="string"))throw new TypeError(`Virtual table module "${t}" ${e} a table definition with an invalid "columns" property (should be an array of strings)`);if(i.length!==new Set(i).size)throw new TypeError(`Virtual table module "${t}" ${e} a table definition with duplicate column names`);if(!i.length)throw new RangeError(`Virtual table module "${t}" ${e} a table definition with zero columns`);let n;if(E.call(r,"parameters")){if(n=r.parameters,!Array.isArray(n)||!(n=[...n]).every(c=>typeof c=="string"))throw new TypeError(`Virtual table module "${t}" ${e} a table definition with an invalid "parameters" property (should be an array of strings)`)}else n=Pe(o);if(n.length!==new Set(n).size)throw new TypeError(`Virtual table module "${t}" ${e} a table definition with duplicate parameter names`);if(n.length>32)throw new RangeError(`Virtual table module "${t}" ${e} a table definition with more than the maximum number of 32 parameters`);for(let c of n)if(i.includes(c))throw new TypeError(`Virtual table module "${t}" ${e} a table definition with column "${c}" which was ambiguously defined as both a column and parameter`);let s=2;if(E.call(r,"safeIntegers")){let c=r.safeIntegers;if(typeof c!="boolean")throw new TypeError(`Virtual table module "${t}" ${e} a table definition with an invalid "safeIntegers" property (should be a boolean)`);s=+c}let u=!1;if(E.call(r,"directOnly")&&(u=r.directOnly,typeof u!="boolean"))throw new TypeError(`Virtual table module "${t}" ${e} a table definition with an invalid "directOnly" property (should be a boolean)`);return[`CREATE TABLE x(${[...n.map(oe).map(c=>`${c} HIDDEN`),...i.map(oe)].join(", ")});`,De(o,new Map(i.map((c,f)=>[c,n.length+f])),t),n,s,u]}function De(r,e,t){return function*(...i){let n=i.map(s=>Buffer.isBuffer(s)?Buffer.from(s):s);for(let s=0;s<e.size;++s)n.push(null);for(let s of r(...i))if(Array.isArray(s))ke(s,n,e.size,t),yield n;else if(typeof s=="object"&&s!==null)Re(s,n,e,t),yield n;else throw new TypeError(`Virtual table module "${t}" yielded something that isn't a valid row object`)}}function ke(r,e,t,o){if(r.length!==t)throw new TypeError(`Virtual table module "${o}" yielded a row with an incorrect number of columns`);let i=e.length-t;for(let n=0;n<t;++n)e[n+i]=r[n]}function Re(r,e,t,o){let i=0;for(let n of Object.keys(r)){let s=t.get(n);if(s===void 0)throw new TypeError(`Virtual table module "${o}" yielded a row with an undeclared column "${n}"`);e[s]=r[n],i+=1}if(i!==t.size)throw new TypeError(`Virtual table module "${o}" yielded a row with missing columns`)}function Pe({length:r}){if(!Number.isInteger(r)||r<0)throw new TypeError("Expected function.length to be a positive integer");let e=[];for(let t=0;t<r;++t)e.push(`$${t+1}`);return e}var{hasOwnProperty:E}=Object.prototype,{apply:Ae}=Function.prototype,Fe=Object.getPrototypeOf(function*(){}),oe=r=>`"${r.replace(/"/g,'""')}"`,Ve=r=>()=>r});var ce=p((et,ue)=>{"use strict";var Le=function(){};ue.exports=function(e,t){return Object.assign(new Le,this)}});var de=p((tt,pe)=>{"use strict";var Me=require("fs"),le=require("path"),$=y(),Ue=D(),fe;function l(r,e){if(new.target==null)return new l(r,e);let t;if(Buffer.isBuffer(r)&&(t=r,r=":memory:"),r==null&&(r=""),e==null&&(e={}),typeof r!="string")throw new TypeError("Expected first argument to be a string");if(typeof e!="object")throw new TypeError("Expected second argument to be an options object");if("readOnly"in e)throw new TypeError('Misspelled option "readOnly" should be "readonly"');if("memory"in e)throw new TypeError('Option "memory" was removed in v7.0.0 (use ":memory:" filename instead)');let o=r.trim(),i=o===""||o===":memory:",n=$.getBooleanOption(e,"readonly"),s=$.getBooleanOption(e,"fileMustExist"),u="timeout"in e?e.timeout:5e3,a="verbose"in e?e.verbose:null,c="nativeBinding"in e?e.nativeBinding:null;if(n&&i&&!t)throw new TypeError("In-memory/temporary databases cannot be readonly");if(!Number.isInteger(u)||u<0)throw new TypeError('Expected the "timeout" option to be a positive integer');if(u>2147483647)throw new RangeError('Option "timeout" cannot be greater than 2147483647');if(a!=null&&typeof a!="function")throw new TypeError('Expected the "verbose" option to be a function');if(c!=null&&typeof c!="string"&&typeof c!="object")throw new TypeError('Expected the "nativeBinding" option to be a string or addon object');let f;if(c==null?f=fe||(fe=U()("better_sqlite3.node")):typeof c=="string"?f=(typeof __non_webpack_require__=="function"?__non_webpack_require__:require)(le.resolve(c).replace(/(\.node)?$/,".node")):f=c,f.isInitialized||(f.setErrorConstructor(Ue),f.isInitialized=!0),!i&&!Me.existsSync(le.dirname(o)))throw new TypeError("Cannot open database because the directory does not exist");Object.defineProperties(this,{[$.cppdb]:{value:new f.Database(o,r,i,n,s,u,a||null,t||null)},...g.getters})}var g=C();l.prototype.prepare=g.prepare;l.prototype.transaction=G();l.prototype.pragma=K();l.prototype.backup=X();l.prototype.serialize=Y();l.prototype.function=ee();l.prototype.aggregate=ne();l.prototype.table=se();l.prototype.loadExtension=g.loadExtension;l.prototype.exec=g.exec;l.prototype.key=g.key;l.prototype.rekey=g.rekey;l.prototype.close=g.close;l.prototype.defaultSafeIntegers=g.defaultSafeIntegers;l.prototype.unsafeMode=g.unsafeMode;l.prototype[$.inspect]=ce();pe.exports=l});module.exports=de();module.exports.SqliteError=D();
